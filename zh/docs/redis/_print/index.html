<!doctype html>
<html itemscope itemtype="http://schema.org/WebPage" lang="zh" class="no-js">
  <head>
    <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link rel="canonical" type="text/html" href="/zh/docs/redis/">
<link rel="alternate" type="application/rss&#43;xml" href="/zh/docs/redis/index.xml">
<meta name="robots" content="noindex, nofollow">


<link rel="shortcut icon" href="/favicons/favicon.ico" >
<link rel="apple-touch-icon" href="/favicons/apple-touch-icon-180x180.png" sizes="180x180">
<link rel="icon" type="image/png" href="/favicons/favicon-16x16.png" sizes="16x16">
<link rel="icon" type="image/png" href="/favicons/favicon-32x32.png" sizes="32x32">
<link rel="icon" type="image/png" href="/favicons/android-36x36.png" sizes="36x36">
<link rel="icon" type="image/png" href="/favicons/android-48x48.png" sizes="48x48">
<link rel="icon" type="image/png" href="/favicons/android-72x72.png" sizes="72x72">
<link rel="icon" type="image/png" href="/favicons/android-96x96.png" sizes="96x96">
<link rel="icon" type="image/png" href="/favicons/android-144x144.png" sizes="144x144">
<link rel="icon" type="image/png" href="/favicons/android-192x192.png" sizes="192x192">

<title>模块：REDIS | Pigsty</title>
<meta name="description" content="Pigsty 内置了 Redis 支持，开源高性能缓存，可作为 PostgreSQL 的辅助与补充，支持主从、集群、哨兵三种模式。">
<meta property="og:title" content="模块：REDIS" />
<meta property="og:description" content="Pigsty 内置了 Redis 支持，开源高性能缓存，可作为 PostgreSQL 的辅助与补充，支持主从、集群、哨兵三种模式。" />
<meta property="og:type" content="website" />
<meta property="og:url" content="/zh/docs/redis/" />

<meta itemprop="name" content="模块：REDIS">
<meta itemprop="description" content="Pigsty 内置了 Redis 支持，开源高性能缓存，可作为 PostgreSQL 的辅助与补充，支持主从、集群、哨兵三种模式。"><meta name="twitter:card" content="summary"/><meta name="twitter:title" content="模块：REDIS"/>
<meta name="twitter:description" content="Pigsty 内置了 Redis 支持，开源高性能缓存，可作为 PostgreSQL 的辅助与补充，支持主从、集群、哨兵三种模式。"/>




<link rel="preload" href="/scss/main.min.194607c777ee31a481a26dfc3d1c65134dfc8eb296a0aae9d353b3bd5be6a683.css" as="style">
<link href="/scss/main.min.194607c777ee31a481a26dfc3d1c65134dfc8eb296a0aae9d353b3bd5be6a683.css" rel="stylesheet" integrity="">

<script
  src="/js/jquery-3.6.3.min.js"
  integrity="sha512-STof4xm1wgkfm7heWqFJVn58Hm3EtS31XFaagaa8VMReCXAkQnJZ+jEy8PCC/iT18dFy95WcExNHFTqLyp72eQ=="
  crossorigin="anonymous"></script>
<script defer
  src="/js/lunr.min.js"
  integrity="sha384-203J0SNzyqHby3iU6hzvzltrWi/M41wOP5Gu+BiJMz5nwKykbkUx8Kp7iti0Lpli"
  crossorigin="anonymous"></script>
<script async src="https://www.googletagmanager.com/gtag/js?id=G-LG1V9WTKGE"></script>
<script>
var doNotTrack = false;
if (!doNotTrack) {
	window.dataLayer = window.dataLayer || [];
	function gtag(){dataLayer.push(arguments);}
	gtag('js', new Date());
	gtag('config', 'G-LG1V9WTKGE');
}
</script>
  </head>
  <body class="td-section">
    <header>
      <nav class="td-navbar navbar-dark js-navbar-scroll">
<div class="container-fluid flex-column flex-md-row">
  <a class="navbar-brand" href="/zh/"><span class="navbar-brand__logo navbar-logo"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xl="http://www.w3.org/1999/xlink" xmlns:dc="http://purl.org/dc/elements/1.1/" viewBox="0 0 24 24" width="24" height="24"><defs/><g id="32" fill="none" stroke-dasharray="none" fill-opacity="1" stroke-opacity="1" stroke="none"><title>32</title><g id="32_图层_2"><title>图层 2</title><g id="Group_17"><g id="Graphic_16"/><g id="Graphic_15"><path d="M7.666187 11.971335l2.165064-3.75H14.16138l2.165065 3.75-2.165065 3.75H9.831251z" fill="#bbb" fill-opacity=".9526367"/><path d="M7.666187 11.971335l2.165064-3.75H14.16138l2.165065 3.75-2.165065 3.75H9.831251z" stroke="#fff" stroke-linecap="round" stroke-linejoin="round" stroke-width=".6730434"/></g><g id="Graphic_14"><path d="M7.666187 19.474806l2.165064-3.75H14.16138l2.165065 3.75-2.165065 3.75H9.831251z" fill="#de372c" fill-opacity=".8545852"/><path d="M7.666187 19.474806l2.165064-3.75H14.16138l2.165065 3.75-2.165065 3.75H9.831251z" stroke="#fff" stroke-linecap="round" stroke-linejoin="round" stroke-width=".6730434"/></g><g id="Graphic_13"><path d="M14.161476 15.751202l2.165064-3.75h4.33013l2.165064 3.75-2.165064 3.75H16.32654z" fill="#424242" fill-opacity=".9016462"/><path d="M14.161476 15.751202l2.165064-3.75h4.33013l2.165064 3.75-2.165064 3.75H16.32654z" stroke="#fff" stroke-linecap="round" stroke-linejoin="round" stroke-width=".6730434"/></g><g id="Graphic_12"><path d="M14.161476 8.226008 16.32654 4.4760076h4.33013L22.821734 8.226008l-2.165064 3.75H16.32654z" fill="#ffa269" fill-opacity=".8975772"/><path d="M14.161476 8.226008 16.32654 4.4760076h4.33013L22.821734 8.226008l-2.165064 3.75H16.32654z" stroke="#fff" stroke-linecap="round" stroke-linejoin="round" stroke-width=".6730434"/></g><g id="Graphic_11"><path d="M7.666187 4.5 9.831251.75H14.16138L16.326445 4.5 14.16138 8.25H9.831251z" fill="#419edb" fill-opacity=".8979957"/><path d="M7.666187 4.5 9.831251.75H14.16138L16.326445 4.5 14.16138 8.25H9.831251z" stroke="#fff" stroke-linecap="round" stroke-linejoin="round" stroke-width=".6730434"/></g><g id="Graphic_10"><path d="M1.1491742 8.226008 3.3142388 4.4760076H7.644368L9.809432 8.226008l-2.165064 3.75H3.3142388z" fill="#2f6793" fill-opacity=".9002511"/><path d="M1.1491742 8.226008 3.3142388 4.4760076H7.644368L9.809432 8.226008l-2.165064 3.75H3.3142388z" stroke="#fff" stroke-linecap="round" stroke-linejoin="round" stroke-width=".6730434"/></g><g id="Graphic_9"><path d="M1.182071 15.741036l2.1650645-3.75h4.330129l2.1650645 3.75-2.1650645 3.75H3.3471355z" fill="#53ac79" fill-opacity=".9"/><path d="M1.182071 15.741036l2.1650645-3.75h4.330129l2.1650645 3.75-2.1650645 3.75H3.3471355z" stroke="#fff" stroke-linecap="round" stroke-linejoin="round" stroke-width=".6730434"/></g></g></g></g></svg></span><span class="navbar-brand__name">Pigsty</span></a>
  <div class="td-navbar-nav-scroll ms-md-auto" id="main_navbar">
    <ul class="navbar-nav">
      <li class="nav-item">
        <a class="nav-link active" href="/zh/docs/"><i class='fa-solid fa-book'></i><span>文档</span></a>
      </li>
      <li class="nav-item">
        <a class="nav-link" href="/zh/blog/"><i class="fas fa-blog"></i><span>博客</span></a>
      </li>
      <li class="nav-item">
        <a class="nav-link" href="https://github.com/Vonng/pigsty/" target="_blank" rel="noopener"><i class='fab fa-github'></i><span>GitHub</span></a>
      </li>
      <li class="nav-item dropdown d-none d-lg-block">
        <div class="dropdown">
  <a class="nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
      <i class="fa-solid fa-language"></i>中文</a>
  <ul class="dropdown-menu">
    <li><a class="dropdown-item" href="/docs/redis/">English</a></li>
    </ul>
</div>
</li>
      </ul>
  </div>
  <div class="d-none d-lg-block">
    <div class="td-search td-search--offline">
  <div class="td-search__icon"></div>
  <input
    type="search"
    class="td-search__input form-control"
    placeholder="Search this site…"
    aria-label="Search this site…"
    autocomplete="off"
    
    data-offline-search-index-json-src="/offline-search-index.b696ec90cb9c07b2c457007bd806beb7.json"
    data-offline-search-base-href="/"
    data-offline-search-max-results="10"
  >
</div>
  </div>
</div>
</nav>
    </header>
    <div class="container-fluid td-outer">
      <div class="td-main">
        <div class="row flex-xl-nowrap">
          <main class="col-12 col-md-9 col-xl-8 ps-md-5" role="main">
            




<div class="td-content">
<div class="pageinfo pageinfo-primary d-print-none">
<p>
This is the multi-page printable view of this section.
<a href="#" onclick="print();return false;">Click here to print</a>.
</p><p>
<a href="/zh/docs/redis/">Return to the regular view of this page</a>.
</p>
</div>



<h1 class="title">模块：REDIS</h1>
<div class="lead">Pigsty 内置了 Redis 支持，开源高性能缓存，可作为 PostgreSQL 的辅助与补充，支持主从、集群、哨兵三种模式。</div>




    <ul>
    
  
  
  
  

  
    
    
	
<li>1: <a href="#pg-fc15b08dead0af0ef0581be1e78f1089">集群配置</a></li>


    
  
    
    
	
<li>2: <a href="#pg-107d691b6855a16e3959ebbb20893769">参数列表</a></li>


    
  
    
    
	
<li>3: <a href="#pg-a4ac99db4d7e939afec8be333eb8e254">预置剧本</a></li>


    
  
    
    
	
<li>4: <a href="#pg-d30f775631874dbea209c56a3cf88d88">管理预案</a></li>


    
  
    
    
	
<li>5: <a href="#pg-81482490a3974d936d1dca668f5c2d09">监控告警</a></li>


    
  
    
    
	
<li>6: <a href="#pg-5bcac294a078899a139a79dc1fb2b009">指标列表</a></li>


    
  
    
    
	
<li>7: <a href="#pg-b2e89e0d2e5fa7361edacff6f86e00ea">常见问题</a></li>


    
  

    </ul>


<div class="content">
      <p>Redis是广受喜爱的开源高性能内存数据结构服务器，PostgreSQL 的好伙伴。Pigsty 中的 Redis 版本锁定在最后一个使用 BSD 协议的 7.2.6 版本。</p>
<p><a href="/zh/docs/redis/#配置">配置</a> | <a href="/zh/docs/redis/#剧本">剧本</a> | <a href="/zh/docs/redis/#管理">管理</a> | <a href="/zh/docs/redis/#监控">监控</a> | <a href="/zh/docs/redis/#参数">参数</a></p>
<hr>
<h2 id="概念">概念</h2>
<p>Redis的实体概念模型与<a href="/zh/docs/pgsql/arch#%E5%AE%9E%E4%BD%93%E6%A6%82%E5%BF%B5%E5%9B%BE">PostgreSQL</a>几乎相同，同样包括 <strong>集群（Cluster）</strong> 与 <strong>实例（Instance）</strong> 的概念。注意这里的Cluster指的不是Redis原生集群方案中的集群。</p>
<p>REDIS模块与PGSQL模块核心的区别在于，Redis通常采用 <strong>单机多实例</strong> 部署，而不是 PostgreSQL 的 1:1 部署：一个物理/虚拟机节点上通常会部署 <strong>多个</strong> Redis实例，以充分利用多核CPU。因此<a href="/zh/docs/redis/#配置">配置</a>和<a href="/zh/docs/redis/#管理">管理</a>Redis实例的方式与PGSQL稍有不同。</p>
<p>在Pigsty管理的Redis中，节点完全隶属于集群，即目前尚不允许在一个节点上部署两个不同集群的Redis实例，但这并不影响您在在一个节点上部署多个独立 Redis 主从实例。当然这样也会有一些局限性，例如在这种情况下您就无法为同一个节点上的不同实例指定不同的密码了。</p>
<hr>
<h2 id="配置">配置</h2>
<p><strong>身份参数</strong></p>
<p>Redis <a href="/zh/docs/reference/param#redis_id"><strong>身份参数</strong></a> 是定义Redis集群时必须提供的信息，包括：</p>
<table>
<thead>
<tr>
<th style="text-align:center">名称</th>
<th style="text-align:center">属性</th>
<th style="text-align:center">说明</th>
<th style="text-align:center">例子</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center"><a href="/zh/docs/reference/param#redis_cluster"><code>redis_cluster</code></a></td>
<td style="text-align:center"><strong>必选</strong>，集群级别</td>
<td style="text-align:center">集群名</td>
<td style="text-align:center"><code>redis-test</code></td>
</tr>
<tr>
<td style="text-align:center"><a href="/zh/docs/reference/param#redis_node"><code>redis_node</code></a></td>
<td style="text-align:center"><strong>必选</strong>，节点级别</td>
<td style="text-align:center">节点号</td>
<td style="text-align:center"><code>1</code>,<code>2</code></td>
</tr>
<tr>
<td style="text-align:center"><a href="/zh/docs/reference/param#redis_instances"><code>redis_instances</code></a></td>
<td style="text-align:center"><strong>必选</strong>，节点级别</td>
<td style="text-align:center">实例定义</td>
<td style="text-align:center"><code>{ 6001 : {} ,6002 : {}}</code></td>
</tr>
</tbody>
</table>
<ul>
<li><a href="/zh/docs/reference/param#redis_cluster"><code>redis_cluster</code></a>：Redis集群名称，作为集群资源的顶层命名空间。</li>
<li><a href="/zh/docs/reference/param#redis_node"><code>redis_node</code></a>：Redis节点标号，整数，在集群内唯一，用于区分不同节点。</li>
<li><a href="/zh/docs/reference/param#redis_instances"><code>redis_instances</code></a>：JSON对象，Key为实例端口号，Value为包含实例其他配置JSON对象。</li>
</ul>
<p><strong>工作模式</strong></p>
<p>Redis有三种不同的工作模式，由 <a href="/zh/docs/reference/param#redis_mode"><code>redis_mode</code></a> 参数指定：</p>
<ul>
<li><code>standalone</code>：默认的独立主从模式</li>
<li><code>cluster</code>：Redis原生分布式集群模式</li>
<li><code>sentinel</code>：哨兵模式，可以为主从模式的 Redis 提供高可用能力</li>
</ul>
<p>下面给出了三种Redis集群的定义样例：</p>
<ul>
<li>一个1节点，一主一从的 Redis Standalone 集群：<code>redis-ms</code></li>
<li>一个1节点，3实例的Redis Sentinel集群：<code>redis-sentinel</code></li>
<li>一个2节点，6实例的的 Redis Cluster集群： <code>redis-cluster</code></li>
</ul>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">redis-ms</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#8f5902;font-style:italic"># redis 经典主从集群</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">hosts</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span>{<span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">10.10.10.10</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span>{<span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">redis_node: 1 , redis_instances</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span>{<span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">6379</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span>{<span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">}, 6380</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span>{<span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">replica_of</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#39;10.10.10.10 6379&#39;</span><span style="color:#f8f8f8;text-decoration:underline"> </span>}<span style="color:#f8f8f8;text-decoration:underline"> </span>}<span style="color:#f8f8f8;text-decoration:underline"> </span>}<span style="color:#f8f8f8;text-decoration:underline"> </span>}<span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">vars</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span>{<span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">redis_cluster: redis-ms ,redis_password: &#39;redis.ms&#39; ,redis_max_memory</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">64MB }</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:bold">redis-meta</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#8f5902;font-style:italic"># redis 哨兵 x 3</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">hosts</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span>{<span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">10.10.10.11</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span>{<span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">redis_node: 1 , redis_instances</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span>{<span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">26379</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span>{<span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">} ,26380</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span>{<span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">} ,26381</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span>{<span style="color:#f8f8f8;text-decoration:underline"> </span>}<span style="color:#f8f8f8;text-decoration:underline"> </span>}<span style="color:#f8f8f8;text-decoration:underline"> </span>}<span style="color:#f8f8f8;text-decoration:underline"> </span>}<span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">vars</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">redis_cluster</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">redis-meta</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">redis_password</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#39;redis.meta&#39;</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">redis_mode</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">sentinel</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">redis_max_memory</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">16MB</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">redis_sentinel_monitor</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#8f5902;font-style:italic"># primary list for redis sentinel, use cls as name, primary ip:port</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span>- {<span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">name: redis-ms, host: 10.10.10.10, port: 6379 ,password: redis.ms, quorum</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#0000cf;font-weight:bold">2</span><span style="color:#f8f8f8;text-decoration:underline"> </span>}<span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:bold">redis-test</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#8f5902;font-style:italic"># redis 原生集群： 3主 x 3从</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">hosts</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">10.10.10.12</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span>{<span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">redis_node: 1 ,redis_instances</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span>{<span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">6379</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span>{<span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">} ,6380</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span>{<span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">} ,6381</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span>{<span style="color:#f8f8f8;text-decoration:underline"> </span>}<span style="color:#f8f8f8;text-decoration:underline"> </span>}<span style="color:#f8f8f8;text-decoration:underline"> </span>}<span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">10.10.10.13</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span>{<span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">redis_node: 2 ,redis_instances</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span>{<span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">6379</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span>{<span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">} ,6380</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span>{<span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">} ,6381</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span>{<span style="color:#f8f8f8;text-decoration:underline"> </span>}<span style="color:#f8f8f8;text-decoration:underline"> </span>}<span style="color:#f8f8f8;text-decoration:underline"> </span>}<span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">vars</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span>{<span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">redis_cluster: redis-test ,redis_password: &#39;redis.test&#39; ,redis_mode: cluster, redis_max_memory</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">32MB }</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span></code></pre></div><p><strong>局限性</strong></p>
<ul>
<li>一个节点只能属于一个 Redis 集群，这意味着您不能将一个节点同时分配给两个不同的Redis集群。</li>
<li>在每个 Redis 节点上，您需要为 Redis实例 分配唯一的端口号，避免端口冲突。</li>
<li>通常同一个 Reids 集群会使用同一个密码，但一个 Redis节点上的多个 Redis 实例无法设置不同的密码（因为 redis_exporter 只允许使用一个密码0</li>
<li>Redis Cluster自带高可用，而Redis主从的高可用需要在 Sentinel 中额外进行手工配置：因为我们不知道您是否会部署 Sentinel。</li>
<li>好在配置 Redis 主从实例的高可用非常简单，可以通过Sentinel进行配置，详情请参考<a href="/zh/docs/redis/#管理">管理-设置Redis主从高可用</a></li>
</ul>
<hr>
<h2 id="剧本">剧本</h2>
<p>REDIS模块提供了两个<a href="/zh/docs/setup/playbook">剧本</a>，用于拉起/销毁 传统主从Redis集群/节点/实例：</p>
<ul>
<li><a href="/zh/docs/redis/#redisyml"><code>redis.yml</code></a>：初始Redis集群/节点/实例。</li>
<li><a href="/zh/docs/redis/#redis-rmyml"><code>redis-rm.yml</code></a>：移除Redis集群/节点/实例</li>
</ul>
<h3 id="redisyml"><code>redis.yml</code></h3>
<p>用于初始化 Redis 的 <a href="https://github.com/Vonng/pigsty/blob/main/redis.yml"><code>redis.yml</code></a> 剧本包含以下子任务：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>redis_node        : 初始化redis节点
</span></span><span style="display:flex;"><span>  - redis_install : 安装redis <span style="color:#000;font-weight:bold">&amp;</span> redis_exporter
</span></span><span style="display:flex;"><span>  - redis_user    : 创建操作系统用户 redis
</span></span><span style="display:flex;"><span>  - redis_dir     : 配置 redis的FHS目录结构
</span></span><span style="display:flex;"><span>redis_exporter    : 配置 redis_exporter 监控
</span></span><span style="display:flex;"><span>  - redis_exporter_config  : 生成redis_exporter配置
</span></span><span style="display:flex;"><span>  - redis_exporter_launch  : 启动redis_exporter
</span></span><span style="display:flex;"><span>redis_instance    : 停止并禁用redis集群/节点/实例
</span></span><span style="display:flex;"><span>  - redis_check   : 检查redis实例是否存在
</span></span><span style="display:flex;"><span>  - redis_clean   : 清除现有的redis实例
</span></span><span style="display:flex;"><span>  - redis_config  : 生成redis实例配置
</span></span><span style="display:flex;"><span>  - redis_launch  : 启动redis实例
</span></span><span style="display:flex;"><span>redis_register    : 将redis注册到基础设施中
</span></span><span style="display:flex;"><span>redis_ha          : 配置redis哨兵
</span></span><span style="display:flex;"><span>redis_join        : 加入redis集群
</span></span></code></pre></div><details><summary>示例：使用Redis剧本初始化Redis集群</summary>
<p><a href="https://asciinema.org/a/568808"><img alt="asciicast" src="https://asciinema.org/a/568808.svg"></a></p>
</details>
<h3 id="redis-rmyml"><code>redis-rm.yml</code></h3>
<p>用于卸载 Redis 的 <a href="https://github.com/Vonng/pigsty/blob/main/redis.yml"><code>redis-rm.yml</code></a> 剧本包含以下子任务：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>register       : 从prometheus中移除监控目标
</span></span><span style="display:flex;"><span>redis_exporter : 停止并禁用redis_exporter
</span></span><span style="display:flex;"><span>redis          : 停止并禁用redis集群/节点/实例
</span></span><span style="display:flex;"><span>redis_data     : 移除redis数据（rdb, aof）
</span></span><span style="display:flex;"><span>redis_pkg      : 卸载redis <span style="color:#000;font-weight:bold">&amp;</span> redis_exporter软件包
</span></span></code></pre></div><hr>
<h2 id="监控">监控</h2>
<p>Pigsty 提供了三个与 <a href="/zh/docs/redis"><code>REDIS</code></a> 模块有关的监控仪表盘：</p>
<hr>
<h3 id="redis-overview">Redis Overview</h3>
<p><a href="https://demo.pigsty.cc/d/redis-overview">Redis Overview</a>：关于所有Redis集群/实例的详细信息</p>
<p><a href="https://demo.pigsty.cc/d/redis-overview"><img alt="redis-overview.jpg" src="/img/dashboard/redis-overview.jpg"></a></p>
<hr>
<h3 id="redis-cluster">Redis Cluster</h3>
<p><a href="https://demo.pigsty.cc/d/redis-cluster">Redis Cluster</a>：关于单个Redis集群的详细信息</p>
<details><summary>Redis Cluster Dashboard</summary>
<p><a href="https://demo.pigsty.cc/d/redis-cluster"><img alt="redis-cluster.jpg" src="/img/dashboard/redis-cluster.jpg"></a></p>
</details><br>
<hr>
<h3 id="redis-instance">Redis Instance</h3>
<p><a href="https://demo.pigsty.cc/d/redis-instance">Redis Instance</a>： 关于单个Redis实例的详细信息</p>
<details><summary>Redis Instance Dashboard</summary>
<p><a href="https://demo.pigsty.cc/d/redis-instance"><img alt="redis-instance" src="/img/dashboard/redis-instance.jpg"></a></p>
</details><br>

</div>
</div>


  
  
  
  

  
  

  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-fc15b08dead0af0ef0581be1e78f1089">1 - 集群配置</h1>
    <div class="lead">根据需求场景选择合适的 Etcd 集群规模，并对外提供可靠的接入。</div>
	<p>在部署 Etcd 之前，你需要在 <a href="/zh/docs/setup/config">配置清单</a> 中定义一个 Etcd 集群，通常来说，你可以选择：</p>
<ul>
<li><a href="/zh/docs/redis/config/#单节点">单节点</a>，没有高可用性，适用于开发、测试、演示，或者依赖外部S3备份进行PITR的无高可用单机部署。</li>
<li><a href="/zh/docs/redis/config/#三节点">三节点</a>，具有基本的高可用性，可以容忍一个节点的故障，适用于中小规模的生产环境</li>
<li><a href="/zh/docs/redis/config/#五节点">五节点</a>，具有更好的高可用性，可以容忍两个节点的故障，适用于大规模生产环境。</li>
</ul>
<p>偶数节点的 Etcd 集群没有意义，超过五节点的 Etcd 集群并不常见，因此通常使用的规格就是单节点，三节点，五节点。</p>
<hr>
<h2 id="单节点">单节点</h2>
<p>在 Pigsty 中，定义一个单例 Etcd 实例非常简单，只需要一行配置即可：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">etcd</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span>{<span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">hosts</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span>{<span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">10.10.10.10</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span>{<span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">etcd_seq: 1 } }, vars</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span>{<span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">etcd_cluster</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">etcd } }</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span></code></pre></div><p>在 Pigsty 提供的所有单机配置模板中，都有这样一项，其中的占位 IP 地址：<code>10.10.10.10</code> 默认会被替换为当前管理节点的 IP。</p>
<p>除了 IP 地址外，这里唯一必要的参数是 <a href="/zh/docs/redis/param/#etcd_seq"><code>etcd_seq</code></a> 和 <a href="/zh/docs/redis/param/#etcd_cluster"><code>etcd_cluster</code></a>，它们会唯一标识每一个 Etcd 实例。</p>
<hr>
<h2 id="三节点">三节点</h2>
<p>三节点的 Etcd 集群最为常见，它可以容忍一个节点的故障，适用于中小规模的生产环境。</p>
<p>例如，Pigsty 的三节点模板：<a href="/zh/docs/conf/trio"><code>trio</code></a> 和 <a href="/zh/docs/conf/safe"><code>safe</code></a> 就使用了三节点的 Etcd 集群，如下所示：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">etcd</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> 
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">hosts</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">10.10.10.10</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span>{<span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">etcd_seq</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#0000cf;font-weight:bold">1</span><span style="color:#f8f8f8;text-decoration:underline"> </span>}<span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#8f5902;font-style:italic"># etcd_seq （etcd实例号）是必须指定的身份参数</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">10.10.10.11</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span>{<span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">etcd_seq</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#0000cf;font-weight:bold">2</span><span style="color:#f8f8f8;text-decoration:underline"> </span>}<span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#8f5902;font-style:italic"># 实例号是正整数，一般从 0 或 1 开始依次分配</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">10.10.10.12</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span>{<span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">etcd_seq</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#0000cf;font-weight:bold">3</span><span style="color:#f8f8f8;text-decoration:underline"> </span>}<span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#8f5902;font-style:italic"># 实例号应当终生不可变，一旦分配就不再回收使用。</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">vars</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#8f5902;font-style:italic"># 集群层面的参数</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">etcd_cluster</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">etcd   </span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#8f5902;font-style:italic"># 默认情况下，etcd集群名就叫 etcd， 除非您想要部署多套 etcd 集群，否则不要改这个名字</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">etcd_safeguard</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">false</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#8f5902;font-style:italic"># 是否打开 etcd 的防误删安全保险？ 在生产环境初始化完成后，可以考虑打开这个选项，避免误删。</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">etcd_clean</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">true</span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#8f5902;font-style:italic"># 在初始化过程中，是否强制移除现有的 etcd 实例？测试的时候可以打开，这样剧本就是真正幂等的。</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span></code></pre></div><hr>
<h2 id="五节点">五节点</h2>
<p>五节点的 Etcd 集群可以容忍两个节点的故障，适用于大规模生产环境。</p>
<p>例如，Pigsty 的生产仿真模板：<a href="/zh/docs/conf/prod"><code>prod</code></a> 中就使用了一个五节点的 Etcd 集群：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">etcd</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">hosts</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">10.10.10.21 </span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span>{<span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">etcd_seq</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#0000cf;font-weight:bold">1</span><span style="color:#f8f8f8;text-decoration:underline"> </span>}<span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">10.10.10.22 </span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span>{<span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">etcd_seq</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#0000cf;font-weight:bold">2</span><span style="color:#f8f8f8;text-decoration:underline"> </span>}<span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">10.10.10.23 </span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span>{<span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">etcd_seq</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#0000cf;font-weight:bold">3</span><span style="color:#f8f8f8;text-decoration:underline"> </span>}<span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">10.10.10.24 </span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span>{<span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">etcd_seq</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#0000cf;font-weight:bold">4</span><span style="color:#f8f8f8;text-decoration:underline"> </span>}<span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">10.10.10.25 </span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span>{<span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">etcd_seq</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#0000cf;font-weight:bold">5</span><span style="color:#f8f8f8;text-decoration:underline"> </span>}<span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">vars</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span>{<span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">etcd_cluster</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">etcd    }</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span></code></pre></div><hr>
<h2 id="使用etcd的服务">使用Etcd的服务</h2>
<p>目前使用 Etcd 的服务有：</p>
<ul>
<li>patroni: 用于 PostgreSQL 高可用，Etcd 的配置将填入 Patroni 配置文件。</li>
<li>vip-manager: 用于在 PostgreSQL 集群上绑定一个可选的 L2 VIP，会从 Etcd 中读取集群的领导者信息。</li>
</ul>
<p>当 etcd 集群的成员信息发生永久性变更时，您应当 <a href="/zh/docs/redis/admin/#重载配置">重载相关服务的配置</a>，以确保服务能够正确访问 Etcd 集群。</p>
<p>在 <code>patroni</code> 上更新 etcd 端点引用：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>./pgsql.yml -t pg_conf                            <span style="color:#8f5902;font-style:italic"># 重新生成 patroni 配置</span>
</span></span><span style="display:flex;"><span>ansible all -f <span style="color:#0000cf;font-weight:bold">1</span> -b -a <span style="color:#4e9a06">&#39;systemctl reload patroni&#39;</span> <span style="color:#8f5902;font-style:italic"># 重新加载 patroni 配置</span>
</span></span></code></pre></div><p>在 <code>vip-manager</code> 上更新 etcd 端点引用（如果你正在使用 PGSQL L2 VIP 才需要执行此操作）：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>./pgsql.yml -t pg_vip_config                           <span style="color:#8f5902;font-style:italic"># 重新生成 vip-manager 配置</span>
</span></span><span style="display:flex;"><span>ansible all -f <span style="color:#0000cf;font-weight:bold">1</span> -b -a <span style="color:#4e9a06">&#39;systemctl restart vip-manager&#39;</span> <span style="color:#8f5902;font-style:italic"># 重启 vip-manager 以使用新配置 </span>
</span></span></code></pre></div><br>
<hr>
<br>

</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-107d691b6855a16e3959ebbb20893769">2 - 参数列表</h1>
    <div class="lead">Etcd 模块提供了 10 个相关配置参数，用于定制所需的 Etcd 集群。</div>
	<p>ETCD 是一个分布式的、可靠的键-值存储，用于存放系统中最为关键的数据。在 Pigsty 中，etcd 作为高可用组件 Patroni 使用的 DCS，它对于 PG 的高可用非常重要。</p>
<p>Pigsty 为 etcd 集群使用一个硬编码的默认集群组名 <code>etcd</code>，它可以是一套现有的外部 etcd 集群，或者是默认由 Pigsty 使用 <a href="/zh/docs/redis/playbook/#etcdyml">etcd.yml</a> 剧本部署创建的新etcd集群。</p>
<hr>
<h2 id="参数列表">参数列表</h2>
<p>Pigsty 中有 21 个关于 Redis 模块的配置参数：</p>
<table>
<thead>
<tr>
<th>参数</th>
<th style="text-align:center">类型</th>
<th style="text-align:center">级别</th>
<th>注释</th>
</tr>
</thead>
<tbody>
<tr>
<td><a href="/zh/docs/redis/param/#redis_cluster"><code>redis_cluster</code></a></td>
<td style="text-align:center">string</td>
<td style="text-align:center">C</td>
<td>Redis数据库集群名称，必选身份参数</td>
</tr>
<tr>
<td><a href="/zh/docs/redis/param/#redis_instances"><code>redis_instances</code></a></td>
<td style="text-align:center">dict</td>
<td style="text-align:center">I</td>
<td>Redis节点上的实例定义</td>
</tr>
<tr>
<td><a href="/zh/docs/redis/param/#redis_node"><code>redis_node</code></a></td>
<td style="text-align:center">int</td>
<td style="text-align:center">I</td>
<td>Redis节点编号，正整数，集群内唯一，必选身份参数</td>
</tr>
<tr>
<td><a href="/zh/docs/redis/param/#redis_fs_main"><code>redis_fs_main</code></a></td>
<td style="text-align:center">path</td>
<td style="text-align:center">C</td>
<td>Redis主数据目录，默认为 <code>/data</code></td>
</tr>
<tr>
<td><a href="/zh/docs/redis/param/#redis_exporter_enabled"><code>redis_exporter_enabled</code></a></td>
<td style="text-align:center">bool</td>
<td style="text-align:center">C</td>
<td>Redis Exporter 是否启用？</td>
</tr>
<tr>
<td><a href="/zh/docs/redis/param/#redis_exporter_port"><code>redis_exporter_port</code></a></td>
<td style="text-align:center">port</td>
<td style="text-align:center">C</td>
<td>Redis Exporter监听端口</td>
</tr>
<tr>
<td><a href="/zh/docs/redis/param/#redis_exporter_options"><code>redis_exporter_options</code></a></td>
<td style="text-align:center">string</td>
<td style="text-align:center">C/I</td>
<td>Redis Exporter命令参数</td>
</tr>
<tr>
<td><a href="/zh/docs/redis/param/#redis_safeguard"><code>redis_safeguard</code></a></td>
<td style="text-align:center">bool</td>
<td style="text-align:center">G/C/A</td>
<td>禁止抹除现存的Redis</td>
</tr>
<tr>
<td><a href="/zh/docs/redis/param/#redis_clean"><code>redis_clean</code></a></td>
<td style="text-align:center">bool</td>
<td style="text-align:center">G/C/A</td>
<td>初始化Redis是否抹除现存实例</td>
</tr>
<tr>
<td><a href="/zh/docs/redis/param/#redis_rmdata"><code>redis_rmdata</code></a></td>
<td style="text-align:center">bool</td>
<td style="text-align:center">G/C/A</td>
<td>移除Redis实例时是否一并移除数据？</td>
</tr>
<tr>
<td><a href="/zh/docs/redis/param/#redis_mode"><code>redis_mode</code></a></td>
<td style="text-align:center">enum</td>
<td style="text-align:center">C</td>
<td>Redis集群模式：sentinel，cluster，standalone</td>
</tr>
<tr>
<td><a href="/zh/docs/redis/param/#redis_conf"><code>redis_conf</code></a></td>
<td style="text-align:center">string</td>
<td style="text-align:center">C</td>
<td>Redis配置文件模板，sentinel 除外</td>
</tr>
<tr>
<td><a href="/zh/docs/redis/param/#redis_bind_address"><code>redis_bind_address</code></a></td>
<td style="text-align:center">ip</td>
<td style="text-align:center">C</td>
<td>Redis监听地址，默认留空则会绑定主机IP</td>
</tr>
<tr>
<td><a href="/zh/docs/redis/param/#redis_max_memory"><code>redis_max_memory</code></a></td>
<td style="text-align:center">size</td>
<td style="text-align:center">C/I</td>
<td>Redis可用的最大内存</td>
</tr>
<tr>
<td><a href="/zh/docs/redis/param/#redis_mem_policy"><code>redis_mem_policy</code></a></td>
<td style="text-align:center">enum</td>
<td style="text-align:center">C</td>
<td>Redis内存逐出策略</td>
</tr>
<tr>
<td><a href="/zh/docs/redis/param/#redis_password"><code>redis_password</code></a></td>
<td style="text-align:center">password</td>
<td style="text-align:center">C</td>
<td>Redis密码，默认留空则禁用密码</td>
</tr>
<tr>
<td><a href="/zh/docs/redis/param/#redis_rdb_save"><code>redis_rdb_save</code></a></td>
<td style="text-align:center">string[]</td>
<td style="text-align:center">C</td>
<td>Redis RDB 保存指令，字符串列表，空数组则禁用RDB</td>
</tr>
<tr>
<td><a href="/zh/docs/redis/param/#redis_aof_enabled"><code>redis_aof_enabled</code></a></td>
<td style="text-align:center">bool</td>
<td style="text-align:center">C</td>
<td>Redis AOF 是否启用？</td>
</tr>
<tr>
<td><a href="/zh/docs/redis/param/#redis_rename_commands"><code>redis_rename_commands</code></a></td>
<td style="text-align:center">dict</td>
<td style="text-align:center">C</td>
<td>Redis危险命令重命名列表</td>
</tr>
<tr>
<td><a href="/zh/docs/redis/param/#redis_cluster_replicas"><code>redis_cluster_replicas</code></a></td>
<td style="text-align:center">int</td>
<td style="text-align:center">C</td>
<td>Redis原生集群中每个主库配几个从库？</td>
</tr>
<tr>
<td><a href="/zh/docs/redis/param/#redis_cluster_replicas"><code>redis_sentinel_monitor</code></a></td>
<td style="text-align:center">master[]</td>
<td style="text-align:center">C</td>
<td>Redis哨兵监控的主库列表，只在哨兵集群上使用？</td>
</tr>
</tbody>
</table>
<hr>
<h2 id="默认参数">默认参数</h2>
<p>Etcd 模块的默认参数定义于 <a href="https://github.com/Vonng/pigsty/blob/main/roles/redis/defaults/main.yml"><code>roles/redis/defaults/main.yml</code></a></p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic">#redis_cluster:            &lt;集群&gt; # Redis数据库集群名称，必选身份参数</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#8f5902;font-style:italic">#redis_node: 1             &lt;节点&gt; # Redis节点上的实例定义</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#8f5902;font-style:italic">#redis_instances: {}       &lt;节点&gt; # Redis节点编号，正整数，集群内唯一，必选身份参数</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:bold">redis_fs_main</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">/data            </span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#8f5902;font-style:italic"># Redis主数据目录，默认为 `/data`</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:bold">redis_exporter_enabled</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">true</span><span style="color:#f8f8f8;text-decoration:underline">     </span><span style="color:#8f5902;font-style:italic"># Redis Exporter 是否启用？</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:bold">redis_exporter_port</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#0000cf;font-weight:bold">9121</span><span style="color:#f8f8f8;text-decoration:underline">        </span><span style="color:#8f5902;font-style:italic"># Redis Exporter监听端口</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:bold">redis_exporter_options</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#39;&#39;</span><span style="color:#f8f8f8;text-decoration:underline">       </span><span style="color:#8f5902;font-style:italic"># Redis Exporter命令参数</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:bold">redis_safeguard</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">false</span><span style="color:#f8f8f8;text-decoration:underline">           </span><span style="color:#8f5902;font-style:italic"># 禁止抹除现存的Redis</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:bold">redis_clean</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">true</span><span style="color:#f8f8f8;text-decoration:underline">                </span><span style="color:#8f5902;font-style:italic"># 初始化Redis是否抹除现存实例</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:bold">redis_rmdata</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">true</span><span style="color:#f8f8f8;text-decoration:underline">               </span><span style="color:#8f5902;font-style:italic"># 移除Redis实例时是否一并移除数据？</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:bold">redis_mode</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">standalone          </span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#8f5902;font-style:italic"># Redis集群模式：sentinel，cluster，standalone</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:bold">redis_conf</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">redis.conf          </span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#8f5902;font-style:italic"># Redis配置文件模板，sentinel 除外</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:bold">redis_bind_address</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#39;0.0.0.0&#39;</span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#8f5902;font-style:italic"># Redis监听地址，默认留空则会绑定主机IP</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:bold">redis_max_memory</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">1GB           </span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#8f5902;font-style:italic"># Redis可用的最大内存</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:bold">redis_mem_policy</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">allkeys-lru   </span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#8f5902;font-style:italic"># Redis内存逐出策略</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:bold">redis_password</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#39;&#39;</span><span style="color:#f8f8f8;text-decoration:underline">               </span><span style="color:#8f5902;font-style:italic"># Redis密码，默认留空则禁用密码</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:bold">redis_rdb_save</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000;font-weight:bold">[</span><span style="color:#4e9a06">&#39;1200 1&#39;</span><span style="color:#000;font-weight:bold">]</span><span style="color:#f8f8f8;text-decoration:underline">       </span><span style="color:#8f5902;font-style:italic"># Redis RDB 保存指令，字符串列表，空数组则禁用RDB</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:bold">redis_aof_enabled</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">false</span><span style="color:#f8f8f8;text-decoration:underline">         </span><span style="color:#8f5902;font-style:italic"># Redis AOF 是否启用？</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:bold">redis_rename_commands</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span>{}<span style="color:#f8f8f8;text-decoration:underline">        </span><span style="color:#8f5902;font-style:italic"># Redis危险命令重命名列表</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:bold">redis_cluster_replicas</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#0000cf;font-weight:bold">1</span><span style="color:#f8f8f8;text-decoration:underline">        </span><span style="color:#8f5902;font-style:italic"># Redis原生集群中每个主库配几个从库？</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:bold">redis_sentinel_monitor</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000;font-weight:bold">[]</span><span style="color:#f8f8f8;text-decoration:underline">       </span><span style="color:#8f5902;font-style:italic"># Redis哨兵监控的主库列表，只在哨兵集群上使用</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span></code></pre></div><h3 id="redis_cluster"><code>redis_cluster</code></h3>
<p>参数名称： <code>redis_cluster</code>， 类型： <code>string</code>， 层次：<code>C</code></p>
<p>身份参数，必选参数，必须显式在集群层面配置，将用作集群内资源的命名空间。</p>
<p>需要遵循特定命名规则：<code>[a-z][a-z0-9-]*</code>，以兼容不同约束对身份标识的要求，建议使用<code>redis-</code>作为集群名前缀。</p>
<h3 id="redis_node"><code>redis_node</code></h3>
<p>参数名称： <code>redis_node</code>， 类型： <code>int</code>， 层次：<code>I</code></p>
<p>Redis节点序列号，身份参数，必选参数，必须显式在节点（Host）层面配置。</p>
<p>自然数，在集群中应当是唯一的，用于区别与标识集群内的不同节点，从0或1开始分配。</p>
<h3 id="redis_instances"><code>redis_instances</code></h3>
<p>参数名称： <code>redis_instances</code>， 类型： <code>dict</code>， 层次：<code>I</code></p>
<p>当前 Redis 节点上的 Redis 实例定义，必选参数，必须显式在节点（Host）层面配置。</p>
<p>内容为JSON KV对象格式。Key为数值类型端口号，Value为该实例特定的JSON配置项。</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">redis-test: # redis native cluster</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">3m x 3s</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">hosts</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">10.10.10.12</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span>{<span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">redis_node: 1 ,redis_instances</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span>{<span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">6379</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span>{<span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">} ,6380</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span>{<span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">} ,6381</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span>{<span style="color:#f8f8f8;text-decoration:underline"> </span>}<span style="color:#f8f8f8;text-decoration:underline"> </span>}<span style="color:#f8f8f8;text-decoration:underline"> </span>}<span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">10.10.10.13</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span>{<span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">redis_node: 2 ,redis_instances</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span>{<span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">6379</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span>{<span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">} ,6380</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span>{<span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">} ,6381</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span>{<span style="color:#f8f8f8;text-decoration:underline"> </span>}<span style="color:#f8f8f8;text-decoration:underline"> </span>}<span style="color:#f8f8f8;text-decoration:underline"> </span>}<span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">vars</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span>{<span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">redis_cluster: redis-test ,redis_password: &#39;redis.test&#39; ,redis_mode: cluster, redis_max_memory</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">32MB }</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span></code></pre></div><p>每一个Redis实例在对应节点上监听一个唯一端口，实例配置项中<code>replica_of</code> 用于设置一个实例的上游主库地址，构建主从复制关系。</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">redis_instances</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">6379</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span>{}<span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">6380</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span>{<span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">replica_of</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#39;10.10.10.13 6379&#39;</span><span style="color:#f8f8f8;text-decoration:underline"> </span>}<span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">6381</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span>{<span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">replica_of</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#39;10.10.10.13 6379&#39;</span><span style="color:#f8f8f8;text-decoration:underline"> </span>}<span style="color:#f8f8f8;text-decoration:underline">
</span></span></span></code></pre></div><h3 id="redis_fs_main"><code>redis_fs_main</code></h3>
<p>参数名称： <code>redis_fs_main</code>， 类型： <code>path</code>， 层次：<code>C</code></p>
<p>Redis使用的主数据盘挂载点，默认为<code>/data</code>，Pigsty会在该目录下创建<code>redis</code>目录，用于存放Redis数据。</p>
<p>所以实际存储数据的目录为 <code>/data/redis</code>，该目录的属主为操作系统用户 <code>redis</code>，内部结构详情请参考 <a href="/zh/docs/fhs#redis-fhs">FHS：Redis</a></p>
<h3 id="redis_exporter_enabled"><code>redis_exporter_enabled</code></h3>
<p>参数名称： <code>redis_exporter_enabled</code>， 类型： <code>bool</code>， 层次：<code>C</code></p>
<p>是否启用Redis监控组件 Redis Exporter？</p>
<p>默认启用，在每个Redis节点上部署一个，默认监听 <a href="/zh/docs/redis/param/#redis_exporter_port"><code>redis_exporter_port</code></a> <code>9121</code> 端口。所有本节点上 Redis 实例的监控指标都由它负责抓取。</p>
<h3 id="redis_exporter_port"><code>redis_exporter_port</code></h3>
<p>参数名称： <code>redis_exporter_port</code>， 类型： <code>port</code>， 层次：<code>C</code></p>
<p>Redis Exporter监听端口，默认值为：<code>9121</code></p>
<h3 id="redis_exporter_options"><code>redis_exporter_options</code></h3>
<p>参数名称： <code>redis_exporter_options</code>， 类型： <code>string</code>， 层次：<code>C/I</code></p>
<p>传给 Redis Exporter 的额外命令行参数，会被渲染到 <code>/etc/defaut/redis_exporter</code> 中，默认为空字符串。</p>
<h3 id="redis_safeguard"><code>redis_safeguard</code></h3>
<p>参数名称： <code>redis_safeguard</code>， 类型： <code>bool</code>， 层次：<code>G/C/A</code></p>
<p>Redis的防误删安全保险开关：打开后无法使用剧本抹除正在运行的 Redis 实例。</p>
<p>默认值为 <code>false</code>，如果设置为 <code>true</code>，那么当剧本遇到正在运行的 Redis 实例时，会中止初始化/抹除的操作，避免误删。</p>
<h3 id="redis_clean"><code>redis_clean</code></h3>
<p>参数名称： <code>redis_clean</code>， 类型： <code>bool</code>， 层次：<code>G/C/A</code></p>
<p>Redis清理开关：是否在初始化的过程中抹除运行中的Redis实例？默认值为：<code>true</code>。</p>
<p>剧本 <code>redis.yml</code> 会在执行时抹除具有相同定义的现有 Redis 实例，这样可以保证剧本的幂等性。</p>
<p>如果您不希望 <code>redis.yml</code> 这样做，可以将此参数设置为 <code>false</code>，那么当剧本遇到正在运行的 Redis 实例时，会中止初始化/抹除的操作，避免误删。</p>
<p>如果安全保险参数 <a href="/zh/docs/redis/param/#redis_safeguard"><code>redis_safeguard</code></a> 已经打开，那么本参数的优先级低于该参数。</p>
<h3 id="redis_rmdata"><code>redis_rmdata</code></h3>
<p>参数名称： <code>redis_rmdata</code>， 类型： <code>bool</code>， 层次：<code>G/C/A</code></p>
<p>移除 Redis 实例的时候，是否一并移除 Redis 数据目录？默认为 <code>true</code>。</p>
<p>数据目录包含了 Redis 的 RDB与AOF文件，如果不抹除它们，那么新拉起的 Redis 实例将会从这些备份文件中加载数据。</p>
<h3 id="redis_mode"><code>redis_mode</code></h3>
<p>参数名称： <code>redis_mode</code>， 类型： <code>enum</code>， 层次：<code>C</code></p>
<p>Redis集群的工作模式，有三种选项：<code>standalone</code>, <code>cluster</code>, <code>sentinel</code>，默认值为 <code>standalone</code></p>
<ul>
<li><code>standalone</code>：默认，独立的Redis主从模式</li>
<li><code>cluster</code>： Redis原生集群模式</li>
<li><code>sentinel</code>：Redis高可用组件：哨兵</li>
</ul>
<p>当使用<code>standalone</code>模式时，Pigsty会根据 <code>replica_of</code> 参数设置Redis主从复制关系。</p>
<p>当使用<code>cluster</code>模式时，Pigsty会根据 <a href="/zh/docs/redis/param/#redis_cluster_replicas"><code>redis_cluster_replicas</code></a> 参数使用所有定义的实例创建原生Redis集群。</p>
<h3 id="redis_conf"><code>redis_conf</code></h3>
<p>参数名称： <code>redis_conf</code>， 类型： <code>string</code>， 层次：<code>C</code></p>
<p>Redis 配置模板路径，Sentinel除外。</p>
<p>默认值：<code>redis.conf</code>，这是一个模板文件，位于 <a href="https://github.com/Vonng/pigsty/blob/main/roles/redis/templates/redis.conf"><code>roles/redis/templates/redis.conf</code></a>。</p>
<p>如果你想使用自己的 Redis 配置模板，你可以将它放在 <code>templates/</code> 目录中，并设置此参数为模板文件名。</p>
<p>注意： Redis Sentinel 使用的是另一个不同的模板文件，即 <a href="https://github.com/Vonng/pigsty/blob/main/roles/redis/templates/redis-sentinel.conf"><code>roles/redis/templates/redis-sentinel.conf</code></a>。</p>
<h3 id="redis_bind_address"><code>redis_bind_address</code></h3>
<p>参数名称： <code>redis_bind_address</code>， 类型： <code>ip</code>， 层次：<code>C</code></p>
<p>Redis服务器绑定的IP地址，空字符串将使用配置清单中定义的主机名。</p>
<p>默认值：<code>0.0.0.0</code>，这将绑定到此主机上的所有可用 IPv4 地址。</p>
<p>在生产环境中出于安全性考虑，建议仅绑定内网 IP，即将此值设置为空字符串 <code>''</code></p>
<h3 id="redis_max_memory"><code>redis_max_memory</code></h3>
<p>参数名称： <code>redis_max_memory</code>， 类型： <code>size</code>， 层次：<code>C/I</code></p>
<p>每个 Redis 实例使用的最大内存配置，默认值：<code>1GB</code>。</p>
<h3 id="redis_mem_policy"><code>redis_mem_policy</code></h3>
<p>参数名称： <code>redis_mem_policy</code>， 类型： <code>enum</code>， 层次：<code>C</code></p>
<p>Redis 内存回收策略，默认值：<code>allkeys-lru</code>，</p>
<ul>
<li><code>noeviction</code>：内存达限时不保存新值：当使用主从复制时仅适用于主库</li>
<li><code>allkeys-lru</code>：保持最近使用的键；删除最近最少使用的键（LRU）</li>
<li><code>allkeys-lfu</code>：保持频繁使用的键；删除最少频繁使用的键（LFU）</li>
<li><code>volatile-lru</code>：删除带有真实过期字段的最近最少使用的键</li>
<li><code>volatile-lfu</code>：删除带有真实过期字段的最少频繁使用的键</li>
<li><code>allkeys-random</code>：随机删除键以为新添加的数据腾出空间</li>
<li><code>volatile-random</code>：随机删除带有过期字段的键</li>
<li><code>volatile-ttl</code>：删除带有真实过期字段和最短剩余生存时间（TTL）值的键。</li>
</ul>
<p>详情请参阅<a href="https://redis.io/docs/reference/eviction/">Redis内存回收策略</a>。</p>
<h3 id="redis_password"><code>redis_password</code></h3>
<p>参数名称： <code>redis_password</code>， 类型： <code>password</code>， 层次：<code>C/N</code></p>
<p>Redis 密码，空字符串将禁用密码，这是默认行为。</p>
<p>注意，由于 redis_exporter 的实现限制，您每个节点只能设置一个 <code>redis_password</code>。这通常不是问题，因为 pigsty 不允许在同一节点上部署两个不同的 Redis 集群。</p>
<blockquote>
<p>请在生产环境中使用强密码</p>
</blockquote>
<h3 id="redis_rdb_save"><code>redis_rdb_save</code></h3>
<p>参数名称： <code>redis_rdb_save</code>， 类型： <code>string[]</code>， 层次：<code>C</code></p>
<p>Redis RDB 保存指令，使用空列表则禁用 RDB。</p>
<p>默认值是 <code>[&quot;1200 1&quot;]</code>：如果最近20分钟至少有1个键更改，则将数据集转储到磁盘。</p>
<p>详情请参考 <a href="https://redis.io/docs/management/persistence/">Redis持久化</a>。</p>
<h3 id="redis_aof_enabled"><code>redis_aof_enabled</code></h3>
<p>参数名称： <code>redis_aof_enabled</code>， 类型： <code>bool</code>， 层次：<code>C</code></p>
<p>启用 Redis AOF 吗？默认值是 <code>false</code>，即不使用 AOF。</p>
<h3 id="redis_rename_commands"><code>redis_rename_commands</code></h3>
<p>参数名称： <code>redis_rename_commands</code>， 类型： <code>dict</code>， 层次：<code>C</code></p>
<p>重命名 Redis 危险命令，这是一个 k:v 字典：<code>old: new</code>，old是待重命名的命令名称，new是重命名后的名字。</p>
<p>默认值：<code>{}</code>，你可以通过设置此值来隐藏像 <code>FLUSHDB</code> 和 <code>FLUSHALL</code> 这样的危险命令，下面是一个例子：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span>{<span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">&#34;keys&#34;: </span><span style="color:#4e9a06">&#34;op_keys&#34;</span><span style="color:#000;font-weight:bold">,</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">&#34;flushdb&#34;: </span><span style="color:#4e9a06">&#34;op_flushdb&#34;</span><span style="color:#000;font-weight:bold">,</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">&#34;flushall&#34;: </span><span style="color:#4e9a06">&#34;op_flushall&#34;</span><span style="color:#000;font-weight:bold">,</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">&#34;config&#34;: </span><span style="color:#4e9a06">&#34;op_config&#34;</span><span style="color:#f8f8f8;text-decoration:underline">  
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span>}<span style="color:#f8f8f8;text-decoration:underline">
</span></span></span></code></pre></div><h3 id="redis_cluster_replicas"><code>redis_cluster_replicas</code></h3>
<p>参数名称： <code>redis_cluster_replicas</code>， 类型： <code>int</code>， 层次：<code>C</code></p>
<p>在 Redis 原生集群中，应当为一个 Master/Primary 实例配置多少个从库？默认值为： <code>1</code>，即每个主库配一个从库。</p>
<h3 id="redis_sentinel_monitor"><code>redis_sentinel_monitor</code></h3>
<p>参数名称： <code>redis_sentinel_monitor</code>， 类型： <code>master[]</code>， 层次：<code>C</code></p>
<p>Redis哨兵监控的主库列表，只在哨兵集群上使用。每个待纳管的主库定义方式如下所示：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">redis_sentinel_monitor</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#8f5902;font-style:italic"># primary list for redis sentinel, use cls as name, primary ip:port</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span>- {<span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">name: redis-src, host: 10.10.10.45, port: 6379 ,password: redis.src, quorum</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#0000cf;font-weight:bold">1</span><span style="color:#f8f8f8;text-decoration:underline"> </span>}<span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span>- {<span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">name: redis-dst, host: 10.10.10.48, port: 6379 ,password: redis.dst, quorum</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#0000cf;font-weight:bold">1</span><span style="color:#f8f8f8;text-decoration:underline"> </span>}<span style="color:#f8f8f8;text-decoration:underline">
</span></span></span></code></pre></div><p>其中，<code>name</code>，<code>host</code> 是必选参数，<code>port</code>，<code>password</code>，<code>quorum</code> 是可选参数，<code>quorum</code> 用于设置判定主库失效所需的法定人数数，通常大于哨兵实例数的一半（默认为1）。</p>
<br>
<hr>
<br>

</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-a4ac99db4d7e939afec8be333eb8e254">3 - 预置剧本</h1>
    <div class="lead">如何使用预置的 ansible 剧本来管理 Etcd 集群，常用管理命令速查。</div>
	<p>Etcd 模块提供了一个默认的剧本 <a href="/zh/docs/redis/playbook/#etcdyml"><code>etcd.yml</code></a> ，用于安装 Etcd 集群。</p>
<hr>
<h2 id="etcdyml"><code>etcd.yml</code></h2>
<p>剧本原始文件：<a href="https://github.com/Vonng/pigsty/blob/main/etcd.yml"><code>etcd.yml</code></a></p>
<p>执行本剧本，将会在硬编码的固定分组 <code>etcd</code> 上安装配置 Etcd 集群，并启动 etcd 服务。</p>
<p>在 <a href="https://github.com/Vonng/pigsty/blob/main/etcd.yml"><code>etcd.yml</code></a> 中，提供了以下是可用的任务子集：</p>
<ul>
<li><code>etcd_assert</code>  ：生成 etcd 身份</li>
<li><code>etcd_install</code> ：安装 etcd rpm 包</li>
<li><code>etcd_clean</code>   ：清理现有的 etcd 实例
<ul>
<li><code>etcd_check</code> ：检查 etcd 实例是否在运行</li>
<li><code>etcd_purge</code> ：删除正在运行的 etcd 实例和数据</li>
</ul>
</li>
<li><code>etcd_dir</code>     ：创建 etcd 数据和配置目录</li>
<li><code>etcd_config</code>  ：生成 etcd 配置
<ul>
<li><code>etcd_conf</code>  ：生成 etcd 主配置</li>
<li><code>etcd_cert</code>  ：生成 etcd ssl 证书</li>
</ul>
</li>
<li><code>etcd_launch</code>  ：启动 etcd 服务</li>
<li><code>etcd_register</code> ： 将 etcd 注册到 prometheus</li>
</ul>
<p>Etcd 模块没有提供专门的卸载剧本，如果您需要卸载 Etcd，可以使用剧本中的 <code>etcd_clean</code> 子任务，请参考 <a href="/zh/docs/redis/playbook/#保护机制"><strong>保护机制</strong></a> 中的介绍。</p>
<hr>
<h2 id="执行演示">执行演示</h2>
<p><a href="https://asciinema.org/a/566414"><img alt="asciicast" src="https://asciinema.org/a/566414.svg"></a></p>
<hr>
<h2 id="命令速查">命令速查</h2>
<p>Etcd 剧本与快捷方式：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>./etcd.yml                                      <span style="color:#8f5902;font-style:italic"># 初始化 etcd 集群 </span>
</span></span><span style="display:flex;"><span>./etcd.yml -t etcd_launch                       <span style="color:#8f5902;font-style:italic"># 重启整个 etcd 集群</span>
</span></span><span style="display:flex;"><span>./etcd.yml -t etcd_clean                        <span style="color:#8f5902;font-style:italic"># 移除整个集群，会检查现有实例是否存在，根据安全保险判断是否执行</span>
</span></span><span style="display:flex;"><span>./etcd.yml -t etcd_purge                        <span style="color:#8f5902;font-style:italic"># 强制移除整个集群，根本不管安全保险是否启用。</span>
</span></span><span style="display:flex;"><span>./etcd.yml -t etcd_conf                         <span style="color:#8f5902;font-style:italic"># 使用最新状态刷新 /etc/etcd/etcd.conf</span>
</span></span><span style="display:flex;"><span>./etcd.yml -l 10.10.10.12 -e <span style="color:#000">etcd_init</span><span style="color:#ce5c00;font-weight:bold">=</span>existing <span style="color:#8f5902;font-style:italic"># 扩容节点：一定要添加 existing 参数，命令行或配置文件均可</span>
</span></span><span style="display:flex;"><span>./etcd.yml -l 10.10.10.12 -t etcd_purge         <span style="color:#8f5902;font-style:italic"># 删除节点</span>
</span></span></code></pre></div><hr>
<h2 id="保护机制">保护机制</h2>
<p>出于防止误删的目的，Pigsty 的 ETCD 模块提供了防误删保险，由以下参数控制：</p>
<ul>
<li><a href="/zh/docs/redis/param/#etcd_clean"><code>etcd_clean</code></a> 默认为 <code>true</code>，即，默认在初始化时清理现有实例。</li>
<li><a href="/zh/docs/redis/param/#etcd_safeguard"><code>etcd_safeguard</code></a>: 默认为 <code>false</code>，即默认不打开防误删保护。</li>
</ul>
<p>默认配置使得您可以使用剧本重置 etcd 集群的状态，这对于开发、测试和生产环境中紧急重建 etcd 集群非常有用。</p>
<p>如果您希望在初始化时清理现有实例，请修改配置文件，显式关闭此保险，或者在执行时使用命令行参数 <code>-e etcd_clean=true</code> 进行覆盖。</p>
<p>如果您单纯希望清理现有实例，而不安装新实例，直接执行 <code>etcd_clean</code> 子任务即可：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>./etcd.yml -l &lt;cls&gt; -e <span style="color:#000">etcd_clean</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#204a87">true</span> -t etcd_clean
</span></span></code></pre></div><p>如果您确定要摧毁这个 etcd 集群，更简单暴力直接的方式是：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>./etcd.yml -l &lt;cls&gt; -t etcd_purge
</span></span></code></pre></div><p>除非您清楚地知道自己在做什么，我们并不建议用户这样清理 Etcd 集群。</p>
<br>
<hr>
<br>

</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-d30f775631874dbea209c56a3cf88d88">4 - 管理预案</h1>
    <div class="lead">Etcd 集群管理 SOP，创建，销毁，扩容，缩容的详细说明</div>
	<p>以下是一些常见的 etcd 管理任务 SOP（预案）：</p>
<ul>
<li><a href="/zh/docs/redis/admin/#创建集群">创建集群</a>：如何初始化 etcd 集群？</li>
<li><a href="/zh/docs/redis/admin/#销毁集群">销毁集群</a>：如何销毁 etcd 集群？</li>
<li><a href="/zh/docs/redis/admin/#环境变量">环境变量</a>：如何配置 etcd 客户端，以访问 etcd 服务器集群？</li>
<li><a href="/zh/docs/redis/admin/#重载配置">重载配置</a>：如何更新客户端使用的 etcd 服务器成员列表？</li>
<li><a href="/zh/docs/redis/admin/#添加成员">添加成员</a>：如何向现有 etcd 集群添加新成员？</li>
<li><a href="/zh/docs/redis/admin/#移除成员">移除成员</a>：如何从 etcd 集群移除老成员？</li>
</ul>
<p>更多问题请参考 <a href="/zh/docs/redis/faq/">FAQ：ETCD</a>。</p>
<hr>
<h2 id="管理">管理</h2>
<p>下面是 REDIS 模块常用的管理任务，更多问题请参考 <a href="/zh/docs/redis/faq/">FAQ：REDIS</a></p>
<hr>
<h3 id="初始化redis">初始化Redis</h3>
<p>您可以使用 <a href="/zh/docs/redis/admin/#redisyml"><code>redis.yml</code></a> 剧本来初始化 Redis 集群、节点、或实例：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># 初始化集群内所有 Redis 实例</span>
</span></span><span style="display:flex;"><span>./redis.yml -l &lt;cluster&gt;      <span style="color:#8f5902;font-style:italic"># 初始化 redis 集群</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># 初始化特定节点上的所有 Redis 实例</span>
</span></span><span style="display:flex;"><span>./redis.yml -l 10.10.10.10    <span style="color:#8f5902;font-style:italic"># 初始化 redis 节点</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># 初始化特定 Redis 实例：  10.10.10.11:6379</span>
</span></span><span style="display:flex;"><span>./redis.yml -l 10.10.10.11 -e <span style="color:#000">redis_port</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#0000cf;font-weight:bold">6379</span> -t redis
</span></span></code></pre></div><p>你也可以使用包装脚本命令行脚本来初始化：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>bin/redis-add redis-ms          <span style="color:#8f5902;font-style:italic"># 初始化 redis 集群 &#39;redis-ms&#39;</span>
</span></span><span style="display:flex;"><span>bin/redis-add 10.10.10.10       <span style="color:#8f5902;font-style:italic"># 初始化 redis 节点 &#39;10.10.10.10&#39;</span>
</span></span><span style="display:flex;"><span>bin/redis-add 10.10.10.10 <span style="color:#0000cf;font-weight:bold">6379</span>  <span style="color:#8f5902;font-style:italic"># 初始化 redis 实例 &#39;10.10.10.10:6379&#39;</span>
</span></span></code></pre></div><hr>
<h3 id="下线redis">下线Redis</h3>
<p>您可以使用 <a href="/zh/docs/redis/admin/#redis-rmyml"><code>redis-rm.yml</code></a> 剧本来初始化 Redis 集群、节点、或实例：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># 下线 Redis 集群 `redis-test`</span>
</span></span><span style="display:flex;"><span>./redis-rm.yml -l redis-test
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># 下线 Redis 集群 `redis-test` 并卸载 Redis 软件包</span>
</span></span><span style="display:flex;"><span>./redis-rm.yml -l redis-test -e <span style="color:#000">redis_uninstall</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#204a87">true</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># 下线 Redis 节点 10.10.10.13 上的所有实例</span>
</span></span><span style="display:flex;"><span>./redis-rm.yml -l 10.10.10.13
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># 下线特定 Redis 实例 10.10.10.13:6379</span>
</span></span><span style="display:flex;"><span>./redis-rm.yml -l 10.10.10.13 -e <span style="color:#000">redis_port</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#0000cf;font-weight:bold">6379</span>
</span></span></code></pre></div><p>你也可以使用包装脚本来下线 Redis 集群/节点/实例：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>bin/redis-rm redis-ms          <span style="color:#8f5902;font-style:italic"># 下线 redis 集群 &#39;redis-ms&#39;</span>
</span></span><span style="display:flex;"><span>bin/redis-rm 10.10.10.10       <span style="color:#8f5902;font-style:italic"># 下线 redis 节点 &#39;10.10.10.10&#39;</span>
</span></span><span style="display:flex;"><span>bin/redis-rm 10.10.10.10 <span style="color:#0000cf;font-weight:bold">6379</span>  <span style="color:#8f5902;font-style:italic"># 下线 redis 实例 &#39;10.10.10.10:6379&#39;</span>
</span></span></code></pre></div><hr>
<h3 id="重新配置redis">重新配置Redis</h3>
<p>您可以部分执行 <a href="/zh/docs/redis/admin/#redisyml"><code>redis.yml</code></a> 剧本来重新配置 Redis 集群、节点、或实例：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>./redis.yml -l &lt;cluster&gt; -t redis_config,redis_launch
</span></span></code></pre></div><p>请注意，redis 无法在线重载配置，您只能使用 launch 任务进行重启来让配置生效。</p>
<hr>
<h2 id="使用redis客户端">使用Redis客户端</h2>
<p>使用 <code>redis-cli</code> 访问 Reids 实例：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>$ redis-cli -h 10.10.10.10 -p <span style="color:#0000cf;font-weight:bold">6379</span> <span style="color:#8f5902;font-style:italic"># &lt;--- 使用 Host 与 Port 访问对应 Redis 实例</span>
</span></span><span style="display:flex;"><span>10.10.10.10:6379&gt; auth redis.ms    <span style="color:#8f5902;font-style:italic"># &lt;--- 使用密码验证</span>
</span></span><span style="display:flex;"><span>OK
</span></span><span style="display:flex;"><span>10.10.10.10:6379&gt; <span style="color:#204a87">set</span> a <span style="color:#0000cf;font-weight:bold">10</span>         <span style="color:#8f5902;font-style:italic"># &lt;--- 设置一个Key</span>
</span></span><span style="display:flex;"><span>OK
</span></span><span style="display:flex;"><span>10.10.10.10:6379&gt; get a            <span style="color:#8f5902;font-style:italic"># &lt;--- 获取 Key 的值</span>
</span></span><span style="display:flex;"><span><span style="color:#4e9a06">&#34;10&#34;</span>
</span></span></code></pre></div><p>Redis提供了<code>redis-benchmark</code>工具，可以用于Redis的性能评估，或生成一些负载用于测试。</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>redis-benchmark -h 10.10.10.13 -p <span style="color:#0000cf;font-weight:bold">6379</span>
</span></span></code></pre></div><hr>
<h3 id="手工设置redis从库">手工设置Redis从库</h3>
<p><a href="https://redis.io/commands/replicaof/">https://redis.io/commands/replicaof/</a></p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># 将一个 Redis 实例提升为主库</span>
</span></span><span style="display:flex;"><span>&gt; REPLICAOF NO ONE
</span></span><span style="display:flex;"><span><span style="color:#4e9a06">&#34;OK&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># 将一个 Redis 实例设置为另一个实例的从库</span>
</span></span><span style="display:flex;"><span>&gt; REPLICAOF 127.0.0.1 <span style="color:#0000cf;font-weight:bold">6799</span>
</span></span><span style="display:flex;"><span><span style="color:#4e9a06">&#34;OK&#34;</span>
</span></span></code></pre></div><hr>
<h3 id="设置redis主从高可用">设置Redis主从高可用</h3>
<p>Redis独立主从集群可以通过 Redis 哨兵集群配置自动高可用，详细用户请参考 <a href="https://redis.io/docs/management/sentinel/">Sentinel官方文档</a></p>
<p>以四节点<a href="/zh/docs/setup/provision#%E6%B2%99%E7%AE%B1%E7%8E%AF%E5%A2%83">沙箱环境</a>为例，一套 Redis Sentinel 集群 <code>redis-meta</code>，可以用来管理很多套独立 Redis 主从集群。</p>
<p>以一主一从的Redis普通主从集群 <code>redis-ms</code> 为例，您需要在每个 Sentinel 实例上，使用 <code>SENTINEL MONITOR</code> 添加目标，并使用 <code>SENTINEL SET</code> 提供密码，高可用就配置完毕了。</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># 对于每一个 sentinel，将 redis 主服务器纳入哨兵管理：（26379,26380,26381）</span>
</span></span><span style="display:flex;"><span>$ redis-cli -h 10.10.10.11 -p <span style="color:#0000cf;font-weight:bold">26379</span> -a redis.meta
</span></span><span style="display:flex;"><span>10.10.10.11:26379&gt; SENTINEL MONITOR redis-ms 10.10.10.10 <span style="color:#0000cf;font-weight:bold">6379</span> <span style="color:#0000cf;font-weight:bold">1</span>
</span></span><span style="display:flex;"><span>10.10.10.11:26379&gt; SENTINEL SET redis-ms auth-pass redis.ms      <span style="color:#8f5902;font-style:italic"># 如果启用了授权，需要配置密码</span>
</span></span></code></pre></div><p>如果您想移除某个由 Sentinel 管理的 Redis 主从集群，使用 <code>SENTINEL REMOVE &lt;name&gt;</code> 移除即可。</p>
<p>您可以使用定义在 Sentinel 集群上的 <a href="/zh/docs/reference/param#redis_sentinel_monitor"><code>redis_sentinel_monitor</code></a> 参数，来自动配置管理哨兵监控管理的主库列表。</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">redis_sentinel_monitor</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#8f5902;font-style:italic"># 需要被监控的主库列表，端口、密码、法定人数（应为1/2以上的哨兵数量）为可选参数</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span>- {<span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">name: redis-src, host: 10.10.10.45, port: 6379 ,password: redis.src, quorum</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#0000cf;font-weight:bold">1</span><span style="color:#f8f8f8;text-decoration:underline"> </span>}<span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span>- {<span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">name: redis-dst, host: 10.10.10.48, port: 6379 ,password: redis.dst, quorum</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#0000cf;font-weight:bold">1</span><span style="color:#f8f8f8;text-decoration:underline"> </span>}<span style="color:#f8f8f8;text-decoration:underline">
</span></span></span></code></pre></div><p>使用以下命令刷新 Redis 哨兵集群上的纳管主库列表：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>./redis.yml -l redis-meta -t redis-ha   <span style="color:#8f5902;font-style:italic"># 如果您的 Sentinel 集群名称不是 redis-meta，请在这里替换。</span>
</span></span></code></pre></div>
</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-81482490a3974d936d1dca668f5c2d09">5 - 监控告警</h1>
    <div class="lead">如何监控 Etcd？有哪些告警规则值得关注？</div>
	<hr>
<h2 id="监控面板">监控面板</h2>
<p>ETCD 模块提供了一个监控面板：Etcd Overview。</p>
<h3 id="etcd-overview-dashboard">ETCD Overview Dashboard</h3>
<p><a href="https://demo.pigsty.cc/d/etcd-overview">ETCD Overview</a>：ETCD 集群概览</p>
<p>这个监控面板提供了 ETCD 状态的关键信息：最值得关注的是 ETCD Aliveness，它显示了 ETCD 集群整体的服务状态。</p>
<p>红色的条带标识着实例不可用的时间段，而底下蓝灰色的条带标识着整个集群处于不可用的时间段。</p>
<p><a href="https://demo.pigsty.cc/d/etcd-overview"><img alt="etcd-overview.jpg" src="/img/dashboard/etcd-overview.jpg"></a></p>
<hr>
<h2 id="告警规则">告警规则</h2>
<p>Pigsty 针对 Etcd 提供了以下五条预置告警规则，定义于 <a href="https://github.com/Vonng/pigsty/blob/main/files/prometheus/rules/etcd.yml"><code>files/prometheus/rules/etcd.yml</code></a></p>
<ul>
<li><code>EtcdServerDown</code>：Etcd 节点宕机，严重警报</li>
<li><code>EtcdNoLeader</code>：Etcd 集群没有领导者，严重警报</li>
<li><code>EtcdQuotaFull</code>：Etcd 配额使用超过 90%，警告</li>
<li><code>EtcdNetworkPeerRTSlow</code>：Etcd 网络时延缓慢，提醒</li>
<li><code>EtcdWalFsyncSlow</code>：Etcd 磁盘刷盘缓慢，提醒</li>
</ul>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic">#==============================================================#</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#8f5902;font-style:italic">#                         Aliveness                            #</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#8f5902;font-style:italic">#==============================================================#</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#8f5902;font-style:italic"># etcd server instance down</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span>- <span style="color:#204a87;font-weight:bold">alert</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">EtcdServerDown</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">expr</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">etcd_up &lt; 1</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">for</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">1m</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">labels</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span>{<span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">level: 0, severity: CRIT, category</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">etcd }</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">annotations</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">summary</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;CRIT EtcdServerDown {{ $labels.ins }}@{{ $labels.instance }}&#34;</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">description</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000;font-weight:bold">|</span><span style="color:#8f5902;font-style:italic">
</span></span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic">      etcd_up[ins={{ $labels.ins }}, instance={{ $labels.instance }}] = {{ $value }} &lt; 1
</span></span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic">      http://g.pigsty/d/etcd-overview</span><span style="color:#f8f8f8;text-decoration:underline">      
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#8f5902;font-style:italic">#==============================================================#</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#8f5902;font-style:italic">#                         Error                                #</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#8f5902;font-style:italic">#==============================================================#</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#8f5902;font-style:italic"># Etcd no Leader triggers a P0 alert immediately</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#8f5902;font-style:italic"># if dcs_failsafe mode is not enabled, this may lead to global outage</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span>- <span style="color:#204a87;font-weight:bold">alert</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">EtcdNoLeader</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">expr</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">min(etcd_server_has_leader) by (cls) &lt; 1</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">for</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">15s</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">labels</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span>{<span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">level: 0, severity: CRIT, category</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">etcd }</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">annotations</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">summary</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;CRIT EtcdNoLeader: {{ $labels.cls }} {{ $value }}&#34;</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">description</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000;font-weight:bold">|</span><span style="color:#8f5902;font-style:italic">
</span></span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic">      etcd_server_has_leader[cls={{ $labels.cls }}] = {{ $value }} &lt; 1
</span></span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic">      http://g.pigsty/d/etcd-overview?from=now-5m&amp;to=now&amp;var-cls={{$labels.cls}}</span><span style="color:#f8f8f8;text-decoration:underline">      
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#8f5902;font-style:italic">#==============================================================#</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#8f5902;font-style:italic">#                        Saturation                            #</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#8f5902;font-style:italic">#==============================================================#</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span>- <span style="color:#204a87;font-weight:bold">alert</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">EtcdQuotaFull</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">expr</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">etcd:cls:quota_usage &gt; 0.90</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">for</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">1m</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">labels</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span>{<span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">level: 1, severity: WARN, category</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">etcd }</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">annotations</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">summary</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;WARN EtcdQuotaFull: {{ $labels.cls }}&#34;</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">description</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000;font-weight:bold">|</span><span style="color:#8f5902;font-style:italic">
</span></span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic">      etcd:cls:quota_usage[cls={{ $labels.cls }}] = {{ $value | printf &#34;%.3f&#34; }} &gt; 90%</span><span style="color:#f8f8f8;text-decoration:underline">      
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#8f5902;font-style:italic">#==============================================================#</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#8f5902;font-style:italic">#                         Latency                              #</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#8f5902;font-style:italic">#==============================================================#</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#8f5902;font-style:italic"># etcd network peer rt p95 &gt; 200ms for 1m</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span>- <span style="color:#204a87;font-weight:bold">alert</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">EtcdNetworkPeerRTSlow</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">expr</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">etcd:ins:network_peer_rt_p95_5m &gt; 0.200</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">for</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">1m</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">labels</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span>{<span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">level: 2, severity: INFO, category</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">etcd }</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">annotations</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">summary</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;INFO EtcdNetworkPeerRTSlow: {{ $labels.cls }} {{ $labels.ins }}&#34;</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">description</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000;font-weight:bold">|</span><span style="color:#8f5902;font-style:italic">
</span></span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic">      etcd:ins:network_peer_rt_p95_5m[cls={{ $labels.cls }}, ins={{ $labels.ins }}] = {{ $value }} &gt; 200ms
</span></span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic">      http://g.pigsty/d/etcd-instance?from=now-10m&amp;to=now&amp;var-cls={{ $labels.cls }}</span><span style="color:#f8f8f8;text-decoration:underline">      
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#8f5902;font-style:italic"># Etcd wal fsync rt p95 &gt; 50ms</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span>- <span style="color:#204a87;font-weight:bold">alert</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">EtcdWalFsyncSlow</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">expr</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">etcd:ins:wal_fsync_rt_p95_5m &gt; 0.050</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">for</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">1m</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">labels</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span>{<span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">level: 2, severity: INFO, category</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">etcd }</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">annotations</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">summary</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;INFO EtcdWalFsyncSlow: {{ $labels.cls }} {{ $labels.ins }}&#34;</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">description</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000;font-weight:bold">|</span><span style="color:#8f5902;font-style:italic">
</span></span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic">      etcd:ins:wal_fsync_rt_p95_5m[cls={{ $labels.cls }}, ins={{ $labels.ins }}] = {{ $value }} &gt; 50ms
</span></span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic">      http://g.pigsty/d/etcd-instance?from=now-10m&amp;to=now&amp;var-cls={{ $labels.cls }}</span><span style="color:#f8f8f8;text-decoration:underline">      
</span></span></span></code></pre></div>
</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-5bcac294a078899a139a79dc1fb2b009">6 - 指标列表</h1>
    <div class="lead">Pigsty REDIS 模块提供的完整监控指标列表与释义</div>
	<p><a href="/zh/docs/redis"><strong><code>REDIS</code></strong></a> 模块包含有 275 类可用监控指标。</p>
<table>
<thead>
<tr>
<th>Metric Name</th>
<th>Type</th>
<th>Labels</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>ALERTS</td>
<td>Unknown</td>
<td><code>cls</code>, <code>ip</code>, <code>level</code>, <code>severity</code>, <code>instance</code>, <code>category</code>, <code>ins</code>, <code>alertname</code>, <code>job</code>, <code>alertstate</code></td>
<td>N/A</td>
</tr>
<tr>
<td>ALERTS_FOR_STATE</td>
<td>Unknown</td>
<td><code>cls</code>, <code>ip</code>, <code>level</code>, <code>severity</code>, <code>instance</code>, <code>category</code>, <code>ins</code>, <code>alertname</code>, <code>job</code></td>
<td>N/A</td>
</tr>
<tr>
<td>redis:cls:aof_rewrite_time</td>
<td>Unknown</td>
<td><code>cls</code>, <code>job</code></td>
<td>N/A</td>
</tr>
<tr>
<td>redis:cls:blocked_clients</td>
<td>Unknown</td>
<td><code>cls</code>, <code>job</code></td>
<td>N/A</td>
</tr>
<tr>
<td>redis:cls:clients</td>
<td>Unknown</td>
<td><code>cls</code>, <code>job</code></td>
<td>N/A</td>
</tr>
<tr>
<td>redis:cls:cmd_qps</td>
<td>Unknown</td>
<td><code>cls</code>, <code>cmd</code>, <code>job</code></td>
<td>N/A</td>
</tr>
<tr>
<td>redis:cls:cmd_rt</td>
<td>Unknown</td>
<td><code>cls</code>, <code>cmd</code>, <code>job</code></td>
<td>N/A</td>
</tr>
<tr>
<td>redis:cls:cmd_time</td>
<td>Unknown</td>
<td><code>cls</code>, <code>cmd</code>, <code>job</code></td>
<td>N/A</td>
</tr>
<tr>
<td>redis:cls:conn_rate</td>
<td>Unknown</td>
<td><code>cls</code>, <code>job</code></td>
<td>N/A</td>
</tr>
<tr>
<td>redis:cls:conn_reject</td>
<td>Unknown</td>
<td><code>cls</code>, <code>job</code></td>
<td>N/A</td>
</tr>
<tr>
<td>redis:cls:cpu_sys</td>
<td>Unknown</td>
<td><code>cls</code>, <code>job</code></td>
<td>N/A</td>
</tr>
<tr>
<td>redis:cls:cpu_sys_child</td>
<td>Unknown</td>
<td><code>cls</code>, <code>job</code></td>
<td>N/A</td>
</tr>
<tr>
<td>redis:cls:cpu_usage</td>
<td>Unknown</td>
<td><code>cls</code>, <code>job</code></td>
<td>N/A</td>
</tr>
<tr>
<td>redis:cls:cpu_usage_child</td>
<td>Unknown</td>
<td><code>cls</code>, <code>job</code></td>
<td>N/A</td>
</tr>
<tr>
<td>redis:cls:cpu_user</td>
<td>Unknown</td>
<td><code>cls</code>, <code>job</code></td>
<td>N/A</td>
</tr>
<tr>
<td>redis:cls:cpu_user_child</td>
<td>Unknown</td>
<td><code>cls</code>, <code>job</code></td>
<td>N/A</td>
</tr>
<tr>
<td>redis:cls:fork_time</td>
<td>Unknown</td>
<td><code>cls</code>, <code>job</code></td>
<td>N/A</td>
</tr>
<tr>
<td>redis:cls:key_evict</td>
<td>Unknown</td>
<td><code>cls</code>, <code>job</code></td>
<td>N/A</td>
</tr>
<tr>
<td>redis:cls:key_expire</td>
<td>Unknown</td>
<td><code>cls</code>, <code>job</code></td>
<td>N/A</td>
</tr>
<tr>
<td>redis:cls:key_hit</td>
<td>Unknown</td>
<td><code>cls</code>, <code>job</code></td>
<td>N/A</td>
</tr>
<tr>
<td>redis:cls:key_hit_rate</td>
<td>Unknown</td>
<td><code>cls</code>, <code>job</code></td>
<td>N/A</td>
</tr>
<tr>
<td>redis:cls:key_miss</td>
<td>Unknown</td>
<td><code>cls</code>, <code>job</code></td>
<td>N/A</td>
</tr>
<tr>
<td>redis:cls:mem_max</td>
<td>Unknown</td>
<td><code>cls</code>, <code>job</code></td>
<td>N/A</td>
</tr>
<tr>
<td>redis:cls:mem_usage</td>
<td>Unknown</td>
<td><code>cls</code>, <code>job</code></td>
<td>N/A</td>
</tr>
<tr>
<td>redis:cls:mem_usage_max</td>
<td>Unknown</td>
<td><code>cls</code>, <code>job</code></td>
<td>N/A</td>
</tr>
<tr>
<td>redis:cls:mem_used</td>
<td>Unknown</td>
<td><code>cls</code>, <code>job</code></td>
<td>N/A</td>
</tr>
<tr>
<td>redis:cls:net_traffic</td>
<td>Unknown</td>
<td><code>cls</code>, <code>job</code></td>
<td>N/A</td>
</tr>
<tr>
<td>redis:cls:qps</td>
<td>Unknown</td>
<td><code>cls</code>, <code>job</code></td>
<td>N/A</td>
</tr>
<tr>
<td>redis:cls:qps_mu</td>
<td>Unknown</td>
<td><code>cls</code>, <code>job</code></td>
<td>N/A</td>
</tr>
<tr>
<td>redis:cls:qps_realtime</td>
<td>Unknown</td>
<td><code>cls</code>, <code>job</code></td>
<td>N/A</td>
</tr>
<tr>
<td>redis:cls:qps_sigma</td>
<td>Unknown</td>
<td><code>cls</code>, <code>job</code></td>
<td>N/A</td>
</tr>
<tr>
<td>redis:cls:rt</td>
<td>Unknown</td>
<td><code>cls</code>, <code>job</code></td>
<td>N/A</td>
</tr>
<tr>
<td>redis:cls:rt_mu</td>
<td>Unknown</td>
<td><code>cls</code>, <code>job</code></td>
<td>N/A</td>
</tr>
<tr>
<td>redis:cls:rt_sigma</td>
<td>Unknown</td>
<td><code>cls</code>, <code>job</code></td>
<td>N/A</td>
</tr>
<tr>
<td>redis:cls:rx</td>
<td>Unknown</td>
<td><code>cls</code>, <code>job</code></td>
<td>N/A</td>
</tr>
<tr>
<td>redis:cls:size</td>
<td>Unknown</td>
<td><code>cls</code>, <code>job</code></td>
<td>N/A</td>
</tr>
<tr>
<td>redis:cls:tx</td>
<td>Unknown</td>
<td><code>cls</code>, <code>job</code></td>
<td>N/A</td>
</tr>
<tr>
<td>redis:env:blocked_clients</td>
<td>Unknown</td>
<td><code>job</code></td>
<td>N/A</td>
</tr>
<tr>
<td>redis:env:clients</td>
<td>Unknown</td>
<td><code>job</code></td>
<td>N/A</td>
</tr>
<tr>
<td>redis:env:cmd_qps</td>
<td>Unknown</td>
<td><code>cmd</code>, <code>job</code></td>
<td>N/A</td>
</tr>
<tr>
<td>redis:env:cmd_rt</td>
<td>Unknown</td>
<td><code>cmd</code>, <code>job</code></td>
<td>N/A</td>
</tr>
<tr>
<td>redis:env:cmd_time</td>
<td>Unknown</td>
<td><code>cmd</code>, <code>job</code></td>
<td>N/A</td>
</tr>
<tr>
<td>redis:env:conn_rate</td>
<td>Unknown</td>
<td><code>job</code></td>
<td>N/A</td>
</tr>
<tr>
<td>redis:env:conn_reject</td>
<td>Unknown</td>
<td><code>job</code></td>
<td>N/A</td>
</tr>
<tr>
<td>redis:env:cpu_usage</td>
<td>Unknown</td>
<td><code>job</code></td>
<td>N/A</td>
</tr>
<tr>
<td>redis:env:cpu_usage_child</td>
<td>Unknown</td>
<td><code>job</code></td>
<td>N/A</td>
</tr>
<tr>
<td>redis:env:key_evict</td>
<td>Unknown</td>
<td><code>job</code></td>
<td>N/A</td>
</tr>
<tr>
<td>redis:env:key_expire</td>
<td>Unknown</td>
<td><code>job</code></td>
<td>N/A</td>
</tr>
<tr>
<td>redis:env:key_hit</td>
<td>Unknown</td>
<td><code>job</code></td>
<td>N/A</td>
</tr>
<tr>
<td>redis:env:key_hit_rate</td>
<td>Unknown</td>
<td><code>job</code></td>
<td>N/A</td>
</tr>
<tr>
<td>redis:env:key_miss</td>
<td>Unknown</td>
<td><code>job</code></td>
<td>N/A</td>
</tr>
<tr>
<td>redis:env:mem_usage</td>
<td>Unknown</td>
<td><code>job</code></td>
<td>N/A</td>
</tr>
<tr>
<td>redis:env:net_traffic</td>
<td>Unknown</td>
<td><code>job</code></td>
<td>N/A</td>
</tr>
<tr>
<td>redis:env:qps</td>
<td>Unknown</td>
<td><code>job</code></td>
<td>N/A</td>
</tr>
<tr>
<td>redis:env:qps_mu</td>
<td>Unknown</td>
<td><code>job</code></td>
<td>N/A</td>
</tr>
<tr>
<td>redis:env:qps_realtime</td>
<td>Unknown</td>
<td><code>job</code></td>
<td>N/A</td>
</tr>
<tr>
<td>redis:env:qps_sigma</td>
<td>Unknown</td>
<td><code>job</code></td>
<td>N/A</td>
</tr>
<tr>
<td>redis:env:rt</td>
<td>Unknown</td>
<td><code>job</code></td>
<td>N/A</td>
</tr>
<tr>
<td>redis:env:rt_mu</td>
<td>Unknown</td>
<td><code>job</code></td>
<td>N/A</td>
</tr>
<tr>
<td>redis:env:rt_sigma</td>
<td>Unknown</td>
<td><code>job</code></td>
<td>N/A</td>
</tr>
<tr>
<td>redis:env:rx</td>
<td>Unknown</td>
<td><code>job</code></td>
<td>N/A</td>
</tr>
<tr>
<td>redis:env:tx</td>
<td>Unknown</td>
<td><code>job</code></td>
<td>N/A</td>
</tr>
<tr>
<td>redis:ins</td>
<td>Unknown</td>
<td><code>cls</code>, <code>id</code>, <code>instance</code>, <code>ins</code>, <code>job</code></td>
<td>N/A</td>
</tr>
<tr>
<td>redis:ins:blocked_clients</td>
<td>Unknown</td>
<td><code>cls</code>, <code>ip</code>, <code>instance</code>, <code>ins</code>, <code>job</code></td>
<td>N/A</td>
</tr>
<tr>
<td>redis:ins:clients</td>
<td>Unknown</td>
<td><code>cls</code>, <code>ip</code>, <code>instance</code>, <code>ins</code>, <code>job</code></td>
<td>N/A</td>
</tr>
<tr>
<td>redis:ins:cmd_qps</td>
<td>Unknown</td>
<td><code>cls</code>, <code>cmd</code>, <code>ip</code>, <code>instance</code>, <code>ins</code>, <code>job</code></td>
<td>N/A</td>
</tr>
<tr>
<td>redis:ins:cmd_rt</td>
<td>Unknown</td>
<td><code>cls</code>, <code>cmd</code>, <code>ip</code>, <code>instance</code>, <code>ins</code>, <code>job</code></td>
<td>N/A</td>
</tr>
<tr>
<td>redis:ins:cmd_time</td>
<td>Unknown</td>
<td><code>cls</code>, <code>cmd</code>, <code>ip</code>, <code>instance</code>, <code>ins</code>, <code>job</code></td>
<td>N/A</td>
</tr>
<tr>
<td>redis:ins:conn_rate</td>
<td>Unknown</td>
<td><code>cls</code>, <code>ip</code>, <code>instance</code>, <code>ins</code>, <code>job</code></td>
<td>N/A</td>
</tr>
<tr>
<td>redis:ins:conn_reject</td>
<td>Unknown</td>
<td><code>cls</code>, <code>ip</code>, <code>instance</code>, <code>ins</code>, <code>job</code></td>
<td>N/A</td>
</tr>
<tr>
<td>redis:ins:cpu_sys</td>
<td>Unknown</td>
<td><code>cls</code>, <code>ip</code>, <code>instance</code>, <code>ins</code>, <code>job</code></td>
<td>N/A</td>
</tr>
<tr>
<td>redis:ins:cpu_sys_child</td>
<td>Unknown</td>
<td><code>cls</code>, <code>ip</code>, <code>instance</code>, <code>ins</code>, <code>job</code></td>
<td>N/A</td>
</tr>
<tr>
<td>redis:ins:cpu_usage</td>
<td>Unknown</td>
<td><code>cls</code>, <code>ip</code>, <code>instance</code>, <code>ins</code>, <code>job</code></td>
<td>N/A</td>
</tr>
<tr>
<td>redis:ins:cpu_usage_child</td>
<td>Unknown</td>
<td><code>cls</code>, <code>ip</code>, <code>instance</code>, <code>ins</code>, <code>job</code></td>
<td>N/A</td>
</tr>
<tr>
<td>redis:ins:cpu_user</td>
<td>Unknown</td>
<td><code>cls</code>, <code>ip</code>, <code>instance</code>, <code>ins</code>, <code>job</code></td>
<td>N/A</td>
</tr>
<tr>
<td>redis:ins:cpu_user_child</td>
<td>Unknown</td>
<td><code>cls</code>, <code>ip</code>, <code>instance</code>, <code>ins</code>, <code>job</code></td>
<td>N/A</td>
</tr>
<tr>
<td>redis:ins:key_evict</td>
<td>Unknown</td>
<td><code>cls</code>, <code>ip</code>, <code>instance</code>, <code>ins</code>, <code>job</code></td>
<td>N/A</td>
</tr>
<tr>
<td>redis:ins:key_expire</td>
<td>Unknown</td>
<td><code>cls</code>, <code>ip</code>, <code>instance</code>, <code>ins</code>, <code>job</code></td>
<td>N/A</td>
</tr>
<tr>
<td>redis:ins:key_hit</td>
<td>Unknown</td>
<td><code>cls</code>, <code>ip</code>, <code>instance</code>, <code>ins</code>, <code>job</code></td>
<td>N/A</td>
</tr>
<tr>
<td>redis:ins:key_hit_rate</td>
<td>Unknown</td>
<td><code>cls</code>, <code>ip</code>, <code>instance</code>, <code>ins</code>, <code>job</code></td>
<td>N/A</td>
</tr>
<tr>
<td>redis:ins:key_miss</td>
<td>Unknown</td>
<td><code>cls</code>, <code>ip</code>, <code>instance</code>, <code>ins</code>, <code>job</code></td>
<td>N/A</td>
</tr>
<tr>
<td>redis:ins:lsn_rate</td>
<td>Unknown</td>
<td><code>cls</code>, <code>ip</code>, <code>instance</code>, <code>ins</code>, <code>job</code></td>
<td>N/A</td>
</tr>
<tr>
<td>redis:ins:mem_usage</td>
<td>Unknown</td>
<td><code>cls</code>, <code>ip</code>, <code>instance</code>, <code>ins</code>, <code>job</code></td>
<td>N/A</td>
</tr>
<tr>
<td>redis:ins:net_traffic</td>
<td>Unknown</td>
<td><code>cls</code>, <code>ip</code>, <code>instance</code>, <code>ins</code>, <code>job</code></td>
<td>N/A</td>
</tr>
<tr>
<td>redis:ins:qps</td>
<td>Unknown</td>
<td><code>cls</code>, <code>ip</code>, <code>instance</code>, <code>ins</code>, <code>job</code></td>
<td>N/A</td>
</tr>
<tr>
<td>redis:ins:qps_mu</td>
<td>Unknown</td>
<td><code>cls</code>, <code>ip</code>, <code>instance</code>, <code>ins</code>, <code>job</code></td>
<td>N/A</td>
</tr>
<tr>
<td>redis:ins:qps_realtime</td>
<td>Unknown</td>
<td><code>cls</code>, <code>ip</code>, <code>instance</code>, <code>ins</code>, <code>job</code></td>
<td>N/A</td>
</tr>
<tr>
<td>redis:ins:qps_sigma</td>
<td>Unknown</td>
<td><code>cls</code>, <code>ip</code>, <code>instance</code>, <code>ins</code>, <code>job</code></td>
<td>N/A</td>
</tr>
<tr>
<td>redis:ins:rt</td>
<td>Unknown</td>
<td><code>cls</code>, <code>ip</code>, <code>instance</code>, <code>ins</code>, <code>job</code></td>
<td>N/A</td>
</tr>
<tr>
<td>redis:ins:rt_mu</td>
<td>Unknown</td>
<td><code>cls</code>, <code>ip</code>, <code>instance</code>, <code>ins</code>, <code>job</code></td>
<td>N/A</td>
</tr>
<tr>
<td>redis:ins:rt_sigma</td>
<td>Unknown</td>
<td><code>cls</code>, <code>ip</code>, <code>instance</code>, <code>ins</code>, <code>job</code></td>
<td>N/A</td>
</tr>
<tr>
<td>redis:ins:rx</td>
<td>Unknown</td>
<td><code>cls</code>, <code>ip</code>, <code>instance</code>, <code>ins</code>, <code>job</code></td>
<td>N/A</td>
</tr>
<tr>
<td>redis:ins:tx</td>
<td>Unknown</td>
<td><code>cls</code>, <code>ip</code>, <code>instance</code>, <code>ins</code>, <code>job</code></td>
<td>N/A</td>
</tr>
<tr>
<td>redis:node:ip</td>
<td>Unknown</td>
<td><code>cls</code>, <code>ip</code>, <code>instance</code>, <code>ins</code>, <code>job</code></td>
<td>N/A</td>
</tr>
<tr>
<td>redis:node:mem_alloc</td>
<td>Unknown</td>
<td><code>cls</code>, <code>ip</code>, <code>job</code></td>
<td>N/A</td>
</tr>
<tr>
<td>redis:node:mem_total</td>
<td>Unknown</td>
<td><code>cls</code>, <code>ip</code>, <code>job</code></td>
<td>N/A</td>
</tr>
<tr>
<td>redis:node:mem_used</td>
<td>Unknown</td>
<td><code>cls</code>, <code>ip</code>, <code>job</code></td>
<td>N/A</td>
</tr>
<tr>
<td>redis:node:qps</td>
<td>Unknown</td>
<td><code>cls</code>, <code>ip</code>, <code>job</code></td>
<td>N/A</td>
</tr>
<tr>
<td>redis_active_defrag_running</td>
<td>gauge</td>
<td><code>cls</code>, <code>ip</code>, <code>instance</code>, <code>ins</code>, <code>job</code></td>
<td>active_defrag_running metric</td>
</tr>
<tr>
<td>redis_allocator_active_bytes</td>
<td>gauge</td>
<td><code>cls</code>, <code>ip</code>, <code>instance</code>, <code>ins</code>, <code>job</code></td>
<td>allocator_active_bytes metric</td>
</tr>
<tr>
<td>redis_allocator_allocated_bytes</td>
<td>gauge</td>
<td><code>cls</code>, <code>ip</code>, <code>instance</code>, <code>ins</code>, <code>job</code></td>
<td>allocator_allocated_bytes metric</td>
</tr>
<tr>
<td>redis_allocator_frag_bytes</td>
<td>gauge</td>
<td><code>cls</code>, <code>ip</code>, <code>instance</code>, <code>ins</code>, <code>job</code></td>
<td>allocator_frag_bytes metric</td>
</tr>
<tr>
<td>redis_allocator_frag_ratio</td>
<td>gauge</td>
<td><code>cls</code>, <code>ip</code>, <code>instance</code>, <code>ins</code>, <code>job</code></td>
<td>allocator_frag_ratio metric</td>
</tr>
<tr>
<td>redis_allocator_resident_bytes</td>
<td>gauge</td>
<td><code>cls</code>, <code>ip</code>, <code>instance</code>, <code>ins</code>, <code>job</code></td>
<td>allocator_resident_bytes metric</td>
</tr>
<tr>
<td>redis_allocator_rss_bytes</td>
<td>gauge</td>
<td><code>cls</code>, <code>ip</code>, <code>instance</code>, <code>ins</code>, <code>job</code></td>
<td>allocator_rss_bytes metric</td>
</tr>
<tr>
<td>redis_allocator_rss_ratio</td>
<td>gauge</td>
<td><code>cls</code>, <code>ip</code>, <code>instance</code>, <code>ins</code>, <code>job</code></td>
<td>allocator_rss_ratio metric</td>
</tr>
<tr>
<td>redis_aof_current_rewrite_duration_sec</td>
<td>gauge</td>
<td><code>cls</code>, <code>ip</code>, <code>instance</code>, <code>ins</code>, <code>job</code></td>
<td>aof_current_rewrite_duration_sec metric</td>
</tr>
<tr>
<td>redis_aof_enabled</td>
<td>gauge</td>
<td><code>cls</code>, <code>ip</code>, <code>instance</code>, <code>ins</code>, <code>job</code></td>
<td>aof_enabled metric</td>
</tr>
<tr>
<td>redis_aof_last_bgrewrite_status</td>
<td>gauge</td>
<td><code>cls</code>, <code>ip</code>, <code>instance</code>, <code>ins</code>, <code>job</code></td>
<td>aof_last_bgrewrite_status metric</td>
</tr>
<tr>
<td>redis_aof_last_cow_size_bytes</td>
<td>gauge</td>
<td><code>cls</code>, <code>ip</code>, <code>instance</code>, <code>ins</code>, <code>job</code></td>
<td>aof_last_cow_size_bytes metric</td>
</tr>
<tr>
<td>redis_aof_last_rewrite_duration_sec</td>
<td>gauge</td>
<td><code>cls</code>, <code>ip</code>, <code>instance</code>, <code>ins</code>, <code>job</code></td>
<td>aof_last_rewrite_duration_sec metric</td>
</tr>
<tr>
<td>redis_aof_last_write_status</td>
<td>gauge</td>
<td><code>cls</code>, <code>ip</code>, <code>instance</code>, <code>ins</code>, <code>job</code></td>
<td>aof_last_write_status metric</td>
</tr>
<tr>
<td>redis_aof_rewrite_in_progress</td>
<td>gauge</td>
<td><code>cls</code>, <code>ip</code>, <code>instance</code>, <code>ins</code>, <code>job</code></td>
<td>aof_rewrite_in_progress metric</td>
</tr>
<tr>
<td>redis_aof_rewrite_scheduled</td>
<td>gauge</td>
<td><code>cls</code>, <code>ip</code>, <code>instance</code>, <code>ins</code>, <code>job</code></td>
<td>aof_rewrite_scheduled metric</td>
</tr>
<tr>
<td>redis_blocked_clients</td>
<td>gauge</td>
<td><code>cls</code>, <code>ip</code>, <code>instance</code>, <code>ins</code>, <code>job</code></td>
<td>blocked_clients metric</td>
</tr>
<tr>
<td>redis_client_recent_max_input_buffer_bytes</td>
<td>gauge</td>
<td><code>cls</code>, <code>ip</code>, <code>instance</code>, <code>ins</code>, <code>job</code></td>
<td>client_recent_max_input_buffer_bytes metric</td>
</tr>
<tr>
<td>redis_client_recent_max_output_buffer_bytes</td>
<td>gauge</td>
<td><code>cls</code>, <code>ip</code>, <code>instance</code>, <code>ins</code>, <code>job</code></td>
<td>client_recent_max_output_buffer_bytes metric</td>
</tr>
<tr>
<td>redis_clients_in_timeout_table</td>
<td>gauge</td>
<td><code>cls</code>, <code>ip</code>, <code>instance</code>, <code>ins</code>, <code>job</code></td>
<td>clients_in_timeout_table metric</td>
</tr>
<tr>
<td>redis_cluster_connections</td>
<td>gauge</td>
<td><code>cls</code>, <code>ip</code>, <code>instance</code>, <code>ins</code>, <code>job</code></td>
<td>cluster_connections metric</td>
</tr>
<tr>
<td>redis_cluster_current_epoch</td>
<td>gauge</td>
<td><code>cls</code>, <code>ip</code>, <code>instance</code>, <code>ins</code>, <code>job</code></td>
<td>cluster_current_epoch metric</td>
</tr>
<tr>
<td>redis_cluster_enabled</td>
<td>gauge</td>
<td><code>cls</code>, <code>ip</code>, <code>instance</code>, <code>ins</code>, <code>job</code></td>
<td>cluster_enabled metric</td>
</tr>
<tr>
<td>redis_cluster_known_nodes</td>
<td>gauge</td>
<td><code>cls</code>, <code>ip</code>, <code>instance</code>, <code>ins</code>, <code>job</code></td>
<td>cluster_known_nodes metric</td>
</tr>
<tr>
<td>redis_cluster_messages_received_total</td>
<td>gauge</td>
<td><code>cls</code>, <code>ip</code>, <code>instance</code>, <code>ins</code>, <code>job</code></td>
<td>cluster_messages_received_total metric</td>
</tr>
<tr>
<td>redis_cluster_messages_sent_total</td>
<td>gauge</td>
<td><code>cls</code>, <code>ip</code>, <code>instance</code>, <code>ins</code>, <code>job</code></td>
<td>cluster_messages_sent_total metric</td>
</tr>
<tr>
<td>redis_cluster_my_epoch</td>
<td>gauge</td>
<td><code>cls</code>, <code>ip</code>, <code>instance</code>, <code>ins</code>, <code>job</code></td>
<td>cluster_my_epoch metric</td>
</tr>
<tr>
<td>redis_cluster_size</td>
<td>gauge</td>
<td><code>cls</code>, <code>ip</code>, <code>instance</code>, <code>ins</code>, <code>job</code></td>
<td>cluster_size metric</td>
</tr>
<tr>
<td>redis_cluster_slots_assigned</td>
<td>gauge</td>
<td><code>cls</code>, <code>ip</code>, <code>instance</code>, <code>ins</code>, <code>job</code></td>
<td>cluster_slots_assigned metric</td>
</tr>
<tr>
<td>redis_cluster_slots_fail</td>
<td>gauge</td>
<td><code>cls</code>, <code>ip</code>, <code>instance</code>, <code>ins</code>, <code>job</code></td>
<td>cluster_slots_fail metric</td>
</tr>
<tr>
<td>redis_cluster_slots_ok</td>
<td>gauge</td>
<td><code>cls</code>, <code>ip</code>, <code>instance</code>, <code>ins</code>, <code>job</code></td>
<td>cluster_slots_ok metric</td>
</tr>
<tr>
<td>redis_cluster_slots_pfail</td>
<td>gauge</td>
<td><code>cls</code>, <code>ip</code>, <code>instance</code>, <code>ins</code>, <code>job</code></td>
<td>cluster_slots_pfail metric</td>
</tr>
<tr>
<td>redis_cluster_state</td>
<td>gauge</td>
<td><code>cls</code>, <code>ip</code>, <code>instance</code>, <code>ins</code>, <code>job</code></td>
<td>cluster_state metric</td>
</tr>
<tr>
<td>redis_cluster_stats_messages_meet_received</td>
<td>gauge</td>
<td><code>cls</code>, <code>ip</code>, <code>instance</code>, <code>ins</code>, <code>job</code></td>
<td>cluster_stats_messages_meet_received metric</td>
</tr>
<tr>
<td>redis_cluster_stats_messages_meet_sent</td>
<td>gauge</td>
<td><code>cls</code>, <code>ip</code>, <code>instance</code>, <code>ins</code>, <code>job</code></td>
<td>cluster_stats_messages_meet_sent metric</td>
</tr>
<tr>
<td>redis_cluster_stats_messages_ping_received</td>
<td>gauge</td>
<td><code>cls</code>, <code>ip</code>, <code>instance</code>, <code>ins</code>, <code>job</code></td>
<td>cluster_stats_messages_ping_received metric</td>
</tr>
<tr>
<td>redis_cluster_stats_messages_ping_sent</td>
<td>gauge</td>
<td><code>cls</code>, <code>ip</code>, <code>instance</code>, <code>ins</code>, <code>job</code></td>
<td>cluster_stats_messages_ping_sent metric</td>
</tr>
<tr>
<td>redis_cluster_stats_messages_pong_received</td>
<td>gauge</td>
<td><code>cls</code>, <code>ip</code>, <code>instance</code>, <code>ins</code>, <code>job</code></td>
<td>cluster_stats_messages_pong_received metric</td>
</tr>
<tr>
<td>redis_cluster_stats_messages_pong_sent</td>
<td>gauge</td>
<td><code>cls</code>, <code>ip</code>, <code>instance</code>, <code>ins</code>, <code>job</code></td>
<td>cluster_stats_messages_pong_sent metric</td>
</tr>
<tr>
<td>redis_commands_duration_seconds_total</td>
<td>counter</td>
<td><code>cls</code>, <code>cmd</code>, <code>ip</code>, <code>instance</code>, <code>ins</code>, <code>job</code></td>
<td>Total amount of time in seconds spent per command</td>
</tr>
<tr>
<td>redis_commands_failed_calls_total</td>
<td>counter</td>
<td><code>cls</code>, <code>cmd</code>, <code>ip</code>, <code>instance</code>, <code>ins</code>, <code>job</code></td>
<td>Total number of errors prior command execution per command</td>
</tr>
<tr>
<td>redis_commands_latencies_usec_bucket</td>
<td>Unknown</td>
<td><code>cls</code>, <code>cmd</code>, <code>ip</code>, <code>le</code>, <code>instance</code>, <code>ins</code>, <code>job</code></td>
<td>N/A</td>
</tr>
<tr>
<td>redis_commands_latencies_usec_count</td>
<td>Unknown</td>
<td><code>cls</code>, <code>cmd</code>, <code>ip</code>, <code>instance</code>, <code>ins</code>, <code>job</code></td>
<td>N/A</td>
</tr>
<tr>
<td>redis_commands_latencies_usec_sum</td>
<td>Unknown</td>
<td><code>cls</code>, <code>cmd</code>, <code>ip</code>, <code>instance</code>, <code>ins</code>, <code>job</code></td>
<td>N/A</td>
</tr>
<tr>
<td>redis_commands_processed_total</td>
<td>counter</td>
<td><code>cls</code>, <code>ip</code>, <code>instance</code>, <code>ins</code>, <code>job</code></td>
<td>commands_processed_total metric</td>
</tr>
<tr>
<td>redis_commands_rejected_calls_total</td>
<td>counter</td>
<td><code>cls</code>, <code>cmd</code>, <code>ip</code>, <code>instance</code>, <code>ins</code>, <code>job</code></td>
<td>Total number of errors within command execution per command</td>
</tr>
<tr>
<td>redis_commands_total</td>
<td>counter</td>
<td><code>cls</code>, <code>cmd</code>, <code>ip</code>, <code>instance</code>, <code>ins</code>, <code>job</code></td>
<td>Total number of calls per command</td>
</tr>
<tr>
<td>redis_config_io_threads</td>
<td>gauge</td>
<td><code>cls</code>, <code>ip</code>, <code>instance</code>, <code>ins</code>, <code>job</code></td>
<td>config_io_threads metric</td>
</tr>
<tr>
<td>redis_config_maxclients</td>
<td>gauge</td>
<td><code>cls</code>, <code>ip</code>, <code>instance</code>, <code>ins</code>, <code>job</code></td>
<td>config_maxclients metric</td>
</tr>
<tr>
<td>redis_config_maxmemory</td>
<td>gauge</td>
<td><code>cls</code>, <code>ip</code>, <code>instance</code>, <code>ins</code>, <code>job</code></td>
<td>config_maxmemory metric</td>
</tr>
<tr>
<td>redis_connected_clients</td>
<td>gauge</td>
<td><code>cls</code>, <code>ip</code>, <code>instance</code>, <code>ins</code>, <code>job</code></td>
<td>connected_clients metric</td>
</tr>
<tr>
<td>redis_connected_slave_lag_seconds</td>
<td>gauge</td>
<td><code>cls</code>, <code>ip</code>, <code>slave_ip</code>, <code>instance</code>, <code>slave_state</code>, <code>ins</code>, <code>slave_port</code>, <code>job</code></td>
<td>Lag of connected slave</td>
</tr>
<tr>
<td>redis_connected_slave_offset_bytes</td>
<td>gauge</td>
<td><code>cls</code>, <code>ip</code>, <code>slave_ip</code>, <code>instance</code>, <code>slave_state</code>, <code>ins</code>, <code>slave_port</code>, <code>job</code></td>
<td>Offset of connected slave</td>
</tr>
<tr>
<td>redis_connected_slaves</td>
<td>gauge</td>
<td><code>cls</code>, <code>ip</code>, <code>instance</code>, <code>ins</code>, <code>job</code></td>
<td>connected_slaves metric</td>
</tr>
<tr>
<td>redis_connections_received_total</td>
<td>counter</td>
<td><code>cls</code>, <code>ip</code>, <code>instance</code>, <code>ins</code>, <code>job</code></td>
<td>connections_received_total metric</td>
</tr>
<tr>
<td>redis_cpu_sys_children_seconds_total</td>
<td>counter</td>
<td><code>cls</code>, <code>ip</code>, <code>instance</code>, <code>ins</code>, <code>job</code></td>
<td>cpu_sys_children_seconds_total metric</td>
</tr>
<tr>
<td>redis_cpu_sys_main_thread_seconds_total</td>
<td>counter</td>
<td><code>cls</code>, <code>ip</code>, <code>instance</code>, <code>ins</code>, <code>job</code></td>
<td>cpu_sys_main_thread_seconds_total metric</td>
</tr>
<tr>
<td>redis_cpu_sys_seconds_total</td>
<td>counter</td>
<td><code>cls</code>, <code>ip</code>, <code>instance</code>, <code>ins</code>, <code>job</code></td>
<td>cpu_sys_seconds_total metric</td>
</tr>
<tr>
<td>redis_cpu_user_children_seconds_total</td>
<td>counter</td>
<td><code>cls</code>, <code>ip</code>, <code>instance</code>, <code>ins</code>, <code>job</code></td>
<td>cpu_user_children_seconds_total metric</td>
</tr>
<tr>
<td>redis_cpu_user_main_thread_seconds_total</td>
<td>counter</td>
<td><code>cls</code>, <code>ip</code>, <code>instance</code>, <code>ins</code>, <code>job</code></td>
<td>cpu_user_main_thread_seconds_total metric</td>
</tr>
<tr>
<td>redis_cpu_user_seconds_total</td>
<td>counter</td>
<td><code>cls</code>, <code>ip</code>, <code>instance</code>, <code>ins</code>, <code>job</code></td>
<td>cpu_user_seconds_total metric</td>
</tr>
<tr>
<td>redis_db_keys</td>
<td>gauge</td>
<td><code>cls</code>, <code>ip</code>, <code>instance</code>, <code>ins</code>, <code>db</code>, <code>job</code></td>
<td>Total number of keys by DB</td>
</tr>
<tr>
<td>redis_db_keys_expiring</td>
<td>gauge</td>
<td><code>cls</code>, <code>ip</code>, <code>instance</code>, <code>ins</code>, <code>db</code>, <code>job</code></td>
<td>Total number of expiring keys by DB</td>
</tr>
<tr>
<td>redis_defrag_hits</td>
<td>gauge</td>
<td><code>cls</code>, <code>ip</code>, <code>instance</code>, <code>ins</code>, <code>job</code></td>
<td>defrag_hits metric</td>
</tr>
<tr>
<td>redis_defrag_key_hits</td>
<td>gauge</td>
<td><code>cls</code>, <code>ip</code>, <code>instance</code>, <code>ins</code>, <code>job</code></td>
<td>defrag_key_hits metric</td>
</tr>
<tr>
<td>redis_defrag_key_misses</td>
<td>gauge</td>
<td><code>cls</code>, <code>ip</code>, <code>instance</code>, <code>ins</code>, <code>job</code></td>
<td>defrag_key_misses metric</td>
</tr>
<tr>
<td>redis_defrag_misses</td>
<td>gauge</td>
<td><code>cls</code>, <code>ip</code>, <code>instance</code>, <code>ins</code>, <code>job</code></td>
<td>defrag_misses metric</td>
</tr>
<tr>
<td>redis_dump_payload_sanitizations</td>
<td>counter</td>
<td><code>cls</code>, <code>ip</code>, <code>instance</code>, <code>ins</code>, <code>job</code></td>
<td>dump_payload_sanitizations metric</td>
</tr>
<tr>
<td>redis_errors_total</td>
<td>counter</td>
<td><code>cls</code>, <code>ip</code>, <code>err</code>, <code>instance</code>, <code>ins</code>, <code>job</code></td>
<td>Total number of errors per error type</td>
</tr>
<tr>
<td>redis_evicted_keys_total</td>
<td>counter</td>
<td><code>cls</code>, <code>ip</code>, <code>instance</code>, <code>ins</code>, <code>job</code></td>
<td>evicted_keys_total metric</td>
</tr>
<tr>
<td>redis_expired_keys_total</td>
<td>counter</td>
<td><code>cls</code>, <code>ip</code>, <code>instance</code>, <code>ins</code>, <code>job</code></td>
<td>expired_keys_total metric</td>
</tr>
<tr>
<td>redis_expired_stale_percentage</td>
<td>gauge</td>
<td><code>cls</code>, <code>ip</code>, <code>instance</code>, <code>ins</code>, <code>job</code></td>
<td>expired_stale_percentage metric</td>
</tr>
<tr>
<td>redis_expired_time_cap_reached_total</td>
<td>gauge</td>
<td><code>cls</code>, <code>ip</code>, <code>instance</code>, <code>ins</code>, <code>job</code></td>
<td>expired_time_cap_reached_total metric</td>
</tr>
<tr>
<td>redis_exporter_build_info</td>
<td>gauge</td>
<td><code>cls</code>, <code>golang_version</code>, <code>ip</code>, <code>commit_sha</code>, <code>instance</code>, <code>version</code>, <code>ins</code>, <code>job</code>, <code>build_date</code></td>
<td>redis exporter build_info</td>
</tr>
<tr>
<td>redis_exporter_last_scrape_connect_time_seconds</td>
<td>gauge</td>
<td><code>cls</code>, <code>ip</code>, <code>instance</code>, <code>ins</code>, <code>job</code></td>
<td>exporter_last_scrape_connect_time_seconds metric</td>
</tr>
<tr>
<td>redis_exporter_last_scrape_duration_seconds</td>
<td>gauge</td>
<td><code>cls</code>, <code>ip</code>, <code>instance</code>, <code>ins</code>, <code>job</code></td>
<td>exporter_last_scrape_duration_seconds metric</td>
</tr>
<tr>
<td>redis_exporter_last_scrape_error</td>
<td>gauge</td>
<td><code>cls</code>, <code>ip</code>, <code>instance</code>, <code>ins</code>, <code>job</code></td>
<td>The last scrape error status.</td>
</tr>
<tr>
<td>redis_exporter_scrape_duration_seconds_count</td>
<td>Unknown</td>
<td><code>cls</code>, <code>ip</code>, <code>instance</code>, <code>ins</code>, <code>job</code></td>
<td>N/A</td>
</tr>
<tr>
<td>redis_exporter_scrape_duration_seconds_sum</td>
<td>Unknown</td>
<td><code>cls</code>, <code>ip</code>, <code>instance</code>, <code>ins</code>, <code>job</code></td>
<td>N/A</td>
</tr>
<tr>
<td>redis_exporter_scrapes_total</td>
<td>counter</td>
<td><code>cls</code>, <code>ip</code>, <code>instance</code>, <code>ins</code>, <code>job</code></td>
<td>Current total redis scrapes.</td>
</tr>
<tr>
<td>redis_instance_info</td>
<td>gauge</td>
<td><code>cls</code>, <code>ip</code>, <code>os</code>, <code>role</code>, <code>instance</code>, <code>run_id</code>, <code>redis_version</code>, <code>tcp_port</code>, <code>process_id</code>, <code>ins</code>, <code>redis_mode</code>, <code>maxmemory_policy</code>, <code>redis_build_id</code>, <code>job</code></td>
<td>Information about the Redis instance</td>
</tr>
<tr>
<td>redis_io_threaded_reads_processed</td>
<td>counter</td>
<td><code>cls</code>, <code>ip</code>, <code>instance</code>, <code>ins</code>, <code>job</code></td>
<td>io_threaded_reads_processed metric</td>
</tr>
<tr>
<td>redis_io_threaded_writes_processed</td>
<td>counter</td>
<td><code>cls</code>, <code>ip</code>, <code>instance</code>, <code>ins</code>, <code>job</code></td>
<td>io_threaded_writes_processed metric</td>
</tr>
<tr>
<td>redis_io_threads_active</td>
<td>gauge</td>
<td><code>cls</code>, <code>ip</code>, <code>instance</code>, <code>ins</code>, <code>job</code></td>
<td>io_threads_active metric</td>
</tr>
<tr>
<td>redis_keyspace_hits_total</td>
<td>counter</td>
<td><code>cls</code>, <code>ip</code>, <code>instance</code>, <code>ins</code>, <code>job</code></td>
<td>keyspace_hits_total metric</td>
</tr>
<tr>
<td>redis_keyspace_misses_total</td>
<td>counter</td>
<td><code>cls</code>, <code>ip</code>, <code>instance</code>, <code>ins</code>, <code>job</code></td>
<td>keyspace_misses_total metric</td>
</tr>
<tr>
<td>redis_last_key_groups_scrape_duration_milliseconds</td>
<td>gauge</td>
<td><code>cls</code>, <code>ip</code>, <code>instance</code>, <code>ins</code>, <code>job</code></td>
<td>Duration of the last key group metrics scrape in milliseconds</td>
</tr>
<tr>
<td>redis_last_slow_execution_duration_seconds</td>
<td>gauge</td>
<td><code>cls</code>, <code>ip</code>, <code>instance</code>, <code>ins</code>, <code>job</code></td>
<td>The amount of time needed for last slow execution, in seconds</td>
</tr>
<tr>
<td>redis_latency_percentiles_usec</td>
<td>summary</td>
<td><code>cls</code>, <code>cmd</code>, <code>ip</code>, <code>instance</code>, <code>quantile</code>, <code>ins</code>, <code>job</code></td>
<td>A summary of latency percentile distribution per command</td>
</tr>
<tr>
<td>redis_latency_percentiles_usec_count</td>
<td>Unknown</td>
<td><code>cls</code>, <code>cmd</code>, <code>ip</code>, <code>instance</code>, <code>ins</code>, <code>job</code></td>
<td>N/A</td>
</tr>
<tr>
<td>redis_latency_percentiles_usec_sum</td>
<td>Unknown</td>
<td><code>cls</code>, <code>cmd</code>, <code>ip</code>, <code>instance</code>, <code>ins</code>, <code>job</code></td>
<td>N/A</td>
</tr>
<tr>
<td>redis_latest_fork_seconds</td>
<td>gauge</td>
<td><code>cls</code>, <code>ip</code>, <code>instance</code>, <code>ins</code>, <code>job</code></td>
<td>latest_fork_seconds metric</td>
</tr>
<tr>
<td>redis_lazyfree_pending_objects</td>
<td>gauge</td>
<td><code>cls</code>, <code>ip</code>, <code>instance</code>, <code>ins</code>, <code>job</code></td>
<td>lazyfree_pending_objects metric</td>
</tr>
<tr>
<td>redis_loading_dump_file</td>
<td>gauge</td>
<td><code>cls</code>, <code>ip</code>, <code>instance</code>, <code>ins</code>, <code>job</code></td>
<td>loading_dump_file metric</td>
</tr>
<tr>
<td>redis_master_last_io_seconds_ago</td>
<td>gauge</td>
<td><code>cls</code>, <code>ip</code>, <code>master_host</code>, <code>instance</code>, <code>ins</code>, <code>job</code>, <code>master_port</code></td>
<td>Master last io seconds ago</td>
</tr>
<tr>
<td>redis_master_link_up</td>
<td>gauge</td>
<td><code>cls</code>, <code>ip</code>, <code>master_host</code>, <code>instance</code>, <code>ins</code>, <code>job</code>, <code>master_port</code></td>
<td>Master link status on Redis slave</td>
</tr>
<tr>
<td>redis_master_repl_offset</td>
<td>gauge</td>
<td><code>cls</code>, <code>ip</code>, <code>instance</code>, <code>ins</code>, <code>job</code></td>
<td>master_repl_offset metric</td>
</tr>
<tr>
<td>redis_master_sync_in_progress</td>
<td>gauge</td>
<td><code>cls</code>, <code>ip</code>, <code>master_host</code>, <code>instance</code>, <code>ins</code>, <code>job</code>, <code>master_port</code></td>
<td>Master sync in progress</td>
</tr>
<tr>
<td>redis_mem_clients_normal</td>
<td>gauge</td>
<td><code>cls</code>, <code>ip</code>, <code>instance</code>, <code>ins</code>, <code>job</code></td>
<td>mem_clients_normal metric</td>
</tr>
<tr>
<td>redis_mem_clients_slaves</td>
<td>gauge</td>
<td><code>cls</code>, <code>ip</code>, <code>instance</code>, <code>ins</code>, <code>job</code></td>
<td>mem_clients_slaves metric</td>
</tr>
<tr>
<td>redis_mem_fragmentation_bytes</td>
<td>gauge</td>
<td><code>cls</code>, <code>ip</code>, <code>instance</code>, <code>ins</code>, <code>job</code></td>
<td>mem_fragmentation_bytes metric</td>
</tr>
<tr>
<td>redis_mem_fragmentation_ratio</td>
<td>gauge</td>
<td><code>cls</code>, <code>ip</code>, <code>instance</code>, <code>ins</code>, <code>job</code></td>
<td>mem_fragmentation_ratio metric</td>
</tr>
<tr>
<td>redis_mem_not_counted_for_eviction_bytes</td>
<td>gauge</td>
<td><code>cls</code>, <code>ip</code>, <code>instance</code>, <code>ins</code>, <code>job</code></td>
<td>mem_not_counted_for_eviction_bytes metric</td>
</tr>
<tr>
<td>redis_memory_max_bytes</td>
<td>gauge</td>
<td><code>cls</code>, <code>ip</code>, <code>instance</code>, <code>ins</code>, <code>job</code></td>
<td>memory_max_bytes metric</td>
</tr>
<tr>
<td>redis_memory_used_bytes</td>
<td>gauge</td>
<td><code>cls</code>, <code>ip</code>, <code>instance</code>, <code>ins</code>, <code>job</code></td>
<td>memory_used_bytes metric</td>
</tr>
<tr>
<td>redis_memory_used_dataset_bytes</td>
<td>gauge</td>
<td><code>cls</code>, <code>ip</code>, <code>instance</code>, <code>ins</code>, <code>job</code></td>
<td>memory_used_dataset_bytes metric</td>
</tr>
<tr>
<td>redis_memory_used_lua_bytes</td>
<td>gauge</td>
<td><code>cls</code>, <code>ip</code>, <code>instance</code>, <code>ins</code>, <code>job</code></td>
<td>memory_used_lua_bytes metric</td>
</tr>
<tr>
<td>redis_memory_used_overhead_bytes</td>
<td>gauge</td>
<td><code>cls</code>, <code>ip</code>, <code>instance</code>, <code>ins</code>, <code>job</code></td>
<td>memory_used_overhead_bytes metric</td>
</tr>
<tr>
<td>redis_memory_used_peak_bytes</td>
<td>gauge</td>
<td><code>cls</code>, <code>ip</code>, <code>instance</code>, <code>ins</code>, <code>job</code></td>
<td>memory_used_peak_bytes metric</td>
</tr>
<tr>
<td>redis_memory_used_rss_bytes</td>
<td>gauge</td>
<td><code>cls</code>, <code>ip</code>, <code>instance</code>, <code>ins</code>, <code>job</code></td>
<td>memory_used_rss_bytes metric</td>
</tr>
<tr>
<td>redis_memory_used_scripts_bytes</td>
<td>gauge</td>
<td><code>cls</code>, <code>ip</code>, <code>instance</code>, <code>ins</code>, <code>job</code></td>
<td>memory_used_scripts_bytes metric</td>
</tr>
<tr>
<td>redis_memory_used_startup_bytes</td>
<td>gauge</td>
<td><code>cls</code>, <code>ip</code>, <code>instance</code>, <code>ins</code>, <code>job</code></td>
<td>memory_used_startup_bytes metric</td>
</tr>
<tr>
<td>redis_migrate_cached_sockets_total</td>
<td>gauge</td>
<td><code>cls</code>, <code>ip</code>, <code>instance</code>, <code>ins</code>, <code>job</code></td>
<td>migrate_cached_sockets_total metric</td>
</tr>
<tr>
<td>redis_module_fork_in_progress</td>
<td>gauge</td>
<td><code>cls</code>, <code>ip</code>, <code>instance</code>, <code>ins</code>, <code>job</code></td>
<td>module_fork_in_progress metric</td>
</tr>
<tr>
<td>redis_module_fork_last_cow_size</td>
<td>gauge</td>
<td><code>cls</code>, <code>ip</code>, <code>instance</code>, <code>ins</code>, <code>job</code></td>
<td>module_fork_last_cow_size metric</td>
</tr>
<tr>
<td>redis_net_input_bytes_total</td>
<td>counter</td>
<td><code>cls</code>, <code>ip</code>, <code>instance</code>, <code>ins</code>, <code>job</code></td>
<td>net_input_bytes_total metric</td>
</tr>
<tr>
<td>redis_net_output_bytes_total</td>
<td>counter</td>
<td><code>cls</code>, <code>ip</code>, <code>instance</code>, <code>ins</code>, <code>job</code></td>
<td>net_output_bytes_total metric</td>
</tr>
<tr>
<td>redis_number_of_cached_scripts</td>
<td>gauge</td>
<td><code>cls</code>, <code>ip</code>, <code>instance</code>, <code>ins</code>, <code>job</code></td>
<td>number_of_cached_scripts metric</td>
</tr>
<tr>
<td>redis_process_id</td>
<td>gauge</td>
<td><code>cls</code>, <code>ip</code>, <code>instance</code>, <code>ins</code>, <code>job</code></td>
<td>process_id metric</td>
</tr>
<tr>
<td>redis_pubsub_channels</td>
<td>gauge</td>
<td><code>cls</code>, <code>ip</code>, <code>instance</code>, <code>ins</code>, <code>job</code></td>
<td>pubsub_channels metric</td>
</tr>
<tr>
<td>redis_pubsub_patterns</td>
<td>gauge</td>
<td><code>cls</code>, <code>ip</code>, <code>instance</code>, <code>ins</code>, <code>job</code></td>
<td>pubsub_patterns metric</td>
</tr>
<tr>
<td>redis_pubsubshard_channels</td>
<td>gauge</td>
<td><code>cls</code>, <code>ip</code>, <code>instance</code>, <code>ins</code>, <code>job</code></td>
<td>pubsubshard_channels metric</td>
</tr>
<tr>
<td>redis_rdb_bgsave_in_progress</td>
<td>gauge</td>
<td><code>cls</code>, <code>ip</code>, <code>instance</code>, <code>ins</code>, <code>job</code></td>
<td>rdb_bgsave_in_progress metric</td>
</tr>
<tr>
<td>redis_rdb_changes_since_last_save</td>
<td>gauge</td>
<td><code>cls</code>, <code>ip</code>, <code>instance</code>, <code>ins</code>, <code>job</code></td>
<td>rdb_changes_since_last_save metric</td>
</tr>
<tr>
<td>redis_rdb_current_bgsave_duration_sec</td>
<td>gauge</td>
<td><code>cls</code>, <code>ip</code>, <code>instance</code>, <code>ins</code>, <code>job</code></td>
<td>rdb_current_bgsave_duration_sec metric</td>
</tr>
<tr>
<td>redis_rdb_last_bgsave_duration_sec</td>
<td>gauge</td>
<td><code>cls</code>, <code>ip</code>, <code>instance</code>, <code>ins</code>, <code>job</code></td>
<td>rdb_last_bgsave_duration_sec metric</td>
</tr>
<tr>
<td>redis_rdb_last_bgsave_status</td>
<td>gauge</td>
<td><code>cls</code>, <code>ip</code>, <code>instance</code>, <code>ins</code>, <code>job</code></td>
<td>rdb_last_bgsave_status metric</td>
</tr>
<tr>
<td>redis_rdb_last_cow_size_bytes</td>
<td>gauge</td>
<td><code>cls</code>, <code>ip</code>, <code>instance</code>, <code>ins</code>, <code>job</code></td>
<td>rdb_last_cow_size_bytes metric</td>
</tr>
<tr>
<td>redis_rdb_last_save_timestamp_seconds</td>
<td>gauge</td>
<td><code>cls</code>, <code>ip</code>, <code>instance</code>, <code>ins</code>, <code>job</code></td>
<td>rdb_last_save_timestamp_seconds metric</td>
</tr>
<tr>
<td>redis_rejected_connections_total</td>
<td>counter</td>
<td><code>cls</code>, <code>ip</code>, <code>instance</code>, <code>ins</code>, <code>job</code></td>
<td>rejected_connections_total metric</td>
</tr>
<tr>
<td>redis_repl_backlog_first_byte_offset</td>
<td>gauge</td>
<td><code>cls</code>, <code>ip</code>, <code>instance</code>, <code>ins</code>, <code>job</code></td>
<td>repl_backlog_first_byte_offset metric</td>
</tr>
<tr>
<td>redis_repl_backlog_history_bytes</td>
<td>gauge</td>
<td><code>cls</code>, <code>ip</code>, <code>instance</code>, <code>ins</code>, <code>job</code></td>
<td>repl_backlog_history_bytes metric</td>
</tr>
<tr>
<td>redis_repl_backlog_is_active</td>
<td>gauge</td>
<td><code>cls</code>, <code>ip</code>, <code>instance</code>, <code>ins</code>, <code>job</code></td>
<td>repl_backlog_is_active metric</td>
</tr>
<tr>
<td>redis_replica_partial_resync_accepted</td>
<td>gauge</td>
<td><code>cls</code>, <code>ip</code>, <code>instance</code>, <code>ins</code>, <code>job</code></td>
<td>replica_partial_resync_accepted metric</td>
</tr>
<tr>
<td>redis_replica_partial_resync_denied</td>
<td>gauge</td>
<td><code>cls</code>, <code>ip</code>, <code>instance</code>, <code>ins</code>, <code>job</code></td>
<td>replica_partial_resync_denied metric</td>
</tr>
<tr>
<td>redis_replica_resyncs_full</td>
<td>gauge</td>
<td><code>cls</code>, <code>ip</code>, <code>instance</code>, <code>ins</code>, <code>job</code></td>
<td>replica_resyncs_full metric</td>
</tr>
<tr>
<td>redis_replication_backlog_bytes</td>
<td>gauge</td>
<td><code>cls</code>, <code>ip</code>, <code>instance</code>, <code>ins</code>, <code>job</code></td>
<td>replication_backlog_bytes metric</td>
</tr>
<tr>
<td>redis_second_repl_offset</td>
<td>gauge</td>
<td><code>cls</code>, <code>ip</code>, <code>instance</code>, <code>ins</code>, <code>job</code></td>
<td>second_repl_offset metric</td>
</tr>
<tr>
<td>redis_sentinel_master_ckquorum_status</td>
<td>gauge</td>
<td><code>cls</code>, <code>ip</code>, <code>message</code>, <code>instance</code>, <code>ins</code>, <code>master_name</code>, <code>job</code></td>
<td>Master ckquorum status</td>
</tr>
<tr>
<td>redis_sentinel_master_ok_sentinels</td>
<td>gauge</td>
<td><code>cls</code>, <code>ip</code>, <code>instance</code>, <code>ins</code>, <code>master_address</code>, <code>master_name</code>, <code>job</code></td>
<td>The number of okay sentinels monitoring this master</td>
</tr>
<tr>
<td>redis_sentinel_master_ok_slaves</td>
<td>gauge</td>
<td><code>cls</code>, <code>ip</code>, <code>instance</code>, <code>ins</code>, <code>master_address</code>, <code>master_name</code>, <code>job</code></td>
<td>The number of okay slaves of the master</td>
</tr>
<tr>
<td>redis_sentinel_master_sentinels</td>
<td>gauge</td>
<td><code>cls</code>, <code>ip</code>, <code>instance</code>, <code>ins</code>, <code>master_address</code>, <code>master_name</code>, <code>job</code></td>
<td>The number of sentinels monitoring this master</td>
</tr>
<tr>
<td>redis_sentinel_master_setting_ckquorum</td>
<td>gauge</td>
<td><code>cls</code>, <code>ip</code>, <code>instance</code>, <code>ins</code>, <code>master_address</code>, <code>master_name</code>, <code>job</code></td>
<td>Show the current ckquorum config for each master</td>
</tr>
<tr>
<td>redis_sentinel_master_setting_down_after_milliseconds</td>
<td>gauge</td>
<td><code>cls</code>, <code>ip</code>, <code>instance</code>, <code>ins</code>, <code>master_address</code>, <code>master_name</code>, <code>job</code></td>
<td>Show the current down-after-milliseconds config for each master</td>
</tr>
<tr>
<td>redis_sentinel_master_setting_failover_timeout</td>
<td>gauge</td>
<td><code>cls</code>, <code>ip</code>, <code>instance</code>, <code>ins</code>, <code>master_address</code>, <code>master_name</code>, <code>job</code></td>
<td>Show the current failover-timeout config for each master</td>
</tr>
<tr>
<td>redis_sentinel_master_setting_parallel_syncs</td>
<td>gauge</td>
<td><code>cls</code>, <code>ip</code>, <code>instance</code>, <code>ins</code>, <code>master_address</code>, <code>master_name</code>, <code>job</code></td>
<td>Show the current parallel-syncs config for each master</td>
</tr>
<tr>
<td>redis_sentinel_master_slaves</td>
<td>gauge</td>
<td><code>cls</code>, <code>ip</code>, <code>instance</code>, <code>ins</code>, <code>master_address</code>, <code>master_name</code>, <code>job</code></td>
<td>The number of slaves of the master</td>
</tr>
<tr>
<td>redis_sentinel_master_status</td>
<td>gauge</td>
<td><code>cls</code>, <code>ip</code>, <code>master_status</code>, <code>instance</code>, <code>ins</code>, <code>master_address</code>, <code>master_name</code>, <code>job</code></td>
<td>Master status on Sentinel</td>
</tr>
<tr>
<td>redis_sentinel_masters</td>
<td>gauge</td>
<td><code>cls</code>, <code>ip</code>, <code>instance</code>, <code>ins</code>, <code>job</code></td>
<td>The number of masters this sentinel is watching</td>
</tr>
<tr>
<td>redis_sentinel_running_scripts</td>
<td>gauge</td>
<td><code>cls</code>, <code>ip</code>, <code>instance</code>, <code>ins</code>, <code>job</code></td>
<td>Number of scripts in execution right now</td>
</tr>
<tr>
<td>redis_sentinel_scripts_queue_length</td>
<td>gauge</td>
<td><code>cls</code>, <code>ip</code>, <code>instance</code>, <code>ins</code>, <code>job</code></td>
<td>Queue of user scripts to execute</td>
</tr>
<tr>
<td>redis_sentinel_simulate_failure_flags</td>
<td>gauge</td>
<td><code>cls</code>, <code>ip</code>, <code>instance</code>, <code>ins</code>, <code>job</code></td>
<td>Failures simulations</td>
</tr>
<tr>
<td>redis_sentinel_tilt</td>
<td>gauge</td>
<td><code>cls</code>, <code>ip</code>, <code>instance</code>, <code>ins</code>, <code>job</code></td>
<td>Sentinel is in TILT mode</td>
</tr>
<tr>
<td>redis_slave_expires_tracked_keys</td>
<td>gauge</td>
<td><code>cls</code>, <code>ip</code>, <code>instance</code>, <code>ins</code>, <code>job</code></td>
<td>slave_expires_tracked_keys metric</td>
</tr>
<tr>
<td>redis_slave_info</td>
<td>gauge</td>
<td><code>cls</code>, <code>ip</code>, <code>master_host</code>, <code>instance</code>, <code>read_only</code>, <code>ins</code>, <code>job</code>, <code>master_port</code></td>
<td>Information about the Redis slave</td>
</tr>
<tr>
<td>redis_slave_priority</td>
<td>gauge</td>
<td><code>cls</code>, <code>ip</code>, <code>instance</code>, <code>ins</code>, <code>job</code></td>
<td>slave_priority metric</td>
</tr>
<tr>
<td>redis_slave_repl_offset</td>
<td>gauge</td>
<td><code>cls</code>, <code>ip</code>, <code>master_host</code>, <code>instance</code>, <code>ins</code>, <code>job</code>, <code>master_port</code></td>
<td>Slave replication offset</td>
</tr>
<tr>
<td>redis_slowlog_last_id</td>
<td>gauge</td>
<td><code>cls</code>, <code>ip</code>, <code>instance</code>, <code>ins</code>, <code>job</code></td>
<td>Last id of slowlog</td>
</tr>
<tr>
<td>redis_slowlog_length</td>
<td>gauge</td>
<td><code>cls</code>, <code>ip</code>, <code>instance</code>, <code>ins</code>, <code>job</code></td>
<td>Total slowlog</td>
</tr>
<tr>
<td>redis_start_time_seconds</td>
<td>gauge</td>
<td><code>cls</code>, <code>ip</code>, <code>instance</code>, <code>ins</code>, <code>job</code></td>
<td>Start time of the Redis instance since unix epoch in seconds.</td>
</tr>
<tr>
<td>redis_target_scrape_request_errors_total</td>
<td>counter</td>
<td><code>cls</code>, <code>ip</code>, <code>instance</code>, <code>ins</code>, <code>job</code></td>
<td>Errors in requests to the exporter</td>
</tr>
<tr>
<td>redis_total_error_replies</td>
<td>counter</td>
<td><code>cls</code>, <code>ip</code>, <code>instance</code>, <code>ins</code>, <code>job</code></td>
<td>total_error_replies metric</td>
</tr>
<tr>
<td>redis_total_reads_processed</td>
<td>counter</td>
<td><code>cls</code>, <code>ip</code>, <code>instance</code>, <code>ins</code>, <code>job</code></td>
<td>total_reads_processed metric</td>
</tr>
<tr>
<td>redis_total_system_memory_bytes</td>
<td>gauge</td>
<td><code>cls</code>, <code>ip</code>, <code>instance</code>, <code>ins</code>, <code>job</code></td>
<td>total_system_memory_bytes metric</td>
</tr>
<tr>
<td>redis_total_writes_processed</td>
<td>counter</td>
<td><code>cls</code>, <code>ip</code>, <code>instance</code>, <code>ins</code>, <code>job</code></td>
<td>total_writes_processed metric</td>
</tr>
<tr>
<td>redis_tracking_clients</td>
<td>gauge</td>
<td><code>cls</code>, <code>ip</code>, <code>instance</code>, <code>ins</code>, <code>job</code></td>
<td>tracking_clients metric</td>
</tr>
<tr>
<td>redis_tracking_total_items</td>
<td>gauge</td>
<td><code>cls</code>, <code>ip</code>, <code>instance</code>, <code>ins</code>, <code>job</code></td>
<td>tracking_total_items metric</td>
</tr>
<tr>
<td>redis_tracking_total_keys</td>
<td>gauge</td>
<td><code>cls</code>, <code>ip</code>, <code>instance</code>, <code>ins</code>, <code>job</code></td>
<td>tracking_total_keys metric</td>
</tr>
<tr>
<td>redis_tracking_total_prefixes</td>
<td>gauge</td>
<td><code>cls</code>, <code>ip</code>, <code>instance</code>, <code>ins</code>, <code>job</code></td>
<td>tracking_total_prefixes metric</td>
</tr>
<tr>
<td>redis_unexpected_error_replies</td>
<td>counter</td>
<td><code>cls</code>, <code>ip</code>, <code>instance</code>, <code>ins</code>, <code>job</code></td>
<td>unexpected_error_replies metric</td>
</tr>
<tr>
<td>redis_up</td>
<td>gauge</td>
<td><code>cls</code>, <code>ip</code>, <code>instance</code>, <code>ins</code>, <code>job</code></td>
<td>Information about the Redis instance</td>
</tr>
<tr>
<td>redis_uptime_in_seconds</td>
<td>gauge</td>
<td><code>cls</code>, <code>ip</code>, <code>instance</code>, <code>ins</code>, <code>job</code></td>
<td>uptime_in_seconds metric</td>
</tr>
<tr>
<td>scrape_duration_seconds</td>
<td>Unknown</td>
<td><code>cls</code>, <code>ip</code>, <code>instance</code>, <code>ins</code>, <code>job</code></td>
<td>N/A</td>
</tr>
<tr>
<td>scrape_samples_post_metric_relabeling</td>
<td>Unknown</td>
<td><code>cls</code>, <code>ip</code>, <code>instance</code>, <code>ins</code>, <code>job</code></td>
<td>N/A</td>
</tr>
<tr>
<td>scrape_samples_scraped</td>
<td>Unknown</td>
<td><code>cls</code>, <code>ip</code>, <code>instance</code>, <code>ins</code>, <code>job</code></td>
<td>N/A</td>
</tr>
<tr>
<td>scrape_series_added</td>
<td>Unknown</td>
<td><code>cls</code>, <code>ip</code>, <code>instance</code>, <code>ins</code>, <code>job</code></td>
<td>N/A</td>
</tr>
<tr>
<td>up</td>
<td>Unknown</td>
<td><code>cls</code>, <code>ip</code>, <code>instance</code>, <code>ins</code>, <code>job</code></td>
<td>N/A</td>
</tr>
</tbody>
</table>

</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-b2e89e0d2e5fa7361edacff6f86e00ea">7 - 常见问题</h1>
    <div class="lead">Pigsty REDIS 模块常见问题答疑</div>
	<hr>
<h2 id="redis初始化失败abort-due-to-existing-redis-instance">Redis初始化失败：ABORT due to existing redis instance</h2>
<p>这意味着正在初始化的 Redis 实例已经存在了，使用 <code>redis_clean = true</code> 和 <code>redis_safeguard = false</code> 来强制清除redis数据</p>
<p>当您运行<code>redis.yml</code>来初始化一个已经在运行的redis实例，并且<a href="/zh/docs/reference/param#redis_clean"><code>redis_clean</code></a>设置为<code>false</code>时，就会出现这种情况。</p>
<p>如果<code>redis_clean</code>设置为<code>true</code>（并且 <a href="/zh/docs/reference/param#redis_safeguard"><code>redis_safeguard</code></a> 也设置为<code>false</code>），<code>redis.yml</code>剧本将删除现有的redis实例并将其重新初始化为一个新的实例，这使得<code>redis.yml</code>剧本完全具有幂等性。</p>
<hr>
<h2 id="redis初始化失败abort-due-to-redis_safeguard-enabled">Redis初始化失败：ABORT due to redis_safeguard enabled</h2>
<p>这意味着正准备清理的 Redis 实例打开了防误删保险：当 <a href="/zh/docs/reference/param#redis_safeguard"><code>redis_safeguard</code></a> 设置为 <code>true</code> 时，尝试移除一个redis实例时就会出现这种情况。</p>
<p>您可以关闭 <a href="/zh/docs/reference/param#redis_safeguard"><code>redis_safeguard</code></a> 来移除Redis实例。这就是 <code>redis_safeguard</code> 的作用。</p>
<hr>
<h2 id="如何在某个节点上添加一个新的redis实例">如何在某个节点上添加一个新的Redis实例？</h2>
<p>使用 <code>bin/redis-add &lt;ip&gt; &lt;port&gt;</code> 在节点上部署一个新的redis实例。</p>
<hr>
<h2 id="如何从节点上移除一个特定实例">如何从节点上移除一个特定实例？</h2>
<p>使用 <code>bin/redis-rm &lt;ip&gt; &lt;port&gt;</code> 从节点上移除一个单独的redis实例。</p>

</div>



    
	
  



          </main>
        </div>
      </div>
      <footer class="td-footer row d-print-none">
  <div class="container-fluid">
    <div class="row mx-md-2">
      <div class="td-footer__left col-6 col-sm-4 order-sm-1">
        <ul class="td-footer__links-list">
  
  <li class="td-footer__links-item" data-bs-toggle="tooltip" title="Mail" aria-label="Mail">
    <a target="_blank" rel="noopener" href="mailto:rh@vonng.com" aria-label="Mail">
      <i class="fa fa-envelope"></i>
    </a>
  </li>
  
  <li class="td-footer__links-item" data-bs-toggle="tooltip" title="GitHub" aria-label="GitHub">
    <a target="_blank" rel="noopener" href="https://github.com/Vonng/pigsty" aria-label="GitHub">
      <i class="fab fa-github"></i>
    </a>
  </li>
  
  <li class="td-footer__links-item" data-bs-toggle="tooltip" title="Twitter" aria-label="Twitter">
    <a target="_blank" rel="noopener" href="https://twitter.com/GobeUncleWang" aria-label="Twitter">
      <i class="fab fa-twitter"></i>
    </a>
  </li>
  
</ul>

      </div><div class="td-footer__right col-6 col-sm-4 order-sm-3">
        <ul class="td-footer__links-list">
  
  <li class="td-footer__links-item" data-bs-toggle="tooltip" title="WeChat" aria-label="WeChat">
    <a target="_blank" rel="noopener" href="/img/pigsty/pigsty-cc.jpg" aria-label="WeChat">
      <i class="fa fa-comment"></i>
    </a>
  </li>
  
  <li class="td-footer__links-item" data-bs-toggle="tooltip" title="Discord" aria-label="Discord">
    <a target="_blank" rel="noopener" href="https://discord.gg/wDzt5VyWEz" aria-label="Discord">
      <i class="fab fa-discord"></i>
    </a>
  </li>
  
  <li class="td-footer__links-item" data-bs-toggle="tooltip" title="Telegram" aria-label="Telegram">
    <a target="_blank" rel="noopener" href="https://t.me/joinchat/gV9zfZraNPM3YjFh" aria-label="Telegram">
      <i class="fab fa-telegram"></i>
    </a>
  </li>
  
</ul>

      </div><div class="td-footer__center col-12 col-sm-4 py-2 order-sm-2">
        <span class="td-footer__copyright">&copy;
    2018&ndash;2025
    <span class="td-footer__authors">Ruohang Feng</span></span><span class="td-footer__all_rights_reserved">All Rights Reserved</span></span><span class="ms-2"><a href="https://vonng.com/en/" target="_blank" rel="noopener">@Vonng</a></span>
<br><span>Pigsty® distributed under <a href="/docs/about/license" target="_blank" rel="noopener">AGPLv3</a></span>
<br><span class="ms-2"><a href="/docs/about/privacy" target="_blank" rel="noopener">Privacy Policy</a></span>
<span><a href="http://beian.miit.gov.cn/" target="_blank" rel="noopener">浙ICP备15016890号</a></span>
      </div>
    </div>
  </div>
</footer>

    </div>
    <script src="/js/main.min.248655eb216150e39da254c2f7aa5357805d0ec66bdb741b591cd35fb5f629ab.js" integrity="sha256-JIZV6yFhUOOdolTC96pTV4BdDsZr23QbWRzTX7X2Kas=" crossorigin="anonymous"></script>
<script defer src="/js/click-to-copy.min.f724d3de49218995223b7316aa2e53e2b34bf42026bf399ebb21bb02212402d1.js" integrity="sha256-9yTT3kkhiZUiO3MWqi5T4rNL9CAmvzmeuyG7AiEkAtE=" crossorigin="anonymous"></script>
<script src='/js/tabpane-persist.js'></script>

  </body>
</html>
