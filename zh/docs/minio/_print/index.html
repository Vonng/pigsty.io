<!doctype html>
<html itemscope itemtype="http://schema.org/WebPage" lang="zh" class="no-js">
  <head>
    <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link rel="canonical" type="text/html" href="/zh/docs/minio/">
<link rel="alternate" type="application/rss&#43;xml" href="/zh/docs/minio/index.xml">
<meta name="robots" content="noindex, nofollow">


<link rel="shortcut icon" href="/favicons/favicon.ico" >
<link rel="apple-touch-icon" href="/favicons/apple-touch-icon-180x180.png" sizes="180x180">
<link rel="icon" type="image/png" href="/favicons/favicon-16x16.png" sizes="16x16">
<link rel="icon" type="image/png" href="/favicons/favicon-32x32.png" sizes="32x32">
<link rel="icon" type="image/png" href="/favicons/android-36x36.png" sizes="36x36">
<link rel="icon" type="image/png" href="/favicons/android-48x48.png" sizes="48x48">
<link rel="icon" type="image/png" href="/favicons/android-72x72.png" sizes="72x72">
<link rel="icon" type="image/png" href="/favicons/android-96x96.png" sizes="96x96">
<link rel="icon" type="image/png" href="/favicons/android-144x144.png" sizes="144x144">
<link rel="icon" type="image/png" href="/favicons/android-192x192.png" sizes="192x192">

<title>模块：MINIO | Pigsty</title>
<meta name="description" content="Pigsty 内置了 MinIO 支持，一个本地 S3 对象存储开源替代，可用于 PGSQL 模块冷备份存储。">
<meta property="og:title" content="模块：MINIO" />
<meta property="og:description" content="Pigsty 内置了 MinIO 支持，一个本地 S3 对象存储开源替代，可用于 PGSQL 模块冷备份存储。" />
<meta property="og:type" content="website" />
<meta property="og:url" content="/zh/docs/minio/" />

<meta itemprop="name" content="模块：MINIO">
<meta itemprop="description" content="Pigsty 内置了 MinIO 支持，一个本地 S3 对象存储开源替代，可用于 PGSQL 模块冷备份存储。"><meta name="twitter:card" content="summary"/><meta name="twitter:title" content="模块：MINIO"/>
<meta name="twitter:description" content="Pigsty 内置了 MinIO 支持，一个本地 S3 对象存储开源替代，可用于 PGSQL 模块冷备份存储。"/>




<link rel="preload" href="/scss/main.min.194607c777ee31a481a26dfc3d1c65134dfc8eb296a0aae9d353b3bd5be6a683.css" as="style">
<link href="/scss/main.min.194607c777ee31a481a26dfc3d1c65134dfc8eb296a0aae9d353b3bd5be6a683.css" rel="stylesheet" integrity="">

<script
  src="/js/jquery-3.6.3.min.js"
  integrity="sha512-STof4xm1wgkfm7heWqFJVn58Hm3EtS31XFaagaa8VMReCXAkQnJZ+jEy8PCC/iT18dFy95WcExNHFTqLyp72eQ=="
  crossorigin="anonymous"></script>
<script defer
  src="/js/lunr.min.js"
  integrity="sha384-203J0SNzyqHby3iU6hzvzltrWi/M41wOP5Gu+BiJMz5nwKykbkUx8Kp7iti0Lpli"
  crossorigin="anonymous"></script>
<script async src="https://www.googletagmanager.com/gtag/js?id=G-LG1V9WTKGE"></script>
<script>
var doNotTrack = false;
if (!doNotTrack) {
	window.dataLayer = window.dataLayer || [];
	function gtag(){dataLayer.push(arguments);}
	gtag('js', new Date());
	gtag('config', 'G-LG1V9WTKGE');
}
</script>
  </head>
  <body class="td-section">
    <header>
      <nav class="td-navbar navbar-dark js-navbar-scroll">
<div class="container-fluid flex-column flex-md-row">
  <a class="navbar-brand" href="/zh/"><span class="navbar-brand__logo navbar-logo"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xl="http://www.w3.org/1999/xlink" xmlns:dc="http://purl.org/dc/elements/1.1/" viewBox="0 0 24 24" width="24" height="24"><defs/><g id="32" fill="none" stroke-dasharray="none" fill-opacity="1" stroke-opacity="1" stroke="none"><title>32</title><g id="32_图层_2"><title>图层 2</title><g id="Group_17"><g id="Graphic_16"/><g id="Graphic_15"><path d="M7.666187 11.971335l2.165064-3.75H14.16138l2.165065 3.75-2.165065 3.75H9.831251z" fill="#bbb" fill-opacity=".9526367"/><path d="M7.666187 11.971335l2.165064-3.75H14.16138l2.165065 3.75-2.165065 3.75H9.831251z" stroke="#fff" stroke-linecap="round" stroke-linejoin="round" stroke-width=".6730434"/></g><g id="Graphic_14"><path d="M7.666187 19.474806l2.165064-3.75H14.16138l2.165065 3.75-2.165065 3.75H9.831251z" fill="#de372c" fill-opacity=".8545852"/><path d="M7.666187 19.474806l2.165064-3.75H14.16138l2.165065 3.75-2.165065 3.75H9.831251z" stroke="#fff" stroke-linecap="round" stroke-linejoin="round" stroke-width=".6730434"/></g><g id="Graphic_13"><path d="M14.161476 15.751202l2.165064-3.75h4.33013l2.165064 3.75-2.165064 3.75H16.32654z" fill="#424242" fill-opacity=".9016462"/><path d="M14.161476 15.751202l2.165064-3.75h4.33013l2.165064 3.75-2.165064 3.75H16.32654z" stroke="#fff" stroke-linecap="round" stroke-linejoin="round" stroke-width=".6730434"/></g><g id="Graphic_12"><path d="M14.161476 8.226008 16.32654 4.4760076h4.33013L22.821734 8.226008l-2.165064 3.75H16.32654z" fill="#ffa269" fill-opacity=".8975772"/><path d="M14.161476 8.226008 16.32654 4.4760076h4.33013L22.821734 8.226008l-2.165064 3.75H16.32654z" stroke="#fff" stroke-linecap="round" stroke-linejoin="round" stroke-width=".6730434"/></g><g id="Graphic_11"><path d="M7.666187 4.5 9.831251.75H14.16138L16.326445 4.5 14.16138 8.25H9.831251z" fill="#419edb" fill-opacity=".8979957"/><path d="M7.666187 4.5 9.831251.75H14.16138L16.326445 4.5 14.16138 8.25H9.831251z" stroke="#fff" stroke-linecap="round" stroke-linejoin="round" stroke-width=".6730434"/></g><g id="Graphic_10"><path d="M1.1491742 8.226008 3.3142388 4.4760076H7.644368L9.809432 8.226008l-2.165064 3.75H3.3142388z" fill="#2f6793" fill-opacity=".9002511"/><path d="M1.1491742 8.226008 3.3142388 4.4760076H7.644368L9.809432 8.226008l-2.165064 3.75H3.3142388z" stroke="#fff" stroke-linecap="round" stroke-linejoin="round" stroke-width=".6730434"/></g><g id="Graphic_9"><path d="M1.182071 15.741036l2.1650645-3.75h4.330129l2.1650645 3.75-2.1650645 3.75H3.3471355z" fill="#53ac79" fill-opacity=".9"/><path d="M1.182071 15.741036l2.1650645-3.75h4.330129l2.1650645 3.75-2.1650645 3.75H3.3471355z" stroke="#fff" stroke-linecap="round" stroke-linejoin="round" stroke-width=".6730434"/></g></g></g></g></svg></span><span class="navbar-brand__name">Pigsty</span></a>
  <div class="td-navbar-nav-scroll ms-md-auto" id="main_navbar">
    <ul class="navbar-nav">
      <li class="nav-item">
        <a class="nav-link active" href="/zh/docs/"><i class='fa-solid fa-book'></i><span>文档</span></a>
      </li>
      <li class="nav-item">
        <a class="nav-link" href="/zh/blog/"><i class="fas fa-blog"></i><span>博客</span></a>
      </li>
      <li class="nav-item">
        <a class="nav-link" href="https://github.com/Vonng/pigsty/" target="_blank" rel="noopener"><i class='fab fa-github'></i><span>GitHub</span></a>
      </li>
      <li class="nav-item dropdown d-none d-lg-block">
        <div class="dropdown">
  <a class="nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
      <i class="fa-solid fa-language"></i>中文</a>
  <ul class="dropdown-menu">
    <li><a class="dropdown-item" href="/docs/minio/">English</a></li>
    </ul>
</div>
</li>
      </ul>
  </div>
  <div class="d-none d-lg-block">
    <div class="td-search td-search--offline">
  <div class="td-search__icon"></div>
  <input
    type="search"
    class="td-search__input form-control"
    placeholder="Search this site…"
    aria-label="Search this site…"
    autocomplete="off"
    
    data-offline-search-index-json-src="/offline-search-index.3dfcc24888a9d723be176d4ac329adc8.json"
    data-offline-search-base-href="/"
    data-offline-search-max-results="10"
  >
</div>
  </div>
</div>
</nav>
    </header>
    <div class="container-fluid td-outer">
      <div class="td-main">
        <div class="row flex-xl-nowrap">
          <main class="col-12 col-md-9 col-xl-8 ps-md-5" role="main">
            




<div class="td-content">
<div class="pageinfo pageinfo-primary d-print-none">
<p>
This is the multi-page printable view of this section.
<a href="#" onclick="print();return false;">Click here to print</a>.
</p><p>
<a href="/zh/docs/minio/">Return to the regular view of this page</a>.
</p>
</div>



<h1 class="title">模块：MINIO</h1>
<div class="lead">Pigsty 内置了 MinIO 支持，一个本地 S3 对象存储开源替代，可用于 PGSQL 模块冷备份存储。</div>




    <ul>
    
  
  
  
  

  
    
    
	
<li>1: <a href="#pg-45b8da1dfca6b0e91aef873f7b72b337">使用方法</a></li>


    
  
    
    
	
<li>2: <a href="#pg-08605fa7a960e0149e3c22312586b71e">集群配置</a></li>


    
  
    
    
	
<li>3: <a href="#pg-280b7e56b08e272d7b26411d506d6c5d">参数列表</a></li>


    
  
    
    
	
<li>4: <a href="#pg-ccc1805ae841df3ebaeb7bb6b8008203">预置剧本</a></li>


    
  
    
    
	
<li>5: <a href="#pg-172708bf70f3c5729ee49aac66787c09">管理预案</a></li>


    
  
    
    
	
<li>6: <a href="#pg-81383092950ff4115e1c3850be65d36f">监控告警</a></li>


    
  
    
    
	
<li>7: <a href="#pg-61857417600e2adc512dcba599edd776">指标列表</a></li>


    
  
    
    
	
<li>8: <a href="#pg-571982477397f0d78a3a5034a4ef3e1d">常见问题</a></li>


    
  

    </ul>


<div class="content">
      <p><a href="https://min.io/">Min.IO</a> 是一个兼容 AWS S3 的多云对象存储软件，使用 AGPLv3 协议开源。</p>
<p>MinIO 可以用来存储文档、图片、视频和备份。Pigsty 原生支持部署各种 MinIO 集群，易于扩展、安全且开箱即用。</p>

</div>
</div>


  
  
  
  

  
  

  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-45b8da1dfca6b0e91aef873f7b72b337">1 - 使用方法</h1>
    <div class="lead">快速上手，如何上手使用 MinIO ？如何可靠地接入 MinIO？如何使用 mc / rclone 客户端工具？</div>
	<p>当您 <a href="/zh/docs/minio/config/">配置</a> 并执行 <a href="/zh/docs/minio/playbook/">剧本</a> 部署 MinIO 集群后，可以参考这里的说明开始使用与接入 MinIO 集群。</p>
<hr>
<h2 id="部署集群">部署集群</h2>
<p>在 Pigsty 中部署一个开箱即用的 单机单盘 MinIO 实例非常简单：首先在 <a href="/zh/docs/setup/config#%E9%85%8D%E7%BD%AE%E6%B8%85%E5%8D%95">配置清单</a> 中定义一套 MinIO 集群：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">minio</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span>{<span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">hosts</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span>{<span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">10.10.10.10</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span>{<span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">minio_seq: 1 } }, vars</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span>{<span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">minio_cluster</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">minio } }</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span></code></pre></div><p>然后，针对定义的分组（这里为 <code>minio</code> ）执行 Pigsty 提供的 <a href="/zh/docs/minio/playbook/"><code>minio.yml</code></a> 剧本即可：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>./minio.yml -l minio
</span></span></code></pre></div><p>请注意在 <a href="/zh/docs/setup/playbook#installyml"><code>install.yml</code></a> 中，事先定义好的 MinIO 集群将自动创建，无需手动再次执行 <code>minio.yml</code> 剧本。</p>
<p>如果您计划部署一个生产等级的大规模多节点 MinIO 集群，我们强烈建议您通读 Pigsty MinIO <a href="/zh/docs/minio/config/">配置文档</a> 与 MinIO <a href="https://min.io/docs/minio/linux/operations/concepts.html">官方文档</a> 后再进行。</p>
<hr>
<h2 id="接入集群">接入集群</h2>
<p>请注意：MinIO 服务必须通过域名与 HTTPS 访问，所以请务必确保： MinIO 服务域名（默认为 <code>sss.pigsty</code>） 正确指向 MinIO 服务器节点</p>
<ol>
<li>您可以在 <a href="/zh/docs/reference/param#node_etc_hosts"><code>node_etc_hosts</code></a> 中添加静态解析记录，或者手工修改 <code>/etc/hosts</code> 文件</li>
<li>您可以在内网的 DNS 服务器上添加一条记录，如果已经有了现成的 DNS 服务</li>
<li>如果您启用了 Infra 节点上的 DNS 服务器，可以在 <a href="/zh/docs/reference/param#dns_records"><code>dns_records</code></a> 中添加记录</li>
</ol>
<p>对于生产环境访问 MinIO，通常我们建议使用第一种方式：静态 DNS 解析记录，避免 MinIO 对于 DNS 的额外依赖。</p>
<p>您应当将 MinIO 服务域名指向 MinIO 服务器节点的 IP 地址与服务端口，或者负载均衡器的 IP 地址与服务端口。
Pigsty 默认使用的 MinIO 服务域名是 <code>sss.pigsty</code>，在单机部署时默认指向本机，在 <code>9000</code> 端口提供服务。</p>
<p>在一些例子中，MinIO 集群上还部署了 HAProxy 实例对外暴露服务，在这种情况下，<code>9002</code> 是模板中使用的服务端口。</p>
<hr>
<h2 id="添加别名">添加别名</h2>
<p>要使用 <code>mcli</code> 客户端访问 <code>minio</code> 服务器集群，首先要配置服务器的别名（<code>alias</code>）：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>mcli <span style="color:#204a87">alias</span> ls  <span style="color:#8f5902;font-style:italic"># 列出 minio 别名（默认使用sss）</span>
</span></span><span style="display:flex;"><span>mcli <span style="color:#204a87">alias</span> <span style="color:#204a87">set</span> sss https://sss.pigsty:9000 minioadmin minioadmin              <span style="color:#8f5902;font-style:italic"># root 用户</span>
</span></span><span style="display:flex;"><span>mcli <span style="color:#204a87">alias</span> <span style="color:#204a87">set</span> sss https://sss.pigsty:9002 minioadmin minioadmin              <span style="color:#8f5902;font-style:italic"># root 用户，使用负载均衡器 9002 端口</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>mcli <span style="color:#204a87">alias</span> <span style="color:#204a87">set</span> pgbackrest https://sss.pigsty:9000 pgbackrest S3User.Backup    <span style="color:#8f5902;font-style:italic"># 使用备份用户</span>
</span></span></code></pre></div><p>在管理节点的管理用户上，已经默认配置了名为 <code>sss</code> 的 MinIO 别名，可以直接使用。</p>
<p>MinIO 客户端工具 <code>mcli</code> 的完整功能参考，请查阅文档： <a href="https://min.io/docs/minio/linux/reference/minio-mc.html">MinIO 客户端</a>。</p>
<hr>
<h2 id="用户管理">用户管理</h2>
<p>使用 <code>mcli</code> 可以管理 MinIO 中的业务用户，例如这里我们可以使用命令行创建两个业务用户：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>mcli admin user list sss     <span style="color:#8f5902;font-style:italic"># 列出 sss 上的所有用户</span>
</span></span><span style="display:flex;"><span><span style="color:#204a87">set</span> +o <span style="color:#204a87">history</span> <span style="color:#8f5902;font-style:italic"># 在历史记录中隐藏密码并创建 minio 用户</span>
</span></span><span style="display:flex;"><span>mcli admin user add sss dba S3User.DBA
</span></span><span style="display:flex;"><span>mcli admin user add sss pgbackrest S3User.Backup
</span></span><span style="display:flex;"><span><span style="color:#204a87">set</span> -o <span style="color:#204a87">history</span> 
</span></span></code></pre></div><hr>
<h2 id="存储桶管理">存储桶管理</h2>
<p><strong>您可以对MinIO中的存储桶进行增删改查</strong>：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>mcli ls sss/                         <span style="color:#8f5902;font-style:italic"># 列出别名 &#39;sss&#39; 的所有桶</span>
</span></span><span style="display:flex;"><span>mcli mb --ignore-existing sss/hello  <span style="color:#8f5902;font-style:italic"># 创建名为 &#39;hello&#39; 的桶</span>
</span></span><span style="display:flex;"><span>mcli rb --force sss/hello            <span style="color:#8f5902;font-style:italic"># 强制删除 &#39;hello&#39; 桶</span>
</span></span></code></pre></div><hr>
<h2 id="对象管理">对象管理</h2>
<p><strong>您也可以对存储桶内的对象进行增删改查</strong>，详情请参考官方文档：<a href="https://min.io/docs/minio/linux/administration/object-management.html">对象管理</a></p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>mcli cp /www/pigsty/* sss/infra/     <span style="color:#8f5902;font-style:italic"># 将本地软件源的内容上传到 MinIO 的 infra 桶中 </span>
</span></span><span style="display:flex;"><span>mcli cp sss/infra/plugins.tgz /tmp/  <span style="color:#8f5902;font-style:italic"># 从 minio 下载文件到本地</span>
</span></span><span style="display:flex;"><span>mcli ls sss/infra                    <span style="color:#8f5902;font-style:italic"># 列出 infra 桶中的所有文件</span>
</span></span><span style="display:flex;"><span>mcli rm sss/infra/plugins.tgz        <span style="color:#8f5902;font-style:italic"># 删除 infra 桶中的特定文件  </span>
</span></span><span style="display:flex;"><span>mcli cat sss/infra/repo_complete     <span style="color:#8f5902;font-style:italic"># 查看 infra 桶中的文件内容</span>
</span></span></code></pre></div><hr>
<h2 id="使用rclone">使用rclone</h2>
<p>Pigsty 仓库中提供了 <a href="https://rclone.org/">rclone</a>， 一个方便的多云对象存储客户端，您可以使用它来访问 MinIO 服务。</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>yum install rclone<span style="color:#000;font-weight:bold">;</span> <span style="color:#8f5902;font-style:italic"># el compatible</span>
</span></span><span style="display:flex;"><span>dnf install rclone<span style="color:#000;font-weight:bold">;</span> <span style="color:#8f5902;font-style:italic"># debian/ubuntu</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>mkdir -p ~/.config/rclone/<span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>tee ~/.config/rclone/rclone.conf &gt; /dev/null <span style="color:#4e9a06">&lt;&lt;EOF
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">[sss]
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">type = s3
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">access_key_id = minioadmin
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">secret_access_key = minioadmin
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">endpoint = sss.pigsty:9000
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">EOF</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>rclone ls sss:/
</span></span></code></pre></div><hr>
<h2 id="配置备份仓库">配置备份仓库</h2>
<p>在 Pigsty 中，MinIO 默认的用例是作为 pgBackRest 的备份存储仓库。
当您修改 <a href="/zh/docs/reference/param#pgbackrest_method"><code>pgbackrest_method</code></a> 为 <code>minio</code> 时，PGSQL 模块会自动将备份存储仓库切换到 MinIO 上。</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">pgbackrest_method: local          # pgbackrest repo method</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">local,minio,[user-defined...]</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:bold">pgbackrest_repo:                  # pgbackrest repo</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">https://pgbackrest.org/configuration.html#section-repository</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">local</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">                          </span><span style="color:#8f5902;font-style:italic"># default pgbackrest repo with local posix fs</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">path</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">/pg/backup             </span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#8f5902;font-style:italic"># local backup directory, `/pg/backup` by default</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">retention_full_type</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">count   </span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#8f5902;font-style:italic"># retention full backups by count</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">retention_full</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#0000cf;font-weight:bold">2</span><span style="color:#f8f8f8;text-decoration:underline">             </span><span style="color:#8f5902;font-style:italic"># keep 2, at most 3 full backup when using local fs repo</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">minio</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">                          </span><span style="color:#8f5902;font-style:italic"># optional minio repo for pgbackrest</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">type</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">s3                     </span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#8f5902;font-style:italic"># minio is s3-compatible, so s3 is used</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">s3_endpoint</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">sss.pigsty      </span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#8f5902;font-style:italic"># minio endpoint domain name, `sss.pigsty` by default</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">s3_region</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">us-east-1         </span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#8f5902;font-style:italic"># minio region, us-east-1 by default, useless for minio</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">s3_bucket</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">pgsql             </span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#8f5902;font-style:italic"># minio bucket name, `pgsql` by default</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">s3_key</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">pgbackrest           </span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#8f5902;font-style:italic"># minio user access key for pgbackrest</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">s3_key_secret</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">S3User.Backup </span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#8f5902;font-style:italic"># minio user secret key for pgbackrest</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">s3_uri_style</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">path           </span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#8f5902;font-style:italic"># use path style uri for minio rather than host style</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">path</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">/pgbackrest            </span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#8f5902;font-style:italic"># minio backup path, default is `/pgbackrest`</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">storage_port</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#0000cf;font-weight:bold">9000</span><span style="color:#f8f8f8;text-decoration:underline">            </span><span style="color:#8f5902;font-style:italic"># minio port, 9000 by default</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">storage_ca_file</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">/pg/cert/ca.crt </span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#8f5902;font-style:italic"># minio ca file path, `/pg/cert/ca.crt` by default</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">bundle</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">y</span><span style="color:#f8f8f8;text-decoration:underline">                     </span><span style="color:#8f5902;font-style:italic"># bundle small files into a single file</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">cipher_type</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">aes-256-cbc     </span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#8f5902;font-style:italic"># enable AES encryption for remote backup repo</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">cipher_pass</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">pgBackRest      </span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#8f5902;font-style:italic"># AES encryption password, default is &#39;pgBackRest&#39;</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">retention_full_type</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">time    </span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#8f5902;font-style:italic"># retention full backup by time on minio repo</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">retention_full</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#0000cf;font-weight:bold">14</span><span style="color:#f8f8f8;text-decoration:underline">            </span><span style="color:#8f5902;font-style:italic"># keep full backup for last 14 days</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span></code></pre></div><p>请注意，如果您使用了多节点部署的 MinIO 集群，并通过负载均衡器对外提供服务，您需要相应地修改这里的 <code>s3_endpoint</code> 与 <code>storage_port</code> 参数。</p>
<br>
<hr>
<br>

</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-08605fa7a960e0149e3c22312586b71e">2 - 集群配置</h1>
    <div class="lead">根据需求场景选择合适的 MinIO 部署类型，并对外提供可靠的接入。</div>
	<p>在部署 MinIO 之前，你需要在 <a href="/zh/docs/setup/config">配置清单</a> 中定义一个 MinIO 集群，MinIO 有三种经典部署模式：</p>
<ul>
<li><a href="/zh/docs/minio/config/#单机单盘">单机单盘：SNSD</a>：单机单盘模式，可以使用任意目录作为数据盘，仅作为开发、测试、演示使用。</li>
<li><a href="/zh/docs/minio/config/#单机多盘">单机多盘：SNMD</a>：折中模式，在单台服务器上使用多块磁盘 (&gt;=2)，仅当资源极为有限时使用。</li>
<li><a href="/zh/docs/minio/config/#多机多盘">多机多盘：MNMD</a>：多机多盘模式，标准生产环境部署，具有最好的可靠性，但需要多台服务器。</li>
</ul>
<p>通常我们建议使用 SNSD 与 MNMD 这两种模式，前者用于开发测试，后者用于生产部署，SNMD 仅在资源有限（只有一台服务器）的情况下使用。</p>
<p>此外，还可以使用 <a href="/zh/docs/minio/config/#多池部署">多池部署</a> 来实现现有 MinIO 集群的扩容，或者直接部署 <a href="/zh/docs/minio/config/#多套集群">多套集群</a>。</p>
<p>使用多节点 MinIO 集群时，访问任意节点都可以获取服务，因此最佳实践是在 MinIO 集群前使用负载均衡与<a href="/zh/docs/minio/config/#服务接入">高可用服务接入机制</a>。</p>
<hr>
<h2 id="核心参数">核心参数</h2>
<p>MinIO 部署中，<a href="https://min.io/docs/minio/linux/reference/minio-server/settings/core.html#envvar.MINIO_VOLUMES"><code>MINIO_VOLUMES</code></a> 是一个核心配置参数，用于指定 MinIO 的部署模式。
Pigsty 提供了一些便捷的参数用于自动根据配置清单，生成 <code>MINIO_VOLUMES</code> 与其他配置参数的值，但您也可以直接指定它们。</p>
<ul>
<li>单机单盘： <code>MINIO_VOLUMES</code> 指向本机上的一个普通目录，默认由 <a href="/zh/docs/minio/param#minio_data"><code>minio_data</code></a> 指定，默认位置为 <code>/data/minio</code>。</li>
<li>单机多盘： <code>MINIO_VOLUMES</code> 指向本机上的序列挂载点，同样是由 <a href="/zh/docs/minio/param#minio_data"><code>minio_data</code></a> 指定，但需要用特殊语法显式覆盖指定真实挂载点，例如 <code>/data{1...4}</code>。</li>
<li>多机多盘： <code>MINIO_VOLUMES</code> 指向多台服务器上的序列挂载点，由以下两部分自动组合生成：
<ul>
<li>首先要使用 <a href="/zh/docs/minio/param#minio_data"><code>minio_data</code></a> 指定集群每个成员的磁盘挂载点序列 <code>/data{1...4}</code>，</li>
<li>还需要使用 <a href="/zh/docs/minio/param#minio_node"><code>minio_node</code></a> 指定节点的命名模式 <code>${minio_cluster}-${minio_seq}.pigsty</code></li>
</ul>
</li>
<li>多池部署： 您需要显式指定 <a href="/zh/docs/minio/param#minio_volumes"><code>minio_volumes</code></a> 参数来分配每个存储池的节点，从而实现集群扩容</li>
</ul>
<hr>
<h2 id="单机单盘">单机单盘</h2>
<p>SNSD 模式，部署参考教程：<a href="https://min.io/docs/minio/linux/operations/install-deploy-manage/deploy-minio-single-node-single-drive.html">MinIO 单机单盘部署</a></p>
<p>在 Pigsty 中，定义一个单例 MinIO 实例非常简单：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># 1 节点 1 驱动器（默认）</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:bold">minio</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span>{<span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">hosts</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span>{<span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">10.10.10.10</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span>{<span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">minio_seq: 1 } }, vars</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span>{<span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">minio_cluster</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">minio } }</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span></code></pre></div><p>单机模式下，唯一必要的参数是 <a href="/zh/docs/minio/param#minio_seq"><code>minio_seq</code></a> 和 <a href="/zh/docs/minio/param#minio_cluster"><code>minio_cluster</code></a>，它们会唯一标识每一个 MinIO 实例。</p>
<p>单节点单磁盘模式仅用于开发目的，因此您可以使用一个普通的目录作为数据目录，该目录由参数 <a href="/zh/docs/minio/param#minio_data"><code>minio_data</code></a> 默认为 <code>/data/minio</code>。</p>
<p>在您使用 MinIO 时，强烈建议您通过静态解析的域名记录访问 MinIO，例如，假设 <a href="/zh/docs/minio/param#minio_domain"><code>minio_domain</code></a> 设置的内部服务域名使用了默认的 <code>sss.pigsty</code>，
那么您可以在所有节点上添加一个静态解析，便于其他节点访问此服务。</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">node_etc_hosts</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000;font-weight:bold">[</span><span style="color:#4e9a06">&#34;10.10.10.10 sss.pigsty&#34;</span><span style="color:#000;font-weight:bold">]</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#8f5902;font-style:italic"># domain name to access minio from all nodes (required)</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span></code></pre></div>

<div class="alert alert-secondary" role="alert">
<h4 class="alert-heading">SNSD 仅适用于开发测试</h4>

    单节点模式应当仅用于开发，测试，演示目的，因为它无法容忍硬件故障，也无法带来多磁盘的性能改善。

</div>

<hr>
<h2 id="单机多盘">单机多盘</h2>
<p>SNMD 模式，部署参考教程：<a href="https://min.io/docs/minio/linux/operations/install-deploy-manage/deploy-minio-single-node-multi-drive.html">MinIO 单机多盘部署</a></p>
<p>要在单节点上使用多块磁盘，所需的操作与 <a href="/zh/docs/minio/config/#单机单盘">单机单盘</a> 基本一致，但用户需要以 <code>{{ prefix }}{x...y}</code> 的特定格式指定 <a href="/zh/docs/minio/param#minio_data"><code>minio_data</code></a>，该格式定义了序列磁盘挂载点。</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">minio</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">hosts</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span>{<span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">10.10.10.10</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span>{<span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">minio_seq</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#0000cf;font-weight:bold">1</span><span style="color:#f8f8f8;text-decoration:underline"> </span>}<span style="color:#f8f8f8;text-decoration:underline"> </span>}<span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">vars</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">minio_cluster</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">minio        </span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#8f5902;font-style:italic"># minio 集群名称，默认为 minio</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">minio_data</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#39;/data{1...4}&#39;</span><span style="color:#f8f8f8;text-decoration:underline">   </span><span style="color:#8f5902;font-style:italic"># minio 数据目录，使用 {x...y} 记号来指定多块磁盘</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span></code></pre></div>

<div class="alert alert-secondary" role="alert">
<h4 class="alert-heading">请使用真实磁盘挂载点</h4>

    请注意，SNMD 模式不支持使用普通目录作为数据目录，如果您使用 SNMD 模式拉起 MinIO，但数据目录不是有效的磁盘挂载点，MinIO 将拒绝启动。

</div>

<p>例如 Vagrant MinIO <a href="https://github.com/Vonng/pigsty/blob/main/vagrant/spec/minio.rb">沙箱</a> 定义了一个带有4块磁盘的单节点 MinIO 集群：<code>/data1</code>、<code>/data2</code>、<code>/data3</code> 和 <code>/data4</code>。启动 MinIO 之前，你需要正确地挂载它们（请务必使用 <code>xfs</code> 格式化磁盘）：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>mkfs.xfs /dev/vdb<span style="color:#000;font-weight:bold">;</span> mkdir /data1<span style="color:#000;font-weight:bold">;</span> mount -t xfs /dev/sdb /data1<span style="color:#000;font-weight:bold">;</span>   <span style="color:#8f5902;font-style:italic"># 挂载第1块盘……</span>
</span></span><span style="display:flex;"><span>mkfs.xfs /dev/vdc<span style="color:#000;font-weight:bold">;</span> mkdir /data2<span style="color:#000;font-weight:bold">;</span> mount -t xfs /dev/sdb /data2<span style="color:#000;font-weight:bold">;</span>   <span style="color:#8f5902;font-style:italic"># 挂载第2块盘……</span>
</span></span><span style="display:flex;"><span>mkfs.xfs /dev/vdd<span style="color:#000;font-weight:bold">;</span> mkdir /data3<span style="color:#000;font-weight:bold">;</span> mount -t xfs /dev/sdb /data3<span style="color:#000;font-weight:bold">;</span>   <span style="color:#8f5902;font-style:italic"># 挂载第3块盘……</span>
</span></span><span style="display:flex;"><span>mkfs.xfs /dev/vde<span style="color:#000;font-weight:bold">;</span> mkdir /data4<span style="color:#000;font-weight:bold">;</span> mount -t xfs /dev/sdb /data4<span style="color:#000;font-weight:bold">;</span>   <span style="color:#8f5902;font-style:italic"># 挂载第4块盘……</span>
</span></span></code></pre></div><p>挂载磁盘属于服务器置备的部分，超出 Pigsty 的处理范畴。挂载的磁盘应该同时写入 <code>/etc/fstab</code> 以便在服务器重启后可以自动挂载。</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>/dev/vdb /data1 xfs defaults,noatime,nodiratime <span style="color:#0000cf;font-weight:bold">0</span> <span style="color:#0000cf;font-weight:bold">0</span>
</span></span><span style="display:flex;"><span>/dev/vdc /data2 xfs defaults,noatime,nodiratime <span style="color:#0000cf;font-weight:bold">0</span> <span style="color:#0000cf;font-weight:bold">0</span>
</span></span><span style="display:flex;"><span>/dev/vdd /data3 xfs defaults,noatime,nodiratime <span style="color:#0000cf;font-weight:bold">0</span> <span style="color:#0000cf;font-weight:bold">0</span>
</span></span><span style="display:flex;"><span>/dev/vde /data4 xfs defaults,noatime,nodiratime <span style="color:#0000cf;font-weight:bold">0</span> <span style="color:#0000cf;font-weight:bold">0</span>
</span></span></code></pre></div><p>SNMD 模式可以利用单机上的多块磁盘，提供更高的性能和容量，并且容忍部分磁盘故障。
但单节点模式无法容忍整个节点的故障，而且您无法在运行时添加新的节点，因此如果没有特殊原因，我们不建议在生产环境中使用 SNMD 模式。</p>
<hr>
<h2 id="多机多盘">多机多盘</h2>
<p>MNMD 模式，部署参考教程：<a href="https://min.io/docs/minio/linux/operations/install-deploy-manage/deploy-minio-multi-node-multi-drive.html">MinIO 多机多盘部署</a></p>
<p>除了需要 <a href="/zh/docs/minio/config/#单机多盘">单机多盘</a> 模式中的 <a href="/zh/docs/minio/param#minio_dataduojiduo"><code>minio_data</code></a> 指定磁盘驱动器，使用MinIO 多节点部署需要使用一个额外的 <a href="/zh/docs/minio/param#minio_node"><code>minio_node</code></a> 参数。</p>
<p>例如，以下配置定义了一个 MinIO 集群，其中有四个节点，每个节点有四块磁盘：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">minio</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">hosts</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">10.10.10.10</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span>{<span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">minio_seq</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#0000cf;font-weight:bold">1</span><span style="color:#f8f8f8;text-decoration:underline"> </span>}<span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#8f5902;font-style:italic"># 实际节点名： minio-1.pigsty</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">10.10.10.11</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span>{<span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">minio_seq</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#0000cf;font-weight:bold">2</span><span style="color:#f8f8f8;text-decoration:underline"> </span>}<span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#8f5902;font-style:italic"># 实际节点名： minio-2.pigsty</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">10.10.10.12</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span>{<span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">minio_seq</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#0000cf;font-weight:bold">3</span><span style="color:#f8f8f8;text-decoration:underline"> </span>}<span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#8f5902;font-style:italic"># 实际节点名： minio-3.pigsty</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">10.10.10.13</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span>{<span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">minio_seq</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#0000cf;font-weight:bold">4</span><span style="color:#f8f8f8;text-decoration:underline"> </span>}<span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#8f5902;font-style:italic"># 实际节点名： minio-4.pigsty</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">vars</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">minio_cluster</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">minio</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">minio_data</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#39;/data{1...4}&#39;</span><span style="color:#f8f8f8;text-decoration:underline">                         </span><span style="color:#8f5902;font-style:italic"># 每个节点使用四块磁盘</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">minio_node</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#39;${minio_cluster}-${minio_seq}.pigsty&#39;</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#8f5902;font-style:italic"># minio 节点名称规则</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span></code></pre></div><p><a href="/zh/docs/minio/param/#minio_node"><code>minio_node</code></a>  参数指定了 MinIO 节点名称的模式，用于生成每个节点的唯一名称。
默认情况下，节点名称是 <code>${minio_cluster}-${minio_seq}.pigsty</code>，其中 <code>${minio_cluster}</code> 是集群名称，<code>${minio_seq}</code> 是节点序号。
MinIO 实例的名称非常重要，会自动写入到 MinIO 节点的 <code>/etc/hosts</code> 中进行静态解析。MinIO 依靠这些名称来识别并访问集群中的其他节点。</p>
<p>在这种情况下，<code>MINIO_VOLUMES</code> 将被设置为 <code>https://minio-{1...4}.pigsty/data{1...4}</code> ，以标识四个节点上的四块盘。
您可以直接在 MinIO 集群中指定 <a href="/zh/docs/minio/param/#minio_volumes"><code>minio_volumes</code></a> 参数，来覆盖自动根据规则生成的值。
但通常不需要这样做，因为 Pigsty 会自动根据配置清单生成它。</p>
<hr>
<h2 id="多池部署">多池部署</h2>
<p>MinIO 的架构允许通过添加新的存储池来扩容。在 Pigsty 中，您可以通过显式指定 <a href="/zh/docs/minio/param/#minio_volumes"><code>minio_volumes</code></a> 参数来分配每个存储池的节点，从而实现集群扩容。</p>
<p>例如，假设您已经创建了 <a href="/zh/docs/minio/config/#多机多盘">多机多盘</a> 样例中定义的 MinIO 集群，现在您想要添加一个新的存储池，同样由四个节点构成。</p>
<p>那么，你需要直接覆盖指定 <a href="/zh/docs/minio/param/#minio_volumes"><code>minio_volumes</code></a> 参数：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">minio</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">hosts</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">10.10.10.10</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span>{<span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">minio_seq</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#0000cf;font-weight:bold">1</span><span style="color:#f8f8f8;text-decoration:underline"> </span>}<span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">10.10.10.11</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span>{<span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">minio_seq</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#0000cf;font-weight:bold">2</span><span style="color:#f8f8f8;text-decoration:underline"> </span>}<span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">10.10.10.12</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span>{<span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">minio_seq</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#0000cf;font-weight:bold">3</span><span style="color:#f8f8f8;text-decoration:underline"> </span>}<span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">10.10.10.13</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span>{<span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">minio_seq</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#0000cf;font-weight:bold">4</span><span style="color:#f8f8f8;text-decoration:underline"> </span>}<span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">10.10.10.14</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span>{<span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">minio_seq</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#0000cf;font-weight:bold">5</span><span style="color:#f8f8f8;text-decoration:underline"> </span>}<span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">10.10.10.15</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span>{<span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">minio_seq</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#0000cf;font-weight:bold">6</span><span style="color:#f8f8f8;text-decoration:underline"> </span>}<span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">10.10.10.16</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span>{<span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">minio_seq</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#0000cf;font-weight:bold">7</span><span style="color:#f8f8f8;text-decoration:underline"> </span>}<span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">10.10.10.17</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span>{<span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">minio_seq</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#0000cf;font-weight:bold">8</span><span style="color:#f8f8f8;text-decoration:underline"> </span>}<span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">vars</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">minio_cluster</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">minio</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">minio_data</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;/data{1...4}&#34;</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">minio_node</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#39;${minio_cluster}-${minio_seq}.pigsty&#39;</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#8f5902;font-style:italic"># minio 节点名称规则</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">minio_volumes</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#39;https://minio-{1...4}.pigsty:9000/data{1...4} https://minio-{5...8}.pigsty:9000/data{1...4}&#39;</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span></code></pre></div><p>在这里，空格分割的两个参数分别代表两个存储池，每个存储池有四个节点，每个节点有四块磁盘。更多关于存储池的信息请参考 <a href="/zh/docs/minio/admin/">管理预案：MinIO集群扩容</a></p>
<hr>
<h2 id="多套集群">多套集群</h2>
<p>您可以将新的 MinIO 节点部署为一个全新的 MinIO 集群，使用不同的集群名称定义一个新的分组即可，以下配置声明了两个独立的 MinIO 集群：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">minio1</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">hosts</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">10.10.10.10</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span>{<span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">minio_seq</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#0000cf;font-weight:bold">1</span><span style="color:#f8f8f8;text-decoration:underline"> </span>}<span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">10.10.10.11</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span>{<span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">minio_seq</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#0000cf;font-weight:bold">2</span><span style="color:#f8f8f8;text-decoration:underline"> </span>}<span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">10.10.10.12</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span>{<span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">minio_seq</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#0000cf;font-weight:bold">3</span><span style="color:#f8f8f8;text-decoration:underline"> </span>}<span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">10.10.10.13</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span>{<span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">minio_seq</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#0000cf;font-weight:bold">4</span><span style="color:#f8f8f8;text-decoration:underline"> </span>}<span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">vars</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">minio_cluster</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">minio2</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">minio_data</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;/data{1...4}&#34;</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:bold">minio2</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">hosts</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">    
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">10.10.10.14</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span>{<span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">minio_seq</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#0000cf;font-weight:bold">5</span><span style="color:#f8f8f8;text-decoration:underline"> </span>}<span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">10.10.10.15</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span>{<span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">minio_seq</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#0000cf;font-weight:bold">6</span><span style="color:#f8f8f8;text-decoration:underline"> </span>}<span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">10.10.10.16</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span>{<span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">minio_seq</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#0000cf;font-weight:bold">7</span><span style="color:#f8f8f8;text-decoration:underline"> </span>}<span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">10.10.10.17</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span>{<span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">minio_seq</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#0000cf;font-weight:bold">8</span><span style="color:#f8f8f8;text-decoration:underline"> </span>}<span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">vars</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">minio_cluster</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">minio2</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">minio_data</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;/data{1...4}&#34;</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">minio_alias</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">sss2</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">minio_domain</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">sss2.pigsty</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">minio_endpoint</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">sss2.pigsty:9000</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span></code></pre></div><p>请注意，Pigsty 默认一套部署中只有一个 MinIO 集群，如果您需要部署多个 MinIO 集群，那么一些带有默认值的参数需要显式设置，无法省略，否则会出现命名冲突，如上所示。</p>
<hr>
<h2 id="服务接入">服务接入</h2>
<p>MinIO 默认使用 <code>9000</code> 端口提供服务。多节点 MinIO 集群可以通过访问 <strong>任意一个节点</strong> 来访问其服务。</p>
<p>服务接入属于 <a href="/zh/docs/node">NODE</a> 模块的功能范畴，这里仅做基本介绍。</p>
<p>多节点 MinIO 集群的高可用接入可以使用 L2 VIP 或 HAProxy 实现。例如，您可以选择使用 keepalived 在 MinIO 集群上绑定一个 L2 <a href="/zh/docs/reference/param#node_vip">VIP</a>，
或者使用由 <a href="/zh/docs/node"><code>NODE</code></a> 模块的提供的 <a href="/zh/docs/reference/param#haproxy"><code>haproxy</code></a> 组件，通过负载均衡器对外暴露 MinIO 服务。</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># minio cluster with 4 nodes and 4 drivers per node</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:bold">minio</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">hosts</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">10.10.10.10</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span>{<span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">minio_seq: 1 , nodename</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">minio-1 }</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">10.10.10.11</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span>{<span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">minio_seq: 2 , nodename</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">minio-2 }</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">10.10.10.12</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span>{<span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">minio_seq: 3 , nodename</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">minio-3 }</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">10.10.10.13</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span>{<span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">minio_seq: 4 , nodename</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">minio-4 }</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">vars</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">minio_cluster</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">minio</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">minio_data</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#39;/data{1...4}&#39;</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">minio_buckets</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000;font-weight:bold">[</span><span style="color:#f8f8f8;text-decoration:underline"> </span>{<span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">name</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">pgsql }, { name: infra }, { name: redis } ]</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">minio_users</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span>- {<span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">access_key: dba , secret_key: S3User.DBA, policy</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">consoleAdmin }</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span>- {<span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">access_key: pgbackrest , secret_key: S3User.SomeNewPassWord , policy</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">readwrite }</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#8f5902;font-style:italic"># bind a node l2 vip (10.10.10.9) to minio cluster (optional)</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">node_cluster</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">minio</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">vip_enabled</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">true</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">vip_vrid</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#0000cf;font-weight:bold">128</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">vip_address</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#0000cf;font-weight:bold">10.10.10.9</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">vip_interface</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">eth1</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#8f5902;font-style:italic"># expose minio service with haproxy on all nodes</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">haproxy_services</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span>- <span style="color:#204a87;font-weight:bold">name</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">minio                   </span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#8f5902;font-style:italic"># [REQUIRED] service name, unique</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">        </span><span style="color:#204a87;font-weight:bold">port</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#0000cf;font-weight:bold">9002</span><span style="color:#f8f8f8;text-decoration:underline">                     </span><span style="color:#8f5902;font-style:italic"># [REQUIRED] service port, unique</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">        </span><span style="color:#204a87;font-weight:bold">balance</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">leastconn            </span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#8f5902;font-style:italic"># [OPTIONAL] load balancer algorithm</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">        </span><span style="color:#204a87;font-weight:bold">options</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">                       </span><span style="color:#8f5902;font-style:italic"># [OPTIONAL] minio health check</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">          </span>- <span style="color:#000">option httpchk</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">          </span>- <span style="color:#000">option http-keep-alive</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">          </span>- <span style="color:#000">http-check send meth OPTIONS uri /minio/health/live</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">          </span>- <span style="color:#000">http-check expect status 200</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">        </span><span style="color:#204a87;font-weight:bold">servers</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">          </span>- {<span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">name: minio-1 ,ip: 10.10.10.10 ,port: 9000 ,options</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#39;check-ssl ca-file /etc/pki/ca.crt check port 9000&#39;</span><span style="color:#f8f8f8;text-decoration:underline"> </span>}<span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">          </span>- {<span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">name: minio-2 ,ip: 10.10.10.11 ,port: 9000 ,options</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#39;check-ssl ca-file /etc/pki/ca.crt check port 9000&#39;</span><span style="color:#f8f8f8;text-decoration:underline"> </span>}<span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">          </span>- {<span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">name: minio-3 ,ip: 10.10.10.12 ,port: 9000 ,options</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#39;check-ssl ca-file /etc/pki/ca.crt check port 9000&#39;</span><span style="color:#f8f8f8;text-decoration:underline"> </span>}<span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">          </span>- {<span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">name: minio-4 ,ip: 10.10.10.13 ,port: 9000 ,options</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#39;check-ssl ca-file /etc/pki/ca.crt check port 9000&#39;</span><span style="color:#f8f8f8;text-decoration:underline"> </span>}<span style="color:#f8f8f8;text-decoration:underline">
</span></span></span></code></pre></div><p>例如，上面的配置块为 MinIO 集群的所有节点上启用了 HAProxy ，在 9002 端口上暴露 MinIO 服务，同时为集群绑定了一个二层 VIP。
当使用时，用户应当将 <code>sss.pigsty</code> 域名解析指向 VIP 地址 <code>10.10.10.9</code>，并使用 <code>9002</code> 端口访问 MinIO 服务。这样当任意一个节点发生故障时，VIP 会自动切换到另一个节点，保证服务的高可用性。</p>
<p>在这种情况下，您通常还需要在全局修改域名解析的目的地，以及 <a href="/zh/docs/minio/param/#minio_endpoint"><code>minio_endpoint</code></a> 参数，修改写入管理节点 MinIO Alias 对应的端点地址：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">minio_endpoint</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">https://sss.pigsty:9002  </span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#8f5902;font-style:italic"># 覆盖默认值： https://sss.pigsty:9000</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:bold">node_etc_hosts</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000;font-weight:bold">[</span><span style="color:#4e9a06">&#34;10.10.10.9 sss.pigsty&#34;</span><span style="color:#000;font-weight:bold">]</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#8f5902;font-style:italic"># 其他节点将使用 sss.pigsty 域名来访问 MinIO</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span></code></pre></div><hr>
<h2 id="专用负载均衡">专用负载均衡</h2>
<p>Pigsty 允许用户使用专用的负载均衡服务器组，而不是集群本身来运行 VIP 与 HAProxy。例如 <a href="/zh/docs/conf/prod"><code>prod</code></a> 模板中就使用了这种方式。</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">proxy</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">hosts</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">10.10.10.18 </span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span>{<span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">nodename: proxy1 ,node_cluster: proxy ,vip_interface: eth1 ,vip_role</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">master }</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">10.10.10.19 </span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span>{<span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">nodename: proxy2 ,node_cluster: proxy ,vip_interface: eth1 ,vip_role</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">backup }</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">vars</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">vip_enabled</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">true</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">vip_address</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#0000cf;font-weight:bold">10.10.10.20</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">vip_vrid</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#0000cf;font-weight:bold">20</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">haproxy_services:      # expose minio service </span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">sss.pigsty:9000</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span>- <span style="color:#204a87;font-weight:bold">name</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">minio       </span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#8f5902;font-style:italic"># [REQUIRED] service name, unique</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">        </span><span style="color:#204a87;font-weight:bold">port</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#0000cf;font-weight:bold">9000</span><span style="color:#f8f8f8;text-decoration:underline">         </span><span style="color:#8f5902;font-style:italic"># [REQUIRED] service port, unique</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">        </span><span style="color:#204a87;font-weight:bold">balance</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">leastconn</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#8f5902;font-style:italic"># Use leastconn algorithm and minio health check</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">        </span><span style="color:#204a87;font-weight:bold">options</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000;font-weight:bold">[</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;option httpchk&#34;</span><span style="color:#000;font-weight:bold">,</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;option http-keep-alive&#34;</span><span style="color:#000;font-weight:bold">,</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;http-check send meth OPTIONS uri /minio/health/live&#34;</span><span style="color:#000;font-weight:bold">,</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;http-check expect status 200&#34;</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000;font-weight:bold">]</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">        </span><span style="color:#204a87;font-weight:bold">servers</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">           </span><span style="color:#8f5902;font-style:italic"># reload service with ./node.yml -t haproxy_config,haproxy_reload</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">          </span>- {<span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">name: minio-1 ,ip: 10.10.10.21 ,port: 9000 ,options</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#39;check-ssl ca-file /etc/pki/ca.crt check port 9000&#39;</span><span style="color:#f8f8f8;text-decoration:underline"> </span>}<span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">          </span>- {<span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">name: minio-2 ,ip: 10.10.10.22 ,port: 9000 ,options</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#39;check-ssl ca-file /etc/pki/ca.crt check port 9000&#39;</span><span style="color:#f8f8f8;text-decoration:underline"> </span>}<span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">          </span>- {<span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">name: minio-3 ,ip: 10.10.10.23 ,port: 9000 ,options</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#39;check-ssl ca-file /etc/pki/ca.crt check port 9000&#39;</span><span style="color:#f8f8f8;text-decoration:underline"> </span>}<span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">          </span>- {<span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">name: minio-4 ,ip: 10.10.10.24 ,port: 9000 ,options</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#39;check-ssl ca-file /etc/pki/ca.crt check port 9000&#39;</span><span style="color:#f8f8f8;text-decoration:underline"> </span>}<span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">          </span>- {<span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">name: minio-5 ,ip: 10.10.10.25 ,port: 9000 ,options</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#39;check-ssl ca-file /etc/pki/ca.crt check port 9000&#39;</span><span style="color:#f8f8f8;text-decoration:underline"> </span>}<span style="color:#f8f8f8;text-decoration:underline">
</span></span></span></code></pre></div><p>在这种情况下，您通常还需要在全局修改 MinIO 域名的解析，将 <code>sss.pigsty</code> 指向负载均衡器的地址，并修改 <a href="/zh/docs/minio/param/#minio_endpoint"><code>minio_endpoint</code></a> 参数，修改写入管理节点 MinIO Alias 对应的端点地址：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">minio_endpoint: https://sss.pigsty:9002    # overwrite the defaults</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">https://sss.pigsty:9000</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:bold">node_etc_hosts</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000;font-weight:bold">[</span><span style="color:#4e9a06">&#34;10.10.10.20 sss.pigsty&#34;</span><span style="color:#000;font-weight:bold">]</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#8f5902;font-style:italic"># domain name to access minio from all nodes (required)</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span></code></pre></div><hr>
<h2 id="访问服务">访问服务</h2>
<p>如果您想要访问上面通过 HAProxy 暴露的 MinIO，以 PGSQL 备份配置为例，可以修改 <a href="/zh/docs/reference/param#pgbackrest_repo"><code>pgbackrest_repo</code></a> 中的配置，添加新的备份仓库定义：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># 这是新添加的 HA MinIO Repo 定义，使用此配置代替之前的单机 MinIO 配置</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:bold">minio_ha</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">type</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">s3</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">s3_endpoint</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">minio-1.pigsty  </span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#8f5902;font-style:italic"># s3_endpoint 可以是任何一个负载均衡器：10.10.10.1{0,1,2}，或指向任意 3 个节点的域名</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">s3_region</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">us-east-1         </span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#8f5902;font-style:italic"># 你可以使用外部域名：sss.pigsty，该域名指向任一成员（`minio_domain`）</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">s3_bucket</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">pgsql             </span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#8f5902;font-style:italic"># 你可使用实例名和节点名：minio-1.pigsty minio-1.pigsty minio-1.pigsty minio-1 minio-2 minio-3</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">s3_key</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">pgbackrest           </span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#8f5902;font-style:italic"># 最好为 MinIO 的 pgbackrest 用户使用专门的密码</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">s3_key_secret</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">S3User.SomeNewPassWord</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">s3_uri_style</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">path</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">path</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">/pgbackrest</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">storage_port</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#0000cf;font-weight:bold">9002</span><span style="color:#f8f8f8;text-decoration:underline">            </span><span style="color:#8f5902;font-style:italic"># 使用负载均衡器的端口 9002 代替默认的 9000（直接访问）</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">storage_ca_file</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">/etc/pki/ca.crt</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">bundle</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">y</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">cipher_type</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">aes-256-cbc     </span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#8f5902;font-style:italic"># 在您的生产环境中最好使用新的加密密码，这里可以使用集群名作为密码的一部分。</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">cipher_pass</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">pgBackRest.With.Some.Extra.PassWord.And.Salt.${pg_cluster}</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">retention_full_type</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">time</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">retention_full</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#0000cf;font-weight:bold">14</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span></code></pre></div><hr>
<h2 id="暴露管控">暴露管控</h2>
<p>MinIO 默认通过 <code>9001</code> 端口（由 <a href="/zh/docs/minio/param/#minio_admin_port"><code>minio_admin_port</code></a> 参数指定）提供Web管控界面。</p>
<p>将后台管理界面暴露给外部可能存在安全隐患。如果你希望这样做，请将 MinIO 添加到 <a href="/zh/docs/reference/param#infra_portal"><code>infra_portal</code></a> 并刷新 Nginx 配置。</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># ./infra.yml -t nginx</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:bold">infra_portal</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">home         </span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span>{<span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">domain</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">h.pigsty }</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">grafana      </span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span>{<span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">domain: g.pigsty ,endpoint</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;${admin_ip}:3000&#34;</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">, websocket</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">true</span><span style="color:#f8f8f8;text-decoration:underline"> </span>}<span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">prometheus   </span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span>{<span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">domain: p.pigsty ,endpoint</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;${admin_ip}:9090&#34;</span><span style="color:#f8f8f8;text-decoration:underline"> </span>}<span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">alertmanager </span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span>{<span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">domain: a.pigsty ,endpoint</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;${admin_ip}:9093&#34;</span><span style="color:#f8f8f8;text-decoration:underline"> </span>}<span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">blackbox     </span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span>{<span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">endpoint</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;${admin_ip}:9115&#34;</span><span style="color:#f8f8f8;text-decoration:underline"> </span>}<span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">loki         </span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span>{<span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">endpoint</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;${admin_ip}:3100&#34;</span><span style="color:#f8f8f8;text-decoration:underline"> </span>}<span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#8f5902;font-style:italic"># MinIO 管理页面需要 HTTPS / Websocket 才能工作</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">minio        </span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span>{<span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">domain: m.pigsty     ,endpoint</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;10.10.10.10:9001&#34;</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">,scheme: https ,websocket</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">true</span><span style="color:#f8f8f8;text-decoration:underline"> </span>}<span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">minio10      </span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span>{<span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">domain: m10.pigsty   ,endpoint</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;10.10.10.10:9001&#34;</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">,scheme: https ,websocket</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">true</span><span style="color:#f8f8f8;text-decoration:underline"> </span>}<span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">minio11      </span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span>{<span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">domain: m11.pigsty   ,endpoint</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;10.10.10.11:9001&#34;</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">,scheme: https ,websocket</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">true</span><span style="color:#f8f8f8;text-decoration:underline"> </span>}<span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">minio12      </span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span>{<span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">domain: m12.pigsty   ,endpoint</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;10.10.10.12:9001&#34;</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">,scheme: https ,websocket</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">true</span><span style="color:#f8f8f8;text-decoration:underline"> </span>}<span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">minio13      </span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span>{<span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">domain: m13.pigsty   ,endpoint</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;10.10.10.13:9001&#34;</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">,scheme: https ,websocket</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">true</span><span style="color:#f8f8f8;text-decoration:underline"> </span>}<span style="color:#f8f8f8;text-decoration:underline">
</span></span></span></code></pre></div><p>请注意，MinIO 管控页面需要使用 HTTPS，请 <strong>不要</strong> 在生产环境中暴露未加密的 MinIO 管控页面。</p>
<p>这意味着，您通常需要在您的 DNS 服务器，或者本机 <code>/etc/hosts</code> 中添加 <code>m.pigsty</code> 的解析记录，以便访问 MinIO 管控页面。</p>
<p>与此同时，如果您使用的是 Pigsty 自签名的 CA 而不是一个正规的公共 CA ，通常您还需要手工信任该 CA 或证书，才能跳过浏览器中的 “不安全” 提示信息。</p>
<br>
<hr>
<br>

</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-280b7e56b08e272d7b26411d506d6c5d">3 - 参数列表</h1>
    <div class="lead">MinIO 模块提供了 15 个相关配置参数，用于定制所需的 Minio 集群。</div>
	<p>MinIO 是一个与 S3 兼容的对象存储服务，它被用作 PostgreSQL 的可选的集中式备份存储库。</p>
<p>但用户也可以将其用于其他目的，如存储文件、文档、图片和视频，作为数据湖。</p>
<hr>
<h2 id="参数列表">参数列表</h2>
<p>MinIO 模块有 15 个相关参数：</p>
<table>
<thead>
<tr>
<th style="text-align:right">参数</th>
<th>类型</th>
<th>层次</th>
<th>中文说明</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right"><a href="/zh/docs/minio/param/#minio_seq"><code>minio_seq</code></a></td>
<td>int</td>
<td>I</td>
<td>minio 实例标识符，必填</td>
</tr>
<tr>
<td style="text-align:right"><a href="/zh/docs/minio/param/#minio_cluster"><code>minio_cluster</code></a></td>
<td>string</td>
<td>C</td>
<td>minio 集群名称，默认为 minio</td>
</tr>
<tr>
<td style="text-align:right"><a href="/zh/docs/minio/param/#minio_clean"><code>minio_clean</code></a></td>
<td>bool</td>
<td>G/C/A</td>
<td>初始化时清除 minio？默认为 false</td>
</tr>
<tr>
<td style="text-align:right"><a href="/zh/docs/minio/param/#minio_user"><code>minio_user</code></a></td>
<td>username</td>
<td>C</td>
<td>minio 操作系统用户，默认为 <code>minio</code></td>
</tr>
<tr>
<td style="text-align:right"><a href="/zh/docs/minio/param/#minio_node"><code>minio_node</code></a></td>
<td>string</td>
<td>C</td>
<td>minio 节点名模式</td>
</tr>
<tr>
<td style="text-align:right"><a href="/zh/docs/minio/param/#minio_data"><code>minio_data</code></a></td>
<td>path</td>
<td>C</td>
<td>minio 数据目录，使用 <code>{x...y}</code> 指定多个磁盘</td>
</tr>
<tr>
<td style="text-align:right"><a href="/zh/docs/minio/param/#minio_volumes"><code>minio_volumes</code></a></td>
<td>string</td>
<td>C</td>
<td>minio 核心参数，指定成员节点与磁盘，默认不指定</td>
</tr>
<tr>
<td style="text-align:right"><a href="/zh/docs/minio/param/#minio_domain"><code>minio_domain</code></a></td>
<td>string</td>
<td>G</td>
<td>minio 外部域名，默认为 <code>sss.pigsty</code></td>
</tr>
<tr>
<td style="text-align:right"><a href="/zh/docs/minio/param/#minio_port"><code>minio_port</code></a></td>
<td>port</td>
<td>C</td>
<td>minio 服务端口，默认为 9000</td>
</tr>
<tr>
<td style="text-align:right"><a href="/zh/docs/minio/param/#minio_admin_port"><code>minio_admin_port</code></a></td>
<td>port</td>
<td>C</td>
<td>minio 控制台端口，默认为 9001</td>
</tr>
<tr>
<td style="text-align:right"><a href="/zh/docs/minio/param/#minio_access_key"><code>minio_access_key</code></a></td>
<td>username</td>
<td>C</td>
<td>根访问密钥，默认为 <code>minioadmin</code></td>
</tr>
<tr>
<td style="text-align:right"><a href="/zh/docs/minio/param/#minio_secret_key"><code>minio_secret_key</code></a></td>
<td>password</td>
<td>C</td>
<td>根密钥，默认为 <code>minioadmin</code></td>
</tr>
<tr>
<td style="text-align:right"><a href="/zh/docs/minio/param/#minio_extra_vars"><code>minio_extra_vars</code></a></td>
<td>string</td>
<td>C</td>
<td>minio 服务器的额外环境变量</td>
</tr>
<tr>
<td style="text-align:right"><a href="/zh/docs/minio/param/#minio_alias"><code>minio_alias</code></a></td>
<td>string</td>
<td>C</td>
<td>minio 部署的客户端别名</td>
</tr>
<tr>
<td style="text-align:right"><a href="/zh/docs/minio/param/#minio_endpoint"><code>minio_endpoint</code></a></td>
<td>string</td>
<td>C</td>
<td>minio 部署的客户端别名对应的端点</td>
</tr>
<tr>
<td style="text-align:right"><a href="/zh/docs/minio/param/#minio_buckets"><code>minio_buckets</code></a></td>
<td>bucket[]</td>
<td>C</td>
<td>待创建的 minio 存储桶列表</td>
</tr>
<tr>
<td style="text-align:right"><a href="/zh/docs/minio/param/#minio_users"><code>minio_users</code></a></td>
<td>user[]</td>
<td>C</td>
<td>待创建的 minio 用户列表</td>
</tr>
</tbody>
</table>
<p>其中，<code>minio_volumes</code> 与 <code>minio_endpoint</code> 为自动生成的参数，但您可以显式覆盖指定这两个参数。</p>
<hr>
<h2 id="默认参数">默认参数</h2>
<p>MinIO 模块的默认参数为：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic">#-----------------------------------------------------------------</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#8f5902;font-style:italic"># MINIO</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#8f5902;font-style:italic">#-----------------------------------------------------------------</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#8f5902;font-style:italic">#minio_seq: 1                     # minio 实例标识符，必填</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:bold">minio_cluster</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">minio             </span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#8f5902;font-style:italic"># minio 集群名称，默认为 minio</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:bold">minio_clean</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">false</span><span style="color:#f8f8f8;text-decoration:underline">                </span><span style="color:#8f5902;font-style:italic"># 初始化时清除 minio？默认为 false</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:bold">minio_user</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">minio                </span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#8f5902;font-style:italic"># minio 操作系统用户，默认为 `minio`</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:bold">minio_node</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#39;${minio_cluster}-${minio_seq}.pigsty&#39;</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#8f5902;font-style:italic"># minio 节点名模式</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:bold">minio_data</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#39;/data/minio&#39;</span><span style="color:#f8f8f8;text-decoration:underline">         </span><span style="color:#8f5902;font-style:italic"># minio 数据目录，使用 `{x...y}` 指定多个磁盘</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#8f5902;font-style:italic">#minio_volumes:                   # minio 核心参数，如果未指定，则使用拼接生成的默认值 </span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:bold">minio_domain</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">sss.pigsty         </span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#8f5902;font-style:italic"># minio 外部域名，默认为 `sss.pigsty`</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:bold">minio_port</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#0000cf;font-weight:bold">9000</span><span style="color:#f8f8f8;text-decoration:underline">                  </span><span style="color:#8f5902;font-style:italic"># minio 服务端口，默认为 9000</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:bold">minio_admin_port</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#0000cf;font-weight:bold">9001</span><span style="color:#f8f8f8;text-decoration:underline">            </span><span style="color:#8f5902;font-style:italic"># minio 控制台端口，默认为 9001</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:bold">minio_access_key</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">minioadmin     </span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#8f5902;font-style:italic"># 根访问密钥，默认为 `minioadmin`</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:bold">minio_secret_key</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">minioadmin     </span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#8f5902;font-style:italic"># 根密钥，默认为 `minioadmin`</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:bold">minio_extra_vars</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#39;&#39;</span><span style="color:#f8f8f8;text-decoration:underline">              </span><span style="color:#8f5902;font-style:italic"># minio 服务器的额外环境变量</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:bold">minio_alias</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">sss                 </span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#8f5902;font-style:italic"># minio 部署的客户端别名</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#8f5902;font-style:italic">#minio_endpoint: https://sss.pigsty:9000 # minio 别名对应的接入点，如果未指定，则使用拼接生成的默认值</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:bold">minio_buckets</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000;font-weight:bold">[</span><span style="color:#f8f8f8;text-decoration:underline"> </span>{<span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">name</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">pgsql }, { name: infra },  { name: redis } ]</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#8f5902;font-style:italic"># 待创建的 minio 存储桶列表</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:bold">minio_users</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">                      </span><span style="color:#8f5902;font-style:italic"># 待创建的 minio 用户列表</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span>- {<span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">access_key: dba , secret_key: S3User.DBA, policy</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">consoleAdmin }</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span>- {<span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">access_key: pgbackrest , secret_key: S3User.Backup, policy</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">readwrite }</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span></code></pre></div><hr>
<h2 id="minio_seq"><code>minio_seq</code></h2>
<p>参数名称： <code>minio_seq</code>， 类型： <code>int</code>， 层次：<code>I</code></p>
<p>MinIO 实例标识符，必需的身份参数。没有默认值，您必须手动分配这些序列号。</p>
<p>通常的最佳实践是，从1开始分配，依次加1，并永远不使用已经分配的序列号。</p>
<hr>
<h2 id="minio_cluster"><code>minio_cluster</code></h2>
<p>参数名称： <code>minio_cluster</code>， 类型： <code>string</code>， 层次：<code>C</code></p>
<p>MinIO 集群名称，默认为 <code>minio</code>。当部署多个MinIO集群时，可以使用此参数进行区分。</p>
<hr>
<h2 id="minio_clean"><code>minio_clean</code></h2>
<p>参数名称： <code>minio_clean</code>， 类型： <code>bool</code>， 层次：<code>G/C/A</code></p>
<p>是否在初始化时清理 MinIO ？默认为 <code>false</code>，即不清理现有数据。</p>
<p>如果您想在移除，或者在安装过程中清理 MinIO 数据目录，可以将此参数设置为 <code>true</code>，这是一个危险的操作，因为它会删除所有MinIO数据！</p>
<hr>
<h2 id="minio_user"><code>minio_user</code></h2>
<p>参数名称： <code>minio_user</code>， 类型： <code>username</code>， 层次：<code>C</code></p>
<p>MinIO 操作系统用户名，默认为 <code>minio</code>，MinIO 的家目录中将存储 MinIO 使用的证书。</p>
<hr>
<h2 id="minio_node"><code>minio_node</code></h2>
<p>参数名称： <code>minio_node</code>， 类型： <code>string</code>， 层次：<code>C</code></p>
<p>MinIO 节点名称模式，用于<a href="/zh/docs/minio/config#%E5%A4%9A%E6%9C%BA%E5%A4%9A%E7%9B%98">多节点</a>部署。</p>
<p>默认值为：<code>${minio_cluster}-${minio_seq}.pigsty</code>，即以实例名 + <code>.pigsty</code> 后缀作为默认的节点名。</p>
<p>在这里指定的域名模式将用于生成节点名，节点名将写入所有 MinIO 节点的 <code>/etc/hosts</code> 文件中。</p>
<hr>
<h2 id="minio_data"><code>minio_data</code></h2>
<p>参数名称： <code>minio_data</code>， 类型： <code>path</code>， 层次：<code>C</code></p>
<p>MinIO 数据目录（们），默认值：<code>/data/minio</code>，这是<a href="/zh/docs/minio/config#%E5%8D%95%E6%9C%BA%E5%8D%95%E7%9B%98">单节点</a>部署的常见目录。</p>
<p>对于 <a href="/zh/docs/minio/config#%E5%A4%9A%E6%9C%BA%E5%A4%9A%E7%9B%98">多机多盘</a> 与 <a href="/zh/docs/minio/config#%E5%8D%95%E6%9C%BA%E5%A4%9A%E7%9B%98"><strong>单机多盘</strong></a> 部署，您可以使用 <code>{x...y}</code> 的记法来指定多个磁盘。</p>
<hr>
<h2 id="minio_volumes"><code>minio_volumes</code></h2>
<p>参数名称： <code>minio_volumes</code>， 类型： <code>string</code>， 层次：<code>C</code></p>
<p>MinIO 核心参数，默认不指定留空，留空情况下，该参数会自动使用以下规则拼接生成：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">minio_volumes</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;{% if minio_cluster_size|int &gt; 1 %}https://{{ minio_node|replace(&#39;${minio_cluster}&#39;, minio_cluster)|replace(&#39;${minio_seq}&#39;,minio_seq_range) }}:{{ minio_port|default(9000) }}{% endif %}{{ minio_data }}&#34;</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span></code></pre></div><ul>
<li>在单机部署（无论是单盘还是多盘）模式下，<code>minio_volumes</code> 直接使用 <a href="/zh/docs/minio/param/#minio_data"><code>minio_data</code></a> 的值，进行单机部署。</li>
<li>在多机部署模式下，<code>minio_volumes</code> 会使用 <code>minio_node</code>, <code>minio_port</code>, <code>minio_data</code> 参数的值生成多节点的地址，用于多机部署。</li>
<li>在多池部署模式下，通常需要您直接指定并覆盖 <code>minio_volumes</code> 的值，以指定多个节点池的地址。</li>
</ul>
<p>指定本参数时，您需要确保使用的参数与 <code>minio_node</code>, <code>minio_port</code>, <code>minio_data</code> 三者匹配。</p>
<hr>
<h2 id="minio_domain"><code>minio_domain</code></h2>
<p>参数名称： <code>minio_domain</code>， 类型： <code>string</code>， 层次：<code>G</code></p>
<p>MinIO 服务域名，默认为<code>sss.pigsty</code>。</p>
<p>客户端可以通过此域名访问 MinIO S3 服务。此名称将注册到本地 DNSMASQ，并包含在 SSL 证书字段中。</p>
<hr>
<h2 id="minio_port"><code>minio_port</code></h2>
<p>参数名称： <code>minio_port</code>， 类型： <code>port</code>， 层次：<code>C</code></p>
<p>MinIO 服务端口，默认为<code>9000</code>。</p>
<hr>
<h2 id="minio_admin_port"><code>minio_admin_port</code></h2>
<p>参数名称： <code>minio_admin_port</code>， 类型： <code>port</code>， 层次：<code>C</code></p>
<p>MinIO 控制台端口，默认为<code>9001</code>。</p>
<hr>
<h2 id="minio_access_key"><code>minio_access_key</code></h2>
<p>参数名称： <code>minio_access_key</code>， 类型： <code>username</code>， 层次：<code>C</code></p>
<p>根访问用户名（access key），默认为<code>minioadmin</code>。</p>
<hr>
<h2 id="minio_secret_key"><code>minio_secret_key</code></h2>
<p>参数名称： <code>minio_secret_key</code>， 类型： <code>password</code>， 层次：<code>C</code></p>
<p>根访问密钥（secret key），默认为<code>minioadmin</code>。</p>


<div class="alert alert-danger" role="alert">
<h4 class="alert-heading">使用默认根密码是高危行为！请务必在生产部署中更改此参数！</h4>

    

</div>

<hr>
<h2 id="minio_extra_vars"><code>minio_extra_vars</code></h2>
<p>参数名称： <code>minio_extra_vars</code>， 类型： <code>string</code>， 层次：<code>C</code></p>
<p>MinIO 服务器的额外环境变量。查看 <a href="https://min.io/docs/minio/linux/reference/minio-server/minio-server.html">MinIO Server</a> 文档以获取完整列表。</p>
<p>默认值为空字符串，您可以使用多行字符串来传递多个环境变量。</p>
<hr>
<h2 id="minio_alias"><code>minio_alias</code></h2>
<p>参数名称： <code>minio_alias</code>， 类型： <code>string</code>， 层次：<code>C</code></p>
<p>本地 MinIO 集群的 MinIO 别名，默认值：<code>sss</code>，它将被写入基础设施节点/管理员用户的客户端别名配置文件中。</p>
<hr>
<h2 id="minio_endpoint"><code>minio_endpoint</code></h2>
<p>参数名称：<code>minio_endpoint</code>， 类型： <code>string</code>， 层次：<code>C</code></p>
<p>部署的客户端别名对应的端点，如果指定，这里的 <code>minio_endpoint</code> （例如： <code>https://sss.pigsty:9002</code>）将会替代默认值，作为写入管理节点 MinIO Alias 的目标端点。</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>mcli <span style="color:#204a87">alias</span> <span style="color:#204a87">set</span> <span style="color:#ce5c00;font-weight:bold">{{</span> minio_alias <span style="color:#ce5c00;font-weight:bold">}}</span> <span style="color:#ce5c00;font-weight:bold">{</span>% <span style="color:#204a87;font-weight:bold">if</span> minio_endpoint is defined and minio_endpoint !<span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#4e9a06">&#39;&#39;</span> %<span style="color:#ce5c00;font-weight:bold">}{{</span> minio_endpoint <span style="color:#ce5c00;font-weight:bold">}}{</span>% <span style="color:#204a87;font-weight:bold">else</span> %<span style="color:#ce5c00;font-weight:bold">}</span>https://<span style="color:#ce5c00;font-weight:bold">{{</span> minio_domain <span style="color:#ce5c00;font-weight:bold">}}</span>:<span style="color:#ce5c00;font-weight:bold">{{</span> minio_port <span style="color:#ce5c00;font-weight:bold">}}{</span>% endif %<span style="color:#ce5c00;font-weight:bold">}</span> <span style="color:#ce5c00;font-weight:bold">{{</span> minio_access_key <span style="color:#ce5c00;font-weight:bold">}}</span> <span style="color:#ce5c00;font-weight:bold">{{</span> minio_secret_key <span style="color:#ce5c00;font-weight:bold">}}</span>
</span></span></code></pre></div><p>以上 MinIO Alias 会在管理节点上以默认管理用户执行。</p>
<hr>
<h2 id="minio_buckets"><code>minio_buckets</code></h2>
<p>参数名称： <code>minio_buckets</code>， 类型： <code>bucket[]</code>， 层次：<code>C</code></p>
<p>默认创建的minio存储桶列表：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">minio_buckets</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000;font-weight:bold">[</span><span style="color:#f8f8f8;text-decoration:underline"> </span>{<span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">name</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">pgsql }, { name: infra },  { name: redis } ]</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span></code></pre></div><p>为模块 <a href="/zh/docs/pgsql"><code>PGSQL</code></a>、<a href="/zh/docs/infra"><code>INFRA</code></a>和<a href="/zh/docs/redis"><code>REDIS</code></a> 创建了三个默认的存储桶</p>
<p>目前这三个桶中，仅 <code>pgsql</code> 默认用于 pgbackrest 备份存储。</p>
<hr>
<h2 id="minio_users"><code>minio_users</code></h2>
<p>参数名称： <code>minio_users</code>， 类型： <code>user[]</code>， 层次：<code>C</code></p>
<p>要创建的minio用户列表，默认值：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">minio_users</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span>- {<span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">access_key: dba , secret_key: S3User.DBA, policy</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">consoleAdmin }</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span>- {<span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">access_key: pgbackrest , secret_key: S3User.Backup, policy</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">readwrite }</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span></code></pre></div><p>默认配置会为 PostgreSQL DBA 和 pgBackREST 创建两个默认用户：<code>dba</code>，<code>pgbackrest</code>。</p>


<div class="alert alert-danger" role="alert">
<h4 class="alert-heading">使用默认密码是高危行为！请务必在您的部署中调整这些凭证！</h4>

    

</div>

<br>
<hr>
<br>

</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-ccc1805ae841df3ebaeb7bb6b8008203">4 - 预置剧本</h1>
    <div class="lead">如何使用预置的 ansible 剧本来管理 MinIO 集群，常用管理命令速查。</div>
	<p>MinIO 模块提供了一个默认的剧本 <a href="/zh/docs/minio/playbook/#minioyml"><code>minio.yml</code></a> ，用于安装 MinIO 集群。</p>
<hr>
<h2 id="minioyml"><code>minio.yml</code></h2>
<p>剧本 <a href="https://github.com/Vonng/pigsty/blob/main/minio.yml"><code>minio.yml</code></a> 用于在节点上安装 MinIO 模块。</p>
<ul>
<li><code>minio-id</code>        : 生成/校验 minio 身份参数</li>
<li><code>minio_install</code>   : 安装 minio
<ul>
<li><code>minio_os_user</code> : 创建操作系统用户 minio</li>
<li><code>minio_pkg</code>     : 安装 minio/mcli 软件包</li>
<li><code>minio_clean</code>     : 移除 minio 数据目录 (默认不移除)</li>
<li><code>minio_dir</code>       : 创建 minio 目录</li>
</ul>
</li>
<li><code>minio_config</code>    : 生成 minio 配置
<ul>
<li><code>minio_conf</code>    : minio 主配置文件</li>
<li><code>minio_cert</code>    : minio SSL证书签发</li>
<li><code>minio_dns</code>     : minio DNS记录插入</li>
</ul>
</li>
<li><code>minio_launch</code>    : minio 服务启动</li>
<li><code>minio_register</code>  : minio 纳入监控</li>
<li><code>minio_provision</code> : 创建 minio 别名/存储桶/业务用户
<ul>
<li><code>minio_alias</code>   : 创建 minio 客户端别名（管理节点上）</li>
<li><code>minio_bucket</code>  : 创建 minio 存储桶</li>
<li><code>minio_user</code>    : 创建 minio 业务用户</li>
</ul>
</li>
</ul>
<p>在执行剧本前，请先在 <a href="/zh/docs/setup/config">配置清单</a> 中，完成 MinIO 集群的 <a href="/zh/docs/minio/config/">配置</a>。</p>
<hr>
<h2 id="命令速查">命令速查</h2>
<p>MINIO 剧本与快捷方式：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>./minio.yml -l &lt;cls&gt;                      <span style="color:#8f5902;font-style:italic"># 在 &lt;cls&gt; 分组上安装 MINIO 模块</span>
</span></span><span style="display:flex;"><span>./minio.yml -l minio -e <span style="color:#000">minio_clean</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#204a87">true</span>  <span style="color:#8f5902;font-style:italic"># 安装 MINIO 模块，安装时清理现有数据目录（危险！）</span>
</span></span><span style="display:flex;"><span>./minio.yml -l minio -e <span style="color:#000">minio_clean</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#204a87">true</span>  -t minio_clean <span style="color:#8f5902;font-style:italic"># 停止 MinIO 并抹除 MinIO 数据目录（危险！）</span>
</span></span><span style="display:flex;"><span>./minio.yml -l minio -t minio_instal      <span style="color:#8f5902;font-style:italic"># 在节点上安装 MinIO 服务，准备数据目录，但不启动</span>
</span></span><span style="display:flex;"><span>./minio.yml -l minio -t minio_config      <span style="color:#8f5902;font-style:italic"># 重新配置 MinIO 集群</span>
</span></span><span style="display:flex;"><span>./minio.yml -l minio -t minio_launch      <span style="color:#8f5902;font-style:italic"># 重启 MinIO 集群</span>
</span></span></code></pre></div><hr>
<h2 id="保护机制">保护机制</h2>
<p>出于防止误删的目的，Pigsty 的 MINIO 模块提供了防误删保险，由以下参数控制：</p>
<ul>
<li><a href="/zh/docs/minio/param#minio_clean"><code>minio_clean</code></a> 默认为 <code>false</code>，即，默认不清理现有实例。</li>
</ul>
<p>如果您希望在初始化时清理现有实例，请修改配置文件，显式关闭此保险，或者在执行时使用命令行参数 <code>-e minio_clean=true</code> 进行覆盖。</p>
<p>如果您单纯希望清理现有实例，而不安装新实例，直接执行 <code>minio_clean</code> 子任务即可：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>./minio.yml -l &lt;cls&gt; -e <span style="color:#000">minio_clean</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#204a87">true</span> -t minio_clean
</span></span></code></pre></div><hr>
<h2 id="执行演示">执行演示</h2>
<p><a href="https://asciinema.org/a/566415"><img alt="asciicast" src="https://asciinema.org/a/566415.svg"></a></p>
<br>
<hr>
<br>

</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-172708bf70f3c5729ee49aac66787c09">5 - 管理预案</h1>
    <div class="lead">MinIO 集群管理 SOP：创建，销毁，扩容，缩容，节点故障与磁盘故障的处理。</div>
	<hr>
<h2 id="创建集群">创建集群</h2>
<p>要创建一个集群，在配置清单中定义好后，执行 <a href="/zh/docs/minio/playbook/#minioyml"><code>minio.yml</code></a> 剧本即可。</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">minio</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span>{<span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">hosts</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span>{<span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">10.10.10.10</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span>{<span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">minio_seq: 1 } }, vars</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span>{<span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">minio_cluster</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">minio } }</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span></code></pre></div><p>例如，上面的配置定义了一个 SNSD <a href="/zh/docs/minio/config/#单机单盘">单机单盘</a> MinIO 集群，使用以下命令即可创建该 MinIO 集群：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>./minio.yml -l minio  <span style="color:#8f5902;font-style:italic"># 在 minio 分组上安装 MinIO 模块 </span>
</span></span></code></pre></div><hr>
<h2 id="销毁集群">销毁集群</h2>
<p>要销毁一个集群，执行 <a href="/zh/docs/minio/playbook/#minioyml"><code>minio.yml</code></a> 剧本的 <code>minio_clean</code> 子任务即可</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>./minio.yml -l minio -t minio_clean -e <span style="color:#000">minio_clean</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#204a87">true</span>   <span style="color:#8f5902;font-style:italic"># 停止并清理 MinIO 数据目录 </span>
</span></span></code></pre></div><p>如果您希望将 MinIO 从 Prometheus 监控系统中移除，可以执行：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>ansible infra -b -a <span style="color:#4e9a06">&#39;rm -rf /etc/prometheus/targets/minio/minio-1.yml&#39;</span>  <span style="color:#8f5902;font-style:italic"># 删除 MinIO 监控目标 minio-1 </span>
</span></span></code></pre></div><hr>
<h2 id="集群扩容">集群扩容</h2>
<ul>
<li><a href="https://min.io/docs/minio/linux/operations/install-deploy-manage/expand-minio-deployment.html">集群扩容教程</a></li>
</ul>
<p>MinIO 无法在节点/磁盘级别上扩容，但可以在存储池（多个节点）层次上进行扩容。</p>
<p>现在假设您有 <a href="/zh/docs/minio/config/#多盘部署">这样一个</a> 四节点的 MinIO 集群，希望扩容一倍，新增一个四节点的存储池。</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">minio</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">hosts</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">10.10.10.10</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span>{<span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">minio_seq: 1 , nodename</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">minio-1 }</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">10.10.10.11</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span>{<span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">minio_seq: 2 , nodename</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">minio-2 }</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">10.10.10.12</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span>{<span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">minio_seq: 3 , nodename</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">minio-3 }</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">10.10.10.13</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span>{<span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">minio_seq: 4 , nodename</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">minio-4 }</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">vars</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">minio_cluster</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">minio</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">minio_data</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#39;/data{1...4}&#39;</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">minio_buckets</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000;font-weight:bold">[</span><span style="color:#f8f8f8;text-decoration:underline"> </span>{<span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">name</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">pgsql }, { name: infra }, { name: redis } ]</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">minio_users</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span>- {<span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">access_key: dba , secret_key: S3User.DBA, policy</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">consoleAdmin }</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span>- {<span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">access_key: pgbackrest , secret_key: S3User.SomeNewPassWord , policy</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">readwrite }</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#8f5902;font-style:italic"># bind a node l2 vip (10.10.10.9) to minio cluster (optional)</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">node_cluster</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">minio</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">vip_enabled</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">true</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">vip_vrid</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#0000cf;font-weight:bold">128</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">vip_address</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#0000cf;font-weight:bold">10.10.10.9</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">vip_interface</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">eth1</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#8f5902;font-style:italic"># expose minio service with haproxy on all nodes</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">haproxy_services</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span>- <span style="color:#204a87;font-weight:bold">name</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">minio                   </span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#8f5902;font-style:italic"># [REQUIRED] service name, unique</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">        </span><span style="color:#204a87;font-weight:bold">port</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#0000cf;font-weight:bold">9002</span><span style="color:#f8f8f8;text-decoration:underline">                     </span><span style="color:#8f5902;font-style:italic"># [REQUIRED] service port, unique</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">        </span><span style="color:#204a87;font-weight:bold">balance</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">leastconn            </span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#8f5902;font-style:italic"># [OPTIONAL] load balancer algorithm</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">        </span><span style="color:#204a87;font-weight:bold">options</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">                       </span><span style="color:#8f5902;font-style:italic"># [OPTIONAL] minio health check</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">          </span>- <span style="color:#000">option httpchk</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">          </span>- <span style="color:#000">option http-keep-alive</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">          </span>- <span style="color:#000">http-check send meth OPTIONS uri /minio/health/live</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">          </span>- <span style="color:#000">http-check expect status 200</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">        </span><span style="color:#204a87;font-weight:bold">servers</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">          </span>- {<span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">name: minio-1 ,ip: 10.10.10.10 ,port: 9000 ,options</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#39;check-ssl ca-file /etc/pki/ca.crt check port 9000&#39;</span><span style="color:#f8f8f8;text-decoration:underline"> </span>}<span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">          </span>- {<span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">name: minio-2 ,ip: 10.10.10.11 ,port: 9000 ,options</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#39;check-ssl ca-file /etc/pki/ca.crt check port 9000&#39;</span><span style="color:#f8f8f8;text-decoration:underline"> </span>}<span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">          </span>- {<span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">name: minio-3 ,ip: 10.10.10.12 ,port: 9000 ,options</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#39;check-ssl ca-file /etc/pki/ca.crt check port 9000&#39;</span><span style="color:#f8f8f8;text-decoration:underline"> </span>}<span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">          </span>- {<span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">name: minio-4 ,ip: 10.10.10.13 ,port: 9000 ,options</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#39;check-ssl ca-file /etc/pki/ca.crt check port 9000&#39;</span><span style="color:#f8f8f8;text-decoration:underline"> </span>}<span style="color:#f8f8f8;text-decoration:underline">
</span></span></span></code></pre></div><p>首先，修改 MinIO 集群定义，新增四台节点，按顺序分配序列号 5 到 8。
这里的关键一步是修改 <a href="/zh/docs/minio/param/#minio_volumes"><code>minio_volumes</code></a> 参数，将新的四个节点指定为一个新的 <strong>存储池</strong>。</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">minio</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">hosts</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">10.10.10.10</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span>{<span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">minio_seq: 1 , nodename</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">minio-1 }</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">10.10.10.11</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span>{<span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">minio_seq: 2 , nodename</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">minio-2 }</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">10.10.10.12</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span>{<span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">minio_seq: 3 , nodename</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">minio-3 }</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">10.10.10.13</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span>{<span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">minio_seq: 4 , nodename</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">minio-4 }</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#8f5902;font-style:italic"># 新增的四个节点</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">10.10.10.14</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span>{<span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">minio_seq: 5 , nodename</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">minio-5 }</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">10.10.10.15</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span>{<span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">minio_seq: 6 , nodename</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">minio-6 }</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">10.10.10.16</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span>{<span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">minio_seq: 7 , nodename</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">minio-7 }</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">10.10.10.17</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span>{<span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">minio_seq: 8 , nodename</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">minio-8 }</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">vars</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">minio_cluster</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">minio</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">minio_data</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#39;/data{1...4}&#39;</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">minio_volumes</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#39;https://minio-{1...4}.pigsty:9000/data{1...4} https://minio-{5...8}.pigsty:9000/data{1...4}&#39;</span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#8f5902;font-style:italic"># 新增的集群配置</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#8f5902;font-style:italic"># …… 省略其他配置</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span></code></pre></div><p>第二步，将这些节点交由 Pigsty 纳管：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>./node.yml -l 10.10.10.14,10.10.10.15,10.10.10.16,10.10.10.17
</span></span></code></pre></div><p>第三步，在新节点上，使用 Ansible <a href="/zh/docs/minio/playbook/">剧本</a> 安装并准备 MinIO 软件：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>./minio.yml -l 10.10.10.14,10.10.10.15,10.10.10.16,10.10.10.17 -t minio_install
</span></span></code></pre></div><p>第四步，在 <strong>整个集群</strong> 上，使用 Ansible <a href="/zh/docs/minio/playbook/">剧本</a> 重新配置 MinIO 集群：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>./minio.yml -l minio -t minio_config
</span></span></code></pre></div><blockquote>
<p>这一步会更新现有四个节点的 <code>MINIO_VOLUMES</code> 配置</p>
</blockquote>
<p>第五步，一次性重启整个 MinIO 集群（请注意，不要滚动重启！）：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>./minio.yml -l minio -t minio_launch -f <span style="color:#0000cf;font-weight:bold">10</span>   <span style="color:#8f5902;font-style:italic"># 8并发数，确保同时重启</span>
</span></span></code></pre></div><p>第六步（可选）：如果您使用了负载均衡，那么请确保负载均衡器的配置也已经更新。例如，将新的四个节点加入到负载均衡器的配置中：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># expose minio service with haproxy on all nodes</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:bold">haproxy_services</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span>- <span style="color:#204a87;font-weight:bold">name</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">minio                   </span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#8f5902;font-style:italic"># [REQUIRED] service name, unique</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">port</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#0000cf;font-weight:bold">9002</span><span style="color:#f8f8f8;text-decoration:underline">                     </span><span style="color:#8f5902;font-style:italic"># [REQUIRED] service port, unique</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">balance</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">leastconn            </span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#8f5902;font-style:italic"># [OPTIONAL] load balancer algorithm</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">options</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">                       </span><span style="color:#8f5902;font-style:italic"># [OPTIONAL] minio health check</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span>- <span style="color:#000">option httpchk</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span>- <span style="color:#000">option http-keep-alive</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span>- <span style="color:#000">http-check send meth OPTIONS uri /minio/health/live</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span>- <span style="color:#000">http-check expect status 200</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">servers</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span>- {<span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">name: minio-1 ,ip: 10.10.10.10 ,port: 9000 ,options</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#39;check-ssl ca-file /etc/pki/ca.crt check port 9000&#39;</span><span style="color:#f8f8f8;text-decoration:underline"> </span>}<span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span>- {<span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">name: minio-2 ,ip: 10.10.10.11 ,port: 9000 ,options</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#39;check-ssl ca-file /etc/pki/ca.crt check port 9000&#39;</span><span style="color:#f8f8f8;text-decoration:underline"> </span>}<span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span>- {<span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">name: minio-3 ,ip: 10.10.10.12 ,port: 9000 ,options</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#39;check-ssl ca-file /etc/pki/ca.crt check port 9000&#39;</span><span style="color:#f8f8f8;text-decoration:underline"> </span>}<span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span>- {<span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">name: minio-4 ,ip: 10.10.10.13 ,port: 9000 ,options</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#39;check-ssl ca-file /etc/pki/ca.crt check port 9000&#39;</span><span style="color:#f8f8f8;text-decoration:underline"> </span>}<span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span>- {<span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">name: minio-5 ,ip: 10.10.10.14 ,port: 9000 ,options</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#39;check-ssl ca-file /etc/pki/ca.crt check port 9000&#39;</span><span style="color:#f8f8f8;text-decoration:underline"> </span>}<span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span>- {<span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">name: minio-6 ,ip: 10.10.10.15 ,port: 9000 ,options</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#39;check-ssl ca-file /etc/pki/ca.crt check port 9000&#39;</span><span style="color:#f8f8f8;text-decoration:underline"> </span>}<span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span>- {<span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">name: minio-7 ,ip: 10.10.10.16 ,port: 9000 ,options</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#39;check-ssl ca-file /etc/pki/ca.crt check port 9000&#39;</span><span style="color:#f8f8f8;text-decoration:underline"> </span>}<span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span>- {<span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">name: minio-8 ,ip: 10.10.10.17 ,port: 9000 ,options</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#39;check-ssl ca-file /etc/pki/ca.crt check port 9000&#39;</span><span style="color:#f8f8f8;text-decoration:underline"> </span>}<span style="color:#f8f8f8;text-decoration:underline">
</span></span></span></code></pre></div><p>然后，执行 <code>node.yml</code> 剧本的 <code>haproxy</code> 子任务，更新负载均衡器配置：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>./node.yml -l minio -t haproxy_config,haproxy_reload   <span style="color:#8f5902;font-style:italic"># 更新负载均衡器配置并在线加载</span>
</span></span></code></pre></div><p>如果您使用 L2 VIP 来确保可靠的负载均衡器接入，那么还需要将新的节点（如果有）加入到现有 NODE VIP 分组中：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>./node.yml -l minio -t node_vip  <span style="color:#8f5902;font-style:italic"># 刷新集群 L2 VIP 配置 </span>
</span></span></code></pre></div><hr>
<h2 id="集群缩容">集群缩容</h2>
<p>MinIO 无法在节点/磁盘级别上缩容，但可以在存储池（多个节点）层次上进行退役 —— 新增一个新存储池，将旧存储池排干迁移到新存储池，然后将旧存储池退役。</p>
<ul>
<li><a href="https://min.io/docs/minio/linux/operations/install-deploy-manage/decommission-server-pool.html">集群缩容教程</a></li>
</ul>
<hr>
<h2 id="集群升级">集群升级</h2>
<ul>
<li><a href="https://min.io/docs/minio/linux/operations/install-deploy-manage/upgrade-minio-deployment.html">集群升级教程</a></li>
</ul>
<p>首先，将新版本的 MinIO 软件包下载至 INFRA 节点的本地软件仓库，然后重建软件仓库索引：</p>
<ul>
<li><a href="https://github.com/minio/minio">minio</a>:
<ul>
<li>amd64: <a href="https://dl.min.io/server/minio/release/linux-amd64/">https://dl.min.io/server/minio/release/linux-amd64/</a></li>
<li>arm64: <a href="https://dl.min.io/server/minio/release/linux-arm64/">https://dl.min.io/server/minio/release/linux-arm64/</a></li>
</ul>
</li>
<li><a href="https://github.com/minio/mc">mcli</a>:
<ul>
<li>amd64: <a href="https://dl.min.io/client/mc/release/linux-amd64/">https://dl.min.io/client/mc/release/linux-amd64/</a></li>
<li>arm64: <a href="https://dl.min.io/client/mc/release/linux-arm64/">https://dl.min.io/client/mc/release/linux-arm64/</a></li>
</ul>
</li>
</ul>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>./infra.yml -t repo_create
</span></span></code></pre></div><p>其次，使用 Ansible 批量升级 MinIO 软件包版本：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>ansible minio -m package -b -a <span style="color:#4e9a06">&#39;name=minio state=latest&#39;</span>  <span style="color:#8f5902;font-style:italic"># 升级 MinIO 服务器软件版本</span>
</span></span><span style="display:flex;"><span>ansible minio -m package -b -a <span style="color:#4e9a06">&#39;name=mcli state=latest&#39;</span>   <span style="color:#8f5902;font-style:italic"># 升级 MinIO 客户端软件版本</span>
</span></span></code></pre></div><p>最后，使用 mc 命令行工具通知 MinIO 集群重启：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>mc admin service restart sss
</span></span></code></pre></div><hr>
<h2 id="替换故障节点">替换故障节点</h2>
<ul>
<li><a href="https://min.io/docs/minio/linux/operations/data-recovery/recover-after-node-failure.html#minio-restore-hardware-failure-node">节点故障教程</a></li>
</ul>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># 1. 从集群中下线故障节点</span>
</span></span><span style="display:flex;"><span>bin/node-rm &lt;your_old_node_ip&gt;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># 2. 替换故障节点，使用原来的节点名称（如果IP变化，您需要修改 MinIO 集群定义）</span>
</span></span><span style="display:flex;"><span>bin/node-add &lt;your_new_node_ip&gt;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># 3. 在新节点上安装配置 MinIO</span>
</span></span><span style="display:flex;"><span>./minio.yml -l &lt;your_new_node_ip&gt;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># 4. 指示 MinIO 执行恢复动作</span>
</span></span><span style="display:flex;"><span>mc admin heal
</span></span></code></pre></div><hr>
<h2 id="替换故障磁盘">替换故障磁盘</h2>
<ul>
<li><a href="https://min.io/docs/minio/linux/operations/data-recovery/recover-after-drive-failure.html#minio-restore-hardware-failure-drive">磁盘故障教程</a></li>
</ul>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># 1. 从集群中删除故障磁盘</span>
</span></span><span style="display:flex;"><span>umount /dev/&lt;your_disk_device&gt;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># 2. 替换故障磁盘，使用xfs格盘</span>
</span></span><span style="display:flex;"><span>mkfs.xfs /dev/sdb -L DRIVE1
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># 3. 不要忘记设置开机自动挂载</span>
</span></span><span style="display:flex;"><span>vi /etc/fstab
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># LABEL=DRIVE1     /mnt/drive1    xfs     defaults,noatime  0       2</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># 4. 重新挂载</span>
</span></span><span style="display:flex;"><span>mount -a
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># 5. 指示 MinIO 执行恢复动作</span>
</span></span><span style="display:flex;"><span>mc admin heal
</span></span></code></pre></div>
</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-81383092950ff4115e1c3850be65d36f">6 - 监控告警</h1>
    <div class="lead">如何在 Pigsty 中监控 MinIO？如何使用 MinIO 本身的管控面板？有哪些告警规则值得关注？</div>
	<hr>
<h2 id="内置控制台">内置控制台</h2>
<p>MinIO 内置了一个相当不错的管控界面，默认您可以通过任意 MinIO 实例的管控端口 （<a href="/zh/docs/minio/param#minio_admin_port"><code>minio_admin_port</code></a> ，默认为 <code>9001</code>），使用 HTTPS 访问此界面。</p>
<p>在大多数提供 MinIO 服务的配置模板中，MinIO 都会以 <code>m.pigsty</code> 的自定义服务对外暴露。在配置域名解析后，您可以通过 <code>https://m.pigsty</code> 访问 MinIO 管控界面。</p>
<hr>
<h2 id="pigsty监控">Pigsty监控</h2>
<p>Pigsty 提供了两个与 <a href="/zh/docs/minio"><code>MINIO</code></a> 模块有关的监控面板：</p>
<p><a href="https://demo.pigsty.cc/d/minio-overview">MinIO Overview</a> 展示了 MinIO 集群的整体监控指标。</p>
<p><a href="https://demo.pigsty.cc/d/minio-instance">MinIO Instance</a> 展示了单个 MinIO 实例的监控指标详情</p>
<p><a href="https://demo.pigsty.cc/d/minio-overview"><img alt="minio-overview.jpg" src="/img/dashboard/minio-overview.jpg"></a></p>
<hr>
<h2 id="pigsty告警">Pigsty告警</h2>
<p>Pigsty 针对 MinIO 提供了以下三条告警规则，分别是：</p>
<ul>
<li>MinIO 宕机</li>
<li>MinIO 节点离线</li>
<li>MinIO 磁盘离线</li>
</ul>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic">#==============================================================#</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#8f5902;font-style:italic">#                         Aliveness                            #</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#8f5902;font-style:italic">#==============================================================#</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#8f5902;font-style:italic"># MinIO server instance down</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span>- <span style="color:#204a87;font-weight:bold">alert</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">MinioServerDown</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">expr</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">minio_up &lt; 1</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">for</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">1m</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">labels</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span>{<span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">level: 0, severity: CRIT, category</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">minio }</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">annotations</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">summary</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;CRIT MinioServerDown {{ $labels.ins }}@{{ $labels.instance }}&#34;</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">description</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000;font-weight:bold">|</span><span style="color:#8f5902;font-style:italic">
</span></span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic">      minio_up[ins={{ $labels.ins }}, instance={{ $labels.instance }}] = {{ $value }} &lt; 1
</span></span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic">      http://g.pigsty/d/minio-overview</span><span style="color:#f8f8f8;text-decoration:underline">      
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#8f5902;font-style:italic">#==============================================================#</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#8f5902;font-style:italic">#                         Error                                #</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#8f5902;font-style:italic">#==============================================================#</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#8f5902;font-style:italic"># MinIO node offline triggers a p1 alert</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span>- <span style="color:#204a87;font-weight:bold">alert</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">MinioNodeOffline</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">expr</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">avg_over_time(minio_cluster_nodes_offline_total{job=&#34;minio&#34;}[5m]) &gt; 0</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">for</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">3m</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">labels</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span>{<span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">level: 1, severity: WARN, category</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">minio }</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">annotations</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">summary</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;WARN MinioNodeOffline: {{ $labels.cls }} {{ $value }}&#34;</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">description</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000;font-weight:bold">|</span><span style="color:#8f5902;font-style:italic">
</span></span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic">      minio_cluster_nodes_offline_total[cls={{ $labels.cls }}] = {{ $value }} &gt; 0
</span></span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic">      http://g.pigsty/d/minio-overview?from=now-5m&amp;to=now&amp;var-cls={{$labels.cls}}</span><span style="color:#f8f8f8;text-decoration:underline">      
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#8f5902;font-style:italic"># MinIO disk offline triggers a p1 alert</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span>- <span style="color:#204a87;font-weight:bold">alert</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">MinioDiskOffline</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">expr</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">avg_over_time(minio_cluster_disk_offline_total{job=&#34;minio&#34;}[5m]) &gt; 0</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">for</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">3m</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">labels</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span>{<span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">level: 1, severity: WARN, category</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">minio }</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">annotations</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">summary</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;WARN MinioDiskOffline: {{ $labels.cls }} {{ $value }}&#34;</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">description</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000;font-weight:bold">|</span><span style="color:#8f5902;font-style:italic">
</span></span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic">      minio_cluster_disk_offline_total[cls={{ $labels.cls }}] = {{ $value }} &gt; 0
</span></span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic">      http://g.pigsty/d/minio-overview?from=now-5m&amp;to=now&amp;var-cls={{$labels.cls}}</span><span style="color:#f8f8f8;text-decoration:underline">      
</span></span></span></code></pre></div>
</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-61857417600e2adc512dcba599edd776">7 - 指标列表</h1>
    <div class="lead">Pigsty MINIO 模块提供的完整监控指标列表与释义</div>
	<p><a href="/zh/docs/minio"><strong><code>MINIO</code></strong></a> 模块包含有 79 类可用监控指标。</p>
<table>
<thead>
<tr>
<th>Metric Name</th>
<th>Type</th>
<th>Labels</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>minio_audit_failed_messages</td>
<td>counter</td>
<td><code>ip</code>, <code>job</code>, <code>target_id</code>, <code>cls</code>, <code>instance</code>, <code>server</code>, <code>ins</code></td>
<td>Total number of messages that failed to send since start</td>
</tr>
<tr>
<td>minio_audit_target_queue_length</td>
<td>gauge</td>
<td><code>ip</code>, <code>job</code>, <code>target_id</code>, <code>cls</code>, <code>instance</code>, <code>server</code>, <code>ins</code></td>
<td>Number of unsent messages in queue for target</td>
</tr>
<tr>
<td>minio_audit_total_messages</td>
<td>counter</td>
<td><code>ip</code>, <code>job</code>, <code>target_id</code>, <code>cls</code>, <code>instance</code>, <code>server</code>, <code>ins</code></td>
<td>Total number of messages sent since start</td>
</tr>
<tr>
<td>minio_cluster_bucket_total</td>
<td>gauge</td>
<td><code>ip</code>, <code>job</code>, <code>cls</code>, <code>instance</code>, <code>server</code>, <code>ins</code></td>
<td>Total number of buckets in the cluster</td>
</tr>
<tr>
<td>minio_cluster_capacity_raw_free_bytes</td>
<td>gauge</td>
<td><code>ip</code>, <code>job</code>, <code>cls</code>, <code>instance</code>, <code>server</code>, <code>ins</code></td>
<td>Total free capacity online in the cluster</td>
</tr>
<tr>
<td>minio_cluster_capacity_raw_total_bytes</td>
<td>gauge</td>
<td><code>ip</code>, <code>job</code>, <code>cls</code>, <code>instance</code>, <code>server</code>, <code>ins</code></td>
<td>Total capacity online in the cluster</td>
</tr>
<tr>
<td>minio_cluster_capacity_usable_free_bytes</td>
<td>gauge</td>
<td><code>ip</code>, <code>job</code>, <code>cls</code>, <code>instance</code>, <code>server</code>, <code>ins</code></td>
<td>Total free usable capacity online in the cluster</td>
</tr>
<tr>
<td>minio_cluster_capacity_usable_total_bytes</td>
<td>gauge</td>
<td><code>ip</code>, <code>job</code>, <code>cls</code>, <code>instance</code>, <code>server</code>, <code>ins</code></td>
<td>Total usable capacity online in the cluster</td>
</tr>
<tr>
<td>minio_cluster_drive_offline_total</td>
<td>gauge</td>
<td><code>ip</code>, <code>job</code>, <code>cls</code>, <code>instance</code>, <code>server</code>, <code>ins</code></td>
<td>Total drives offline in this cluster</td>
</tr>
<tr>
<td>minio_cluster_drive_online_total</td>
<td>gauge</td>
<td><code>ip</code>, <code>job</code>, <code>cls</code>, <code>instance</code>, <code>server</code>, <code>ins</code></td>
<td>Total drives online in this cluster</td>
</tr>
<tr>
<td>minio_cluster_drive_total</td>
<td>gauge</td>
<td><code>ip</code>, <code>job</code>, <code>cls</code>, <code>instance</code>, <code>server</code>, <code>ins</code></td>
<td>Total drives in this cluster</td>
</tr>
<tr>
<td>minio_cluster_health_erasure_set_healing_drives</td>
<td>gauge</td>
<td><code>pool</code>, <code>ip</code>, <code>job</code>, <code>cls</code>, <code>set</code>, <code>instance</code>, <code>server</code>, <code>ins</code></td>
<td>Get the count of healing drives of this erasure set</td>
</tr>
<tr>
<td>minio_cluster_health_erasure_set_online_drives</td>
<td>gauge</td>
<td><code>pool</code>, <code>ip</code>, <code>job</code>, <code>cls</code>, <code>set</code>, <code>instance</code>, <code>server</code>, <code>ins</code></td>
<td>Get the count of the online drives in this erasure set</td>
</tr>
<tr>
<td>minio_cluster_health_erasure_set_read_quorum</td>
<td>gauge</td>
<td><code>pool</code>, <code>ip</code>, <code>job</code>, <code>cls</code>, <code>set</code>, <code>instance</code>, <code>server</code>, <code>ins</code></td>
<td>Get the read quorum for this erasure set</td>
</tr>
<tr>
<td>minio_cluster_health_erasure_set_status</td>
<td>gauge</td>
<td><code>pool</code>, <code>ip</code>, <code>job</code>, <code>cls</code>, <code>set</code>, <code>instance</code>, <code>server</code>, <code>ins</code></td>
<td>Get current health status for this erasure set</td>
</tr>
<tr>
<td>minio_cluster_health_erasure_set_write_quorum</td>
<td>gauge</td>
<td><code>pool</code>, <code>ip</code>, <code>job</code>, <code>cls</code>, <code>set</code>, <code>instance</code>, <code>server</code>, <code>ins</code></td>
<td>Get the write quorum for this erasure set</td>
</tr>
<tr>
<td>minio_cluster_health_status</td>
<td>gauge</td>
<td><code>ip</code>, <code>job</code>, <code>cls</code>, <code>instance</code>, <code>server</code>, <code>ins</code></td>
<td>Get current cluster health status</td>
</tr>
<tr>
<td>minio_cluster_nodes_offline_total</td>
<td>gauge</td>
<td><code>ip</code>, <code>job</code>, <code>cls</code>, <code>instance</code>, <code>server</code>, <code>ins</code></td>
<td>Total number of MinIO nodes offline</td>
</tr>
<tr>
<td>minio_cluster_nodes_online_total</td>
<td>gauge</td>
<td><code>ip</code>, <code>job</code>, <code>cls</code>, <code>instance</code>, <code>server</code>, <code>ins</code></td>
<td>Total number of MinIO nodes online</td>
</tr>
<tr>
<td>minio_cluster_objects_size_distribution</td>
<td>gauge</td>
<td><code>ip</code>, <code>range</code>, <code>job</code>, <code>cls</code>, <code>instance</code>, <code>server</code>, <code>ins</code></td>
<td>Distribution of object sizes across a cluster</td>
</tr>
<tr>
<td>minio_cluster_objects_version_distribution</td>
<td>gauge</td>
<td><code>ip</code>, <code>range</code>, <code>job</code>, <code>cls</code>, <code>instance</code>, <code>server</code>, <code>ins</code></td>
<td>Distribution of object versions across a cluster</td>
</tr>
<tr>
<td>minio_cluster_usage_deletemarker_total</td>
<td>gauge</td>
<td><code>ip</code>, <code>job</code>, <code>cls</code>, <code>instance</code>, <code>server</code>, <code>ins</code></td>
<td>Total number of delete markers in a cluster</td>
</tr>
<tr>
<td>minio_cluster_usage_object_total</td>
<td>gauge</td>
<td><code>ip</code>, <code>job</code>, <code>cls</code>, <code>instance</code>, <code>server</code>, <code>ins</code></td>
<td>Total number of objects in a cluster</td>
</tr>
<tr>
<td>minio_cluster_usage_total_bytes</td>
<td>gauge</td>
<td><code>ip</code>, <code>job</code>, <code>cls</code>, <code>instance</code>, <code>server</code>, <code>ins</code></td>
<td>Total cluster usage in bytes</td>
</tr>
<tr>
<td>minio_cluster_usage_version_total</td>
<td>gauge</td>
<td><code>ip</code>, <code>job</code>, <code>cls</code>, <code>instance</code>, <code>server</code>, <code>ins</code></td>
<td>Total number of versions (includes delete marker) in a cluster</td>
</tr>
<tr>
<td>minio_cluster_webhook_failed_messages</td>
<td>counter</td>
<td><code>ip</code>, <code>job</code>, <code>cls</code>, <code>instance</code>, <code>server</code>, <code>ins</code></td>
<td>Number of messages that failed to send</td>
</tr>
<tr>
<td>minio_cluster_webhook_online</td>
<td>gauge</td>
<td><code>ip</code>, <code>job</code>, <code>cls</code>, <code>instance</code>, <code>server</code>, <code>ins</code></td>
<td>Is the webhook online?</td>
</tr>
<tr>
<td>minio_cluster_webhook_queue_length</td>
<td>counter</td>
<td><code>ip</code>, <code>job</code>, <code>cls</code>, <code>instance</code>, <code>server</code>, <code>ins</code></td>
<td>Webhook queue length</td>
</tr>
<tr>
<td>minio_cluster_webhook_total_messages</td>
<td>counter</td>
<td><code>ip</code>, <code>job</code>, <code>cls</code>, <code>instance</code>, <code>server</code>, <code>ins</code></td>
<td>Total number of messages sent to this target</td>
</tr>
<tr>
<td>minio_cluster_write_quorum</td>
<td>gauge</td>
<td><code>ip</code>, <code>job</code>, <code>cls</code>, <code>instance</code>, <code>server</code>, <code>ins</code></td>
<td>Maximum write quorum across all pools and sets</td>
</tr>
<tr>
<td>minio_node_file_descriptor_limit_total</td>
<td>gauge</td>
<td><code>ip</code>, <code>job</code>, <code>cls</code>, <code>instance</code>, <code>server</code>, <code>ins</code></td>
<td>Limit on total number of open file descriptors for the MinIO Server process</td>
</tr>
<tr>
<td>minio_node_file_descriptor_open_total</td>
<td>gauge</td>
<td><code>ip</code>, <code>job</code>, <code>cls</code>, <code>instance</code>, <code>server</code>, <code>ins</code></td>
<td>Total number of open file descriptors by the MinIO Server process</td>
</tr>
<tr>
<td>minio_node_go_routine_total</td>
<td>gauge</td>
<td><code>ip</code>, <code>job</code>, <code>cls</code>, <code>instance</code>, <code>server</code>, <code>ins</code></td>
<td>Total number of go routines running</td>
</tr>
<tr>
<td>minio_node_ilm_expiry_pending_tasks</td>
<td>gauge</td>
<td><code>ip</code>, <code>job</code>, <code>cls</code>, <code>instance</code>, <code>server</code>, <code>ins</code></td>
<td>Number of pending ILM expiry tasks in the queue</td>
</tr>
<tr>
<td>minio_node_ilm_transition_active_tasks</td>
<td>gauge</td>
<td><code>ip</code>, <code>job</code>, <code>cls</code>, <code>instance</code>, <code>server</code>, <code>ins</code></td>
<td>Number of active ILM transition tasks</td>
</tr>
<tr>
<td>minio_node_ilm_transition_missed_immediate_tasks</td>
<td>gauge</td>
<td><code>ip</code>, <code>job</code>, <code>cls</code>, <code>instance</code>, <code>server</code>, <code>ins</code></td>
<td>Number of missed immediate ILM transition tasks</td>
</tr>
<tr>
<td>minio_node_ilm_transition_pending_tasks</td>
<td>gauge</td>
<td><code>ip</code>, <code>job</code>, <code>cls</code>, <code>instance</code>, <code>server</code>, <code>ins</code></td>
<td>Number of pending ILM transition tasks in the queue</td>
</tr>
<tr>
<td>minio_node_ilm_versions_scanned</td>
<td>counter</td>
<td><code>ip</code>, <code>job</code>, <code>cls</code>, <code>instance</code>, <code>server</code>, <code>ins</code></td>
<td>Total number of object versions checked for ilm actions since server start</td>
</tr>
<tr>
<td>minio_node_io_rchar_bytes</td>
<td>counter</td>
<td><code>ip</code>, <code>job</code>, <code>cls</code>, <code>instance</code>, <code>server</code>, <code>ins</code></td>
<td>Total bytes read by the process from the underlying storage system including cache, /proc/[pid]/io rchar</td>
</tr>
<tr>
<td>minio_node_io_read_bytes</td>
<td>counter</td>
<td><code>ip</code>, <code>job</code>, <code>cls</code>, <code>instance</code>, <code>server</code>, <code>ins</code></td>
<td>Total bytes read by the process from the underlying storage system, /proc/[pid]/io read_bytes</td>
</tr>
<tr>
<td>minio_node_io_wchar_bytes</td>
<td>counter</td>
<td><code>ip</code>, <code>job</code>, <code>cls</code>, <code>instance</code>, <code>server</code>, <code>ins</code></td>
<td>Total bytes written by the process to the underlying storage system including page cache, /proc/[pid]/io wchar</td>
</tr>
<tr>
<td>minio_node_io_write_bytes</td>
<td>counter</td>
<td><code>ip</code>, <code>job</code>, <code>cls</code>, <code>instance</code>, <code>server</code>, <code>ins</code></td>
<td>Total bytes written by the process to the underlying storage system, /proc/[pid]/io write_bytes</td>
</tr>
<tr>
<td>minio_node_process_cpu_total_seconds</td>
<td>counter</td>
<td><code>ip</code>, <code>job</code>, <code>cls</code>, <code>instance</code>, <code>server</code>, <code>ins</code></td>
<td>Total user and system CPU time spent in seconds</td>
</tr>
<tr>
<td>minio_node_process_resident_memory_bytes</td>
<td>gauge</td>
<td><code>ip</code>, <code>job</code>, <code>cls</code>, <code>instance</code>, <code>server</code>, <code>ins</code></td>
<td>Resident memory size in bytes</td>
</tr>
<tr>
<td>minio_node_process_starttime_seconds</td>
<td>gauge</td>
<td><code>ip</code>, <code>job</code>, <code>cls</code>, <code>instance</code>, <code>server</code>, <code>ins</code></td>
<td>Start time for MinIO process per node, time in seconds since Unix epoc</td>
</tr>
<tr>
<td>minio_node_process_uptime_seconds</td>
<td>gauge</td>
<td><code>ip</code>, <code>job</code>, <code>cls</code>, <code>instance</code>, <code>server</code>, <code>ins</code></td>
<td>Uptime for MinIO process per node in seconds</td>
</tr>
<tr>
<td>minio_node_scanner_bucket_scans_finished</td>
<td>counter</td>
<td><code>ip</code>, <code>job</code>, <code>cls</code>, <code>instance</code>, <code>server</code>, <code>ins</code></td>
<td>Total number of bucket scans finished since server start</td>
</tr>
<tr>
<td>minio_node_scanner_bucket_scans_started</td>
<td>counter</td>
<td><code>ip</code>, <code>job</code>, <code>cls</code>, <code>instance</code>, <code>server</code>, <code>ins</code></td>
<td>Total number of bucket scans started since server start</td>
</tr>
<tr>
<td>minio_node_scanner_directories_scanned</td>
<td>counter</td>
<td><code>ip</code>, <code>job</code>, <code>cls</code>, <code>instance</code>, <code>server</code>, <code>ins</code></td>
<td>Total number of directories scanned since server start</td>
</tr>
<tr>
<td>minio_node_scanner_objects_scanned</td>
<td>counter</td>
<td><code>ip</code>, <code>job</code>, <code>cls</code>, <code>instance</code>, <code>server</code>, <code>ins</code></td>
<td>Total number of unique objects scanned since server start</td>
</tr>
<tr>
<td>minio_node_scanner_versions_scanned</td>
<td>counter</td>
<td><code>ip</code>, <code>job</code>, <code>cls</code>, <code>instance</code>, <code>server</code>, <code>ins</code></td>
<td>Total number of object versions scanned since server start</td>
</tr>
<tr>
<td>minio_node_syscall_read_total</td>
<td>counter</td>
<td><code>ip</code>, <code>job</code>, <code>cls</code>, <code>instance</code>, <code>server</code>, <code>ins</code></td>
<td>Total read SysCalls to the kernel. /proc/[pid]/io syscr</td>
</tr>
<tr>
<td>minio_node_syscall_write_total</td>
<td>counter</td>
<td><code>ip</code>, <code>job</code>, <code>cls</code>, <code>instance</code>, <code>server</code>, <code>ins</code></td>
<td>Total write SysCalls to the kernel. /proc/[pid]/io syscw</td>
</tr>
<tr>
<td>minio_notify_current_send_in_progress</td>
<td>gauge</td>
<td><code>ip</code>, <code>job</code>, <code>cls</code>, <code>instance</code>, <code>server</code>, <code>ins</code></td>
<td>Number of concurrent async Send calls active to all targets (deprecated, please use &lsquo;minio_notify_target_current_send_in_progress&rsquo; instead)</td>
</tr>
<tr>
<td>minio_notify_events_errors_total</td>
<td>counter</td>
<td><code>ip</code>, <code>job</code>, <code>cls</code>, <code>instance</code>, <code>server</code>, <code>ins</code></td>
<td>Events that were failed to be sent to the targets (deprecated, please use &lsquo;minio_notify_target_failed_events&rsquo; instead)</td>
</tr>
<tr>
<td>minio_notify_events_sent_total</td>
<td>counter</td>
<td><code>ip</code>, <code>job</code>, <code>cls</code>, <code>instance</code>, <code>server</code>, <code>ins</code></td>
<td>Total number of events sent to the targets (deprecated, please use &lsquo;minio_notify_target_total_events&rsquo; instead)</td>
</tr>
<tr>
<td>minio_notify_events_skipped_total</td>
<td>counter</td>
<td><code>ip</code>, <code>job</code>, <code>cls</code>, <code>instance</code>, <code>server</code>, <code>ins</code></td>
<td>Events that were skipped to be sent to the targets due to the in-memory queue being full</td>
</tr>
<tr>
<td>minio_s3_requests_4xx_errors_total</td>
<td>counter</td>
<td><code>ip</code>, <code>job</code>, <code>cls</code>, <code>instance</code>, <code>server</code>, <code>ins</code>, <code>api</code></td>
<td>Total number of S3 requests with (4xx) errors</td>
</tr>
<tr>
<td>minio_s3_requests_errors_total</td>
<td>counter</td>
<td><code>ip</code>, <code>job</code>, <code>cls</code>, <code>instance</code>, <code>server</code>, <code>ins</code>, <code>api</code></td>
<td>Total number of S3 requests with (4xx and 5xx) errors</td>
</tr>
<tr>
<td>minio_s3_requests_incoming_total</td>
<td>gauge</td>
<td><code>ip</code>, <code>job</code>, <code>cls</code>, <code>instance</code>, <code>server</code>, <code>ins</code></td>
<td>Total number of incoming S3 requests</td>
</tr>
<tr>
<td>minio_s3_requests_inflight_total</td>
<td>gauge</td>
<td><code>ip</code>, <code>job</code>, <code>cls</code>, <code>instance</code>, <code>server</code>, <code>ins</code>, <code>api</code></td>
<td>Total number of S3 requests currently in flight</td>
</tr>
<tr>
<td>minio_s3_requests_rejected_auth_total</td>
<td>counter</td>
<td><code>ip</code>, <code>job</code>, <code>cls</code>, <code>instance</code>, <code>server</code>, <code>ins</code></td>
<td>Total number of S3 requests rejected for auth failure</td>
</tr>
<tr>
<td>minio_s3_requests_rejected_header_total</td>
<td>counter</td>
<td><code>ip</code>, <code>job</code>, <code>cls</code>, <code>instance</code>, <code>server</code>, <code>ins</code></td>
<td>Total number of S3 requests rejected for invalid header</td>
</tr>
<tr>
<td>minio_s3_requests_rejected_invalid_total</td>
<td>counter</td>
<td><code>ip</code>, <code>job</code>, <code>cls</code>, <code>instance</code>, <code>server</code>, <code>ins</code></td>
<td>Total number of invalid S3 requests</td>
</tr>
<tr>
<td>minio_s3_requests_rejected_timestamp_total</td>
<td>counter</td>
<td><code>ip</code>, <code>job</code>, <code>cls</code>, <code>instance</code>, <code>server</code>, <code>ins</code></td>
<td>Total number of S3 requests rejected for invalid timestamp</td>
</tr>
<tr>
<td>minio_s3_requests_total</td>
<td>counter</td>
<td><code>ip</code>, <code>job</code>, <code>cls</code>, <code>instance</code>, <code>server</code>, <code>ins</code>, <code>api</code></td>
<td>Total number of S3 requests</td>
</tr>
<tr>
<td>minio_s3_requests_ttfb_seconds_distribution</td>
<td>gauge</td>
<td><code>ip</code>, <code>job</code>, <code>cls</code>, <code>le</code>, <code>instance</code>, <code>server</code>, <code>ins</code>, <code>api</code></td>
<td>Distribution of time to first byte across API calls</td>
</tr>
<tr>
<td>minio_s3_requests_waiting_total</td>
<td>gauge</td>
<td><code>ip</code>, <code>job</code>, <code>cls</code>, <code>instance</code>, <code>server</code>, <code>ins</code></td>
<td>Total number of S3 requests in the waiting queue</td>
</tr>
<tr>
<td>minio_s3_traffic_received_bytes</td>
<td>counter</td>
<td><code>ip</code>, <code>job</code>, <code>cls</code>, <code>instance</code>, <code>server</code>, <code>ins</code></td>
<td>Total number of s3 bytes received</td>
</tr>
<tr>
<td>minio_s3_traffic_sent_bytes</td>
<td>counter</td>
<td><code>ip</code>, <code>job</code>, <code>cls</code>, <code>instance</code>, <code>server</code>, <code>ins</code></td>
<td>Total number of s3 bytes sent</td>
</tr>
<tr>
<td>minio_software_commit_info</td>
<td>gauge</td>
<td><code>ip</code>, <code>job</code>, <code>cls</code>, <code>instance</code>, <code>commit</code>, <code>server</code>, <code>ins</code></td>
<td>Git commit hash for the MinIO release</td>
</tr>
<tr>
<td>minio_software_version_info</td>
<td>gauge</td>
<td><code>ip</code>, <code>job</code>, <code>cls</code>, <code>instance</code>, <code>version</code>, <code>server</code>, <code>ins</code></td>
<td>MinIO Release tag for the server</td>
</tr>
<tr>
<td>minio_up</td>
<td>Unknown</td>
<td><code>ip</code>, <code>job</code>, <code>cls</code>, <code>instance</code>, <code>ins</code></td>
<td>N/A</td>
</tr>
<tr>
<td>minio_usage_last_activity_nano_seconds</td>
<td>gauge</td>
<td><code>ip</code>, <code>job</code>, <code>cls</code>, <code>instance</code>, <code>server</code>, <code>ins</code></td>
<td>Time elapsed (in nano seconds) since last scan activity.</td>
</tr>
<tr>
<td>scrape_duration_seconds</td>
<td>Unknown</td>
<td><code>ip</code>, <code>job</code>, <code>cls</code>, <code>instance</code>, <code>ins</code></td>
<td>N/A</td>
</tr>
<tr>
<td>scrape_samples_post_metric_relabeling</td>
<td>Unknown</td>
<td><code>ip</code>, <code>job</code>, <code>cls</code>, <code>instance</code>, <code>ins</code></td>
<td>N/A</td>
</tr>
<tr>
<td>scrape_samples_scraped</td>
<td>Unknown</td>
<td><code>ip</code>, <code>job</code>, <code>cls</code>, <code>instance</code>, <code>ins</code></td>
<td>N/A</td>
</tr>
<tr>
<td>scrape_series_added</td>
<td>Unknown</td>
<td><code>ip</code>, <code>job</code>, <code>cls</code>, <code>instance</code>, <code>ins</code></td>
<td>N/A</td>
</tr>
<tr>
<td>up</td>
<td>Unknown</td>
<td><code>ip</code>, <code>job</code>, <code>cls</code>, <code>instance</code>, <code>ins</code></td>
<td>N/A</td>
</tr>
</tbody>
</table>

</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-571982477397f0d78a3a5034a4ef3e1d">8 - 常见问题</h1>
    <div class="lead">Pigsty MINIO 对象存储模块常见问题答疑</div>
	<hr>
<h2 id="启动多节点多盘minio集群失败怎么办">启动多节点/多盘MinIO集群失败怎么办？</h2>
<p>在<a href="/zh/docs/minio/config#%E5%8D%95%E6%9C%BA%E5%A4%9A%E7%9B%98">单机多盘</a>或<a href="/zh/docs/minio/config#%E5%A4%9A%E6%9C%BA%E5%A4%9A%E7%9B%98">多机多盘</a>模式下，如果数据目录不是有效的磁盘挂载点，MinIO会拒绝启动。</p>
<p>请使用已挂载的磁盘作为MinIO的数据目录，而不是普通目录。您只能在<a href="/zh/docs/minio/config#%E5%8D%95%E6%9C%BA%E5%8D%95%E7%9B%98">单机单盘</a>模式下使用普通目录作为 MinIO 的数据目录，作为开发测试之用。</p>
<hr>
<h2 id="如何向已有的minio集群中添加新的成员">如何向已有的MinIO集群中添加新的成员？</h2>
<blockquote>
<p>在部署之前，您最好规划MinIO集群容量，因为新增成员需要全局重启。</p>
</blockquote>
<p>您可以通过向现有集群中添加新的服务器节点，打造一个新的存储池的方式，实现 MinIO 扩容。</p>
<p>请注意，MinIO 一旦部署，你无法修改现有集群的节点数量与磁盘数量！</p>
<p>请参考这里：<a href="https://min.io/docs/minio/linux/operations/install-deploy-manage/expand-minio-deployment.html">扩展MinIO部署</a></p>

</div>



    
	
  



          </main>
        </div>
      </div>
      <footer class="td-footer row d-print-none">
  <div class="container-fluid">
    <div class="row mx-md-2">
      <div class="td-footer__left col-6 col-sm-4 order-sm-1">
        <ul class="td-footer__links-list">
  
  <li class="td-footer__links-item" data-bs-toggle="tooltip" title="Mail" aria-label="Mail">
    <a target="_blank" rel="noopener" href="mailto:rh@vonng.com" aria-label="Mail">
      <i class="fa fa-envelope"></i>
    </a>
  </li>
  
  <li class="td-footer__links-item" data-bs-toggle="tooltip" title="GitHub" aria-label="GitHub">
    <a target="_blank" rel="noopener" href="https://github.com/Vonng/pigsty" aria-label="GitHub">
      <i class="fab fa-github"></i>
    </a>
  </li>
  
  <li class="td-footer__links-item" data-bs-toggle="tooltip" title="Twitter" aria-label="Twitter">
    <a target="_blank" rel="noopener" href="https://twitter.com/GobeUncleWang" aria-label="Twitter">
      <i class="fab fa-twitter"></i>
    </a>
  </li>
  
</ul>

      </div><div class="td-footer__right col-6 col-sm-4 order-sm-3">
        <ul class="td-footer__links-list">
  
  <li class="td-footer__links-item" data-bs-toggle="tooltip" title="WeChat" aria-label="WeChat">
    <a target="_blank" rel="noopener" href="/img/pigsty/pigsty-cc.jpg" aria-label="WeChat">
      <i class="fa fa-comment"></i>
    </a>
  </li>
  
  <li class="td-footer__links-item" data-bs-toggle="tooltip" title="Discord" aria-label="Discord">
    <a target="_blank" rel="noopener" href="https://discord.gg/wDzt5VyWEz" aria-label="Discord">
      <i class="fab fa-discord"></i>
    </a>
  </li>
  
  <li class="td-footer__links-item" data-bs-toggle="tooltip" title="Telegram" aria-label="Telegram">
    <a target="_blank" rel="noopener" href="https://t.me/joinchat/gV9zfZraNPM3YjFh" aria-label="Telegram">
      <i class="fab fa-telegram"></i>
    </a>
  </li>
  
</ul>

      </div><div class="td-footer__center col-12 col-sm-4 py-2 order-sm-2">
        <span class="td-footer__copyright">&copy;
    2018&ndash;2024
    <span class="td-footer__authors">Ruohang Feng</span></span><span class="td-footer__all_rights_reserved">All Rights Reserved</span></span><span class="ms-2"><a href="https://vonng.com/en/" target="_blank" rel="noopener">@Vonng</a></span>
<br><span>Pigsty® distributed under <a href="/docs/about/license" target="_blank" rel="noopener">AGPLv3</a></span>
<br><span class="ms-2"><a href="/docs/about/privacy" target="_blank" rel="noopener">Privacy Policy</a></span>
<span><a href="http://beian.miit.gov.cn/" target="_blank" rel="noopener">浙ICP备15016890号</a></span>
      </div>
    </div>
  </div>
</footer>

    </div>
    <script src="/js/main.min.248655eb216150e39da254c2f7aa5357805d0ec66bdb741b591cd35fb5f629ab.js" integrity="sha256-JIZV6yFhUOOdolTC96pTV4BdDsZr23QbWRzTX7X2Kas=" crossorigin="anonymous"></script>
<script defer src="/js/click-to-copy.min.f724d3de49218995223b7316aa2e53e2b34bf42026bf399ebb21bb02212402d1.js" integrity="sha256-9yTT3kkhiZUiO3MWqi5T4rNL9CAmvzmeuyG7AiEkAtE=" crossorigin="anonymous"></script>
<script src='/js/tabpane-persist.js'></script>

  </body>
</html>
