<!doctype html>
<html itemscope itemtype="http://schema.org/WebPage" lang="zh" class="no-js">
  <head>
    <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link rel="canonical" type="text/html" href="/zh/docs/software/">
<link rel="alternate" type="application/rss&#43;xml" href="/zh/docs/software/index.xml">
<meta name="robots" content="noindex, nofollow">


<link rel="shortcut icon" href="/favicons/favicon.ico" >
<link rel="apple-touch-icon" href="/favicons/apple-touch-icon-180x180.png" sizes="180x180">
<link rel="icon" type="image/png" href="/favicons/favicon-16x16.png" sizes="16x16">
<link rel="icon" type="image/png" href="/favicons/favicon-32x32.png" sizes="32x32">
<link rel="icon" type="image/png" href="/favicons/android-36x36.png" sizes="36x36">
<link rel="icon" type="image/png" href="/favicons/android-48x48.png" sizes="48x48">
<link rel="icon" type="image/png" href="/favicons/android-72x72.png" sizes="72x72">
<link rel="icon" type="image/png" href="/favicons/android-96x96.png" sizes="96x96">
<link rel="icon" type="image/png" href="/favicons/android-144x144.png" sizes="144x144">
<link rel="icon" type="image/png" href="/favicons/android-192x192.png" sizes="192x192">

<title>软件镜像模板 | Pigsty</title>
<meta name="description" content="使用 Docker 运行开箱即用的软件与工具">
<meta property="og:title" content="软件镜像模板" />
<meta property="og:description" content="使用 Docker 运行开箱即用的软件与工具" />
<meta property="og:type" content="website" />
<meta property="og:url" content="/zh/docs/software/" />

<meta itemprop="name" content="软件镜像模板">
<meta itemprop="description" content="使用 Docker 运行开箱即用的软件与工具"><meta name="twitter:card" content="summary"/><meta name="twitter:title" content="软件镜像模板"/>
<meta name="twitter:description" content="使用 Docker 运行开箱即用的软件与工具"/>




<link rel="preload" href="/scss/main.min.194607c777ee31a481a26dfc3d1c65134dfc8eb296a0aae9d353b3bd5be6a683.css" as="style">
<link href="/scss/main.min.194607c777ee31a481a26dfc3d1c65134dfc8eb296a0aae9d353b3bd5be6a683.css" rel="stylesheet" integrity="">

<script
  src="/js/jquery-3.6.3.min.js"
  integrity="sha512-STof4xm1wgkfm7heWqFJVn58Hm3EtS31XFaagaa8VMReCXAkQnJZ+jEy8PCC/iT18dFy95WcExNHFTqLyp72eQ=="
  crossorigin="anonymous"></script>
<script defer
  src="/js/lunr.min.js"
  integrity="sha384-203J0SNzyqHby3iU6hzvzltrWi/M41wOP5Gu+BiJMz5nwKykbkUx8Kp7iti0Lpli"
  crossorigin="anonymous"></script>
<script async src="https://www.googletagmanager.com/gtag/js?id=G-LG1V9WTKGE"></script>
<script>
var doNotTrack = false;
if (!doNotTrack) {
	window.dataLayer = window.dataLayer || [];
	function gtag(){dataLayer.push(arguments);}
	gtag('js', new Date());
	gtag('config', 'G-LG1V9WTKGE');
}
</script>
  </head>
  <body class="td-section">
    <header>
      <nav class="td-navbar navbar-dark js-navbar-scroll">
<div class="container-fluid flex-column flex-md-row">
  <a class="navbar-brand" href="/zh/"><span class="navbar-brand__logo navbar-logo"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xl="http://www.w3.org/1999/xlink" xmlns:dc="http://purl.org/dc/elements/1.1/" viewBox="0 0 24 24" width="24" height="24"><defs/><g id="32" fill="none" stroke-dasharray="none" fill-opacity="1" stroke-opacity="1" stroke="none"><title>32</title><g id="32_图层_2"><title>图层 2</title><g id="Group_17"><g id="Graphic_16"/><g id="Graphic_15"><path d="M7.666187 11.971335l2.165064-3.75H14.16138l2.165065 3.75-2.165065 3.75H9.831251z" fill="#bbb" fill-opacity=".9526367"/><path d="M7.666187 11.971335l2.165064-3.75H14.16138l2.165065 3.75-2.165065 3.75H9.831251z" stroke="#fff" stroke-linecap="round" stroke-linejoin="round" stroke-width=".6730434"/></g><g id="Graphic_14"><path d="M7.666187 19.474806l2.165064-3.75H14.16138l2.165065 3.75-2.165065 3.75H9.831251z" fill="#de372c" fill-opacity=".8545852"/><path d="M7.666187 19.474806l2.165064-3.75H14.16138l2.165065 3.75-2.165065 3.75H9.831251z" stroke="#fff" stroke-linecap="round" stroke-linejoin="round" stroke-width=".6730434"/></g><g id="Graphic_13"><path d="M14.161476 15.751202l2.165064-3.75h4.33013l2.165064 3.75-2.165064 3.75H16.32654z" fill="#424242" fill-opacity=".9016462"/><path d="M14.161476 15.751202l2.165064-3.75h4.33013l2.165064 3.75-2.165064 3.75H16.32654z" stroke="#fff" stroke-linecap="round" stroke-linejoin="round" stroke-width=".6730434"/></g><g id="Graphic_12"><path d="M14.161476 8.226008 16.32654 4.4760076h4.33013L22.821734 8.226008l-2.165064 3.75H16.32654z" fill="#ffa269" fill-opacity=".8975772"/><path d="M14.161476 8.226008 16.32654 4.4760076h4.33013L22.821734 8.226008l-2.165064 3.75H16.32654z" stroke="#fff" stroke-linecap="round" stroke-linejoin="round" stroke-width=".6730434"/></g><g id="Graphic_11"><path d="M7.666187 4.5 9.831251.75H14.16138L16.326445 4.5 14.16138 8.25H9.831251z" fill="#419edb" fill-opacity=".8979957"/><path d="M7.666187 4.5 9.831251.75H14.16138L16.326445 4.5 14.16138 8.25H9.831251z" stroke="#fff" stroke-linecap="round" stroke-linejoin="round" stroke-width=".6730434"/></g><g id="Graphic_10"><path d="M1.1491742 8.226008 3.3142388 4.4760076H7.644368L9.809432 8.226008l-2.165064 3.75H3.3142388z" fill="#2f6793" fill-opacity=".9002511"/><path d="M1.1491742 8.226008 3.3142388 4.4760076H7.644368L9.809432 8.226008l-2.165064 3.75H3.3142388z" stroke="#fff" stroke-linecap="round" stroke-linejoin="round" stroke-width=".6730434"/></g><g id="Graphic_9"><path d="M1.182071 15.741036l2.1650645-3.75h4.330129l2.1650645 3.75-2.1650645 3.75H3.3471355z" fill="#53ac79" fill-opacity=".9"/><path d="M1.182071 15.741036l2.1650645-3.75h4.330129l2.1650645 3.75-2.1650645 3.75H3.3471355z" stroke="#fff" stroke-linecap="round" stroke-linejoin="round" stroke-width=".6730434"/></g></g></g></g></svg></span><span class="navbar-brand__name">Pigsty</span></a>
  <div class="td-navbar-nav-scroll ms-md-auto" id="main_navbar">
    <ul class="navbar-nav">
      <li class="nav-item">
        <a class="nav-link active" href="/zh/docs/"><i class='fa-solid fa-book'></i><span>文档</span></a>
      </li>
      <li class="nav-item">
        <a class="nav-link" href="/zh/blog/"><i class="fas fa-blog"></i><span>博客</span></a>
      </li>
      <li class="nav-item">
        <a class="nav-link" href="https://github.com/Vonng/pigsty/" target="_blank" rel="noopener"><i class='fab fa-github'></i><span>GitHub</span></a>
      </li>
      <li class="nav-item dropdown d-none d-lg-block">
        <div class="dropdown">
  <a class="nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
      <i class="fa-solid fa-language"></i>中文</a>
  <ul class="dropdown-menu">
    <li><a class="dropdown-item" href="/docs/software/">English</a></li>
    </ul>
</div>
</li>
      </ul>
  </div>
  <div class="d-none d-lg-block">
    <div class="td-search td-search--offline">
  <div class="td-search__icon"></div>
  <input
    type="search"
    class="td-search__input form-control"
    placeholder="Search this site…"
    aria-label="Search this site…"
    autocomplete="off"
    
    data-offline-search-index-json-src="/offline-search-index.b696ec90cb9c07b2c457007bd806beb7.json"
    data-offline-search-base-href="/"
    data-offline-search-max-results="10"
  >
</div>
  </div>
</div>
</nav>
    </header>
    <div class="container-fluid td-outer">
      <div class="td-main">
        <div class="row flex-xl-nowrap">
          <main class="col-12 col-md-9 col-xl-8 ps-md-5" role="main">
            




<div class="td-content">
<div class="pageinfo pageinfo-primary d-print-none">
<p>
This is the multi-page printable view of this section.
<a href="#" onclick="print();return false;">Click here to print</a>.
</p><p>
<a href="/zh/docs/software/">Return to the regular view of this page</a>.
</p>
</div>



<h1 class="title">软件镜像模板</h1>
<div class="lead">使用 Docker 运行开箱即用的软件与工具</div>




    <ul>
    
  
  
  
  

  
    
    
	
<li>1: <a href="#pg-73d64ed6cf2902263f8969b19456a73c">Dify：自建开源AI工作流编排平台</a></li>


    
  
    
    
	
<li>2: <a href="#pg-af738ab5b44c495aeb279ea812fce87d">Odoo：自建开源ERP系统</a></li>


    
  
    
    
	
<li>3: <a href="#pg-2e3fe03b4958e2681fa579e931fb2c22">Kong：企业级开源 API 网关</a></li>


    
  
    
    
	
<li>4: <a href="#pg-5d00b8779841da134b5b22fde61c99db">Jupyter：数据分析笔记本与AI IDE</a></li>


    
  
    
    
	
<li>5: <a href="#pg-712570c64c1ea4a71b6a08b0dd16d98b">Gitea：自建简易代码托管平台</a></li>


    
  
    
    
	
<li>6: <a href="#pg-1a5013ccb6314c00d1dbde17782c7234">Wiki.js：搭建你自己的维基百科</a></li>


    
  
    
    
	
<li>7: <a href="#pg-39d65c3b01d1bc14497afab7a5e3a53b">Minio：开源S3，简单对象存储服务</a></li>


    
  
    
    
	
<li>8: <a href="#pg-28564e14d16e9a4152a3a74308aadc58">ByteBase：PG模式迁移工具</a></li>


    
  
    
    
	
<li>9: <a href="#pg-df59db962ac59a6b76913d3d9c08ddd3">PGAdmin4：用GUI管理PG数据库</a></li>


    
  
    
    
	
<li>10: <a href="#pg-e0991d41daeb1162d48a97bf676e105e">PostgREST：自动生成REST API</a></li>


    
  
    
    
	
<li>11: <a href="#pg-9ec15a0d01cd5abc36fd6af1f45a0595">SchemaSPY：PG模式可视化</a></li>


    
  
    
    
	
<li>12: <a href="#pg-04017d0d30f9f51be2b31a34c8bdf117">PGWeb：从浏览器访问PostgreSQL</a></li>


    
  
    
    
	
<li>13: <a href="#pg-57ab357de3ec0981b36e0aeb8ae7d50b">Discourse：开源技术论坛</a></li>


    
  
    
    
	
<li>14: <a href="#pg-1040742b787f34bbaa39a7a8145b00c4">GitLab：企业级开源代码托管平台</a></li>


    
  

    </ul>


<div class="content">
      <p>PostgreSQL 是世界上最流行的数据库，有无数的软件构建于 PostgreSQL 之上，围绕 PostgreSQL 生态，或服务于 PostgreSQL 本身，例如</p>
<ul>
<li>使用 PostgreSQL 作为首选数据库的 “<strong>应用软件</strong>”</li>
<li>服务于 PostgreSQL 软件开发与管理的 “<strong>工具软件</strong>”</li>
<li>基于 PostgreSQL 的上层数据库，兼容分支等 “<strong>数据库软件</strong>”</li>
</ul>
<p>Pigsty 提供了一系列 Docker Compose 模板，帮助用户一键拉起这些软件应用，开箱即用：</p>
<table>
<thead>
<tr>
<th style="text-align:center">名称</th>
<th style="text-align:center">官方网站</th>
<th style="text-align:center">类型</th>
<th style="text-align:center">状态</th>
<th style="text-align:center">端口</th>
<th>默认域名</th>
<th style="text-align:left">说明</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center"><a href="supabase"><strong>Supabase</strong></a></td>
<td style="text-align:center"><a href="https://supabase.com/">Supabase</a></td>
<td style="text-align:center">数据库</td>
<td style="text-align:center"><strong>GA</strong></td>
<td style="text-align:center">8000</td>
<td>supa.pigsty</td>
<td style="text-align:left">基于PG的开源 Firebase 替代，后端平台</td>
</tr>
<tr>
<td style="text-align:center">PolarDB</td>
<td style="text-align:center"><a href="https://github.com/ApsaraDB/PolarDB-for-PostgreSQL">PolarDB</a></td>
<td style="text-align:center">数据库</td>
<td style="text-align:center"><strong>GA</strong></td>
<td style="text-align:center">5532</td>
<td></td>
<td style="text-align:left">开源的 RAC 版 PostgreSQL，国产信创稻草人</td>
</tr>
<tr>
<td style="text-align:center">FerretDB</td>
<td style="text-align:center"><a href="https://www.ferretdb.com/">FerretDB</a></td>
<td style="text-align:center">数据库</td>
<td style="text-align:center"><strong>GA</strong></td>
<td style="text-align:center">27017</td>
<td></td>
<td style="text-align:left">基于PG的 开源 MongoDB 替代</td>
</tr>
<tr>
<td style="text-align:center"><a href="/zh/docs/software/minio/"><strong>MinIO</strong></a></td>
<td style="text-align:center"><a href="https://min.io/">MinIO</a></td>
<td style="text-align:center">数据库</td>
<td style="text-align:center"><strong>GA</strong></td>
<td style="text-align:center">9000</td>
<td>sss.pigsty</td>
<td style="text-align:left">开源S3对象存储替代</td>
</tr>
<tr>
<td style="text-align:center">EdgeDB</td>
<td style="text-align:center"><a href="https://www.edgedb.com/">EdgeDB</a></td>
<td style="text-align:center">数据库</td>
<td style="text-align:center"><em>TBD</em></td>
<td style="text-align:center"></td>
<td></td>
<td style="text-align:left">基于PostgreSQL的图数据库</td>
</tr>
<tr>
<td style="text-align:center">NocoDB</td>
<td style="text-align:center"><a href="https://nocodb.com/">NocoDB</a></td>
<td style="text-align:center">应用软件</td>
<td style="text-align:center"><strong>GA</strong></td>
<td style="text-align:center">8080</td>
<td>noco.pigsty</td>
<td style="text-align:left">开源的 Airtable 替代</td>
</tr>
<tr>
<td style="text-align:center"><a href="/zh/docs/software/odoo/"><strong>Odoo</strong></a></td>
<td style="text-align:center"><a href="https://www.odoo.com/">Odoo</a></td>
<td style="text-align:center">应用软件</td>
<td style="text-align:center"><strong>GA</strong></td>
<td style="text-align:center">8069</td>
<td>odoo.pigsty</td>
<td style="text-align:left">开源的企业级ERP系统</td>
</tr>
<tr>
<td style="text-align:center"><a href="/zh/docs/software/dify/"><strong>Dify</strong></a></td>
<td style="text-align:center"><a href="https://dify.ai/zh">Dify</a></td>
<td style="text-align:center">应用软件</td>
<td style="text-align:center"><strong>GA</strong></td>
<td style="text-align:center">8001</td>
<td>dify.pigsty</td>
<td style="text-align:left">AI工作流编排平台，LLMOPS</td>
</tr>
<tr>
<td style="text-align:center"><a href="/zh/docs/software/jupyter/"><strong>Jupyter</strong></a></td>
<td style="text-align:center"><a href="https://jupyter.org/">Jupyter</a></td>
<td style="text-align:center">应用软件</td>
<td style="text-align:center"><strong>GA</strong></td>
<td style="text-align:center"></td>
<td>lab.pigsty</td>
<td style="text-align:left">Python开发与数据分析笔记本</td>
</tr>
<tr>
<td style="text-align:center"><a href="/zh/docs/software/gitea/"><strong>Gitea</strong></a></td>
<td style="text-align:center"><a href="https://gitea.com/">Gitea</a></td>
<td style="text-align:center">应用软件</td>
<td style="text-align:center"><strong>GA</strong></td>
<td style="text-align:center">8889</td>
<td>git.pigsty</td>
<td style="text-align:left">私有，可靠高效的 DevOps 代码托管平台</td>
</tr>
<tr>
<td style="text-align:center"><a href="/zh/docs/software/wiki/"><strong>Wiki</strong></a></td>
<td style="text-align:center"><a href="https://js.wiki/">Wiki.js</a></td>
<td style="text-align:center">应用软件</td>
<td style="text-align:center"><strong>GA</strong></td>
<td style="text-align:center">9002</td>
<td>wiki.pigsty</td>
<td style="text-align:left">开源且可扩展的 Wiki 软件</td>
</tr>
<tr>
<td style="text-align:center">GitLab</td>
<td style="text-align:center"><a href="https://gitlab.com/">GitLab</a></td>
<td style="text-align:center">应用软件</td>
<td style="text-align:center"><em>TBD</em></td>
<td style="text-align:center"></td>
<td></td>
<td style="text-align:left">开源 GitHub，企业级代码托管平台</td>
</tr>
<tr>
<td style="text-align:center">Mastodon</td>
<td style="text-align:center"><a href="https://joinmastodon.org/">Mastodon</a></td>
<td style="text-align:center">应用软件</td>
<td style="text-align:center"><em>TBD</em></td>
<td style="text-align:center"></td>
<td></td>
<td style="text-align:left">开源去中心化社交网站</td>
</tr>
<tr>
<td style="text-align:center">Keycloak</td>
<td style="text-align:center"><a href="https://www.keycloak.org/">Keycloak</a></td>
<td style="text-align:center">应用软件</td>
<td style="text-align:center"><em>TBD</em></td>
<td style="text-align:center"></td>
<td></td>
<td style="text-align:left">开源的身份认证与访问控制组件</td>
</tr>
<tr>
<td style="text-align:center">Harbour</td>
<td style="text-align:center"><a href="https://goharbor.io/">Harbour</a></td>
<td style="text-align:center">应用软件</td>
<td style="text-align:center"><em>TBD</em></td>
<td style="text-align:center"></td>
<td></td>
<td style="text-align:left">企业级 Docker/K8S 镜像仓库</td>
</tr>
<tr>
<td style="text-align:center">Confluence</td>
<td style="text-align:center"><a href="https://www.atlassian.com/software/confluence">Confluence</a></td>
<td style="text-align:center">应用软件</td>
<td style="text-align:center"><em>TBD</em></td>
<td style="text-align:center"></td>
<td></td>
<td style="text-align:left">企业级知识管理库</td>
</tr>
<tr>
<td style="text-align:center">Jira</td>
<td style="text-align:center"><a href="https://www.atlassian.com/software/jira">Jira</a></td>
<td style="text-align:center">应用软件</td>
<td style="text-align:center"><em>TBD</em></td>
<td style="text-align:center"></td>
<td></td>
<td style="text-align:left">企业级项目管理工具</td>
</tr>
<tr>
<td style="text-align:center">Zabbix</td>
<td style="text-align:center"><a href="https://www.zabbix.com/">Zabbix 7</a></td>
<td style="text-align:center">应用软件</td>
<td style="text-align:center"><em>TBD</em></td>
<td style="text-align:center"></td>
<td></td>
<td style="text-align:left">企业级全家桶监控平台</td>
</tr>
<tr>
<td style="text-align:center">Grafana</td>
<td style="text-align:center"><a href="https://grafana.com/">Grafana</a></td>
<td style="text-align:center">应用软件</td>
<td style="text-align:center"><em>TBD</em></td>
<td style="text-align:center"></td>
<td></td>
<td style="text-align:left">企业级数据可视化与面板平台</td>
</tr>
<tr>
<td style="text-align:center">Metabase</td>
<td style="text-align:center"><a href="https://www.metabase.com/">Metabase</a></td>
<td style="text-align:center">应用软件</td>
<td style="text-align:center"><strong>GA</strong></td>
<td style="text-align:center">9004</td>
<td>mtbs.pigsty</td>
<td style="text-align:left">快速对多种数据源内的数据进行分析</td>
</tr>
<tr>
<td style="text-align:center">ByteBase</td>
<td style="text-align:center"><a href="https://www.bytebase.com/">ByteBase</a></td>
<td style="text-align:center">应用软件</td>
<td style="text-align:center"><strong>GA</strong></td>
<td style="text-align:center">8887</td>
<td>ddl.pigsty</td>
<td style="text-align:left">数据库模式变更工具</td>
</tr>
<tr>
<td style="text-align:center"><a href="/zh/docs/software/kong/"><strong>Kong</strong></a></td>
<td style="text-align:center"><a href="https://konghq.com/">Kong</a></td>
<td style="text-align:center">开发套件</td>
<td style="text-align:center"><strong>GA</strong></td>
<td style="text-align:center">8000</td>
<td>api.pigsty</td>
<td style="text-align:left">基于Nginx/OpenResty的API网关</td>
</tr>
<tr>
<td style="text-align:center"><a href="/zh/docs/software/postgrest/"><strong>PostgREST</strong></a></td>
<td style="text-align:center"><a href="https://postgrest.org/">PostgREST</a></td>
<td style="text-align:center">开发套件</td>
<td style="text-align:center"><strong>GA</strong></td>
<td style="text-align:center">8884</td>
<td>api.pigsty</td>
<td style="text-align:left">自动从PG模式中生成RestAPI</td>
</tr>
<tr>
<td style="text-align:center"><a href="/zh/docs/software/pgadmin/"><strong>pgAdmin4</strong></a></td>
<td style="text-align:center"><a href="https://www.pgadmin.org/">pgAdmin4</a></td>
<td style="text-align:center">PG工具</td>
<td style="text-align:center"><strong>GA</strong></td>
<td style="text-align:center">8885</td>
<td>adm.pigsty</td>
<td style="text-align:left">PostgreSQL GUI 管理工具</td>
</tr>
<tr>
<td style="text-align:center"><a href="/zh/docs/software/pgweb/"><strong>pgWeb</strong></a></td>
<td style="text-align:center"><a href="https://github.com/sosedoff/pgweb?tab=readme-ov-file">pgWeb</a></td>
<td style="text-align:center">PG工具</td>
<td style="text-align:center"><strong>GA</strong></td>
<td style="text-align:center">8886</td>
<td>cli.pigsty</td>
<td style="text-align:left">PostgreSQL 网页客户端工具</td>
</tr>
<tr>
<td style="text-align:center">SchemaSpy</td>
<td style="text-align:center"><a href="https://schemaspy.org/">SchemaSpy</a></td>
<td style="text-align:center">PG工具</td>
<td style="text-align:center"><em>TBD</em></td>
<td style="text-align:center"></td>
<td></td>
<td style="text-align:left">生成PostgreSQL模式图的工具</td>
</tr>
<tr>
<td style="text-align:center">pgBadger</td>
<td style="text-align:center"><a href="https://github.com/darold/pgbadger">pgBadger</a></td>
<td style="text-align:center">PG工具</td>
<td style="text-align:center"><em>TBD</em></td>
<td style="text-align:center"></td>
<td></td>
<td style="text-align:left">分析PostgreSQL</td>
</tr>
<tr>
<td style="text-align:center">pg_exporter</td>
<td style="text-align:center"><a href="https://github.com/Vonng/pg_exporter">pg_exporter</a></td>
<td style="text-align:center">PG工具</td>
<td style="text-align:center"><strong>GA</strong></td>
<td style="text-align:center">9630</td>
<td></td>
<td style="text-align:left">暴露PostgreSQL与Pgbouncer的监控指标</td>
</tr>
</tbody>
</table>


<div class="alert alert-success" role="alert">
<h4 class="alert-heading">如何使用这些软件模板？</h4>

    使用这些软件模板需要在 <a href="/zh/docs/node#%E6%99%AE%E9%80%9A%E8%8A%82%E7%82%B9"><strong>节点</strong></a> 上安装 <a href="/zh/docs/docker"><strong><code>DOCKER</code></strong></a> 模块，中国大陆用户可能还要配置 DockerHub 代理，详见 <a href="/zh/docs/tasks/docker"><strong>教程</strong></a>。

</div>


</div>
</div>


  
  
  
  

  
  

  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-73d64ed6cf2902263f8969b19456a73c">1 - Dify：自建开源AI工作流编排平台</h1>
    <div class="lead">如何使用 Pigsty 自建 AI Workflow LLMOps 平台 —— Dify，并使用外部 PostgreSQL，PGVector，Redis 作为存储？</div>
	<p><a href="https://dify.ai/zh"><strong>Dify</strong></a> 是一个生成式 AI 应用创新引擎，开源的 LLM 应用开发平台。提供从 Agent 构建到 AI workflow 编排、RAG 检索、模型管理等能力，帮助用户轻松构建和运营生成式 AI 原生应用。</p>
<p>当然，像这样的一个 AI 工作流编排软件，在底下也少不得用到数据库 —— Dify 便是用 PostgreSQL 存储数据的，当然还有 Redis 缓存，与一个专用的向量数据库。Docker 镜像拉起来本地玩玩可以，生产环境部署的话，数据库肯定不能这么搞，高可用，备份，监控啥都没有。
好在 Pigsty 就提供了开箱即用的生产级高可用 PostgreSQL 集群，也正好提供了 Dify 需要用到的 Redis 与 S3 （MinIO） 服务，也提供了 Nginx 可以对外暴露 Web 服务，堪称 Dify 最佳拍档。</p>
<p>这里我不得不吐槽一下 Dify 模板的设计，元数据都已经用 PostgreSQL 存储了，你直接加个 <code>pgvector</code> 不就能拿来当向量数据库了？更让人想吐槽的是 <code>pgvector</code> 竟然还是一个单独的镜像与容器，你直接用一个带 pgvector 的 PG 镜像不就行了？
Dify “支持” 了一堆花里胡哨的向量数据库，但你既然已经选定了 PostgreSQL 了，向量数据库默认也用 <code>pgvector</code> 就是自然而然地选择了。同理，我觉得 Dify 官方应该考虑一下把 Redis 去掉，Celery 任务队列又不是不能用 PostgreSQL 作为后端存储，弄那么多数据库纯属吃饱了撑着。如无必要，勿增实体。</p>
<p>所以 Pigsty 提供的 <a href="https://github.com/Vonng/pigsty/tree/master/app/dify">Dify Docker Compose 模板</a> 也对官方的样例做了一些修改，把 <code>db</code> 和 <code>redis</code> 两个数据库镜像给去掉了，使用由 Pigsty 管理的实例，向量数据库固定使用 <code>pgvector</code>，复用同一个 PostgreSQL 实例。</p>
<p>最后上面那个架构就被简化为无状态的：<code>dify-api</code>，<code>dify-web</code>，<code>dify-worker</code> 三个无状态容器，可以随意创建销毁。当然还有两个可选的 <code>ssrf_proxy</code> 与 <code>nginx</code>，用于提供代理与些许安全特性。
还有一点状态尾巴是 <a href="https://github.com/Vonng/pigsty/blob/main/app/dify/docker-compose.yml#L128">文件系统卷</a>，存放私钥之类的东西，定期备份一下就好了，也可以使用 MinIO 替代。</p>
<p>参考资料：</p>
<ul>
<li><a href="https://github.com/langgenius/dify/">GitHub: langgenius/Dify</a></li>
<li><a href="https://github.com/Vonng/pigsty/tree/master/app/dify">Pigsty: Dify Docker Compose Template</a></li>
</ul>
<hr>
<h2 id="pigsty的准备工作">Pigsty的准备工作</h2>
<p>我们用 <a href="/zh/docs/concept/arch/#%E5%8D%95%E6%9C%BA%E5%AE%89%E8%A3%85">单机安装</a> 的 Pigsty 为例，假设你有一台 IP 地址为 <code>10.10.10.10</code> 的机器，已经 <a href="/zh/docs/setup/install">安装好了单机 Pigsty</a>。</p>
<p>当然，我们需要在 Pigsty 配置文件 <code>pigsty.yml</code> 中定义一下我们所需的数据库集群。
这里定义了一个名为 <code>pg-meta</code> 的集群，其中有一个名为 <code>dbuser_dify</code> 的超级业务用户（它这个实现的有点挫，在 Migration 脚本里面执行了 <code>CREATE EXTENSION</code> ），一个安装了 <code>pgvector</code> 扩展插件的数据库 <code>dify</code>，以及一条特定的防火墙规则，允许用户通过密码从任何地方访问数据库（你也可以将其限制为docker的网段 <code>172.0.0.0/8</code> 之类更精确的范围）。</p>
<p>同时，上面还定义了一个单实例的标准 Redis 集群 <code>redis-dify</code>，设置了密码 <code>redis.dify</code>。</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">pg-meta</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">hosts</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span>{<span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">10.10.10.10</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span>{<span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">pg_seq: 1, pg_role</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">primary } }</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">vars</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">pg_cluster</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">pg-meta</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">pg_users</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000;font-weight:bold">[</span><span style="color:#f8f8f8;text-decoration:underline"> </span>{<span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">name: dbuser_dify ,password: DBUser.Dify  ,superuser: true ,pgbouncer: true ,roles</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000;font-weight:bold">[</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">dbrole_admin ] } ]</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">pg_databases</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000;font-weight:bold">[</span><span style="color:#f8f8f8;text-decoration:underline"> </span>{<span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">name: dify, owner: dbuser_dify, extensions</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000;font-weight:bold">[</span><span style="color:#f8f8f8;text-decoration:underline"> </span>{<span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">name</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">pgvector } ] } ]</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">pg_hba_rules</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000;font-weight:bold">[</span><span style="color:#f8f8f8;text-decoration:underline"> </span>{<span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">user: dbuser_dify , db: all ,addr: world ,auth: pwd ,title</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#39;allow dify user world pwd access&#39;</span><span style="color:#f8f8f8;text-decoration:underline"> </span>}<span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000;font-weight:bold">]</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:bold">redis-dify</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">hosts</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span>{<span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">10.10.10.10</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span>{<span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">redis_node: 1 , redis_instances</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span>{<span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">6379</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span>{<span style="color:#f8f8f8;text-decoration:underline"> </span>}<span style="color:#f8f8f8;text-decoration:underline"> </span>}<span style="color:#f8f8f8;text-decoration:underline"> </span>}<span style="color:#f8f8f8;text-decoration:underline"> </span>}<span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">vars</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span>{<span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">redis_cluster: redis-dify ,redis_password: &#39;redis.dify&#39; ,redis_max_memory</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">64MB }</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span></code></pre></div><p>这里出于演示目的，我们全部使用单实例配置，你可以参考 Pigsty 文档部署 <a href="/zh/docs/concept/ha">高可用</a> 的 PG 集群与 Redis 集群。总之，在定义完成后，使用以下命令创建 PG 和 Redis 。</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>bin/pgsql-add  pg-meta                <span style="color:#8f5902;font-style:italic"># create the dify database cluster</span>
</span></span><span style="display:flex;"><span>bin/redis-add  redis-dify             <span style="color:#8f5902;font-style:italic"># create redis cluster</span>
</span></span></code></pre></div><p>当然，您也可以在现有的 PostgreSQL 集群，例如 <code>pg-meta</code> 上新定义业务用户与业务数据库，并通过以下命令创建：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>bin/pgsql-user pg-meta dbuser_dify    <span style="color:#8f5902;font-style:italic"># create dify biz user</span>
</span></span><span style="display:flex;"><span>bin/pgsql-db   pg-meta dify           <span style="color:#8f5902;font-style:italic"># create dify biz database</span>
</span></span></code></pre></div><p>您应该可以通过以下的连接串，访问到 PostgreSQL 与 Redis，当然连接信息请根据实际情况进行修改。</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>psql postgres://dbuser_dify:DBUser.Dify@10.10.10.10:5432/dify -c <span style="color:#4e9a06">&#39;SELECT 1&#39;</span>
</span></span><span style="display:flex;"><span>redis-cli -u redis://redis.dify@10.10.10.10:6379/0 ping
</span></span></code></pre></div><p>当你确认这两个连接串可用后，大功告成，你可以开始部署 Dify 了。</p>
<p>这里出于演示方便的原因，使用IP直连的土办法，如果是多节点的高可用 PG 集群，请参考 <a href="/zh/docs/concept/svc/">接入</a> 一节。</p>
<p>当然，上面的部分是假设你已经是 Pigsty 用户，了解如何部署 PostgreSQL 与 Redis 集群。你可以直接跳过下一节，查看 <a href="/zh/docs/software/dify/#dify的配置工作">Dify 如何配置</a>。</p>
<hr>
<h2 id="从零开始的一些说明">从零开始的一些说明</h2>
<p>如果您已经了解如何配置使用 Pigsty，可以略过本节。</p>
<p><a href="/zh/docs/setup/install">从零安装</a> Pigsty 需要 <a href="/zh/docs/setup/prepare/">准备</a> 一台符合要求的机器节点： Linux / x86_64，静态 IP，使用带有免密 <code>sudo</code> 权限的用户，执行以下命令：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>curl -fsSL https://repo.pigsty.io/get <span style="color:#000;font-weight:bold">|</span> bash
</span></span></code></pre></div><p>然后依次完成以下步骤：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#204a87">cd</span> ~/pigsty      <span style="color:#8f5902;font-style:italic"># 下载源码包解压后进入 Pigsty 源码目录，完成后续 准备、配置、安装 三个步骤</span>
</span></span><span style="display:flex;"><span>./bootstrap      <span style="color:#8f5902;font-style:italic"># 【可选项】用于确保 Ansible 正常安装，如果 /tmp/pkg.tgz 离线包则使用它</span>
</span></span><span style="display:flex;"><span>./configure      <span style="color:#8f5902;font-style:italic"># 【可选项】执行环境检测，并生成相应的推荐配置文件，如果知道如何配置可以跳过</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># …… 这里请修改自动生成的配置 pigsty.yml ，将上面的集群定义填入 all.children 部分内</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>./install.yml    <span style="color:#8f5902;font-style:italic"># 根据生成的配置文件开始在当前节点上执行安装，使用离线安装包大概需要10分钟完成</span>
</span></span></code></pre></div><p>您应当将上面的 PostgreSQL 集群与 Redis 集群定义填入 <code>pigsty.yml</code> 文件中，然后执行 <a href="/zh/docs/infra#infrayml"><code>install.yml</code></a> 完成安装。</p>
<p><strong>Redis安装问题</strong></p>
<p>Pigsty 默认不会安装 Redis，所以您需要使用 <a href="/zh/docs/redis#redisyml"><code>redis.yml</code></a> 剧本显式完成 Redis 安装：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>./redis.yml
</span></span></code></pre></div><p><strong>Docker安装问题</strong></p>
<p>Pigsty 默认不会在当前节点安装 Docker，所以您需要使用 <a href="/zh/docs/docker#dockeryml"><code>docker.yml</code></a> 剧本安装 Docker。</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>./docker.yml
</span></span></code></pre></div><p><strong>Docker Hub 被墙问题</strong></p>
<p>请注意，对于中国大陆用户来说，Docker Hub 与各镜像站点目前出于封锁状态，需要 “科学上网” 才能拉取 Dify 所需的镜像，您可以考虑 <code>docker save|load</code>，或者为 Docker Daemon 配置代理。</p>
<p>要为 Docker Daemon 配置代理，您需要在 <a href="/zh/docs/reference/param#proxy_env"><code>proxy_env</code></a> 中指定 <code>http_proxy</code> 与 <code>https_proxy</code> 环境变量，该参数会在 <code>docker_config</code> 任务中被写入 <code>/etc/docker/daemon.json</code> 中：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span><span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>  <span style="color:#204a87;font-weight:bold">&#34;proxies&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">&#34;http-proxy&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;http://192.168.x.x:8118&#34;</span><span style="color:#000;font-weight:bold">,</span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">&#34;https-proxy&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;http://192.168.x.x:8118&#34;</span><span style="color:#000;font-weight:bold">,</span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">&#34;no-proxy&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;localhost,127.0.0.1,10.0.0.0/8,192.168.0.0/16,*.pigsty,*.aliyun.com,mirrors.*,*.myqcloud.com,*.tsinghua.edu.cn&#34;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#000;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">}</span>
</span></span></code></pre></div><p>当然您也可以直接在配置文件中填入您的 HTTP/HTTPS 代理地址，并使用 <code>systemctl restart docker</code> 重启生效。</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>$ docker compose pull
</span></span><span style="display:flex;"><span><span style="color:#ce5c00;font-weight:bold">[</span>+<span style="color:#ce5c00;font-weight:bold">]</span> Pulling 5/5
</span></span><span style="display:flex;"><span>✔ worker Skipped - Image is already being pulled by api
</span></span><span style="display:flex;"><span>✔ web Pulled
</span></span><span style="display:flex;"><span>✔ api Pulled
</span></span><span style="display:flex;"><span>✔ ssrf_proxy Pulled
</span></span><span style="display:flex;"><span>✔ nginx Pulled
</span></span></code></pre></div><p>配置代理后，镜像都可以成功拉取了。当然您也可以使用其他可用的镜像站点，例如 quay.io 等。</p>
<hr>
<h2 id="dify的配置工作">Dify的配置工作</h2>
<p>Dify 的配置参数一如往常地放在 <a href="https://github.com/Vonng/pigsty/blob/main/app/dify/.env"><code>.env</code></a> 文件中，内容如下所示：</p>
<p>所有参数都顾名思义，已经填入了在 <a href="/zh/docs/setup/provision/">Pigsty默认沙箱环境</a> 中可以直接工作的默认值，数据库连接信息请根据您的真实配置，与上面 PG / Redis 集群配置保持一致即可。
我们建议你随便改一下这个 <code>SECRET_KEY</code> 字段，可以使用 <code>openssl rand -base64 42</code> 生成一个强密钥。</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># meta parameter</span>
</span></span><span style="display:flex;"><span><span style="color:#000">DIFY_PORT</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#0000cf;font-weight:bold">8001</span> <span style="color:#8f5902;font-style:italic"># expose dify nginx service with port 8001 by default</span>
</span></span><span style="display:flex;"><span><span style="color:#000">LOG_LEVEL</span><span style="color:#ce5c00;font-weight:bold">=</span>INFO <span style="color:#8f5902;font-style:italic"># The log level for the application. Supported values are `DEBUG`, `INFO`, `WARNING`, `ERROR`, `CRITICAL`</span>
</span></span><span style="display:flex;"><span><span style="color:#000">SECRET_KEY</span><span style="color:#ce5c00;font-weight:bold">=</span>sk-9f73s3ljTXVcMT3Blb3ljTqtsKiGHXVcMT3BlbkFJLK7U <span style="color:#8f5902;font-style:italic"># A secret key for signing and encryption, gen with `openssl rand -base64 42`</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># postgres credential</span>
</span></span><span style="display:flex;"><span><span style="color:#000">PG_USERNAME</span><span style="color:#ce5c00;font-weight:bold">=</span>dbuser_dify
</span></span><span style="display:flex;"><span><span style="color:#000">PG_PASSWORD</span><span style="color:#ce5c00;font-weight:bold">=</span>DBUser.Dify
</span></span><span style="display:flex;"><span><span style="color:#000">PG_HOST</span><span style="color:#ce5c00;font-weight:bold">=</span>10.10.10.10
</span></span><span style="display:flex;"><span><span style="color:#000">PG_PORT</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#0000cf;font-weight:bold">5432</span>
</span></span><span style="display:flex;"><span><span style="color:#000">PG_DATABASE</span><span style="color:#ce5c00;font-weight:bold">=</span>dify
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># redis credential</span>
</span></span><span style="display:flex;"><span><span style="color:#000">REDIS_HOST</span><span style="color:#ce5c00;font-weight:bold">=</span>10.10.10.10
</span></span><span style="display:flex;"><span><span style="color:#000">REDIS_PORT</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#0000cf;font-weight:bold">6379</span>
</span></span><span style="display:flex;"><span><span style="color:#000">REDIS_USERNAME</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#39;&#39;</span>
</span></span><span style="display:flex;"><span><span style="color:#000">REDIS_PASSWORD</span><span style="color:#ce5c00;font-weight:bold">=</span>redis.dify
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># minio/s3 [OPTIONAL] when STORAGE_TYPE=s3</span>
</span></span><span style="display:flex;"><span><span style="color:#000">STORAGE_TYPE</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#204a87">local</span>
</span></span><span style="display:flex;"><span><span style="color:#000">S3_ENDPOINT</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#39;https://sss.pigsty&#39;</span>
</span></span><span style="display:flex;"><span><span style="color:#000">S3_BUCKET_NAME</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#39;infra&#39;</span>
</span></span><span style="display:flex;"><span><span style="color:#000">S3_ACCESS_KEY</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#39;dba&#39;</span>
</span></span><span style="display:flex;"><span><span style="color:#000">S3_SECRET_KEY</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#39;S3User.DBA&#39;</span>
</span></span><span style="display:flex;"><span><span style="color:#000">S3_REGION</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#39;us-east-1&#39;</span>
</span></span></code></pre></div><p>填好连接信息后，我们就可以使用 Docker Compose 拉起 Dify 服务了：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#204a87">cd</span> pigsty/app/dify <span style="color:#ce5c00;font-weight:bold">&amp;&amp;</span> make up
</span></span></code></pre></div><hr>
<h2 id="使用nginx暴露web服务">使用Nginx暴露Web服务</h2>
<p>Dify 的 Docker Compose 模板里面已经包含了一个 Nginx Server，占据了宿主机的 80 端口。如果你的这台机器就是拿来专门跑 Dify 的那没问题。如果你用的是 Pigsty 单机安装，那么这台宿主机上的 80 端口已经被 Pigsty 部署的 Nginx Web Portal 占据了。</p>
<p>所以，Pigsty 提供的模板中，<code>DIFY_PORT</code> 默认使用了 <code>8001</code>，并通过宿主机上 Pigsty 部署的 Nginx 转发至此端口。当然我们也提供选项B，你也可以直接在 <code>/etc/nginx/conf.d/dify.conf</code> 里使用样例配置，直接指向 Dify 的 <code>web</code> 与 <code>api</code> 端口。</p>
<p>在 <code>pigsty.yml</code> 配置文件中的 <code>infra_portal</code> 参数中新增一行 Dify 的配置</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">infra_portal</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">                     </span><span style="color:#8f5902;font-style:italic"># domain names and upstream servers</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">home         </span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span>{<span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">domain</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">h.pigsty }</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">grafana      </span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span>{<span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">domain: g.pigsty ,endpoint</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;${admin_ip}:3000&#34;</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">, websocket</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">true</span><span style="color:#f8f8f8;text-decoration:underline"> </span>}<span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">prometheus   </span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span>{<span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">domain: p.pigsty ,endpoint</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;${admin_ip}:9090&#34;</span><span style="color:#f8f8f8;text-decoration:underline"> </span>}<span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">alertmanager </span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span>{<span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">domain: a.pigsty ,endpoint</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;${admin_ip}:9093&#34;</span><span style="color:#f8f8f8;text-decoration:underline"> </span>}<span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">blackbox     </span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span>{<span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">endpoint</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;${admin_ip}:9115&#34;</span><span style="color:#f8f8f8;text-decoration:underline"> </span>}<span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">loki         </span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span>{<span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">endpoint</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;${admin_ip}:3100&#34;</span><span style="color:#f8f8f8;text-decoration:underline"> </span>}<span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">dify         </span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span>{<span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">domain: dify.pigsty ,endpoint</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;10.10.10.10:8001&#34;</span><span style="color:#204a87;font-weight:bold">, websocket</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">true</span><span style="color:#f8f8f8;text-decoration:underline"> </span>}<span style="color:#f8f8f8;text-decoration:underline">
</span></span></span></code></pre></div><p>执行以下剧本，重新生成 Nginx 配置、证书并应用：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>./infra.yml -t nginx
</span></span></code></pre></div><p>当然如果要通过域名访问，你要把自己的域名 <code>dify.pigsty</code> 添加到域名服务器，或者简单地写入：<code>/etc/hosts</code> 或 <code>C:\Windows\System32\drivers\etc\hosts</code> 之类的静态域名解析文件。</p>
<p>然后，你就可以从浏览器中，通过 <a href="http://dify.pigsty">http://dify.pigsty</a> 访问 Dify IDE 了。</p>

</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-af738ab5b44c495aeb279ea812fce87d">2 - Odoo：自建开源ERP系统</h1>
    <div class="lead">如何拉起开箱即用的企业级应用全家桶 Odoo，并使用 Pigsty 管理其后端 PostgreSQL 数据库。</div>
	<p><a href="https://www.odoo.com/">Odoo</a> 是一个开源的企业级 ERP 系统，提供了从 CRM、销售、采购、库存、生产、财务等全方位的企业管理功能。Odoo 也是一个典型的 Web 应用，底层使用 PostgreSQL 数据库作为存储。</p>
<blockquote>
<p>将你所有的业务都汇总入一个平台，简单，高效，省钱。</p>
</blockquote>
<p>公开演示（不一定开放）：http://odoo.pigsty.cc, username: <code>test@pigsty.cc</code>, password: <code>pigsty</code></p>
<hr>
<h2 id="快速上手">快速上手</h2>
<p>首先准备一个 Pigsty 单节点配置文件，如下所示：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span> curl -fsSL https://repo.pigsty.io/get <span style="color:#000;font-weight:bold">|</span> bash
</span></span><span style="display:flex;"><span>./bootstrap               <span style="color:#8f5902;font-style:italic"># prepare local repo &amp; ansible</span>
</span></span><span style="display:flex;"><span>./configure -c demo/odoo  <span style="color:#8f5902;font-style:italic"># IMPORTANT: CHANGE CREDENTIALS!!</span>
</span></span><span style="display:flex;"><span>./install.yml             <span style="color:#8f5902;font-style:italic"># install pigsty &amp; pgsql &amp; minio</span>
</span></span><span style="display:flex;"><span>./docker.yml              <span style="color:#8f5902;font-style:italic"># install docker &amp; docker-compose</span>
</span></span><span style="display:flex;"><span>./app.yml                 <span style="color:#8f5902;font-style:italic"># install odoo</span>
</span></span></code></pre></div><p>Odoo 默认监听在 8069 端口，你可以通过浏览器访问 <code>http://&lt;ip&gt;:8069</code>。第一次登陆会提示您创建数据库（建议使用 <code>odoo</code> 即可，其他初始用户名密码按实际情况填写并记录）</p>
<p>你可以在浏览器所在主机（<code>/etc/hosts</code>）添加一条解析记录 <code>odoo.pigsty</code> 指向您的服务器，这样您就可以通过 <code>http://odoo.pigsty</code> 访问 Odoo 网络界面了。</p>
<p>如果你想要通过 SSL/HTTPS 访问 Odoo，你需要使用真正的 SSL 证书，或者信任 Pigsty 自动生成的自签名 ca 证书。（当然，在 Chrome 浏览器中，你也可以使用敲击键入 <code>thisisunsafe</code> 来绕过证书验证）</p>
<hr>
<h2 id="单节点配置文件">单节点配置文件</h2>
<p>在 <a href="https://github.com/Vonng/pigsty/blob/main/conf/demo/odoo.yml"><code>conf/demo/odoo.yml</code></a> 中有一个样例配置文件：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">all</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">children</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">infra</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">hosts</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span>{<span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">10.10.10.10</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span>{<span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">infra_seq</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#0000cf;font-weight:bold">1</span><span style="color:#f8f8f8;text-decoration:underline"> </span>}<span style="color:#f8f8f8;text-decoration:underline"> </span>}<span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">vars</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">        </span><span style="color:#8f5902;font-style:italic"># ./docker.yml -l infra</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">        </span><span style="color:#204a87;font-weight:bold">docker_enabled</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">true</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">        </span><span style="color:#204a87;font-weight:bold">docker_registry_mirrors</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000;font-weight:bold">[]</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">        </span><span style="color:#8f5902;font-style:italic">#  - https://docker.m.daocloud.io</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">        </span><span style="color:#8f5902;font-style:italic">#  - https://dockerproxy.com</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">        </span><span style="color:#8f5902;font-style:italic"># ./app.yml -l infra -e app=odoo</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">        </span><span style="color:#204a87;font-weight:bold">app</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">odoo</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">        </span><span style="color:#204a87;font-weight:bold">app_config</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">          </span><span style="color:#204a87;font-weight:bold">PG_HOST</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#0000cf;font-weight:bold">10.10.10.10</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">          </span><span style="color:#204a87;font-weight:bold">PG_PORT</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#0000cf;font-weight:bold">5432</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">          </span><span style="color:#204a87;font-weight:bold">PG_USER</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">dbuser_odoo</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">          </span><span style="color:#204a87;font-weight:bold">PG_PASS</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">DBUser.Odoo</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">          </span><span style="color:#204a87;font-weight:bold">ODOO_PORT</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#0000cf;font-weight:bold">8069</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">etcd</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span>{<span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">hosts</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span>{<span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">10.10.10.10</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span>{<span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">etcd_seq: 1 } }, vars</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span>{<span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">etcd_cluster</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">etcd } }</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#8f5902;font-style:italic">#minio: { hosts: { 10.10.10.10: { minio_seq: 1 } }, vars: { minio_cluster: minio } }</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">pg-meta</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">hosts</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span>{<span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">10.10.10.10</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span>{<span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">pg_seq: 1, pg_role</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">primary } }</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">vars</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">        </span><span style="color:#204a87;font-weight:bold">pg_cluster</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">pg-meta</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">        </span><span style="color:#204a87;font-weight:bold">pg_users</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">          </span>- {<span style="color:#204a87;font-weight:bold">name: dbuser_meta       ,password: DBUser.Meta       ,pgbouncer: true ,roles: [dbrole_admin]    ,comment</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">pigsty admin user }</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">          </span>- {<span style="color:#204a87;font-weight:bold">name: dbuser_view       ,password: DBUser.Viewer     ,pgbouncer: true ,roles: [dbrole_readonly] ,comment</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">read-only viewer for meta database }</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">          </span>- {<span style="color:#204a87;font-weight:bold">name: dbuser_odoo       ,password: DBUser.Odoo       ,pgbouncer: true ,roles: [dbrole_admin]    ,comment: admin user for odoo service ,createdb: true } #,superuser</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">true</span>}<span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">        </span><span style="color:#204a87;font-weight:bold">pg_databases</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">          </span>- {<span style="color:#204a87;font-weight:bold">name: meta ,baseline: cmdb.sql ,comment: pigsty meta database ,schemas: [pigsty] ,extensions</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000;font-weight:bold">[</span>{<span style="color:#204a87;font-weight:bold">name</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">vector}]}</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">          </span><span style="color:#8f5902;font-style:italic">#- {name: odoo ,owner: dbuser_odoo ,revokeconn: true ,comment: odoo main database  }  # this will be created by the dbuser_odoo, you can register it to grafana later</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">        </span><span style="color:#204a87;font-weight:bold">pg_hba_rules</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">          </span>- {<span style="color:#204a87;font-weight:bold">user: dbuser_view , db: all ,addr: infra ,auth: pwd ,title</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#39;allow grafana dashboard access cmdb from infra nodes&#39;</span>}<span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">        </span><span style="color:#204a87;font-weight:bold">pg_libs</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#39;pg_stat_statements, auto_explain&#39;</span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#8f5902;font-style:italic"># add timescaledb to shared_preload_libraries</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">vars</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">                               </span><span style="color:#8f5902;font-style:italic"># global variables</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">version</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">v3.2.1                  </span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#8f5902;font-style:italic"># pigsty version string</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">admin_ip</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#0000cf;font-weight:bold">10.10.10.10</span><span style="color:#f8f8f8;text-decoration:underline">             </span><span style="color:#8f5902;font-style:italic"># admin node ip address</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">region: default                   # upstream mirror region</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">default|china|europe</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">infra_portal</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">                     </span><span style="color:#8f5902;font-style:italic"># domain names and upstream servers</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">home         </span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span>{<span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">domain</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">h.pigsty }</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">grafana      </span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span>{<span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">domain: g.pigsty ,endpoint</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;${admin_ip}:3000&#34;</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">, websocket</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">true</span><span style="color:#f8f8f8;text-decoration:underline"> </span>}<span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">prometheus   </span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span>{<span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">domain: p.pigsty ,endpoint</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;${admin_ip}:9090&#34;</span><span style="color:#f8f8f8;text-decoration:underline"> </span>}<span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">alertmanager </span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span>{<span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">domain: a.pigsty ,endpoint</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;${admin_ip}:9093&#34;</span><span style="color:#f8f8f8;text-decoration:underline"> </span>}<span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">blackbox     </span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span>{<span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">endpoint</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;${admin_ip}:9115&#34;</span><span style="color:#f8f8f8;text-decoration:underline"> </span>}<span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">loki         </span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span>{<span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">endpoint</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;${admin_ip}:3100&#34;</span><span style="color:#f8f8f8;text-decoration:underline"> </span>}<span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">odoo         </span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span>{<span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">domain: odoo.pigsty, endpoint</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;127.0.0.1:8069&#34;</span><span style="color:#204a87;font-weight:bold">, websocket</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">true</span><span style="color:#f8f8f8;text-decoration:underline"> </span>}<span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#8f5902;font-style:italic"># &lt;-- 在这里指定 Odoo 的域名</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#8f5902;font-style:italic"># Credential: CHANGE THESE PASSWORDS IN PRODUCTION</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">grafana_admin_password</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">pigsty</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">pg_admin_password</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">DBUser.DBA</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">pg_monitor_password</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">DBUser.Monitor</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">pg_replication_password</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">DBUser.Replicator</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">patroni_password</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">Patroni.API</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">haproxy_admin_password</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">pigsty</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">repo_modules</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">infra,node,pgsql,docker</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">repo_packages</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000;font-weight:bold">[</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">node-bootstrap, infra-package, infra-addons, node-package1, node-package2, pgsql-utility, docker ]</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">repo_extra_packages</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000;font-weight:bold">[</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">pg17-main ]</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">pg_version</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#0000cf;font-weight:bold">17</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span></code></pre></div><p>然后依次执行以下剧本，即可完成 Odoo 安装：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>./install.yml   <span style="color:#8f5902;font-style:italic"># 完成单节点 Pigsty 安装</span>
</span></span><span style="display:flex;"><span>./docker.yml    <span style="color:#8f5902;font-style:italic"># 安装 Docker 模块</span>
</span></span><span style="display:flex;"><span>./app.yml       <span style="color:#8f5902;font-style:italic"># 安装 Odoo 模块</span>
</span></span></code></pre></div><p>默认的连接串如下所示，你可以在 <code>app.yml</code> 中修改用户的密码，并相应修改 <code>app_config</code> 中的配置</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>psql postgres://dbuser_odoo:DBUser.Odoo@10.10.10.10:5432/postgres
</span></span></code></pre></div><hr>
<h2 id="将-odoo-服务对外暴露">将 Odoo 服务对外暴露</h2>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">infra_portal</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">                     </span><span style="color:#8f5902;font-style:italic"># domain names and upstream servers</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">home         </span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span>{<span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">domain</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">h.pigsty }</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">grafana      </span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span>{<span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">domain: g.pigsty    ,endpoint</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;${admin_ip}:3000&#34;</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">, websocket</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">true</span><span style="color:#f8f8f8;text-decoration:underline"> </span>}<span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">prometheus   </span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span>{<span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">domain: p.pigsty    ,endpoint</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;${admin_ip}:9090&#34;</span><span style="color:#f8f8f8;text-decoration:underline"> </span>}<span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">alertmanager </span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span>{<span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">domain: a.pigsty    ,endpoint</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;${admin_ip}:9093&#34;</span><span style="color:#f8f8f8;text-decoration:underline"> </span>}<span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">blackbox     </span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span>{<span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">endpoint</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;${admin_ip}:9115&#34;</span><span style="color:#f8f8f8;text-decoration:underline"> </span>}<span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">loki         </span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span>{<span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">endpoint</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;${admin_ip}:3100&#34;</span><span style="color:#f8f8f8;text-decoration:underline"> </span>}<span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">odoo         </span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span>{<span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">domain: odoo.pigsty, endpoint</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;127.0.0.1:8069&#34;</span><span style="color:#204a87;font-weight:bold">, websocket</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">true</span><span style="color:#f8f8f8;text-decoration:underline"> </span>}<span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#8f5902;font-style:italic"># &lt;------ add this line</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>./infra.yml -t nginx   <span style="color:#8f5902;font-style:italic"># setup nginx infra portal</span>
</span></span></code></pre></div><h1 id="odoo-扩展插件">Odoo 扩展插件</h1>
<p>社区中有很多可用的 Odoo 模块，你可以通过下载并将它们放置在 <code>addons</code> 文件夹中来安装它们。</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">volumes</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span>- <span style="color:#000">./addons:/mnt/extra-addons</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span></code></pre></div><p>你可以将 <code>./addons</code> 目录挂载到容器中的 <code>/mnt/extra-addons</code> 目录，然后下载并解压到 <code>addons</code> 文件夹中，然后启用这些模块。</p>
<p>要启用这些模块，首先进入 <a href="https://www.odoo.com/documentation/18.0/applications/general/developer_mode.html">开发者模式</a></p>
<blockquote>
<p>Settings -&gt; Generic Settings -&gt; Developer Tools -&gt; Activate the developer Mode</p>
</blockquote>
<p>然后，转到 &gt; Apps -&gt; Update Apps List, 然后你可以在面板中找到这些额外的模块并安装它们。</p>
<p>经常使用的 <a href="https://apps.odoo.com/apps/modules/browse?order=Downloads">免费模块</a> ，当然以及大家最需要的 <a href="https://apps.odoo.com/apps/modules/18.0/base_accounting_kit/">Accounting Kit</a> 模块。</p>

</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-2e3fe03b4958e2681fa579e931fb2c22">3 - Kong：企业级开源 API 网关</h1>
    <div class="lead">拉起基于 Nginx 与 OpenResty 的强力开源 API 网关，并使用 PostgreSQL 与 Redis 作为其后端状态存储</div>
	<p><img src="/img/docs/app/kong.jpeg"></p>
<h2 id="tldr">TL;DR</h2>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#204a87">cd</span> app/kong <span style="color:#000;font-weight:bold">;</span> docker-compose up -d
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>make up         <span style="color:#8f5902;font-style:italic"># pull up kong with docker-compose</span>
</span></span><span style="display:flex;"><span>make ui         <span style="color:#8f5902;font-style:italic"># run swagger ui container</span>
</span></span><span style="display:flex;"><span>make log        <span style="color:#8f5902;font-style:italic"># tail -f kong logs</span>
</span></span><span style="display:flex;"><span>make info       <span style="color:#8f5902;font-style:italic"># introspect kong with jq</span>
</span></span><span style="display:flex;"><span>make stop       <span style="color:#8f5902;font-style:italic"># stop kong container</span>
</span></span><span style="display:flex;"><span>make clean      <span style="color:#8f5902;font-style:italic"># remove kong container</span>
</span></span><span style="display:flex;"><span>make rmui       <span style="color:#8f5902;font-style:italic"># remove swagger ui container</span>
</span></span><span style="display:flex;"><span>make pull       <span style="color:#8f5902;font-style:italic"># pull latest kong image</span>
</span></span><span style="display:flex;"><span>make rmi        <span style="color:#8f5902;font-style:italic"># remove kong image</span>
</span></span><span style="display:flex;"><span>make save       <span style="color:#8f5902;font-style:italic"># save kong image to /tmp/kong.tgz</span>
</span></span><span style="display:flex;"><span>make load       <span style="color:#8f5902;font-style:italic"># load kong image from /tmp</span>
</span></span></code></pre></div><h2 id="scripts">Scripts</h2>
<ul>
<li>Default Port: 8000</li>
<li>Default SSL Port: 8443</li>
<li>Default Admin Port: 8001</li>
<li>Default Postgres Database: <code>postgres://dbuser_kong:DBUser.Kong@10.10.10.10:5432/kong</code></li>
</ul>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># postgres://dbuser_kong:DBUser.Kong@10.10.10.10:5432/kong</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span>- {<span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">name: kong, owner: dbuser_kong, revokeconn: true , comment</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">kong the api gateway database }</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span>- {<span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">name: dbuser_kong, password: DBUser.Kong , pgbouncer: true , roles</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000;font-weight:bold">[</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">dbrole_admin ] }</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span></code></pre></div>
</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-5d00b8779841da134b5b22fde61c99db">4 - Jupyter：数据分析笔记本与AI IDE</h1>
    <div class="lead">使用 Jupyter Lab 并访问 PostgreSQL 数据库，并组合使用SQL与Python的能力进行数据分析。</div>
	<blockquote>
<p>本文需要更新</p>
</blockquote>
<p>Jupyter Lab 是基于 IPython Notebook 的完整数据科学研发环境，可用于数据分析与可视化。</p>
<p>因为JupyterLab提供了Web Terminal功能，因此在默认安装中不启用，需要主动使用 <a href="/zh/docs/software/jupyter/#infra-jupyter"><code>infra-jupyter.yml</code></a> 在元节点上进行部署。</p>
<p><img src="/img/docs/app/jupyter.jpeg"></p>
<h2 id="数据分析环境jupyter">数据分析环境：Jupyter</h2>
<p><a href="https://github.com/jupyter/docker-stacks">Jupyter Lab</a> 是一站式数据分析环境，下列命令将在 8887 端口启动一个Jupyter Server.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>docker run -it --restart always --detach --name jupyter -p 8888:8888 -v &#34;${PWD}&#34;:/tmp/notebook jupyter/scipy-notebook
</span></span><span style="display:flex;"><span>docker logs jupyter # 打印日志，获取登陆的Token
</span></span></code></pre></div><p>访问 http://10.10.10.10:8888/ 即可使用 JupyterLab，（需要填入自动生成的Token）。</p>
<p>您也可以使用 <a href="https://github.com/Vonng/pigsty/blob/feef4bd293fa3e4b7cc55c59ea39aa43ad0e1ee9/docs/zh-cn//zh/docs/infra/playbook#infra-jupyter">infra-jupyter.yml</a> 在管理节点裸机上启用Jupyter Notebook。</p>
<h2 id="太长不看">太长不看</h2>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>./infra-jupyter.yml <span style="color:#8f5902;font-style:italic"># 在管理节点上安装 Jupyter Lab，使用8888端口，OS用户jupyter，默认密码 pigsty</span>
</span></span><span style="display:flex;"><span>./infra-jupyter.yml -e <span style="color:#000">jupyter_domain</span><span style="color:#ce5c00;font-weight:bold">=</span>lab.pigsty.cc  <span style="color:#8f5902;font-style:italic"># 使用另一个域名（默认为lab.pigsty）</span>
</span></span><span style="display:flex;"><span>./infra-jupyter.yml -e <span style="color:#000">jupyter_port</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#0000cf;font-weight:bold">8887</span>             <span style="color:#8f5902;font-style:italic"># 使用另一个端口（默认为8888）</span>
</span></span><span style="display:flex;"><span>./infra-jupyter.yml -e <span style="color:#000">jupyter_username</span><span style="color:#ce5c00;font-weight:bold">=</span>osuser_jupyter <span style="color:#000">jupyter_password</span><span style="color:#ce5c00;font-weight:bold">=</span>pigsty2 <span style="color:#8f5902;font-style:italic"># 使用不同的操作系统用户与密码</span>
</span></span></code></pre></div><h2 id="jupyter配置">Jupyter配置</h2>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Level</th>
<th>Comment</th>
</tr>
</thead>
<tbody>
<tr>
<td><a href="/zh/docs/software/jupyter/#jupyter_port"><code>jupyter_port</code></a></td>
<td>integer</td>
<td>G</td>
<td>Jupyter端口</td>
</tr>
<tr>
<td><a href="/zh/docs/software/jupyter/#jupyter_domain"><code>jupyter_domain</code></a></td>
<td>string</td>
<td>G</td>
<td>Jupyter端口</td>
</tr>
<tr>
<td><a href="/zh/docs/software/jupyter/#jupyter_username"><code>jupyter_username</code></a></td>
<td>string</td>
<td>G</td>
<td>Jupyter使用的操作系统用户</td>
</tr>
<tr>
<td><a href="/zh/docs/software/jupyter/#jupyter_password"><code>jupyter_password</code></a></td>
<td>string</td>
<td>G</td>
<td>Jupyter Lab的密码</td>
</tr>
</tbody>
</table>
<h3 id="默认值">默认值</h3>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">jupyter_username: jupyter       # os user name, special names</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">default|root (dangerous!)</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:bold">jupyter_password</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">pigsty       </span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#8f5902;font-style:italic"># default password for jupyter lab (important!)</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:bold">jupyter_port</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#0000cf;font-weight:bold">8888</span><span style="color:#f8f8f8;text-decoration:underline">              </span><span style="color:#8f5902;font-style:italic"># default port for jupyter lab</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:bold">jupyter_domain</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">lab.pigsty     </span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#8f5902;font-style:italic"># domain name used to distinguish jupyter</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span></code></pre></div><h3 id="jupyter_username"><code>jupyter_username</code></h3>
<p>Jupyter使用的操作系统用户, 类型：<code>bool</code>，层级：G，默认值为：<code>&quot;jupyter&quot;</code></p>
<p>其他用户名亦同理，但特殊用户名<code>default</code>会使用当前执行安装的用户（通常为管理员）运行 Jupyter Lab，这会更方便，但也更危险。</p>
<h3 id="jupyter_password"><code>jupyter_password</code></h3>
<p>Jupyter Lab的密码, 类型：<code>bool</code>，层级：G，默认值为：<code>&quot;pigsty&quot;</code></p>
<p>如果启用Jupyter，强烈建议修改此密码。加盐混淆的密码默认会写入<code>~jupyter/.jupyter/jupyter_server_config.json</code>。</p>
<h3 id="jupyter_port"><code>jupyter_port</code></h3>
<p>Jupyter监听端口, 类型：<code>int</code>，层级：G，默认值为：<code>8888</code>。</p>
<p>启用JupyterLab时，Pigsty会使用<a href="jupyter_username"><code>jupyter_username</code></a> 参数指定的用户运行本地Notebook服务器。
此外，需要确保配置<a href="/zh/docs/nodes/config#node_packages_meta_pip"><code>node_packages_meta_pip</code></a> 参数包含默认值 <code>'jupyterlab'</code>。
Jupyter Lab可以从Pigsty首页导航进入，或通过默认域名 <code>lab.pigsty</code> 访问，默认监听于8888端口。</p>
<h3 id="jupyter_domain"><code>jupyter_domain</code></h3>
<p>Jupyter域名, 类型：<code>string</code>，层级：G，默认值为：<code>lab.pigsty</code>。</p>
<p>该域名会被写入 <code>/etc/nginx/conf.d/jupyter.conf</code> 中，作为Jupyter服务的监听域名。</p>
<hr>
<h2 id="jupyter剧本">Jupyter剧本</h2>
<h3 id="infra-jupyter"><code>infra-jupyter</code></h3>
<p><a href="https://github.com/Vonng/pigsty/blob/v1.5.1/infra-jupyter.yml"><code>infra-jupyter.yml</code></a> 剧本用于在元节点上加装 Jupyter Lab服务</p>
<p>Jupyter Lab 是非常实用的Python数据分析环境，但自带Web Shell，风险较大，需要使用专用剧本显式安装。</p>
<p>使用说明：参照 <a href="/zh/docs/software/jupyter/#jupyter配置">Jupyter配置</a> 中的说明调整配置清单，然后执行此剧本即可。</p>
<blockquote>
<p>如果您在生产环境中启用了Jupyter，请务必修改Jupyter的密码</p>
</blockquote>
<hr>
<h2 id="在jupyter中访问postgresql数据库">在Jupyter中访问PostgreSQL数据库</h2>
<p>您可以直接使用 <code>psycopg2</code> 驱动访问 PostgreSQL 数据库</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">import</span> <span style="color:#000">psycopg2</span>
</span></span><span style="display:flex;"><span><span style="color:#000">conn</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">psycopg2</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">connect</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#39;postgres://dbuser_meta:DBUser.Meta@:5432/meta&#39;</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span><span style="color:#000">cursor</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">conn</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">cursor</span><span style="color:#000;font-weight:bold">()</span>
</span></span><span style="display:flex;"><span><span style="color:#000">cursor</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">execute</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#34;&#34;&#34;SELECT date, new_cases FROM covid.country_history WHERE country_code = &#39;CN&#39;;&#34;&#34;&#34;</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span><span style="color:#000">data</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">cursor</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">fetchall</span><span style="color:#000;font-weight:bold">()</span>
</span></span></code></pre></div>
</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-712570c64c1ea4a71b6a08b0dd16d98b">5 - Gitea：自建简易代码托管平台</h1>
    <div class="lead">使用Docker拉起Gitea，并使用Pigsty的PG作为外部的元数据库</div>
	<p>公开Demo地址：<a href="http://git.pigsty.cc">http://git.pigsty.cc</a></p>
<p><img src="/img/docs/app/gitea.jpeg"></p>
<h2 id="太长不看">太长；不看</h2>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#204a87">cd</span> ~/pigsty/app/gitea<span style="color:#000;font-weight:bold">;</span> make up
</span></span></code></pre></div><p>在本例中，Gitea 默认使用 8889 端口，您可以访问以下位置：</p>
<p><a href="http://git.pigsty">http://git.pigsty</a> 或 http://10.10.10.10:8889</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>make up      <span style="color:#8f5902;font-style:italic"># pull up gitea with docker-compose in minimal mode</span>
</span></span><span style="display:flex;"><span>make run     <span style="color:#8f5902;font-style:italic"># launch gitea with docker , local data dir and external PostgreSQL</span>
</span></span><span style="display:flex;"><span>make view    <span style="color:#8f5902;font-style:italic"># print gitea access point</span>
</span></span><span style="display:flex;"><span>make log     <span style="color:#8f5902;font-style:italic"># tail -f gitea logs</span>
</span></span><span style="display:flex;"><span>make info    <span style="color:#8f5902;font-style:italic"># introspect gitea with jq</span>
</span></span><span style="display:flex;"><span>make stop    <span style="color:#8f5902;font-style:italic"># stop gitea container</span>
</span></span><span style="display:flex;"><span>make clean   <span style="color:#8f5902;font-style:italic"># remove gitea container</span>
</span></span><span style="display:flex;"><span>make pull    <span style="color:#8f5902;font-style:italic"># pull latest gitea image</span>
</span></span><span style="display:flex;"><span>make rmi     <span style="color:#8f5902;font-style:italic"># remove gitea image</span>
</span></span><span style="display:flex;"><span>make save    <span style="color:#8f5902;font-style:italic"># save gitea image to /tmp/gitea.tgz</span>
</span></span><span style="display:flex;"><span>make load    <span style="color:#8f5902;font-style:italic"># load gitea image from /tmp</span>
</span></span></code></pre></div><h2 id="使用外部的postgresql">使用外部的PostgreSQL</h2>
<p>Pigsty默认使用容器内的 Sqlite 作为元数据存储，您可以让 Gitea 通过连接串环境变量使用外部的PostgreSQL</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># postgres://dbuser_gitea:DBUser.gitea@10.10.10.10:5432/gitea</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:bold">db</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">   </span>{<span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">name: gitea, owner: dbuser_gitea, comment</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">gitea primary database }</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:bold">user</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span>{<span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">name: dbuser_gitea , password: DBUser.gitea, roles</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000;font-weight:bold">[</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">dbrole_admin ] }</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span></code></pre></div>
</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-1a5013ccb6314c00d1dbde17782c7234">6 - Wiki.js：搭建你自己的维基百科</h1>
    <div class="lead">如何使用 Wiki.js 搭建你自己的开源维基百科，并使用 Pigsty 管理的PG作为持久数据存储</div>
	<p>公开Demo地址：<a href="http://wiki.pigsty.cc">http://wiki.pigsty.cc</a></p>
<p><img src="/img/docs/app/wiki.jpg"></p>
<h2 id="太长不看">太长;不看</h2>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#204a87">cd</span> app/wiki <span style="color:#000;font-weight:bold">;</span> docker-compose up -d
</span></span></code></pre></div><h2 id="准备数据库">准备数据库</h2>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># postgres://dbuser_wiki:DBUser.Wiki@10.10.10.10:5432/wiki</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span>- {<span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">name: wiki, owner: dbuser_wiki, revokeconn: true , comment</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">wiki the api gateway database }</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span>- {<span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">name: dbuser_wiki, password: DBUser.Wiki , pgbouncer: true , roles</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000;font-weight:bold">[</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">dbrole_admin ] }</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>bin/createuser pg-meta dbuser_wiki
</span></span><span style="display:flex;"><span>bin/createdb   pg-meta wiki
</span></span></code></pre></div><h2 id="容器配置">容器配置</h2>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">version</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;3&#34;</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:bold">services</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">wiki</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">container_name</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">wiki</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">image</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">requarks/wiki:2</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">environment</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">DB_TYPE</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">postgres</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">DB_HOST</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#0000cf;font-weight:bold">10.10.10.10</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">DB_PORT</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#0000cf;font-weight:bold">5432</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">DB_USER</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">dbuser_wiki</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">DB_PASS</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">DBUser.Wiki</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">DB_NAME</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">wiki</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">restart</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">unless-stopped</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">ports</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span>- <span style="color:#4e9a06">&#34;9002:3000&#34;</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span></code></pre></div><h2 id="access">Access</h2>
<ul>
<li>Default Port for wiki: 9002</li>
</ul>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># add to nginx_upstream</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span>- {<span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">name: wiki  , domain: wiki.pigsty.cc , endpoint</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;127.0.0.1:9002&#34;</span><span style="color:#f8f8f8;text-decoration:underline">   </span>}<span style="color:#f8f8f8;text-decoration:underline">
</span></span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>./infra.yml -t nginx_config
</span></span><span style="display:flex;"><span>ansible all -b -a <span style="color:#4e9a06">&#39;nginx -s reload&#39;</span>
</span></span></code></pre></div>
</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-39d65c3b01d1bc14497afab7a5e3a53b">7 - Minio：开源S3，简单对象存储服务</h1>
    <div class="lead">使用Docker拉起Minio，即刻拥有你自己的对象存储服务。</div>
	<p>公开Demo地址：<a href="http://sss.pigsty.cc">http://sss.pigsty.cc</a></p>
<p>默认用户名： <code>admin</code>  / <code>pigsty.minio</code></p>
<p><img src="/img/docs/app/minio.jpeg"></p>
<h2 id="太长不看">太长；不看</h2>
<p>Launch minio (s3) service on 9000 &amp; 9001</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#204a87">cd</span> ~/pigsty/app/minio <span style="color:#000;font-weight:bold">;</span> docker-compose up -d
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>docker run -p 9000:9000 -p 9001:9001 <span style="color:#4e9a06">\
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06"></span>  -e <span style="color:#4e9a06">&#34;MINIO_ROOT_USER=admin&#34;</span> <span style="color:#4e9a06">\
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06"></span>  -e <span style="color:#4e9a06">&#34;MINIO_ROOT_PASSWORD=pigsty.minio&#34;</span> <span style="color:#4e9a06">\
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06"></span>  minio/minio server /data --console-address <span style="color:#4e9a06">&#34;:9001&#34;</span>
</span></span></code></pre></div><p>visit http://10.10.10.10:9000 with user <code>admin</code> and password <code>pigsty.minio</code></p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>make up         <span style="color:#8f5902;font-style:italic"># pull up minio with docker-compose</span>
</span></span><span style="display:flex;"><span>make run        <span style="color:#8f5902;font-style:italic"># launch minio with docker</span>
</span></span><span style="display:flex;"><span>make view       <span style="color:#8f5902;font-style:italic"># print minio access point</span>
</span></span><span style="display:flex;"><span>make log        <span style="color:#8f5902;font-style:italic"># tail -f minio logs</span>
</span></span><span style="display:flex;"><span>make info       <span style="color:#8f5902;font-style:italic"># introspect minio with jq</span>
</span></span><span style="display:flex;"><span>make stop       <span style="color:#8f5902;font-style:italic"># stop minio container</span>
</span></span><span style="display:flex;"><span>make clean      <span style="color:#8f5902;font-style:italic"># remove minio container</span>
</span></span><span style="display:flex;"><span>make pull       <span style="color:#8f5902;font-style:italic"># pull latest minio image</span>
</span></span><span style="display:flex;"><span>make rmi        <span style="color:#8f5902;font-style:italic"># remove minio image</span>
</span></span><span style="display:flex;"><span>make save       <span style="color:#8f5902;font-style:italic"># save minio image to /tmp/minio.tgz</span>
</span></span><span style="display:flex;"><span>make load       <span style="color:#8f5902;font-style:italic"># load minio image from /tmp</span>
</span></span></code></pre></div>
</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-28564e14d16e9a4152a3a74308aadc58">8 - ByteBase：PG模式迁移工具</h1>
    <div class="lead">使用Docker拉起Bytebase，对PG的模式进行版本化管理</div>
	<h2 id="bytebase">ByteBase</h2>
<p><a href="https://bytebase.com/">ByteBase</a>是一个进行数据库模式变更的工具，以下命令将在元节点 8887 端口启动一个ByteBase。</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-gdscript3" data-lang="gdscript3"><span style="display:flex;"><span><span style="color:#000">mkdir</span> <span style="color:#ce5c00;font-weight:bold">-</span><span style="color:#000">p</span> <span style="color:#ce5c00;font-weight:bold">/</span><span style="color:#000">data</span><span style="color:#ce5c00;font-weight:bold">/</span><span style="color:#000">bytebase</span><span style="color:#ce5c00;font-weight:bold">/</span><span style="color:#000">data</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span><span style="color:#000">docker</span> <span style="color:#000">run</span> <span style="color:#ce5c00;font-weight:bold">--</span><span style="color:#000">init</span> <span style="color:#ce5c00;font-weight:bold">--</span><span style="color:#000">name</span> <span style="color:#000">bytebase</span> <span style="color:#ce5c00;font-weight:bold">--</span><span style="color:#000">restart</span> <span style="color:#000">always</span> <span style="color:#ce5c00;font-weight:bold">--</span><span style="color:#000">detach</span> <span style="color:#ce5c00;font-weight:bold">--</span><span style="color:#000">publish</span> <span style="color:#0000cf;font-weight:bold">8887</span><span style="color:#000;font-weight:bold">:</span><span style="color:#0000cf;font-weight:bold">8887</span> <span style="color:#ce5c00;font-weight:bold">--</span><span style="color:#000">volume</span> <span style="color:#ce5c00;font-weight:bold">/</span><span style="color:#000">data</span><span style="color:#ce5c00;font-weight:bold">/</span><span style="color:#000">bytebase</span><span style="color:#ce5c00;font-weight:bold">/</span><span style="color:#000">data</span><span style="color:#000;font-weight:bold">:</span><span style="color:#ce5c00;font-weight:bold">/</span><span style="color:#204a87;font-weight:bold">var</span><span style="color:#ce5c00;font-weight:bold">/</span><span style="color:#000">opt</span><span style="color:#ce5c00;font-weight:bold">/</span><span style="color:#000">bytebase</span> \
</span></span><span style="display:flex;"><span>    <span style="color:#000">bytebase</span><span style="color:#ce5c00;font-weight:bold">/</span><span style="color:#000">bytebase</span><span style="color:#000;font-weight:bold">:</span><span style="color:#0000cf;font-weight:bold">1.0</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#0000cf;font-weight:bold">4</span> <span style="color:#ce5c00;font-weight:bold">--</span><span style="color:#000">data</span> <span style="color:#ce5c00;font-weight:bold">/</span><span style="color:#204a87;font-weight:bold">var</span><span style="color:#ce5c00;font-weight:bold">/</span><span style="color:#000">opt</span><span style="color:#ce5c00;font-weight:bold">/</span><span style="color:#000">bytebase</span> <span style="color:#ce5c00;font-weight:bold">--</span><span style="color:#000">host</span> <span style="color:#000">http</span><span style="color:#000;font-weight:bold">:</span><span style="color:#ce5c00;font-weight:bold">//</span><span style="color:#000">ddl</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">pigsty</span> <span style="color:#ce5c00;font-weight:bold">--</span><span style="color:#000">port</span> <span style="color:#0000cf;font-weight:bold">8887</span>
</span></span></code></pre></div><p>访问 http://10.10.10.10:8887/ 或 <a href="http://ddl.pigsty/">http://ddl.pigsty</a> 即可使用 ByteBase，您需要依次创建项目、环境、实例、数据库，即可开始进行模式变更。 公开Demo地址： <a href="http://ddl.pigsty.cc">http://ddl.pigsty.cc</a></p>
<p>公开Demo地址：<a href="http://ddl.pigsty.cc">http://ddl.pigsty.cc</a></p>
<p>默认用户名与密码： <code>admin</code> / <code>pigsty</code></p>
<p><img src="/img/docs/app/bytebase.jpeg"></p>
<h2 id="bytebase概览">Bytebase概览</h2>
<p>Schema Migrator for PostgreSQL</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#204a87">cd</span> app/bytebase<span style="color:#000;font-weight:bold">;</span> make up
</span></span></code></pre></div><p>Visit <a href="http://ddl.pigsty">http://ddl.pigsty</a> or http://10.10.10.10:8887</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>make up         <span style="color:#8f5902;font-style:italic"># pull up bytebase with docker-compose in minimal mode</span>
</span></span><span style="display:flex;"><span>make run        <span style="color:#8f5902;font-style:italic"># launch bytebase with docker , local data dir and external PostgreSQL</span>
</span></span><span style="display:flex;"><span>make view       <span style="color:#8f5902;font-style:italic"># print bytebase access point</span>
</span></span><span style="display:flex;"><span>make log        <span style="color:#8f5902;font-style:italic"># tail -f bytebase logs</span>
</span></span><span style="display:flex;"><span>make info       <span style="color:#8f5902;font-style:italic"># introspect bytebase with jq</span>
</span></span><span style="display:flex;"><span>make stop       <span style="color:#8f5902;font-style:italic"># stop bytebase container</span>
</span></span><span style="display:flex;"><span>make clean      <span style="color:#8f5902;font-style:italic"># remove bytebase container</span>
</span></span><span style="display:flex;"><span>make pull       <span style="color:#8f5902;font-style:italic"># pull latest bytebase image</span>
</span></span><span style="display:flex;"><span>make rmi        <span style="color:#8f5902;font-style:italic"># remove bytebase image</span>
</span></span><span style="display:flex;"><span>make save       <span style="color:#8f5902;font-style:italic"># save bytebase image to /tmp/bytebase.tgz</span>
</span></span><span style="display:flex;"><span>make load       <span style="color:#8f5902;font-style:italic"># load bytebase image from /tmp</span>
</span></span></code></pre></div><h2 id="使用外部的postgresql">使用外部的PostgreSQL</h2>
<p>Bytebase use its internal PostgreSQL database by default, You can use external PostgreSQL for higher durability.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># postgres://dbuser_bytebase:DBUser.Bytebase@10.10.10.10:5432/bytebase</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:bold">db</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">   </span>{<span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">name: bytebase, owner: dbuser_bytebase, comment</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">bytebase primary database }</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:bold">user</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span>{<span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">name: dbuser_bytebase , password: DBUser.Bytebase, roles</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000;font-weight:bold">[</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">dbrole_admin ] }</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span></code></pre></div><p>if you wish to user an external PostgreSQL, drop monitor extensions and views &amp; pg_repack</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>DROP SCHEMA monitor CASCADE<span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>DROP EXTENSION pg_repack<span style="color:#000;font-weight:bold">;</span>
</span></span></code></pre></div><p>After bytebase initialized, you can create them back with <code>/pg/tmp/pg-init-template.sql</code></p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>psql bytebase &lt; /pg/tmp/pg-init-template.sql
</span></span></code></pre></div>
</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-df59db962ac59a6b76913d3d9c08ddd3">9 - PGAdmin4：用GUI管理PG数据库</h1>
    <div class="lead">使用Docker拉起PgAdmin4，并加载Pigsty服务器列表</div>
	<p>PgAdmin4 是一个实用的PostgreSQL管理工具，执行以下命令可在管理节点拉起 pgadmin服务：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#204a87">cd</span> ~/pigsty/app/pgadmin <span style="color:#000;font-weight:bold">;</span> docker-compose up -d
</span></span></code></pre></div><p>默认分配 8885 端口，使用域名： <a href="http://adm.pigsty">http://adm.pigsty</a> 访问， Demo：http://adm.pigsty.cc。</p>
<p>默认用户名：<code>admin@pigsty.cc</code>，密码：<code>pigsty</code>。</p>
<hr>
<h2 id="demo">Demo</h2>
<p>公开Demo地址：<a href="http://adm.pigsty.cc">http://adm.pigsty.cc</a></p>
<p>默认用户名与密码: <code>admin@pigsty.cc</code> /  <code>pigsty</code></p>
<p><img src="/img/docs/app/pgadmin.jpeg"></p>
<h2 id="太长不看">太长；不看</h2>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#204a87">cd</span> ~/pigsty/app/pgadmin   <span style="color:#8f5902;font-style:italic"># 进入应用目录</span>
</span></span><span style="display:flex;"><span>make up                   <span style="color:#8f5902;font-style:italic"># 拉起pgadmin容器</span>
</span></span><span style="display:flex;"><span>make conf view            <span style="color:#8f5902;font-style:italic"># 加载Pigsty服务器列表文件至Pgadmin容器内并加载</span>
</span></span></code></pre></div><p>Pigsty的Pgadmin应用模板默认使用8885端口，您可以通过以下地址访问：</p>
<p><a href="http://adm.pigsty">http://adm.pigsty</a> 或 http://10.10.10.10:8885</p>
<p>默认用户名与密码: <code>admin@pigsty.cc</code> /  <code>pigsty</code></p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>make up         <span style="color:#8f5902;font-style:italic"># pull up pgadmin with docker-compose</span>
</span></span><span style="display:flex;"><span>make run        <span style="color:#8f5902;font-style:italic"># launch pgadmin with docker</span>
</span></span><span style="display:flex;"><span>make view       <span style="color:#8f5902;font-style:italic"># print pgadmin access point</span>
</span></span><span style="display:flex;"><span>make log        <span style="color:#8f5902;font-style:italic"># tail -f pgadmin logs</span>
</span></span><span style="display:flex;"><span>make info       <span style="color:#8f5902;font-style:italic"># introspect pgadmin with jq</span>
</span></span><span style="display:flex;"><span>make stop       <span style="color:#8f5902;font-style:italic"># stop pgadmin container</span>
</span></span><span style="display:flex;"><span>make clean      <span style="color:#8f5902;font-style:italic"># remove pgadmin container</span>
</span></span><span style="display:flex;"><span>make conf       <span style="color:#8f5902;font-style:italic"># provision pgadmin with pigsty pg servers list </span>
</span></span><span style="display:flex;"><span>make dump       <span style="color:#8f5902;font-style:italic"># dump servers.json from pgadmin container</span>
</span></span><span style="display:flex;"><span>make pull       <span style="color:#8f5902;font-style:italic"># pull latest pgadmin image</span>
</span></span><span style="display:flex;"><span>make rmi        <span style="color:#8f5902;font-style:italic"># remove pgadmin image</span>
</span></span><span style="display:flex;"><span>make save       <span style="color:#8f5902;font-style:italic"># save pgadmin image to /tmp/pgadmin.tgz</span>
</span></span><span style="display:flex;"><span>make load       <span style="color:#8f5902;font-style:italic"># load pgadmin image from /tmp</span>
</span></span></code></pre></div>
</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-e0991d41daeb1162d48a97bf676e105e">10 - PostgREST：自动生成REST API</h1>
    <div class="lead">使用Docker拉起PostgREST，自动根据PostgreSQL模式生成后端REST API</div>
	<h2 id="postgrest">PostgREST</h2>
<p><a href="https://postgrest.org/en/stable/index.html">PostgREST</a>是一个自动根据 PostgreSQL 数据库模式生成 REST API的二进制组件。</p>
<p>例如，以下命令将使用docker拉起 postgrest （本地 8884 端口，使用默认管理员用户，暴露Pigsty CMDB模式）</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>docker run --init --name postgrest --restart always --detach --publish 8884:8081 postgrest/postgrest
</span></span></code></pre></div><p>访问 <a href="http://10.10.10.10:8884/">http://10.10.10.10:8884</a> 会展示所有自动生成API的定义，并自动使用 <a href="http://home.pigsty.cc:8883">Swagger Editor</a> 暴露API文档。</p>
<p>如果您想要进行增删改查，设计更精细的权限控制，请参考 <a href="https://postgrest.org/en/stable/tutorials/tut1.html">Tutorial 1 - The Golden Key</a>，生成一个签名JWT。</p>
<p><img src="/img/docs/app/postgrest.jpeg"></p>
<p>This is an example of creating pigsty cmdb API with PostgREST</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#204a87">cd</span> ~/pigsty/app/postgrest <span style="color:#000;font-weight:bold">;</span> docker-compose up -d
</span></span></code></pre></div><p>http://10.10.10.10:8884 is the default endpoint for PostgREST</p>
<p>http://10.10.10.10:8883 is the default api docs for PostgREST</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>make up         <span style="color:#8f5902;font-style:italic"># pull up postgrest with docker-compose</span>
</span></span><span style="display:flex;"><span>make run        <span style="color:#8f5902;font-style:italic"># launch postgrest with docker</span>
</span></span><span style="display:flex;"><span>make ui         <span style="color:#8f5902;font-style:italic"># run swagger ui container</span>
</span></span><span style="display:flex;"><span>make view       <span style="color:#8f5902;font-style:italic"># print postgrest access point</span>
</span></span><span style="display:flex;"><span>make log        <span style="color:#8f5902;font-style:italic"># tail -f postgrest logs</span>
</span></span><span style="display:flex;"><span>make info       <span style="color:#8f5902;font-style:italic"># introspect postgrest with jq</span>
</span></span><span style="display:flex;"><span>make stop       <span style="color:#8f5902;font-style:italic"># stop postgrest container</span>
</span></span><span style="display:flex;"><span>make clean      <span style="color:#8f5902;font-style:italic"># remove postgrest container</span>
</span></span><span style="display:flex;"><span>make rmui       <span style="color:#8f5902;font-style:italic"># remove swagger ui container</span>
</span></span><span style="display:flex;"><span>make pull       <span style="color:#8f5902;font-style:italic"># pull latest postgrest image</span>
</span></span><span style="display:flex;"><span>make rmi        <span style="color:#8f5902;font-style:italic"># remove postgrest image</span>
</span></span><span style="display:flex;"><span>make save       <span style="color:#8f5902;font-style:italic"># save postgrest image to /tmp/postgrest.tgz</span>
</span></span><span style="display:flex;"><span>make load       <span style="color:#8f5902;font-style:italic"># load postgrest image from /tmp</span>
</span></span></code></pre></div><h2 id="swagger-ui">Swagger UI</h2>
<p>Launch a swagger OpenAPI UI and visualize PostgREST API on 8883 with:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>docker run --init --name postgrest --name swagger -p 8883:8080 -e <span style="color:#000">API_URL</span><span style="color:#ce5c00;font-weight:bold">=</span>http://10.10.10.10:8884 swaggerapi/swagger-ui
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># docker run -d -e API_URL=http://10.10.10.10:8884 -p 8883:8080 swaggerapi/swagger-editor # swagger editor</span>
</span></span></code></pre></div><p>Check <a href="http://10.10.10.10:8883/">http://10.10.10.10:8883/</a></p>

</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-9ec15a0d01cd5abc36fd6af1f45a0595">11 - SchemaSPY：PG模式可视化</h1>
    <div class="lead">使用 SchemaSPY 镜像解析 PostgreSQL 数据库模式，生成可视化报表</div>
	<p>使用以下<code>docker</code>生成数据库模式报表，以CMDB为例：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>docker run -v /www/schema/pg-meta/meta/pigsty:/output andrewjones/schemaspy-postgres:latest -host 10.10.10.10 -port <span style="color:#0000cf;font-weight:bold">5432</span> -u dbuser_dba -p DBUser.DBA -db meta -s pigsty
</span></span></code></pre></div><p>然后访问 <a href="http://h.pigsty/schema/pg-meta/meta/pigsty">http://h.pigsty/schema/pg-meta/meta/pigsty</a> 即可访问Schema报表</p>

</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-04017d0d30f9f51be2b31a34c8bdf117">12 - PGWeb：从浏览器访问PostgreSQL</h1>
    <div class="lead">使用Docker拉起PGWEB，以便从浏览器进行小批量在线数据查询</div>
	<h2 id="pgweb客户端工具">PGWeb客户端工具</h2>
<p><a href="https://github.com/sosedoff/pgweb">PGWeb</a>是一款基于浏览器的PG客户端工具，使用以下命令，在元节点上拉起PGWEB服务，默认为主机<code>8886</code>端口。可使用域名： <a href="http://cli.pigsty">http://cli.pigsty</a> 访问，公开Demo：http://cli.pigsty.cc。</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># docker stop pgweb; docker rm pgweb</span>
</span></span><span style="display:flex;"><span>docker run --init --name pgweb --restart always --detach --publish 8886:8081 sosedoff/pgweb
</span></span></code></pre></div><p>用户需要自行填写数据库连接串，例如默认CMDB的连接串：</p>
<p><code>postgres://dbuser_dba:DBUser.DBA@10.10.10.10:5432/meta?sslmode=disable</code></p>
<p>公开Demo地址：<a href="http://cli.pigsty.cc">http://cli.pigsty.cc</a></p>
<p><img src="/img/docs/app/pgweb.jpeg"></p>
<p>使用Docker Compose拉起PGWEB容器：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#204a87">cd</span> ~/pigsty/app/pgweb <span style="color:#000;font-weight:bold">;</span> docker-compose up -d
</span></span></code></pre></div><p>接下来，访问您本机的 8886 端口，即可看到 PGWEB 的UI界面： http://10.10.10.10:8886</p>
<p>您可以尝试使用下面的URL连接串，通过 PGWEB 连接至数据库实例并进行探索。</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>postgres://dbuser_meta:DBUser.Meta@10.10.10.10:5432/meta?sslmode<span style="color:#ce5c00;font-weight:bold">=</span>disable
</span></span><span style="display:flex;"><span>postgres://test:test@10.10.10.11:5432/test?sslmode<span style="color:#ce5c00;font-weight:bold">=</span>disable
</span></span></code></pre></div><h2 id="快捷方式">快捷方式</h2>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>make up         <span style="color:#8f5902;font-style:italic"># pull up pgweb with docker-compose</span>
</span></span><span style="display:flex;"><span>make run        <span style="color:#8f5902;font-style:italic"># launch pgweb with docker</span>
</span></span><span style="display:flex;"><span>make view       <span style="color:#8f5902;font-style:italic"># print pgweb access point</span>
</span></span><span style="display:flex;"><span>make log        <span style="color:#8f5902;font-style:italic"># tail -f pgweb logs</span>
</span></span><span style="display:flex;"><span>make info       <span style="color:#8f5902;font-style:italic"># introspect pgweb with jq</span>
</span></span><span style="display:flex;"><span>make stop       <span style="color:#8f5902;font-style:italic"># stop pgweb container</span>
</span></span><span style="display:flex;"><span>make clean      <span style="color:#8f5902;font-style:italic"># remove pgweb container</span>
</span></span><span style="display:flex;"><span>make pull       <span style="color:#8f5902;font-style:italic"># pull latest pgweb image</span>
</span></span><span style="display:flex;"><span>make rmi        <span style="color:#8f5902;font-style:italic"># remove pgweb image</span>
</span></span><span style="display:flex;"><span>make save       <span style="color:#8f5902;font-style:italic"># save pgweb image to /tmp/pgweb.tgz</span>
</span></span><span style="display:flex;"><span>make load       <span style="color:#8f5902;font-style:italic"># load pgweb image from /tmp</span>
</span></span></code></pre></div>
</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-57ab357de3ec0981b36e0aeb8ae7d50b">13 - Discourse：开源技术论坛</h1>
    <div class="lead">如何搭建开源的论坛软件 Discourse，并使用 Pigsty 管理的 PG 作为后端数据库存储？</div>
	<p>搭建开源论坛Discourse，需要调整配置 <code>app.yml</code> ，重点是SMTP部分的配置</p>
<details><summary>Discourse配置样例</summary>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">templates</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span>- <span style="color:#4e9a06">&#34;templates/web.china.template.yml&#34;</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span>- <span style="color:#4e9a06">&#34;templates/postgres.template.yml&#34;</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span>- <span style="color:#4e9a06">&#34;templates/redis.template.yml&#34;</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span>- <span style="color:#4e9a06">&#34;templates/web.template.yml&#34;</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span>- <span style="color:#4e9a06">&#34;templates/web.ratelimited.template.yml&#34;</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#8f5902;font-style:italic">## Uncomment these two lines if you wish to add Lets Encrypt (https)</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#8f5902;font-style:italic"># - &#34;templates/web.ssl.template.yml&#34;</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#8f5902;font-style:italic"># - &#34;templates/web.letsencrypt.ssl.template.yml&#34;</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:bold">expose</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span>- <span style="color:#4e9a06">&#34;80:80&#34;</span><span style="color:#f8f8f8;text-decoration:underline">   </span><span style="color:#8f5902;font-style:italic"># http</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span>- <span style="color:#4e9a06">&#34;443:443&#34;</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#8f5902;font-style:italic"># https</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:bold">params</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">db_default_text_search_config</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;pg_catalog.english&#34;</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">db_shared_buffers</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;768MB&#34;</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:bold">env</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">LC_ALL</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">en_US.UTF-8</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">LANG</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">en_US.UTF-8</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">LANGUAGE</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">en_US.UTF-8</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">EMBER_CLI_PROD_ASSETS</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#0000cf;font-weight:bold">1</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">UNICORN_WORKERS</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#0000cf;font-weight:bold">4</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">DISCOURSE_HOSTNAME</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">forum.pigsty</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">DISCOURSE_DEVELOPER_EMAILS</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#39;fengruohang@outlook.com,rh@vonng.com&#39;</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">DISCOURSE_SMTP_ENABLE_START_TLS</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">false</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">DISCOURSE_SMTP_AUTHENTICATION</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">login</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">DISCOURSE_SMTP_OPENSSL_VERIFY_MODE</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">none</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">DISCOURSE_SMTP_ADDRESS</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">smtpdm.server.address</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">DISCOURSE_SMTP_PORT</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#0000cf;font-weight:bold">80</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">DISCOURSE_SMTP_USER_NAME</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">no_reply@mail.pigsty.cc</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">DISCOURSE_SMTP_PASSWORD</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;&lt;password&gt;&#34;</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">DISCOURSE_SMTP_DOMAIN</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">mail.pigsty.cc</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:bold">volumes</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span>- <span style="color:#204a87;font-weight:bold">volume</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">host</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">/var/discourse/shared/standalone</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">guest</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">/shared</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span>- <span style="color:#204a87;font-weight:bold">volume</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">host</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">/var/discourse/shared/standalone/log/var-log</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">guest</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">/var/log</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:bold">hooks</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">after_code</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span>- <span style="color:#204a87;font-weight:bold">exec</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">        </span><span style="color:#204a87;font-weight:bold">cd</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">$home/plugins</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">        </span><span style="color:#204a87;font-weight:bold">cmd</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">          </span>- <span style="color:#000">git clone https://github.com/discourse/docker_manager.git</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:bold">run</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span>- <span style="color:#204a87;font-weight:bold">exec</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">echo &#34;Beginning of custom commands&#34;</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#8f5902;font-style:italic"># - exec: rails r &#34;SiteSetting.notification_email=&#39;no_reply@mail.pigsty.cc&#39;&#34;</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span>- <span style="color:#204a87;font-weight:bold">exec</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">echo &#34;End of custom commands&#34;</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span></code></pre></div></details>
<p>然后，执行以下命令，拉起Discourse即可。</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#000;font-weight:bold">.</span><span style="color:#ce5c00;font-weight:bold">/</span><span style="color:#000">launcher</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">rebuild</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">app</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span></code></pre></div>
</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-1040742b787f34bbaa39a7a8145b00c4">14 - GitLab：企业级开源代码托管平台</h1>
    <div class="lead">如何自建企业级开源代码托管平台 GitLab，并使用 Pigsty 管理的 PG 作为后端数据库存储？</div>
	<ul>
<li><a href="https://about.gitlab.com/install/">安装自主管理的 GitLab</a></li>
</ul>
<h2 id="样例开源代码仓库gitlab">样例：开源代码仓库：Gitlab</h2>
<p>请参考<a href="https://docs.gitlab.com/ee/install/docker.html">Gitlab Docker部署文档</a> 完成Docker部署。</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#204a87">export</span> <span style="color:#000">GITLAB_HOME</span><span style="color:#ce5c00;font-weight:bold">=</span>/data/gitlab
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>sudo docker run --detach <span style="color:#4e9a06">\
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06"></span>  --hostname gitlab.example.com <span style="color:#4e9a06">\
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06"></span>  --publish 443:443 --publish 80:80 --publish 23:22 <span style="color:#4e9a06">\
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06"></span>  --name gitlab <span style="color:#4e9a06">\
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06"></span>  --restart always <span style="color:#4e9a06">\
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06"></span>  --volume <span style="color:#000">$GITLAB_HOME</span>/config:/etc/gitlab <span style="color:#4e9a06">\
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06"></span>  --volume <span style="color:#000">$GITLAB_HOME</span>/logs:/var/log/gitlab <span style="color:#4e9a06">\
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06"></span>  --volume <span style="color:#000">$GITLAB_HOME</span>/data:/var/opt/gitlab <span style="color:#4e9a06">\
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06"></span>  --shm-size 256m <span style="color:#4e9a06">\
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06"></span>  gitlab/gitlab-ee:latest
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>sudo docker <span style="color:#204a87">exec</span> -it gitlab grep <span style="color:#4e9a06">&#39;Password:&#39;</span> /etc/gitlab/initial_root_password
</span></span></code></pre></div>
</div>



    
	
  



          </main>
        </div>
      </div>
      <footer class="td-footer row d-print-none">
  <div class="container-fluid">
    <div class="row mx-md-2">
      <div class="td-footer__left col-6 col-sm-4 order-sm-1">
        <ul class="td-footer__links-list">
  
  <li class="td-footer__links-item" data-bs-toggle="tooltip" title="Mail" aria-label="Mail">
    <a target="_blank" rel="noopener" href="mailto:rh@vonng.com" aria-label="Mail">
      <i class="fa fa-envelope"></i>
    </a>
  </li>
  
  <li class="td-footer__links-item" data-bs-toggle="tooltip" title="GitHub" aria-label="GitHub">
    <a target="_blank" rel="noopener" href="https://github.com/Vonng/pigsty" aria-label="GitHub">
      <i class="fab fa-github"></i>
    </a>
  </li>
  
  <li class="td-footer__links-item" data-bs-toggle="tooltip" title="Twitter" aria-label="Twitter">
    <a target="_blank" rel="noopener" href="https://twitter.com/GobeUncleWang" aria-label="Twitter">
      <i class="fab fa-twitter"></i>
    </a>
  </li>
  
</ul>

      </div><div class="td-footer__right col-6 col-sm-4 order-sm-3">
        <ul class="td-footer__links-list">
  
  <li class="td-footer__links-item" data-bs-toggle="tooltip" title="WeChat" aria-label="WeChat">
    <a target="_blank" rel="noopener" href="/img/pigsty/pigsty-cc.jpg" aria-label="WeChat">
      <i class="fa fa-comment"></i>
    </a>
  </li>
  
  <li class="td-footer__links-item" data-bs-toggle="tooltip" title="Discord" aria-label="Discord">
    <a target="_blank" rel="noopener" href="https://discord.gg/wDzt5VyWEz" aria-label="Discord">
      <i class="fab fa-discord"></i>
    </a>
  </li>
  
  <li class="td-footer__links-item" data-bs-toggle="tooltip" title="Telegram" aria-label="Telegram">
    <a target="_blank" rel="noopener" href="https://t.me/joinchat/gV9zfZraNPM3YjFh" aria-label="Telegram">
      <i class="fab fa-telegram"></i>
    </a>
  </li>
  
</ul>

      </div><div class="td-footer__center col-12 col-sm-4 py-2 order-sm-2">
        <span class="td-footer__copyright">&copy;
    2018&ndash;2025
    <span class="td-footer__authors">Ruohang Feng</span></span><span class="td-footer__all_rights_reserved">All Rights Reserved</span></span><span class="ms-2"><a href="https://vonng.com/en/" target="_blank" rel="noopener">@Vonng</a></span>
<br><span>Pigsty® distributed under <a href="/docs/about/license" target="_blank" rel="noopener">AGPLv3</a></span>
<br><span class="ms-2"><a href="/docs/about/privacy" target="_blank" rel="noopener">Privacy Policy</a></span>
<span><a href="http://beian.miit.gov.cn/" target="_blank" rel="noopener">浙ICP备15016890号</a></span>
      </div>
    </div>
  </div>
</footer>

    </div>
    <script src="/js/main.min.248655eb216150e39da254c2f7aa5357805d0ec66bdb741b591cd35fb5f629ab.js" integrity="sha256-JIZV6yFhUOOdolTC96pTV4BdDsZr23QbWRzTX7X2Kas=" crossorigin="anonymous"></script>
<script defer src="/js/click-to-copy.min.f724d3de49218995223b7316aa2e53e2b34bf42026bf399ebb21bb02212402d1.js" integrity="sha256-9yTT3kkhiZUiO3MWqi5T4rNL9CAmvzmeuyG7AiEkAtE=" crossorigin="anonymous"></script>
<script src='/js/tabpane-persist.js'></script>

  </body>
</html>
