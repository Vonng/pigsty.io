<!doctype html>
<html itemscope itemtype="http://schema.org/WebPage" lang="zh" class="no-js">
  <head>
    <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link rel="canonical" type="text/html" href="/zh/docs/pgext/usage/">
<link rel="alternate" type="application/rss&#43;xml" href="/zh/docs/pgext/usage/index.xml">
<meta name="robots" content="noindex, nofollow">


<link rel="shortcut icon" href="/favicons/favicon.ico" >
<link rel="apple-touch-icon" href="/favicons/apple-touch-icon-180x180.png" sizes="180x180">
<link rel="icon" type="image/png" href="/favicons/favicon-16x16.png" sizes="16x16">
<link rel="icon" type="image/png" href="/favicons/favicon-32x32.png" sizes="32x32">
<link rel="icon" type="image/png" href="/favicons/android-36x36.png" sizes="36x36">
<link rel="icon" type="image/png" href="/favicons/android-48x48.png" sizes="48x48">
<link rel="icon" type="image/png" href="/favicons/android-72x72.png" sizes="72x72">
<link rel="icon" type="image/png" href="/favicons/android-96x96.png" sizes="96x96">
<link rel="icon" type="image/png" href="/favicons/android-144x144.png" sizes="144x144">
<link rel="icon" type="image/png" href="/favicons/android-192x192.png" sizes="192x192">

<title>安装使用 | Pigsty</title>
<meta name="description" content="如何在 Pigsty 中安装，启用，更新，卸载 PostgreSQL 扩展插件，使用 Pigsty 插件仓库。">
<meta property="og:title" content="安装使用" />
<meta property="og:description" content="如何在 Pigsty 中安装，启用，更新，卸载 PostgreSQL 扩展插件，使用 Pigsty 插件仓库。" />
<meta property="og:type" content="website" />
<meta property="og:url" content="/zh/docs/pgext/usage/" />

<meta itemprop="name" content="安装使用">
<meta itemprop="description" content="如何在 Pigsty 中安装，启用，更新，卸载 PostgreSQL 扩展插件，使用 Pigsty 插件仓库。"><meta name="twitter:card" content="summary"/><meta name="twitter:title" content="安装使用"/>
<meta name="twitter:description" content="如何在 Pigsty 中安装，启用，更新，卸载 PostgreSQL 扩展插件，使用 Pigsty 插件仓库。"/>




<link rel="preload" href="/scss/main.min.194607c777ee31a481a26dfc3d1c65134dfc8eb296a0aae9d353b3bd5be6a683.css" as="style">
<link href="/scss/main.min.194607c777ee31a481a26dfc3d1c65134dfc8eb296a0aae9d353b3bd5be6a683.css" rel="stylesheet" integrity="">

<script
  src="/js/jquery-3.6.3.min.js"
  integrity="sha512-STof4xm1wgkfm7heWqFJVn58Hm3EtS31XFaagaa8VMReCXAkQnJZ+jEy8PCC/iT18dFy95WcExNHFTqLyp72eQ=="
  crossorigin="anonymous"></script>
<script defer
  src="/js/lunr.min.js"
  integrity="sha384-203J0SNzyqHby3iU6hzvzltrWi/M41wOP5Gu+BiJMz5nwKykbkUx8Kp7iti0Lpli"
  crossorigin="anonymous"></script>
<script async src="https://www.googletagmanager.com/gtag/js?id=G-LG1V9WTKGE"></script>
<script>
var doNotTrack = false;
if (!doNotTrack) {
	window.dataLayer = window.dataLayer || [];
	function gtag(){dataLayer.push(arguments);}
	gtag('js', new Date());
	gtag('config', 'G-LG1V9WTKGE');
}
</script>
  </head>
  <body class="td-section">
    <header>
      <nav class="td-navbar navbar-dark js-navbar-scroll">
<div class="container-fluid flex-column flex-md-row">
  <a class="navbar-brand" href="/zh/"><span class="navbar-brand__logo navbar-logo"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xl="http://www.w3.org/1999/xlink" xmlns:dc="http://purl.org/dc/elements/1.1/" viewBox="0 0 24 24" width="24" height="24"><defs/><g id="32" fill="none" stroke-dasharray="none" fill-opacity="1" stroke-opacity="1" stroke="none"><title>32</title><g id="32_图层_2"><title>图层 2</title><g id="Group_17"><g id="Graphic_16"/><g id="Graphic_15"><path d="M7.666187 11.971335l2.165064-3.75H14.16138l2.165065 3.75-2.165065 3.75H9.831251z" fill="#bbb" fill-opacity=".9526367"/><path d="M7.666187 11.971335l2.165064-3.75H14.16138l2.165065 3.75-2.165065 3.75H9.831251z" stroke="#fff" stroke-linecap="round" stroke-linejoin="round" stroke-width=".6730434"/></g><g id="Graphic_14"><path d="M7.666187 19.474806l2.165064-3.75H14.16138l2.165065 3.75-2.165065 3.75H9.831251z" fill="#de372c" fill-opacity=".8545852"/><path d="M7.666187 19.474806l2.165064-3.75H14.16138l2.165065 3.75-2.165065 3.75H9.831251z" stroke="#fff" stroke-linecap="round" stroke-linejoin="round" stroke-width=".6730434"/></g><g id="Graphic_13"><path d="M14.161476 15.751202l2.165064-3.75h4.33013l2.165064 3.75-2.165064 3.75H16.32654z" fill="#424242" fill-opacity=".9016462"/><path d="M14.161476 15.751202l2.165064-3.75h4.33013l2.165064 3.75-2.165064 3.75H16.32654z" stroke="#fff" stroke-linecap="round" stroke-linejoin="round" stroke-width=".6730434"/></g><g id="Graphic_12"><path d="M14.161476 8.226008 16.32654 4.4760076h4.33013L22.821734 8.226008l-2.165064 3.75H16.32654z" fill="#ffa269" fill-opacity=".8975772"/><path d="M14.161476 8.226008 16.32654 4.4760076h4.33013L22.821734 8.226008l-2.165064 3.75H16.32654z" stroke="#fff" stroke-linecap="round" stroke-linejoin="round" stroke-width=".6730434"/></g><g id="Graphic_11"><path d="M7.666187 4.5 9.831251.75H14.16138L16.326445 4.5 14.16138 8.25H9.831251z" fill="#419edb" fill-opacity=".8979957"/><path d="M7.666187 4.5 9.831251.75H14.16138L16.326445 4.5 14.16138 8.25H9.831251z" stroke="#fff" stroke-linecap="round" stroke-linejoin="round" stroke-width=".6730434"/></g><g id="Graphic_10"><path d="M1.1491742 8.226008 3.3142388 4.4760076H7.644368L9.809432 8.226008l-2.165064 3.75H3.3142388z" fill="#2f6793" fill-opacity=".9002511"/><path d="M1.1491742 8.226008 3.3142388 4.4760076H7.644368L9.809432 8.226008l-2.165064 3.75H3.3142388z" stroke="#fff" stroke-linecap="round" stroke-linejoin="round" stroke-width=".6730434"/></g><g id="Graphic_9"><path d="M1.182071 15.741036l2.1650645-3.75h4.330129l2.1650645 3.75-2.1650645 3.75H3.3471355z" fill="#53ac79" fill-opacity=".9"/><path d="M1.182071 15.741036l2.1650645-3.75h4.330129l2.1650645 3.75-2.1650645 3.75H3.3471355z" stroke="#fff" stroke-linecap="round" stroke-linejoin="round" stroke-width=".6730434"/></g></g></g></g></svg></span><span class="navbar-brand__name">Pigsty</span></a>
  <div class="td-navbar-nav-scroll ms-md-auto" id="main_navbar">
    <ul class="navbar-nav">
      <li class="nav-item">
        <a class="nav-link active" href="/zh/docs/"><i class='fa-solid fa-book'></i><span>文档</span></a>
      </li>
      <li class="nav-item">
        <a class="nav-link" href="/zh/blog/"><i class="fas fa-blog"></i><span>博客</span></a>
      </li>
      <li class="nav-item">
        <a class="nav-link" href="https://github.com/Vonng/pigsty/" target="_blank" rel="noopener"><i class='fab fa-github'></i><span>GitHub</span></a>
      </li>
      <li class="nav-item dropdown d-none d-lg-block">
        <div class="dropdown">
  <a class="nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
      <i class="fa-solid fa-language"></i>中文</a>
  <ul class="dropdown-menu">
    <li><a class="dropdown-item" href="/docs/pgext/usage/">English</a></li>
    </ul>
</div>
</li>
      </ul>
  </div>
  <div class="d-none d-lg-block">
    <div class="td-search td-search--offline">
  <div class="td-search__icon"></div>
  <input
    type="search"
    class="td-search__input form-control"
    placeholder="Search this site…"
    aria-label="Search this site…"
    autocomplete="off"
    
    data-offline-search-index-json-src="/offline-search-index.4125b29715bb03f7dec1973b107267cd.json"
    data-offline-search-base-href="/"
    data-offline-search-max-results="10"
  >
</div>
  </div>
</div>
</nav>
    </header>
    <div class="container-fluid td-outer">
      <div class="td-main">
        <div class="row flex-xl-nowrap">
          <main class="col-12 col-md-9 col-xl-8 ps-md-5" role="main">
            




<div class="td-content">
<div class="pageinfo pageinfo-primary d-print-none">
<p>
This is the multi-page printable view of this section.
<a href="#" onclick="print();return false;">Click here to print</a>.
</p><p>
<a href="/zh/docs/pgext/usage/">Return to the regular view of this page</a>.
</p>
</div>



<h1 class="title">安装使用</h1>
<div class="lead">如何在 Pigsty 中安装，启用，更新，卸载 PostgreSQL 扩展插件，使用 Pigsty 插件仓库。</div>




    <ul>
    
  
  
  
  

  
    
    
	
<li>1: <a href="#pg-e40ff1617ea9efefed35a854f611319f">快速上手</a></li>


    
  
    
    
	
<li>2: <a href="#pg-c433589c26820559447d608cbf714e1d">下载扩展</a></li>


    
  
    
    
	
<li>3: <a href="#pg-07b66e859c34f3782e2010cea8d3721e">扩展仓库</a></li>


    
  
    
    
	
<li>4: <a href="#pg-76461c68ca809aefb9616ca07b648d6c">安装扩展</a></li>


    
  
    
    
	
<li>5: <a href="#pg-c12d714b40237f738ff22c7b61498055">加载扩展</a></li>


    
  
    
    
	
<li>6: <a href="#pg-64ad4b73770d32d506c29117aae8e444">启用扩展</a></li>


    
  
    
    
	
<li>7: <a href="#pg-78965704f6925349ce2731a811ea1f57">更新扩展</a></li>


    
  
    
    
	
<li>8: <a href="#pg-5a92a7d28a5b010ba05ac12a6a7c7a4f">卸载扩展</a></li>


    
  
    
    
	
<li>9: <a href="#pg-c72b4718241a8b952d499a2e110ac0a6">预定义扩展栈</a></li>


    
  

    </ul>


<div class="content">
      
</div>
</div>


  
  
  
  

  
  

  
    
    
	
    

<div class="td-content" style="">
    
	<h1 id="pg-e40ff1617ea9efefed35a854f611319f">1 - 快速上手</h1>
    <div class="lead">如何在 Pigsty 中，通过开箱即用的方式安装并启用 PostgreSQL 扩展插件？</div>
	<p>Pigsty 让您可以直接在 <a href="/zh/docs/pgsql"><strong><code>PGSQL</code></strong></a> 集群中，通过声明式的方式启用 PostgreSQL 插件。</p>
<hr>
<h2 id="概览">概览</h2>
<p>通常想要在一套 PostgreSQL 集群中使用插件，涉及到 <a href="/zh/docs/pgext/usage/download/"><strong>下载</strong></a>、<a href="/zh/docs/pgext/usage/install/"><strong>安装</strong></a>、<a href="/zh/docs/pgext/usage/load/"><strong>加载</strong></a>、<a href="/zh/docs/pgext/usage/create/"><strong>启用</strong></a> 四个核心问题：</p>
<ul>
<li>
<p><a href="/zh/docs/pgext/usage/download/"><strong>怎样下载扩展</strong></a>：<a href="/zh/docs/reference/param#repo_upstream"><strong><code>repo_upstream</code></strong></a> &amp; <a href="/zh/docs/reference/param#repo_pacakges"><strong><code>repo_packages</code></strong></a></p>
<p>在 Pigsty 默认在线安装时，已经默认下载了当前首要PG大版本（16）可用的所有扩展，如果不需要添加额外或者冷门扩展，通常都不需要您操心 <code>repo_upstream</code> 与 <code>repo_packages</code> 以及扩展下载相关的问题。</p>
</li>
<li>
<p><a href="/zh/docs/pgext/usage/install/"><strong>安装哪些扩展</strong></a>：<a href="/zh/docs/reference/param#pg_extensions"><strong><code>pg_extensions</code></strong></a> &amp; <a href="/zh/docs/reference/param#pg_packages"><strong><code>pg_packages</code></strong></a></p>
<p>在 Pigsty 配置模板中的样例集群中，已经提供了完整可用的扩展清单，您只需要将想要 <strong>安装</strong> 的扩展，添加到 <code>pg_packages</code> 与 <code>pg_extensions</code> 中即可。</p>
</li>
<li>
<p><a href="/zh/docs/pgext/usage/load/"><strong>加载哪些扩展</strong></a>：<a href="/zh/docs/reference/param#pg_libs"><strong><code>pg_libs</code></strong></a></p>
<p>一小部分使用了 PostgreSQL HOOK 的扩展需要动态加载并重启数据库后才可以使用，您需要将这些扩展添加到 <code>pg_libs</code> 中，并在重启加载后生效。</p>
</li>
<li>
<p><a href="/zh/docs/pgext/usage/create/"><strong>启用哪些扩展</strong></a>：<a href="/zh/docs/pgsql/db"><strong><code>pg_databases.extensions</code></strong></a></p>
<p>绝大多数扩展在安装之后，都需要执行 <code>CREATE EXTENSION</code> DDL 语句，才会真实在具体的数据库中被创建并启用。您可以手工执行此 DDL，或者在 <code>pg_datbasese.extensions</code> 中显式指定，则数据库会在初始化的时候自动启用这些扩展。</p>
</li>
</ul>
<hr>
<h2 id="开箱即用">开箱即用</h2>
<p>Pigsty 为用户封装了扩展管理的复杂度，您不需要知道这些扩展的 RPM 包名，也不需要知道如何下载，安装，加载，启用这些扩展，只需要在配置文件中声明您需要的扩展即可。</p>
<p>例如，下面的配置文件片段声明了一个 PostgreSQL 集群，<a href="/zh/docs/pgext/usage/install/">安装</a> 了所有可用的扩展插件，动态 <a href="/zh/docs/pgext/usage/load/"><strong>加载</strong></a> 了三个扩展，并 <a href="/zh/docs/pgext/usage/create/"><strong>启用</strong></a> 了三个扩展。</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">pg-meta</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">hosts</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">10.10.10.10</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span>{<span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">pg_seq: 1, pg_role</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">primary }</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">vars</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">pg_cluster</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">pg-meta</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">pg_databases</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span>- <span style="color:#204a87;font-weight:bold">name</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">meta</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">        </span><span style="color:#204a87;font-weight:bold">extensions</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">          </span>- {<span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">name</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">postgis     }</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">          </span>- {<span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">name</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">timescaledb }</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">          </span>- {<span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">name</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">vector      }</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">pg_libs</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#39;timescaledb, pg_stat_statements, auto_explain&#39;</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">pg_extensions</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span>- <span style="color:#000">timescaledb periods temporal_tables emaj table_version pg_cron pg_later pg_background pg_timetable                        </span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#8f5902;font-style:italic">#[TIME]#</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span>- <span style="color:#000">postgis pgrouting pointcloud pg_h3 q3c ogr_fdw geoip                                                                       </span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#8f5902;font-style:italic">#[GIS]#</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span>- <span style="color:#000">pgvector pgvectorscale pg_vectorize pg_similarity pg_tiktoken pgml                                                         </span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#8f5902;font-style:italic">#[RAG]#</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span>- <span style="color:#000">pg_search pg_bigm zhparser hunspell                                                                                        </span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#8f5902;font-style:italic">#[FTS]#</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span>- <span style="color:#000">hydra pg_lakehouse duckdb_fdw pg_fkpart pg_partman plproxy #citus pg_strom                                                </span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#8f5902;font-style:italic">#[OLAP]#</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span>- <span style="color:#000">age hll rum pg_graphql pg_jsonschema jsquery pg_hint_plan hypopg imgsmlr pg_ivm pgmq pgq                                  </span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#8f5902;font-style:italic">#[FEAT]#</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span>- <span style="color:#000">pg_tle plv8 pllua plprql pldebugger plpgsql_check plprofiler plsh pljava #plr faker pgtap                                 </span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#8f5902;font-style:italic">#[LANG]#</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span>- <span style="color:#000">prefix semver pgmp pguint pgunit roaringbitmap md5hash asn1oid numeral pg_rational ip4r pgsphere pgfaceting timestamp9     #[TYPE]# #[FUNC]# #[ADMIN]# #[STAT]#</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#8f5902;font-style:italic">#[SEC]#</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span>- <span style="color:#000">pg_gzip pg_http topn pg_net pgjwt shacrypt pgsql_tweaks pg_extra_time count_distinct extra_window_functions first_last_agg tdigest pgpcre icu_ext pg_idkit pg_hashids pg_uuidv7 permuteseq sequential_uuids</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span>- <span style="color:#000">pg_repack pg_squeeze pg_dirtyread pgfincore pgdd ddlx pg_prioritize pg_checksums pg_readonly safeupdate pg_permissions pg_auto_failover preprepare pg_catcheck</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span>- <span style="color:#000">pg_profile pg_show_plans pg_stat_kcache pg_stat_monitor pg_qualstats pg_store_plans pg_track_settings pg_wait_sampling system_stats bgw_replstatus pg_sqlog powa pgmeminfo toastinfo</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span>- <span style="color:#000">passwordcheck supautils pgsodium pg_vault anonymizer pg_tde pgsmcrypto pgaudit pgauditlogtofile pg_auth_mon credcheck pgcryptokey pg_jobmon logerrors login_hook set_user tablelog pg_snakeoil pgextwlist</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span>- <span style="color:#000">wrappers multicorn mongo_fdw mysql_fdw tds_fdw sqlite_fdw hdfs_fdw pgbouncer_fdw firebird_fdw #oracle_fdw db2_fdw          </span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#8f5902;font-style:italic">#[FDW]#</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span>- <span style="color:#000">mysqlcompat pgmemcache pgtt orafce pg_statement_rollback pg_dbms_lock pg_dbms_metadata #pg_dbms_job babelfish              </span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#8f5902;font-style:italic">#[SIM]#</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span>- <span style="color:#000">pglogical pgl_ddl_deploy decoderbufs wal2json wal2mongo pg_failover_slots mimeo pg_fact_loader pg_bulkload #repmgr slony   </span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#8f5902;font-style:italic">#[ETL]#</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span>- <span style="color:#000">gis-stack rag-stack fdw-stack fts-stack etl-stack feat-stack olap-stack supa-stack stat-stack json-stack                 </span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#8f5902;font-style:italic">#[STACK]#</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span></code></pre></div><p>您可能注意到这里的扩展名称既非 RPM / DEB 包名，而是由 Pigsty 封装简化过的 <strong>标准扩展名（Alias）</strong>。</p>
<p>在不同的操作系统发行版中，Pigsty 将标准扩展名翻译为对应 PG 大版本的 RPM / DEB 包名，这样您就无需关心不同操作系统发行版的扩展包名差异了。</p>
<ul>
<li><a href="https://github.com/Vonng/pigsty/blob/main/roles/node_id/vars/el8.yml"><strong>EL8 扩展列表</strong></a></li>
<li><a href="https://github.com/Vonng/pigsty/blob/main/roles/node_id/vars/el9.yml"><strong>EL9 扩展列表</strong></a></li>
<li><a href="https://github.com/Vonng/pigsty/blob/main/roles/node_id/vars/d12.yml"><strong>D12 扩展列表</strong></a></li>
<li><a href="https://github.com/Vonng/pigsty/blob/main/roles/node_id/vars/u22.yml"><strong>U22 扩展列表</strong></a></li>
<li><a href="https://github.com/Vonng/pigsty/blob/main/roles/node_id/vars/u24.yml"><strong>U24 扩展列表</strong></a></li>
</ul>
<p>在 Pigsty <a href="/zh/docs/setup/install#%E9%85%8D%E7%BD%AE"><code>configure</code></a> 过程中，针对特定操作系统发行版生成的默认配置里已经带有上述清单。
要安装这些扩展，您只需要根据自己的需求，在配置文件中将需要的扩展取消注释即可。</p>
<p>请注意，您依然可以在这里直接使用操作系统特定的 RPM/DEB 包名称。</p>
<hr>
<h2 id="预定义的扩展集合">预定义的扩展集合</h2>
<p>如果您不清楚应该安装哪些扩展，Pigsty 为您提供了一些预定义的扩展集合（Stack），您可以根据自己的需求场景，选择其中一个集合与任意组合，将其添加到 <code>pg_extensions</code> 中即可。</p>
<ul>
<li><code>gis-stack</code>: 地理空间扩展集合，包括：<code>postgis</code>, <code>pgrouting</code>, <code>pointcloud</code>, <code>h3</code>, <code>q3c</code>, <code>ogr_fdw</code></li>
<li><code>rag-stack</code>: 向量检索扩展集合，包括：<code>pgvector</code>, <code>pgvectorscale</code>, <code>pg_vectorize</code>, <code>pg_similarity</code>, <code>pg_tiktoken</code>, <code>pgml</code></li>
<li><code>fts-stack</code>: 全文检索扩展集合，包括：<code>pg_search</code>, <code>pg_bigm</code>, <code>zhparser</code>, <code>hunspell</code></li>
<li><code>fdw-stack</code>: 外部数据扩展集合，包括：<code>wrappers</code>, <code>mysql_fdw</code>, <code>tds_fdw</code>, <code>sqlite_fdw</code></li>
<li><code>etl-stack</code>: 数据ETL/CDC集合，包括：<code>pglogical</code>, <code>pgl_ddl_deploy</code>, <code>wal2json</code>, <code>wal2mongo</code>, <code>decoderbufs</code>, <code>pg_fact_loader</code>, <code>pg_bulkload</code>, <code>pgloader</code>, <code>pgcopydb</code></li>
<li><code>feat-stack</code>: 类型函数扩展集合，包括：<code>age</code>, <code>hll</code>, <code>rum</code>, <code>pg_graphql</code>, <code>pg_jsonschema</code>, <code>jsquery</code>, <code>pg_ivm</code>, <code>pgq3</code>, <code>gzip</code>, <code>http</code>, <code>topn</code>, <code>pgjwt</code></li>
<li><code>olap-stack</code>: 数据仓库OLAP集合，包括：<code>duckdb</code>, <code>duckdb_fdw</code>, <code>pg-lakehouse</code>, <code>hydra</code>, <code>timescaledb</code>, <code>pg-fkpart</code>, <code>pg-partman</code>, <code>plproxy</code></li>
<li><code>supa-stack</code>: Supabase扩展集合，包括：<code>pg-graphql</code>, <code>pg-jsonschema</code>, <code>wrappers</code>, <code>pgvector</code>, <code>cron</code>, <code>supautils</code>, <code>pgsodium</code>, <code>vault</code>, <code>pgjwt</code>, <code>http</code>, <code>pg-net</code></li>
<li><code>stat-stack</code>: 统计监控扩展集合，包括：<code>show-plans</code>, <code>pg-stat-kcache</code>, <code>pg-qualstats</code>, <code>pg-track-settings</code>, <code>pg-wait-sampling</code>, <code>pg-sqlog</code></li>
<li><code>json-stack</code>: JSON处理扩展集合，包括：<code>plv8</code>, <code>pg-jsonschema</code>, <code>pgjwt</code>, <code>jsquery</code>, <code>pg-graphql</code>, <code>ferretdb</code></li>
</ul>
<p>当您在 <code>pg_extensions</code> 或 <code>pg_packages</code> 中指定了这些扩展集合时，Pigsty 会自动翻译，展开并安装其中的所有扩展插件。</p>
<hr>
<h2 id="安装加载与启用">安装、加载与启用</h2>
<p>Pigsty 不仅允许您在配置文件中声明需要安装的扩展，还允许您在配置文件中直接声明需要加载的扩展，以及需要启用的扩展。</p>
<p>下面是一个具体的例子：<a href="https://supabase.com/"><strong>Supabase</strong></a>。
Supabase 是一个封装 PostgreSQL 作为底层存储的“上层抽象数据库”，它深度使用了 PostgreSQL 的扩展机制。
以下是使用 Pigsty 创建一套 Supabase 所需 PostgreSQL 集群的样例配置文件：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># supabase example cluster: pg-meta</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#8f5902;font-style:italic"># this cluster needs to be migrated with app/supabase/migration.sql :</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#8f5902;font-style:italic"># psql postgres://supabase_admin:DBUser.Supa@10.10.10.10:5432/supa -v ON_ERROR_STOP=1 --no-psqlrc -f ~pigsty/app/supabase/migration.sql</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:bold">pg-meta</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">hosts</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span>{<span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">10.10.10.10</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span>{<span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">pg_seq: 1, pg_role</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">primary } }</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">vars</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">pg_cluster</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">pg-meta</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">pg_users</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span>- {<span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">name: supabase_admin ,password: &#39;DBUser.Supa&#39; ,pgbouncer: true ,inherit: true   ,superuser: true ,replication: true ,createdb: true ,createrole: true ,bypassrls</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">true</span><span style="color:#f8f8f8;text-decoration:underline"> </span>}<span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">pg_databases</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span>- <span style="color:#204a87;font-weight:bold">name</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">supa</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">        </span><span style="color:#204a87;font-weight:bold">baseline: supa.sql    # the init-scripts</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">https://github.com/supabase/postgres/tree/develop/migrations/db/init-scripts</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">        </span><span style="color:#204a87;font-weight:bold">owner</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">supabase_admin</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">        </span><span style="color:#204a87;font-weight:bold">comment</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">supabase postgres database</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">        </span><span style="color:#204a87;font-weight:bold">schemas</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000;font-weight:bold">[</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">extensions ,auth ,realtime ,storage ,graphql_public ,supabase_functions ,_analytics ,_realtime ]</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">        </span><span style="color:#204a87;font-weight:bold">extensions</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">          </span>- {<span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">name: pgcrypto  ,schema: extensions  } # 1.3   </span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">cryptographic functions</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">          </span>- {<span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">name: pg_net    ,schema: extensions  } # 0.9.2 </span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">async HTTP</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">          </span>- {<span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">name: pgjwt     ,schema: extensions  } # 0.2.0 </span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">json web token API for postgres</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">          </span>- {<span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">name: uuid-ossp ,schema: extensions  } # 1.1   </span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">generate universally unique identifiers (UUIDs)</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">          </span>- {<span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">name: pgsodium        }                # 3.1.9 </span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">pgsodium is a modern cryptography library for Postgres.</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">          </span>- {<span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">name: supabase_vault  }                # 0.2.8 </span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">Supabase Vault Extension</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">          </span>- {<span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">name: pg_graphql      }                # 1.5.7 : pg_graphql</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">GraphQL support</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">          </span>- {<span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">name: pg_jsonschema   }                # 0.3.1 : pg_jsonschema</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">Validate json schema</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">          </span>- {<span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">name: wrappers        }                # 0.4.1 : wrappers</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">FDW collections</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">          </span>- {<span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">name: http            }                # 1.6   : http</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">allows web page retrieval inside the database.</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">          </span>- {<span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">name</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">pg_cron         }</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#8f5902;font-style:italic"># supabase required extensions</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">pg_libs</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#39;pg_net, pg_cron, pg_stat_statements, auto_explain&#39;</span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#8f5902;font-style:italic"># add pg_net to shared_preload_libraries</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">pg_extensions</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span>- <span style="color:#000">wal2json pg_repack</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span>- <span style="color:#000">supa-stack</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#8f5902;font-style:italic"># pgvector pg_cron pgsodium pg_graphql pg_jsonschema wrappers pgjwt pgsql_http pg_net supautils</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">pg_parameters</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">cron.database_name</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">supa</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">pgsodium.enable_event_trigger</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">off</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">pg_hba_rules</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#8f5902;font-style:italic"># supabase hba rules, require access from docker network</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span>- {<span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">user: all ,db: supa ,addr: intra       ,auth: pwd ,title</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#39;allow supa database access from intranet&#39;</span><span style="color:#f8f8f8;text-decoration:underline">      </span>}<span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span>- {<span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">user: all ,db: supa ,addr: 172.0.0.0/8 ,auth: pwd ,title</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#39;allow supa database access from docker network&#39;</span>}<span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span>- {<span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">user: all ,db: supa ,addr: all         ,auth: pwd ,title</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#39;allow supa database access from entire world&#39;</span><span style="color:#f8f8f8;text-decoration:underline">  </span>}<span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#8f5902;font-style:italic"># not safe!</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span></code></pre></div><p>在这里，我们声明了一个名为 <code>pg-meta</code> 的 PostgreSQL 集群，它包含了一个名为 <code>supa</code> 的数据库，以及一系列的扩展插件。</p>
<p>在 <code>pg_extensions</code> 中定义的 <code>supa-stack</code> 被翻译为 <code>pgvector pg_cron pgsodium pg_graphql pg_jsonschema wrappers pgjwt pgsql_http pg_net supautils</code>，并自动安装。
与此同时，<code>pg_libs</code> 指定了两个需要动态加载的扩展： <code>pg_net</code> 与 <code>pg_cron</code>；此外，<code>pgsodium</code> 与 <code>pg_cron</code> 扩展所必须的配置参数，也通过 <code>pg_parameters</code> 预先指定；
接下来，这些扩展在 <code>pg_databases.extensions</code> 中被依次创建到指定的/或默认的 Schema 中，正式启用。</p>
<p>最后，这样一个开箱即用，可以直接供无状态 Supabase 容器使用的高可用 PostgreSQL 集群，就能在一行 <code>./pgsql.yml</code> 命令中被完整拉起，开箱即用。</p>

</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-c433589c26820559447d608cbf714e1d">2 - 下载扩展</h1>
    <div class="lead">如何下载新的扩展插件，并将其添加至 Pigsty 中？</div>
	<p>在 Pigsty 默认安装模式中，扩展插件的下载与安装是分离的。在 <a href="/zh/docs/pgext/usage/install/"><strong>安装扩展</strong></a>前 ，您需要确保目标节点上已经添加了相应的软件源，否则安装过程会因为找不到软件包而失败。</p>
<p>Pigsty 在安装过程中会下载当前首要PG大版本（16）可用的所有扩展至 <strong>INFRA节点</strong> ，并构建一个 <strong>本地软件仓库</strong>，供包括本机在内的所有节点使用。
这样做可以加速安装，避免重复下载，减少网络流量消耗，提高交付可靠性性，并解决重复安装版本不一致的风险。</p>
<p>您也可以选择使用另一种方式：直接在 Pigsty 纳管的目标节点上添加上游 PostgreSQL 软件仓库及其依赖仓库（操作系统软件源）。
然后直接从互联网上游进行安装，这样做可以方便地将插件更新至最新版本，但要求环境有互联网访问或 HTTP 代理，同时可能会受网络条件影响，并有潜在的安装版本不一致风险。</p>
<hr>
<h2 id="软件仓库">软件仓库</h2>
<p>在首次安装过程中，Pigsty 会从 <a href="/zh/docs/reference/param#repo_upstream"><strong><code>repo_upstream</code></strong></a> 指定的上游软件仓库中下载 <a href="/zh/docs/reference/param#repo_pacakges"><strong><code>repo_packages</code></strong></a> 指定的软件包。
EL 系统与 Debian/Ubuntu 系统的软件包名称有所不同，完整列表请参考以下地址：</p>
<ul>
<li><a href="https://github.com/Vonng/pigsty/blob/main/roles/node_id/vars/el8.yml"><strong>EL8 扩展列表</strong></a></li>
<li><a href="https://github.com/Vonng/pigsty/blob/main/roles/node_id/vars/el9.yml"><strong>EL9 扩展列表</strong></a></li>
<li><a href="https://github.com/Vonng/pigsty/blob/main/roles/node_id/vars/d12.yml"><strong>D12 扩展列表</strong></a></li>
<li><a href="https://github.com/Vonng/pigsty/blob/main/roles/node_id/vars/u22.yml"><strong>U22 扩展列表</strong></a></li>
<li><a href="https://github.com/Vonng/pigsty/blob/main/roles/node_id/vars/u24.yml"><strong>U24 扩展列表</strong></a></li>
</ul>
<p>极个别插件因为各种原因被排除在外，默认没有下载。如果您需要使用这些扩展，请参考扩展列表里的 RPM / DEB 包名，将其加入到 <a href="/zh/docs/reference/param#repo_upstream"><strong><code>repo_upstream</code></strong></a> 中后下载。</p>
<ul>
<li>依赖过重：<code>pljava</code>, <code>plr</code></li>
<li>生态位重叠：<code>repmgr</code>, <code>pgexporterext</code>, <code>pgpool</code></li>
<li>EL9 独占：<code>pljava</code>, <code>sequential_uuids</code>, <code>firebird_fdw</code></li>
</ul>
<hr>
<h2 id="下载扩展">下载扩展</h2>
<p>要想下载新的扩展插件，您可以将其添加至 <a href="/zh/docs/reference/param#repo_upstream"><strong><code>repo_upstream</code></strong></a> 中，并执行以下任务更新本地软件仓库，并刷新所有节点的软件源缓存：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>./infra.yml -t repo       <span style="color:#8f5902;font-style:italic"># 重新下载指定的软件包至本地软件仓库</span>
</span></span><span style="display:flex;"><span>./node.yml  -t node_repo  <span style="color:#8f5902;font-style:italic"># 刷新所有节点的本地软件仓库元数据缓存 </span>
</span></span></code></pre></div><p>Pigsty 默认使用位于 <strong>INFRA节点</strong> 上的本地软件源，如果您不想将这些扩展下载至本地软件源，而是直接使用在线软件仓库进行安装，那么可以直接将上游软件源添加到节点上：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#000">./node.yml -t node_repo -e node_repo_modules=node,pgsql </span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#8f5902;font-style:italic"># 添加 Postgres 插件仓库与操作系统软件源（依赖）</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span></code></pre></div><p>完成这些任务后，您就可以通过标准操作系统包管理器（yum/apt）的方式，安装 PostgreSQL 扩展插件了。</p>

</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-07b66e859c34f3782e2010cea8d3721e">3 - 扩展仓库</h1>
    <div class="lead">如何在 EL/Debian/Ubuntu 及其兼容操作系统上，使用 Pigsty 提供的补充插件仓库？</div>
	<hr>
<h2 id="yum仓库">YUM仓库</h2>
<p>Pigsty 目前针对 EL 系统提供了补充插件仓库，在官方 PGDG YUM 仓库的基础上提供了 <strong>65</strong> 个额外的 RPM 插件。</p>
<ul>
<li>Pigsty YUM 仓库: <a href="https://repo.pigsty.io/yum/">https://repo.pigsty.io/yum/</a></li>
<li>PGDG YUM 仓库: <a href="https://download.postgresql.org/pub/repos/yum/">https://download.postgresql.org/pub/repos/yum/</a></li>
</ul>
<p>Pigsty Yum 仓库只收录那些 <strong>不存在于 PGDG Yum 仓库的扩展</strong>，一旦某个扩展进入 PGDG YUM 仓库，Pigsty Yum 仓库将移除此扩展或与 PGDG 仓库保持一致。</p>
<p>对于 EL 7/8/9 及其兼容系统，使用以下命令依次添加 Pigsty 仓库的 GPG 公钥与上游仓库文件：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>curl -fsSL https://repo.pigsty.io/key      <span style="color:#000;font-weight:bold">|</span> sudo tee /etc/pki/rpm-gpg/RPM-GPG-KEY-pigsty &gt;/dev/null  <span style="color:#8f5902;font-style:italic"># 添加公钥</span>
</span></span><span style="display:flex;"><span>curl -fsSL https://repo.pigsty.io/yum/repo <span style="color:#000;font-weight:bold">|</span> sudo tee /etc/yum.repos.d/pigsty.repo        &gt;/dev/null  <span style="color:#8f5902;font-style:italic"># 添加仓库</span>
</span></span></code></pre></div><p>中国大陆地区的用户，可以使用国内 CDN 镜像 YUM 仓库：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>curl -fsSL https://repo.pigsty.cc/key      <span style="color:#000;font-weight:bold">|</span> sudo tee /etc/pki/rpm-gpg/RPM-GPG-KEY-pigsty &gt;/dev/null  <span style="color:#8f5902;font-style:italic"># 添加公钥</span>
</span></span><span style="display:flex;"><span>curl -fsSL https://repo.pigsty.cc/yum/repo <span style="color:#000;font-weight:bold">|</span> sudo tee /etc/yum.repos.d/pigsty.repo        &gt;/dev/null  <span style="color:#8f5902;font-style:italic"># 添加仓库</span>
</span></span></code></pre></div><p>所有的 RPM 包都使用指纹为 <code>9592A7BC7A682E7333376E09E7935D8DB9BD8B20</code> (<code>B9BD8B20</code>) 的 GPG 密钥进行签名。</p>
<details><summary>手工写入Repo文件</summary><br>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>sudo tee /etc/yum.repos.d/pigsty-io.repo &gt; /dev/null <span style="color:#4e9a06">&lt;&lt;-&#39;EOF&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">[pigsty-infra]
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">name=Pigsty Infra for $basearch
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">baseurl=https://repo.pigsty.io/yum/infra/$basearch
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">skip_if_unavailable = 1
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">enabled = 1
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">priority = 1
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">gpgcheck = 1
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-pigsty
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">module_hotfixes=1
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">[pigsty-pgsql]
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">name=Pigsty PGSQL For el$releasever.$basearch
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">baseurl=https://repo.pigsty.io/yum/pgsql/el$releasever.$basearch
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">skip_if_unavailable = 1
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">enabled = 1
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">priority = 1
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">gpgcheck = 1
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-pigsty
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">module_hotfixes=1
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">EOF</span>
</span></span><span style="display:flex;"><span>sudo yum makecache<span style="color:#000;font-weight:bold">;</span>
</span></span></code></pre></div></details>
<hr>
<h2 id="apt仓库">APT仓库</h2>
<p>Pigsty 目前针对 Debian / Ubuntu 系统提供了补充插件仓库，在官方 PGDG YUM 仓库的基础上提供了 <strong>77</strong> 个额外的 DEB 插件包。</p>
<ul>
<li>Pigsty APT 仓库: <a href="https://repo.pigsty.io/apt/">https://repo.pigsty.io/apt/</a></li>
<li>PGDG APT 仓库: <a href="http://apt.postgresql.org/pub/repos/apt/">http://apt.postgresql.org/pub/repos/apt/</a></li>
</ul>
<p>Pigsty APT 仓库只收录那些 <strong>不存在于 PGDG ATP 仓库的扩展</strong>：一旦某个扩展进入 PGDG APT 仓库，Pigsty APT 仓库将移除此扩展或与 PGDG 仓库保持一致。</p>
<p>对于 Debian / Ubuntu 及其兼容系统，使用以下命令依次添加 Pigsty 仓库的 GPG 公钥与上游仓库文件：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># 将 pigsty 的 gpg 公钥添加到你的系统钥匙链中，从而验证软件包签名</span>
</span></span><span style="display:flex;"><span>curl -fsSL https://repo.pigsty.io/key <span style="color:#000;font-weight:bold">|</span> sudo gpg --dearmor -o /etc/apt/keyrings/pigsty.gpg      <span style="color:#8f5902;font-style:italic"># 添加公钥</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># 获取 Debian 发行版代号，distro_codename=jammy, focal, bullseye, bookworm，并将对应上游仓库地址写入 APT List 文件</span>
</span></span><span style="display:flex;"><span><span style="color:#000">distro_codename</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#204a87;font-weight:bold">$(</span>lsb_release -cs<span style="color:#204a87;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>sudo tee /etc/apt/sources.list.d/pigsty-io.list &gt; /dev/null <span style="color:#4e9a06">&lt;&lt;EOF
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">deb [signed-by=/etc/apt/keyrings/pigsty.gpg] https://repo.pigsty.io/apt/infra generic main 
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">deb [signed-by=/etc/apt/keyrings/pigsty.gpg] https://repo.pigsty.io/apt/pgsql ${distro_codename} main
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">EOF</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># 刷新 APT 仓库缓存</span>
</span></span><span style="display:flex;"><span>sudo apt update
</span></span></code></pre></div><p>中国大陆地区的用户，可以使用国内 CDN 镜像 APT 仓库：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># 将 pigsty 的 gpg 公钥添加到你的系统钥匙链中，从而验证软件包签名</span>
</span></span><span style="display:flex;"><span>curl -fsSL https://repo.pigsty.cc/key <span style="color:#000;font-weight:bold">|</span> sudo gpg --dearmor -o /etc/apt/keyrings/pigsty.gpg      <span style="color:#8f5902;font-style:italic"># 添加公钥</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># 获取 Debian 发行版代号，distro_codename=jammy, focal, bullseye, bookworm，并将对应上游仓库地址写入 APT List 文件</span>
</span></span><span style="display:flex;"><span><span style="color:#000">distro_codename</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#204a87;font-weight:bold">$(</span>lsb_release -cs<span style="color:#204a87;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>sudo tee /etc/apt/sources.list.d/pigsty-io.list &gt; /dev/null <span style="color:#4e9a06">&lt;&lt;EOF
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">deb [signed-by=/etc/apt/keyrings/pigsty.gpg] https://repo.pigsty.cc/apt/infra generic main 
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">deb [signed-by=/etc/apt/keyrings/pigsty.gpg] https://repo.pigsty.cc/apt/pgsql/${distro_codename} ${distro_codename} main
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">EOF</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># 刷新 APT 仓库缓存</span>
</span></span><span style="display:flex;"><span>sudo apt update
</span></span></code></pre></div><p>所有的 DEB 包都使用指纹为 <code>9592A7BC7A682E7333376E09E7935D8DB9BD8B20</code> (<code>B9BD8B20</code>) 的 GPG 密钥进行签名。</p>
<hr>
<h2 id="扩展安装">扩展安装</h2>
<p>Pigsty 目前针对 EL 系统提供了补充插件仓库，在官方 PGDG YUM 仓库的基础上提供了 <strong>65</strong> 个额外的 RPM 插件。</p>
<ul>
<li>Pigsty YUM 仓库: <a href="https://repo.pigsty.io/yum/">https://repo.pigsty.io/yum/</a></li>
<li>PGDG YUM 仓库: <a href="https://download.postgresql.org/pub/repos/yum/">https://download.postgresql.org/pub/repos/yum/</a></li>
</ul>
<p>Pigsty Yum 仓库只收录那些 <strong>不存在于 PGDG Yum 仓库的扩展</strong>，一旦某个扩展进入 PGDG YUM 仓库，Pigsty Yum 仓库将移除此扩展或与 PGDG 仓库保持一致。</p>

</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-76461c68ca809aefb9616ca07b648d6c">4 - 安装扩展</h1>
    <div class="lead">如何从 Pigsty 本地软件源，或直接从上游互联网软件源安装 PostgreSQL 扩展插件？</div>
	<p>Pigsty 使用操作系统标准的包管理器（yum/apt）来安装 PostgreSQL 扩展插件。</p>
<hr>
<h2 id="扩展安装相关参数">扩展安装相关参数</h2>
<p>您可以在以下变量中指定要安装哪些扩展，两者的效果基本相同：</p>
<ul>
<li><a href="/zh/docs/reference/param#pg_packages"><strong><code>pg_packages</code></strong></a></li>
<li><a href="/zh/docs/reference/param#pg_extensions"><strong><code>pg_extensions</code></strong></a></li>
</ul>
<p>通常 <code>pg_packages</code> 用于在全局指定整个环境中所有 PostgreSQL 集群都需要统一安装的软件包：
例如 PostgreSQL 内核，高可用组建 Patroni，连接池 pgBouncer，监控 pgExporter 等。
Pigsty 默认也会在这里指定安装两个必选扩展： <code>pg_repack</code> 和 <code>wal2json</code> 用于膨胀治理和 CDC 变更抽取。</p>
<p>而 <code>pg_extensions</code> 则通常用于在特定集群中，指定本集群需要安装的扩展插件。
Pigsty 默认安装三个PG生态的重要扩展：<code>postgis</code>, <code>timescaledb</code>, <code>pgvector</code>，您可以在这里指定需要安装的其他扩展插件。</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">pg_packages</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">                      </span><span style="color:#8f5902;font-style:italic"># pg packages to be installed, alias can be used</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span>- <span style="color:#000">postgresql</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span>- <span style="color:#000">patroni pgbouncer pgbackrest pg_exporter pgbadger vip-manager wal2json pg_repack</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:bold">pg_extensions</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">                    </span><span style="color:#8f5902;font-style:italic"># pg extensions to be installed, alias can be used</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span>- <span style="color:#000">postgis timescaledb pgvector</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span></code></pre></div><p>另一个重要区别是：<code>pg_packages</code> 安装的软件包只确保存在，而 <code>pg_extensions</code> 安装的软件包会默认升级到最新可用版本。
当使用本地软件源时，这并不是一个问题。当您直接使用互联网上游软件源时，请充分考虑这一点，并将不希望升级的扩展插件转移到 <code>pg_packages</code> 中。</p>
<p>在 PGSQL 集群初始化时，Pigsty 会自动安装 <code>pg_packages</code> 和 <code>pg_extensions</code> 中指定的扩展插件。</p>
<hr>
<h2 id="在已有集群上安装扩展">在已有集群上安装扩展</h2>
<p>对于一个已经完成置备初始化的 PostgreSQL 集群，您可以首先将所需的扩展添加至 <code>pg_packages</code> 或 <code>pg_extensions</code> 中，然后通过以下命令安装扩展：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>./pgsql.yml -t pg_extension  <span style="color:#8f5902;font-style:italic"># 安装 pg_extensions 中指定的扩展插件</span>
</span></span></code></pre></div><hr>
<h2 id="扩展名翻译机制">扩展名翻译机制</h2>
<p>在 Pigsty 中，您可以在 <code>pg_packages</code> 和 <code>pg_extensions</code> 中使用：</p>
<ul>
<li>原始的操作系统包名</li>
<li>标准扩展名（Alias）</li>
</ul>
<p>例如：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>postgis                    <span style="color:#8f5902;font-style:italic"># 安装当前 PG 大版本对应的 PostGIS 包</span>
</span></span><span style="display:flex;"><span>postgis34_<span style="color:#000">$v</span>*              <span style="color:#8f5902;font-style:italic"># 安装当前 PG 大版本对应的 PostGIS RPM 包</span>
</span></span><span style="display:flex;"><span>postgis34_15*              <span style="color:#8f5902;font-style:italic"># 安装 PG 15 大版本对应的 PostGIS RPM 包</span>
</span></span><span style="display:flex;"><span>postgresql-<span style="color:#000">$v</span>-postgis-3*   <span style="color:#8f5902;font-style:italic"># 安装当前 PG 大版本对应的 PostGIS DEB 包</span>
</span></span><span style="display:flex;"><span>postgresql-14-postgis-3*   <span style="color:#8f5902;font-style:italic"># 安装 PG 14 大版本对应的 PostGIS DEB 包</span>
</span></span></code></pre></div><p>我们建议使用 Pigsty 提供的标准化扩展名（Alias），在不同的操作系统发行版中，Pigsty 将标准扩展名翻译为对应 PG 大版本的 RPM / DEB 包名，这样用户可以无需关心不同操作系统发行版的扩展包名差异：</p>
<ul>
<li><a href="https://github.com/Vonng/pigsty/blob/main/roles/node_id/vars/el8.yml"><strong>EL8 扩展列表</strong></a></li>
<li><a href="https://github.com/Vonng/pigsty/blob/main/roles/node_id/vars/el9.yml"><strong>EL9 扩展列表</strong></a></li>
<li><a href="https://github.com/Vonng/pigsty/blob/main/roles/node_id/vars/d12.yml"><strong>D12 扩展列表</strong></a></li>
<li><a href="https://github.com/Vonng/pigsty/blob/main/roles/node_id/vars/u22.yml"><strong>U22 扩展列表</strong></a></li>
<li><a href="https://github.com/Vonng/pigsty/blob/main/roles/node_id/vars/u24.yml"><strong>U24 扩展列表</strong></a></li>
</ul>
<p>Pigsty 尽最大努力对齐 EL 操作系统与 Debian 操作系统生态的 PostgreSQL 扩展，但仍有少量扩展因为各种原因难以/尚未移植，
请参考 <a href="/zh/docs/pgext/list/rpm">RPM扩展列表</a> 与 <a href="/zh/docs/pgext/list/deb">DEB扩展列表</a> 了解更多信息。</p>

</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-c12d714b40237f738ff22c7b61498055">5 - 加载扩展</h1>
    <div class="lead">使用了 HOOK 的扩展插件需要显式加载，并重启数据库服务器生效。</div>
	<p>安装 PostgreSQL 扩展后，您便可以在 PostgreSQL 的 <code>pg_available_extensions</code> 视图中看到它们。</p>
<p>除了纯 SQL 编写的扩展外，绝大多数扩展都会提供一个 <code>.so</code> 文件，这是一个动态连接库文件。</p>
<p>大部分扩展并不需要显式加载，只需要通过 <code>CREATE EXTENSION</code> 启用即可。
但一小部分扩展使用 PostgreSQL 的 Hook 机制，这些扩展必须通过 <code>shared_preload_libraries</code> 参数预先加载，并重启 PostgreSQL 后才能生效。
如果您在未加载/重启生效的情况下直接执行 <code>CREATE EXTENSION</code> 会报错。</p>
<p>在 Pigsty 中，您可以在集群的 <a href="/zh/docs/reference/param#pg_libs"><code>pg_libs</code></a> 参数中预先指定集群需要加载的扩展，或者在集群初始化后 <a href="/zh/docs/pgsql/admin#%E9%85%8D%E7%BD%AE%E9%9B%86%E7%BE%A4"><strong>修改集群配置</strong></a>。</p>
<hr>
<h2 id="需要加载的扩展">需要加载的扩展</h2>
<p>在 <a href="/zh/docs/pgext/list">扩展列表</a> 中，带有 <code>LOAD</code> 标记的扩展，即为需要动态加载并重启的扩展，包括：</p>
<table>
<thead>
<tr>
<th style="text-align:left">扩展名</th>
<th style="text-align:left">标准名</th>
<th style="text-align:left">说明</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left"><a href="https://github.com/timescale/timescaledb"><code>timescaledb</code></a></td>
<td style="text-align:left"><a href="/zh/docs/pgext/time/timescaledb">timescaledb</a></td>
<td style="text-align:left">时序数据库扩展插件</td>
</tr>
<tr>
<td style="text-align:left"><a href="https://github.com/postgresml/postgresml"><code>pgml</code></a></td>
<td style="text-align:left"><a href="/zh/docs/pgext/rag/pgml">pgml</a></td>
<td style="text-align:left">PostgresML：用SQL运行机器学习算法并训练模型</td>
</tr>
<tr>
<td style="text-align:left"><a href="https://github.com/citusdata/citus"><code>citus</code></a></td>
<td style="text-align:left"><a href="/zh/docs/pgext/olap/citus">citus</a></td>
<td style="text-align:left">Citus 分布式数据库</td>
</tr>
<tr>
<td style="text-align:left"><a href="https://github.com/cybertec-postgresql/pg_squeeze"><code>pg_squeeze</code></a></td>
<td style="text-align:left"><a href="/zh/docs/pgext/admin/pg_squeeze">pg_squeeze</a></td>
<td style="text-align:left">从关系中删除未使用空间</td>
</tr>
<tr>
<td style="text-align:left"><a href="https://github.com/hapostgres/pg_auto_failover"><code>pgautofailover</code></a></td>
<td style="text-align:left"><a href="/zh/docs/pgext/admin/pgautofailover">pgautofailover</a></td>
<td style="text-align:left">PG 自动故障迁移</td>
</tr>
<tr>
<td style="text-align:left"><a href="https://www.postgresql.org/docs/current/pgprewarm.html"><code>pg_prewarm</code></a></td>
<td style="text-align:left"><a href="/zh/docs/pgext/admin/pg_prewarm">pg_prewarm</a></td>
<td style="text-align:left">预热关系数据</td>
</tr>
<tr>
<td style="text-align:left"><a href="https://github.com/powa-team/pg_stat_kcache"><code>pg_stat_kcache</code></a></td>
<td style="text-align:left"><a href="/zh/docs/pgext/stat/pg_stat_kcache">pg_stat_kcache</a></td>
<td style="text-align:left">内核统计信息收集</td>
</tr>
<tr>
<td style="text-align:left"><a href="https://github.com/mhagander/bgw_replstatus"><code>bgw_replstatus</code></a></td>
<td style="text-align:left"><a href="/zh/docs/pgext/stat/bgw_replstatus">bgw_replstatus</a></td>
<td style="text-align:left">用于汇报本机主从状态的后台工作进程</td>
</tr>
<tr>
<td style="text-align:left"><a href="https://www.postgresql.org/docs/current/auto-explain.html"><code>auto_explain</code></a></td>
<td style="text-align:left"><a href="/zh/docs/pgext/stat/auto_explain">auto_explain</a></td>
<td style="text-align:left">提供一种自动记录执行计划的手段</td>
</tr>
<tr>
<td style="text-align:left"><a href="https://www.postgresql.org/docs/current/pgstatstatements.html"><code>pg_stat_statements</code></a></td>
<td style="text-align:left"><a href="/zh/docs/pgext/stat/pg_stat_statements">pg_stat_statements</a></td>
<td style="text-align:left">跟踪所有执行的 SQL 语句的计划和执行统计信息</td>
</tr>
<tr>
<td style="text-align:left"><a href="https://github.com/devrimgunduz/passwordcheck_cracklib"><code>passwordcheck_cracklib</code></a></td>
<td style="text-align:left"><a href="/zh/docs/pgext/sec/passwordcheck">passwordcheck</a></td>
<td style="text-align:left">使用cracklib加固PG用户密码</td>
</tr>
<tr>
<td style="text-align:left"><a href="https://github.com/supabase/supautils"><code>supautils</code></a></td>
<td style="text-align:left"><a href="/zh/docs/pgext/sec/supautils">supautils</a></td>
<td style="text-align:left">用于在云环境中确保数据库集群的安全</td>
</tr>
<tr>
<td style="text-align:left"><a href="https://github.com/Percona-Lab/pg_tde"><code>pg_tde</code></a></td>
<td style="text-align:left"><a href="/zh/docs/pgext/sec/pg_tde">pg_tde</a></td>
<td style="text-align:left">试点性质的加密存储引擎</td>
</tr>
<tr>
<td style="text-align:left"><a href="https://github.com/pgaudit/pgaudit"><code>pgaudit</code></a></td>
<td style="text-align:left"><a href="/zh/docs/pgext/sec/pgaudit">pgaudit</a></td>
<td style="text-align:left">提供审计功能</td>
</tr>
<tr>
<td style="text-align:left"><a href="https://github.com/credativ/pg_snakeoil"><code>pg_snakeoil</code></a></td>
<td style="text-align:left"><a href="/zh/docs/pgext/sec/pg_snakeoil">pg_snakeoil</a></td>
<td style="text-align:left">PostgreSQL动态链接库反病毒功能</td>
</tr>
<tr>
<td style="text-align:left"><a href="https://github.com/dimitri/pgextwlist"><code>pgextwlist</code></a></td>
<td style="text-align:left"><a href="/zh/docs/pgext/sec/pgextwlist">pgextwlist</a></td>
<td style="text-align:left">PostgreSQL扩展白名单功能</td>
</tr>
<tr>
<td style="text-align:left"><a href="https://www.postgresql.org/docs/current/sepgsql.html"><code>sepgsql</code></a></td>
<td style="text-align:left"><a href="/zh/docs/pgext/sec/sepgsql">sepgsql</a></td>
<td style="text-align:left">基于SELinux标签的强制访问控制</td>
</tr>
<tr>
<td style="text-align:left"><a href="https://www.postgresql.org/docs/current/auth-delay.html"><code>auth_delay</code></a></td>
<td style="text-align:left"><a href="/zh/docs/pgext/sec/auth_delay">auth_delay</a></td>
<td style="text-align:left">在返回认证失败前暂停一会，避免爆破</td>
</tr>
<tr>
<td style="text-align:left"><a href="https://www.postgresql.org/docs/current/passwordcheck.html"><code>passwordcheck</code></a></td>
<td style="text-align:left"><a href="/zh/docs/pgext/sec/passwordcheck">passwordcheck</a></td>
<td style="text-align:left">用于强制拒绝修改弱密码的扩展</td>
</tr>
<tr>
<td style="text-align:left"><a href="https://github.com/lzlabs/pg_statement_rollback"><code>pg_statement_rollback</code></a></td>
<td style="text-align:left"><a href="/zh/docs/pgext/sim/pg_statement_rollback">pg_statement_rollback</a></td>
<td style="text-align:left">在服务端提供类似Oracle/DB2的语句级回滚能力</td>
</tr>
<tr>
<td style="text-align:left"><a href="https://babelfishpg.org/"><code>babelfishpg_tsql</code></a></td>
<td style="text-align:left"><a href="/zh/docs/pgext/sim/babelfishpg_tsql">babelfishpg_tsql</a></td>
<td style="text-align:left">SQL Server SQL语法兼容性扩展</td>
</tr>
</tbody>
</table>
<hr>
<h2 id="加载顺序">加载顺序</h2>
<p>在 <code>shared_preload_libraries</code> 中，如果有多个扩展插件需要加载，可以使用逗号分隔，例如：</p>
<ul>
<li><code>'timescaledb, pg_stat_statements, auto_explain'</code></li>
</ul>
<p>请注意，Citus 和 TimescaleDB 这两个扩展显式提出要求，要在 <code>shared_preload_libraries</code> 中预先加载，也就是放在最前面。</p>
<p>虽然同时使用 Citus 与 TimescaleDB 的情况非常罕见，但在这种情况中，建议将 <code>citus</code> 放在 <code>timescaledb</code> 之前。</p>
<p>Pigsty 默认会加载两个扩展：<code>pg_stat_statements</code> 与 <code>auto_explain</code>，这两个扩展对于优化数据库性能非常实用，强烈建议安装。</p>

</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-64ad4b73770d32d506c29117aae8e444">6 - 启用扩展</h1>
    <div class="lead">如何通过 <code>CREATE EXTENSION</code> 在 PostgreSQL 数据库中真正启用扩展？</div>
	<hr>
<h2 id="列出可用扩展">列出可用扩展</h2>
<p>安装 PostgreSQL 扩展后，您可以在 PostgreSQL 的 <code>pg_available_extensions</code> 视图中看到它们。但想要实际启用扩展，通常还需要额外的步骤：</p>
<ol>
<li>一部分扩展要求被添加到 <code>shared_preload_libraries</code> 中动态加载，例如 <code>timescaledb</code>，<code>citus</code> 等。</li>
<li>大部分扩展都需要通过 SQL 语句：<code>CREATE EXTENSION &lt;name&gt;;</code> 启用，极少量扩展不需要，例如 <code>wal2json</code>。</li>
</ol>
<ul>
<li>修改 <code>shared_preload_libraries</code>：
<ul>
<li>在数据库集群初始化前，可以通过 <a href="/zh/docs/reference/param#pg_libs"><code>pg_libs</code></a> 参数手工预先指定；</li>
<li>当数据库已经初始化完毕后，您可以修改<a href="/zh/docs/pgsql/admin#%E9%85%8D%E7%BD%AE%E9%9B%86%E7%BE%A4">集群配置</a>，直接修改 <code>shared_preload_libraries</code> 参数并应用（无需重启）。</li>
<li>需要动态加载的典型插件：<code>citus</code>, <code>timescaledb</code>, <code>pg_cron</code>, <code>pg_net</code>, <code>pg_tle</code></li>
</ul>
</li>
<li>执行 <code>CREATE EXTENSION</code>：
<ul>
<li>在数据库集群初始化前，可以在 <a href="/zh/docs/reference/param#pg_databases"><code>pg_databases</code></a>.<code>extensions</code> 列表中指定。</li>
<li>当数据库已经初始化完毕后，您可以直接连接数据库执行此 SQL 命令，或使用其他模式变更工具管理扩展。</li>
</ul>
</li>
</ul>
<blockquote>
<p>从原理上讲：PostgreSQL 的扩展通常由 Control文件（元数据，一定存在），SQL文件（SQL语句，可选），So文件（二进制动态连接库，可选）三部分组成。
提供 <code>.so</code> 文件的扩展有可能需要添加到 <code>shared_preload_libraries</code> 才能生效，例如 <code>citus</code> 与 <code>timescaledb</code>，但也有许多扩展不用，例如 <code>postgis</code>，<code>pgvector</code>。
不通过 SQL 接口对外服务的扩展不需要执行 <code>CREATE EXTENSION</code>，例如提供 CDC 抽取能力的 <code>wal2json</code> 扩展。</p>
</blockquote>
<p>在您希望启用扩展的数据库中执行 <code>CREATE EXTENSION</code> SQL 语句，即可完成扩展的创建：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">CREATE</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">EXTENSION</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">vector</span><span style="color:#000;font-weight:bold">;</span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#8f5902;font-style:italic">-- 安装向量数据库扩展
</span></span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"></span><span style="color:#204a87;font-weight:bold">CREATE</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">EXTENSION</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">hydra</span><span style="color:#000;font-weight:bold">;</span><span style="color:#f8f8f8;text-decoration:underline">   </span><span style="color:#8f5902;font-style:italic">-- 安装列存数据库扩展
</span></span></span></code></pre></div>
</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-78965704f6925349ce2731a811ea1f57">7 - 更新扩展</h1>
    <div class="lead">如何从安全地集群中移除扩展插件？</div>
	
</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-5a92a7d28a5b010ba05ac12a6a7c7a4f">8 - 卸载扩展</h1>
    <div class="lead">如何从安全地集群中移除扩展插件？</div>
	<p>要卸载某个扩展，通常需要执行以下步骤：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">DROP</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">EXTENSION</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;&lt;extname&gt;&#34;</span><span style="color:#000;font-weight:bold">;</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span></code></pre></div><p>请注意，如果有其他扩展，或者使用此扩展的数据库对象依赖，您需要首先卸载/删除这些依赖，然后再卸载此扩展；</p>
<p>或者，也可以使用以下语句一次性强制卸载扩展及其依赖：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">DROP</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">EXTENSION</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;&lt;extname&gt;&#34;</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">CASCADE</span><span style="color:#000;font-weight:bold">;</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span></code></pre></div><blockquote>
<p>注意：<code>CASCADE</code> 选项会删除依赖于此扩展的所有对象，包括数据库对象、函数、视图等，慎用！</p>
</blockquote>
<p>如果您希望移除扩展的软件包，可以操作系统的包管理器进行卸载：</p>

</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-c72b4718241a8b952d499a2e110ac0a6">9 - 预定义扩展栈</h1>
    <div class="lead">如何使用预定义的扩展堆栈，一次性安装特定场景下推荐的所有扩展插件？</div>
	
</div>



    
	
  



          </main>
        </div>
      </div>
      <footer class="td-footer row d-print-none">
  <div class="container-fluid">
    <div class="row mx-md-2">
      <div class="td-footer__left col-6 col-sm-4 order-sm-1">
        <ul class="td-footer__links-list">
  
  <li class="td-footer__links-item" data-bs-toggle="tooltip" title="Mail" aria-label="Mail">
    <a target="_blank" rel="noopener" href="mailto:rh@vonng.com" aria-label="Mail">
      <i class="fa fa-envelope"></i>
    </a>
  </li>
  
  <li class="td-footer__links-item" data-bs-toggle="tooltip" title="GitHub" aria-label="GitHub">
    <a target="_blank" rel="noopener" href="https://github.com/Vonng/pigsty" aria-label="GitHub">
      <i class="fab fa-github"></i>
    </a>
  </li>
  
  <li class="td-footer__links-item" data-bs-toggle="tooltip" title="Twitter" aria-label="Twitter">
    <a target="_blank" rel="noopener" href="https://twitter.com/GobeUncleWang" aria-label="Twitter">
      <i class="fab fa-twitter"></i>
    </a>
  </li>
  
</ul>

      </div><div class="td-footer__right col-6 col-sm-4 order-sm-3">
        <ul class="td-footer__links-list">
  
  <li class="td-footer__links-item" data-bs-toggle="tooltip" title="WeChat" aria-label="WeChat">
    <a target="_blank" rel="noopener" href="/img/pigsty/pigsty-cc.jpg" aria-label="WeChat">
      <i class="fa fa-comment"></i>
    </a>
  </li>
  
  <li class="td-footer__links-item" data-bs-toggle="tooltip" title="Discord" aria-label="Discord">
    <a target="_blank" rel="noopener" href="https://discord.gg/wDzt5VyWEz" aria-label="Discord">
      <i class="fab fa-discord"></i>
    </a>
  </li>
  
  <li class="td-footer__links-item" data-bs-toggle="tooltip" title="Telegram" aria-label="Telegram">
    <a target="_blank" rel="noopener" href="https://t.me/joinchat/gV9zfZraNPM3YjFh" aria-label="Telegram">
      <i class="fab fa-telegram"></i>
    </a>
  </li>
  
</ul>

      </div><div class="td-footer__center col-12 col-sm-4 py-2 order-sm-2">
        <span class="td-footer__copyright">&copy;
    2018&ndash;2024
    <span class="td-footer__authors">Ruohang Feng</span></span><span class="td-footer__all_rights_reserved">All Rights Reserved</span></span><span class="ms-2"><a href="https://vonng.com/en/" target="_blank" rel="noopener">@Vonng</a></span>
<br><span>Pigsty® distributed under <a href="/docs/about/license" target="_blank" rel="noopener">AGPLv3</a></span>
<br><span class="ms-2"><a href="/docs/about/privacy" target="_blank" rel="noopener">Privacy Policy</a></span>
<span><a href="http://beian.miit.gov.cn/" target="_blank" rel="noopener">浙ICP备15016890号</a></span>
      </div>
    </div>
  </div>
</footer>

    </div>
    <script src="/js/main.min.248655eb216150e39da254c2f7aa5357805d0ec66bdb741b591cd35fb5f629ab.js" integrity="sha256-JIZV6yFhUOOdolTC96pTV4BdDsZr23QbWRzTX7X2Kas=" crossorigin="anonymous"></script>
<script defer src="/js/click-to-copy.min.f724d3de49218995223b7316aa2e53e2b34bf42026bf399ebb21bb02212402d1.js" integrity="sha256-9yTT3kkhiZUiO3MWqi5T4rNL9CAmvzmeuyG7AiEkAtE=" crossorigin="anonymous"></script>
<script src='/js/tabpane-persist.js'></script>

  </body>
</html>
