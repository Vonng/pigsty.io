<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
    <title>Pigsty â€“ Go</title>
    <link>/zh/tags/go/</link>
    <description>Recent content in Go on Pigsty</description>
    <generator>Hugo -- gohugo.io</generator>
    <language>zh</language>
    <lastBuildDate>Thu, 24 Aug 2017 00:00:00 +0000</lastBuildDate>
    
	  <atom:link href="/zh/tags/go/index.xml" rel="self" type="application/rss+xml" />
    
    
      
        
      
    
    
    <item>
      <title>Blog: Goæ•°æ®åº“æ•™ç¨‹ï¼šdatabase/sql</title>
      <link>/zh/blog/pg/pg-go-driver/</link>
      <pubDate>Thu, 24 Aug 2017 00:00:00 +0000</pubDate>
      
      <guid>/zh/blog/pg/pg-go-driver/</guid>
      <description>
        
        
        &lt;p&gt;Goä½¿ç”¨SQLä¸ç±»SQLæ•°æ®åº“çš„æƒ¯ä¾‹æ˜¯é€šè¿‡æ ‡å‡†åº“&lt;a href=&#34;http://golang.org/pkg/database/sql/&#34;&gt;database/sql&lt;/a&gt;ã€‚è¿™æ˜¯ä¸€ä¸ªå¯¹å…³ç³»å‹æ•°æ®åº“çš„é€šç”¨æŠ½è±¡ï¼Œå®ƒæä¾›äº†æ ‡å‡†çš„ã€è½»é‡çš„ã€é¢å‘è¡Œçš„æ¥å£ã€‚ä¸è¿‡&lt;code&gt;database/sql&lt;/code&gt;çš„åŒ…æ–‡æ¡£åªè®²å®ƒåšäº†ä»€ä¹ˆï¼Œå´å¯¹å¦‚ä½•ä½¿ç”¨åªå­—æœªæã€‚å¿«é€ŸæŒ‡å—è¿œæ¯”å †ç Œäº‹å®æœ‰ç”¨ï¼Œæœ¬æ–‡è®²è¿°äº†&lt;code&gt;database/sql&lt;/code&gt;çš„ä½¿ç”¨æ–¹æ³•åŠå…¶æ³¨æ„äº‹é¡¹ã€‚&lt;/p&gt;
&lt;h2 id=&#34;1-é¡¶å±‚æŠ½è±¡&#34;&gt;1. é¡¶å±‚æŠ½è±¡&lt;/h2&gt;
&lt;p&gt;åœ¨Goä¸­è®¿é—®æ•°æ®åº“éœ€è¦ç”¨åˆ°&lt;code&gt;sql.DB&lt;/code&gt;æ¥å£ï¼šå®ƒå¯ä»¥åˆ›å»ºè¯­å¥(statement)å’Œäº‹åŠ¡(transaction)ï¼Œæ‰§è¡ŒæŸ¥è¯¢ï¼Œè·å–ç»“æœã€‚&lt;/p&gt;
&lt;p&gt;&lt;code&gt;sql.DB&lt;/code&gt;å¹¶ä¸æ˜¯æ•°æ®åº“è¿æ¥ï¼Œä¹Ÿå¹¶æœªåœ¨æ¦‚å¿µä¸Šæ˜ å°„åˆ°ç‰¹å®šçš„æ•°æ®åº“(Database)æˆ–æ¨¡å¼(schema)ã€‚å®ƒåªæ˜¯ä¸€ä¸ªæŠ½è±¡çš„æ¥å£ï¼Œä¸åŒçš„å…·ä½“é©±åŠ¨æœ‰ç€ä¸åŒçš„å®ç°æ–¹å¼ã€‚é€šå¸¸è€Œè¨€ï¼Œ&lt;code&gt;sql.DB&lt;/code&gt;ä¼šå¤„ç†ä¸€äº›é‡è¦è€Œéº»çƒ¦çš„äº‹æƒ…ï¼Œä¾‹å¦‚æ“ä½œå…·ä½“çš„é©±åŠ¨æ‰“å¼€/å…³é—­å®é™…åº•å±‚æ•°æ®åº“çš„è¿æ¥ï¼ŒæŒ‰éœ€ç®¡ç†è¿æ¥æ± ã€‚&lt;/p&gt;
&lt;p&gt;&lt;code&gt;sql.DB&lt;/code&gt;è¿™ä¸€æŠ½è±¡è®©ç”¨æˆ·ä¸å¿…è€ƒè™‘å¦‚ä½•ç®¡ç†å¹¶å‘è®¿é—®åº•å±‚æ•°æ®åº“çš„é—®é¢˜ã€‚å½“ä¸€ä¸ªè¿æ¥åœ¨æ‰§è¡Œä»»åŠ¡æ—¶ä¼šè¢«æ ‡è®°ä¸ºæ­£åœ¨ä½¿ç”¨ã€‚ç”¨å®Œä¹‹åä¼šæ”¾å›è¿æ¥æ± ä¸­ã€‚ä¸è¿‡ç”¨æˆ·å¦‚æœç”¨å®Œè¿æ¥åå¿˜è®°é‡Šæ”¾ï¼Œå°±ä¼šäº§ç”Ÿå¤§é‡çš„è¿æ¥ï¼Œæå¯èƒ½å¯¼è‡´èµ„æºè€—å°½ï¼ˆå»ºç«‹å¤ªå¤šè¿æ¥ï¼Œæ‰“å¼€å¤ªå¤šæ–‡ä»¶ï¼Œç¼ºå°‘å¯ç”¨ç½‘ç»œç«¯å£ï¼‰ã€‚&lt;/p&gt;
&lt;h2 id=&#34;2-å¯¼å…¥é©±åŠ¨&#34;&gt;2. å¯¼å…¥é©±åŠ¨&lt;/h2&gt;
&lt;p&gt;ä½¿ç”¨æ•°æ®åº“æ—¶ï¼Œé™¤äº†&lt;code&gt;database/sql&lt;/code&gt;åŒ…æœ¬èº«ï¼Œè¿˜éœ€è¦å¼•å…¥æƒ³ä½¿ç”¨çš„ç‰¹å®šæ•°æ®åº“é©±åŠ¨ã€‚&lt;/p&gt;
&lt;p&gt;å°½ç®¡æœ‰æ—¶å€™ä¸€äº›æ•°æ®åº“ç‰¹æœ‰çš„åŠŸèƒ½å¿…éœ€é€šè¿‡é©±åŠ¨çš„Ad Hocæ¥å£æ¥å®ç°ï¼Œä½†é€šå¸¸åªè¦æœ‰å¯èƒ½ï¼Œè¿˜æ˜¯åº”å½“å°½é‡åªç”¨&lt;code&gt;database/sql&lt;/code&gt;ä¸­å®šä¹‰çš„ç±»å‹ã€‚è¿™å¯ä»¥å‡å°ç”¨æˆ·ä»£ç ä¸é©±åŠ¨çš„è€¦åˆï¼Œä½¿åˆ‡æ¢é©±åŠ¨æ—¶ä»£ç æ”¹åŠ¨æœ€å°åŒ–ï¼Œä¹Ÿå°½å¯èƒ½åœ°ä½¿ç”¨æˆ·éµå¾ªGoçš„æƒ¯ç”¨æ³•ã€‚æœ¬æ–‡ä½¿ç”¨PostgreSQLä¸ºä¾‹ï¼ŒPostgreSQLçš„è‘—åçš„é©±åŠ¨æœ‰ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://github.com/lib/pq&#34;&gt;&lt;code&gt;github.com/lib/pq&lt;/code&gt;&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://github.com/go-pg/pg&#34;&gt;&lt;code&gt;github.com/go-pg/pg&lt;/code&gt;&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://github.com/jackc/pgx&#34;&gt;&lt;code&gt;github.com/jackc/pgx&lt;/code&gt;&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;è¿™é‡Œä»¥&lt;code&gt;pgx&lt;/code&gt;ä¸ºä¾‹ï¼Œå®ƒæ€§èƒ½è¡¨ç°ä¸ä¿—ï¼Œå¹¶å¯¹PostgreSQLè¯¸å¤šç‰¹æ€§ä¸ç±»å‹æœ‰ç€è‰¯å¥½çš„æ”¯æŒã€‚æ—¢å¯ä½¿ç”¨Ad-Hoc APIï¼Œä¹Ÿæä¾›äº†æ ‡å‡†æ•°æ®åº“æ¥å£çš„å®ç°ï¼š&lt;code&gt;github.com/jackc/pgx/stdlib&lt;/code&gt;ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#204a87;font-weight:bold&#34;&gt;import&lt;/span&gt; &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;(&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#4e9a06&#34;&gt;&amp;#34;database/sql&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#000&#34;&gt;_&lt;/span&gt; &lt;span style=&#34;color:#4e9a06&#34;&gt;&amp;#34;github.com/jackx/pgx/stdlib&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ä½¿ç”¨&lt;code&gt;_&lt;/code&gt;åˆ«åæ¥åŒ¿åå¯¼å…¥é©±åŠ¨ï¼Œé©±åŠ¨çš„å¯¼å‡ºåå­—ä¸ä¼šå‡ºç°åœ¨å½“å‰ä½œç”¨åŸŸä¸­ã€‚å¯¼å…¥æ—¶ï¼Œé©±åŠ¨çš„åˆå§‹åŒ–å‡½æ•°ä¼šè°ƒç”¨&lt;code&gt;sql.Register&lt;/code&gt;å°†è‡ªå·±æ³¨å†Œåœ¨&lt;code&gt;database/sql&lt;/code&gt;åŒ…çš„å…¨å±€å˜é‡&lt;code&gt;sql.drivers&lt;/code&gt;ä¸­ï¼Œä»¥ä¾¿ä»¥åé€šè¿‡&lt;code&gt;sql.Open&lt;/code&gt;è®¿é—®ã€‚&lt;/p&gt;
&lt;h2 id=&#34;3-è®¿é—®æ•°æ®&#34;&gt;3. è®¿é—®æ•°æ®&lt;/h2&gt;
&lt;p&gt;åŠ è½½é©±åŠ¨åŒ…åï¼Œéœ€è¦ä½¿ç”¨&lt;code&gt;sql.Open()&lt;/code&gt;æ¥åˆ›å»º&lt;code&gt;sql.DB&lt;/code&gt;ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#204a87;font-weight:bold&#34;&gt;func&lt;/span&gt; &lt;span style=&#34;color:#000&#34;&gt;main&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;()&lt;/span&gt; &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#000&#34;&gt;db&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;,&lt;/span&gt; &lt;span style=&#34;color:#000&#34;&gt;err&lt;/span&gt; &lt;span style=&#34;color:#ce5c00;font-weight:bold&#34;&gt;:=&lt;/span&gt; &lt;span style=&#34;color:#000&#34;&gt;sql&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color:#000&#34;&gt;Open&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color:#4e9a06&#34;&gt;&amp;#34;pgx&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;,&lt;/span&gt;&lt;span style=&#34;color:#4e9a06&#34;&gt;&amp;#34;postgres://localhost:5432/postgres&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#204a87;font-weight:bold&#34;&gt;if&lt;/span&gt; &lt;span style=&#34;color:#000&#34;&gt;err&lt;/span&gt; &lt;span style=&#34;color:#ce5c00;font-weight:bold&#34;&gt;!=&lt;/span&gt; &lt;span style=&#34;color:#204a87;font-weight:bold&#34;&gt;nil&lt;/span&gt; &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;		&lt;span style=&#34;color:#000&#34;&gt;log&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color:#000&#34;&gt;Fatal&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color:#000&#34;&gt;err&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#204a87;font-weight:bold&#34;&gt;defer&lt;/span&gt; &lt;span style=&#34;color:#000&#34;&gt;db&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color:#000&#34;&gt;Close&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;()&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;code&gt;sql.Open&lt;/code&gt;æœ‰ä¸¤ä¸ªå‚æ•°ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯é©±åŠ¨åç§°ï¼Œå­—ç¬¦ä¸²ç±»å‹ã€‚ä¸ºé¿å…æ··æ·†ï¼Œä¸€èˆ¬ä¸åŒ…åç›¸åŒï¼Œè¿™é‡Œæ˜¯&lt;code&gt;pgx&lt;/code&gt;ã€‚&lt;/li&gt;
&lt;li&gt;ç¬¬äºŒä¸ªå‚æ•°ä¹Ÿæ˜¯å­—ç¬¦ä¸²ï¼Œå†…å®¹ä¾èµ–äºç‰¹å®šé©±åŠ¨çš„è¯­æ³•ã€‚é€šå¸¸æ˜¯URLçš„å½¢å¼ï¼Œä¾‹å¦‚&lt;code&gt;postgres://localhost:5432&lt;/code&gt;ã€‚&lt;/li&gt;
&lt;li&gt;ç»å¤§å¤šæ•°æƒ…å†µä¸‹éƒ½åº”å½“æ£€æŸ¥&lt;code&gt;database/sql&lt;/code&gt;æ“ä½œæ‰€è¿”å›çš„é”™è¯¯ã€‚&lt;/li&gt;
&lt;li&gt;ä¸€èˆ¬è€Œè¨€ï¼Œç¨‹åºéœ€è¦åœ¨é€€å‡ºæ—¶é€šè¿‡&lt;code&gt;sql.DB&lt;/code&gt;çš„&lt;code&gt;Close()&lt;/code&gt;æ–¹æ³•é‡Šæ”¾æ•°æ®åº“è¿æ¥èµ„æºã€‚å¦‚æœå…¶ç”Ÿå‘½å‘¨æœŸä¸è¶…è¿‡å‡½æ•°çš„èŒƒå›´ï¼Œåˆ™åº”å½“ä½¿ç”¨&lt;code&gt;defer db.Close()&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;æ‰§è¡Œ&lt;code&gt;sql.Open()&lt;/code&gt;å¹¶æœªå®é™…å»ºç«‹èµ·åˆ°æ•°æ®åº“çš„è¿æ¥ï¼Œä¹Ÿä¸ä¼šéªŒè¯é©±åŠ¨å‚æ•°ã€‚ç¬¬ä¸€ä¸ªå®é™…çš„è¿æ¥ä¼šæƒ°æ€§æ±‚å€¼ï¼Œå»¶è¿Ÿåˆ°ç¬¬ä¸€æ¬¡éœ€è¦æ—¶å»ºç«‹ã€‚ç”¨æˆ·åº”è¯¥é€šè¿‡&lt;code&gt;db.Ping()&lt;/code&gt;æ¥æ£€æŸ¥æ•°æ®åº“æ˜¯å¦å®é™…å¯ç”¨ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#204a87;font-weight:bold&#34;&gt;if&lt;/span&gt; &lt;span style=&#34;color:#000&#34;&gt;err&lt;/span&gt; &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#000&#34;&gt;db&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color:#000&#34;&gt;Ping&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;();&lt;/span&gt; &lt;span style=&#34;color:#000&#34;&gt;err&lt;/span&gt; &lt;span style=&#34;color:#ce5c00;font-weight:bold&#34;&gt;!=&lt;/span&gt; &lt;span style=&#34;color:#204a87;font-weight:bold&#34;&gt;nil&lt;/span&gt; &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#8f5902;font-style:italic&#34;&gt;// do something about db error
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#8f5902;font-style:italic&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;code&gt;sql.DB&lt;/code&gt;å¯¹è±¡æ˜¯ä¸ºäº†é•¿è¿æ¥è€Œè®¾è®¡çš„ï¼Œä¸è¦é¢‘ç¹&lt;code&gt;Open()&lt;/code&gt;å’Œ&lt;code&gt;Close()&lt;/code&gt;æ•°æ®åº“ã€‚è€Œåº”è¯¥ä¸ºæ¯ä¸ªå¾…è®¿é—®çš„æ•°æ®åº“åˆ›å»º&lt;strong&gt;ä¸€ä¸ª&lt;/strong&gt;&lt;code&gt;sql.DB&lt;/code&gt;å®ä¾‹ï¼Œå¹¶åœ¨ç”¨å®Œå‰ä¸€ç›´ä¿ç•™å®ƒã€‚éœ€è¦æ—¶å¯å°†å…¶ä½œä¸ºå‚æ•°ä¼ é€’ï¼Œæˆ–æ³¨å†Œä¸ºå…¨å±€å¯¹è±¡ã€‚&lt;/p&gt;
&lt;p&gt;å¦‚æœæ²¡æœ‰æŒ‰ç…§&lt;code&gt;database/sql&lt;/code&gt;è®¾è®¡çš„æ„å›¾ï¼Œä¸æŠŠ&lt;code&gt;sql.DB&lt;/code&gt;å½“æˆé•¿æœŸå¯¹è±¡æ¥ç”¨è€Œé¢‘ç¹å¼€å…³å¯åœï¼Œå°±å¯èƒ½é­é‡å„å¼å„æ ·çš„é”™è¯¯ï¼šæ— æ³•å¤ç”¨å’Œå…±äº«è¿æ¥ï¼Œè€—å°½ç½‘ç»œèµ„æºï¼Œç”±äºTCPè¿æ¥ä¿æŒåœ¨&lt;code&gt;TIME_WAIT&lt;/code&gt;çŠ¶æ€è€Œé—´æ–­æ€§çš„å¤±è´¥ç­‰â€¦â€¦&lt;/p&gt;
&lt;h2 id=&#34;4-è·å–ç»“æœ&#34;&gt;4. è·å–ç»“æœ&lt;/h2&gt;
&lt;p&gt;æœ‰äº†&lt;code&gt;sql.DB&lt;/code&gt;å®ä¾‹ä¹‹åå°±å¯ä»¥å¼€å§‹æ‰§è¡ŒæŸ¥è¯¢è¯­å¥äº†ã€‚&lt;/p&gt;
&lt;p&gt;Goå°†æ•°æ®åº“æ“ä½œåˆ†ä¸ºä¸¤ç±»ï¼š&lt;code&gt;Query&lt;/code&gt;ä¸&lt;code&gt;Exec&lt;/code&gt;ã€‚ä¸¤è€…çš„åŒºåˆ«åœ¨äºå‰è€…ä¼šè¿”å›ç»“æœï¼Œè€Œåè€…ä¸ä¼šã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;Query&lt;/code&gt;è¡¨ç¤ºæŸ¥è¯¢ï¼Œå®ƒä¼šä»æ•°æ®åº“è·å–æŸ¥è¯¢ç»“æœï¼ˆä¸€ç³»åˆ—è¡Œï¼Œå¯èƒ½ä¸ºç©ºï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;&lt;code&gt;Exec&lt;/code&gt;è¡¨ç¤ºæ‰§è¡Œè¯­å¥ï¼Œå®ƒä¸ä¼šè¿”å›è¡Œã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;æ­¤å¤–è¿˜æœ‰ä¸¤ç§å¸¸è§çš„æ•°æ®åº“æ“ä½œæ¨¡å¼ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;QueryRow&lt;/code&gt;è¡¨ç¤ºåªè¿”å›ä¸€è¡Œçš„æŸ¥è¯¢ï¼Œä½œä¸º&lt;code&gt;Query&lt;/code&gt;çš„ä¸€ä¸ªå¸¸è§ç‰¹ä¾‹ã€‚&lt;/li&gt;
&lt;li&gt;&lt;code&gt;Prepare&lt;/code&gt;è¡¨ç¤ºå‡†å¤‡ä¸€ä¸ªéœ€è¦å¤šæ¬¡ä½¿ç”¨çš„è¯­å¥ï¼Œä¾›åç»­æ‰§è¡Œç”¨ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;41-è·å–æ•°æ®&#34;&gt;4.1 è·å–æ•°æ®&lt;/h3&gt;
&lt;p&gt;è®©æˆ‘ä»¬çœ‹ä¸€ä¸ªå¦‚ä½•æŸ¥è¯¢æ•°æ®åº“å¹¶ä¸”å¤„ç†ç»“æœçš„ä¾‹å­ï¼šåˆ©ç”¨æ•°æ®åº“è®¡ç®—ä»1åˆ°10çš„è‡ªç„¶æ•°ä¹‹å’Œã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#204a87;font-weight:bold&#34;&gt;func&lt;/span&gt; &lt;span style=&#34;color:#000&#34;&gt;example&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;()&lt;/span&gt; &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#204a87;font-weight:bold&#34;&gt;var&lt;/span&gt; &lt;span style=&#34;color:#000&#34;&gt;sum&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;,&lt;/span&gt; &lt;span style=&#34;color:#000&#34;&gt;n&lt;/span&gt; &lt;span style=&#34;color:#204a87;font-weight:bold&#34;&gt;int32&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#8f5902;font-style:italic&#34;&gt;// invoke query
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#8f5902;font-style:italic&#34;&gt;&lt;/span&gt;	&lt;span style=&#34;color:#000&#34;&gt;rows&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;,&lt;/span&gt; &lt;span style=&#34;color:#000&#34;&gt;err&lt;/span&gt; &lt;span style=&#34;color:#ce5c00;font-weight:bold&#34;&gt;:=&lt;/span&gt; &lt;span style=&#34;color:#000&#34;&gt;db&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color:#000&#34;&gt;Query&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color:#4e9a06&#34;&gt;&amp;#34;SELECT generate_series(1,$1)&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;,&lt;/span&gt; &lt;span style=&#34;color:#0000cf;font-weight:bold&#34;&gt;10&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#8f5902;font-style:italic&#34;&gt;// handle query error
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#8f5902;font-style:italic&#34;&gt;&lt;/span&gt;	&lt;span style=&#34;color:#204a87;font-weight:bold&#34;&gt;if&lt;/span&gt; &lt;span style=&#34;color:#000&#34;&gt;err&lt;/span&gt; &lt;span style=&#34;color:#ce5c00;font-weight:bold&#34;&gt;!=&lt;/span&gt; &lt;span style=&#34;color:#204a87;font-weight:bold&#34;&gt;nil&lt;/span&gt; &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;		&lt;span style=&#34;color:#000&#34;&gt;fmt&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color:#000&#34;&gt;Println&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color:#000&#34;&gt;err&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#8f5902;font-style:italic&#34;&gt;// defer close result set
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#8f5902;font-style:italic&#34;&gt;&lt;/span&gt;	&lt;span style=&#34;color:#204a87;font-weight:bold&#34;&gt;defer&lt;/span&gt; &lt;span style=&#34;color:#000&#34;&gt;rows&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color:#000&#34;&gt;Close&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;()&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#8f5902;font-style:italic&#34;&gt;// Iter results
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#8f5902;font-style:italic&#34;&gt;&lt;/span&gt;	&lt;span style=&#34;color:#204a87;font-weight:bold&#34;&gt;for&lt;/span&gt; &lt;span style=&#34;color:#000&#34;&gt;rows&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color:#000&#34;&gt;Next&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;()&lt;/span&gt; &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;		&lt;span style=&#34;color:#204a87;font-weight:bold&#34;&gt;if&lt;/span&gt; &lt;span style=&#34;color:#000&#34;&gt;err&lt;/span&gt; &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#000&#34;&gt;rows&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color:#000&#34;&gt;Scan&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color:#ce5c00;font-weight:bold&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span style=&#34;color:#000&#34;&gt;n&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;);&lt;/span&gt; &lt;span style=&#34;color:#000&#34;&gt;err&lt;/span&gt; &lt;span style=&#34;color:#ce5c00;font-weight:bold&#34;&gt;!=&lt;/span&gt; &lt;span style=&#34;color:#204a87;font-weight:bold&#34;&gt;nil&lt;/span&gt; &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;			&lt;span style=&#34;color:#000&#34;&gt;fmt&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color:#000&#34;&gt;Println&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color:#000&#34;&gt;err&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;)&lt;/span&gt;	&lt;span style=&#34;color:#8f5902;font-style:italic&#34;&gt;// Handle scan error
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#8f5902;font-style:italic&#34;&gt;&lt;/span&gt;		&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;		&lt;span style=&#34;color:#000&#34;&gt;sum&lt;/span&gt; &lt;span style=&#34;color:#ce5c00;font-weight:bold&#34;&gt;+=&lt;/span&gt; &lt;span style=&#34;color:#000&#34;&gt;n&lt;/span&gt;				&lt;span style=&#34;color:#8f5902;font-style:italic&#34;&gt;// Use result
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#8f5902;font-style:italic&#34;&gt;&lt;/span&gt;	&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#8f5902;font-style:italic&#34;&gt;// check iteration error
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#8f5902;font-style:italic&#34;&gt;&lt;/span&gt;	&lt;span style=&#34;color:#204a87;font-weight:bold&#34;&gt;if&lt;/span&gt; &lt;span style=&#34;color:#000&#34;&gt;rows&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color:#000&#34;&gt;Err&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;()&lt;/span&gt; &lt;span style=&#34;color:#ce5c00;font-weight:bold&#34;&gt;!=&lt;/span&gt; &lt;span style=&#34;color:#204a87;font-weight:bold&#34;&gt;nil&lt;/span&gt; &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;		&lt;span style=&#34;color:#000&#34;&gt;fmt&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color:#000&#34;&gt;Println&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color:#000&#34;&gt;err&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#000&#34;&gt;fmt&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color:#000&#34;&gt;Println&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color:#000&#34;&gt;sum&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;æ•´ä½“å·¥ä½œæµç¨‹å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;ä½¿ç”¨&lt;code&gt;db.Query()&lt;/code&gt;æ¥å‘é€æŸ¥è¯¢åˆ°æ•°æ®åº“ï¼Œè·å–ç»“æœé›†&lt;code&gt;Rows&lt;/code&gt;ï¼Œå¹¶æ£€æŸ¥é”™è¯¯ã€‚&lt;/li&gt;
&lt;li&gt;ä½¿ç”¨&lt;code&gt;rows.Next()&lt;/code&gt;ä½œä¸ºå¾ªç¯æ¡ä»¶ï¼Œè¿­ä»£è¯»å–ç»“æœé›†ã€‚&lt;/li&gt;
&lt;li&gt;ä½¿ç”¨&lt;code&gt;rows.Scan&lt;/code&gt;ä»ç»“æœé›†ä¸­è·å–ä¸€è¡Œç»“æœã€‚&lt;/li&gt;
&lt;li&gt;ä½¿ç”¨&lt;code&gt;rows.Err()&lt;/code&gt;åœ¨é€€å‡ºè¿­ä»£åæ£€æŸ¥é”™è¯¯ã€‚&lt;/li&gt;
&lt;li&gt;ä½¿ç”¨&lt;code&gt;rows.Close()&lt;/code&gt;å…³é—­ç»“æœé›†ï¼Œé‡Šæ”¾è¿æ¥ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;ä¸€äº›éœ€è¦è¯¦ç»†è¯´æ˜çš„åœ°æ–¹ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;code&gt;db.Query&lt;/code&gt;ä¼šè¿”å›ç»“æœé›†&lt;code&gt;*Rows&lt;/code&gt;å’Œé”™è¯¯ã€‚æ¯ä¸ªé©±åŠ¨è¿”å›çš„é”™è¯¯éƒ½ä¸ä¸€æ ·ï¼Œç”¨é”™è¯¯å­—ç¬¦ä¸²æ¥åˆ¤æ–­é”™è¯¯ç±»å‹å¹¶ä¸æ˜¯æ˜æ™ºçš„åšæ³•ï¼Œæ›´å¥½çš„æ–¹æ³•æ˜¯å¯¹æŠ½è±¡çš„é”™è¯¯åš&lt;code&gt;Type Assertion&lt;/code&gt;ï¼Œåˆ©ç”¨é©±åŠ¨æä¾›çš„æ›´å…·ä½“çš„ä¿¡æ¯æ¥å¤„ç†é”™è¯¯ã€‚å½“ç„¶ç±»å‹æ–­è¨€ä¹Ÿå¯èƒ½äº§ç”Ÿé”™è¯¯ï¼Œè¿™ä¹Ÿæ˜¯éœ€è¦å¤„ç†çš„ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#204a87;font-weight:bold&#34;&gt;if&lt;/span&gt; &lt;span style=&#34;color:#000&#34;&gt;err&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;.(&lt;/span&gt;&lt;span style=&#34;color:#000&#34;&gt;pgx&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color:#000&#34;&gt;PgError&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;).&lt;/span&gt;&lt;span style=&#34;color:#000&#34;&gt;Code&lt;/span&gt; &lt;span style=&#34;color:#ce5c00;font-weight:bold&#34;&gt;==&lt;/span&gt; &lt;span style=&#34;color:#4e9a06&#34;&gt;&amp;#34;0A000&amp;#34;&lt;/span&gt; &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#8f5902;font-style:italic&#34;&gt;// Do something with that type or error
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#8f5902;font-style:italic&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;code&gt;rows.Next()&lt;/code&gt;ä¼šæŒ‡æ˜æ˜¯å¦è¿˜æœ‰æœªè¯»å–çš„æ•°æ®è®°å½•ï¼Œé€šå¸¸ç”¨äºè¿­ä»£ç»“æœé›†ã€‚è¿­ä»£ä¸­çš„é”™è¯¯ä¼šå¯¼è‡´&lt;code&gt;rows.Next()&lt;/code&gt;è¿”å›&lt;code&gt;false&lt;/code&gt;ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;code&gt;rows.Scan()&lt;/code&gt;ç”¨äºåœ¨è¿­ä»£ä¸­è·å–ä¸€è¡Œç»“æœã€‚æ•°æ®åº“ä¼šä½¿ç”¨wire protocalé€šè¿‡TCP/UnixSocketä¼ è¾“æ•°æ®ï¼Œå¯¹Pgè€Œè¨€ï¼Œæ¯ä¸€è¡Œå®é™…ä¸Šå¯¹åº”ä¸€æ¡&lt;code&gt;DataRow&lt;/code&gt;æ¶ˆæ¯ã€‚&lt;code&gt;Scan&lt;/code&gt;æ¥å—å˜é‡åœ°å€ï¼Œè§£æ&lt;code&gt;DataRow&lt;/code&gt;æ¶ˆæ¯å¹¶å¡«å…¥ç›¸åº”å˜é‡ä¸­ã€‚å› ä¸ºGoè¯­è¨€æ˜¯å¼ºç±»å‹çš„ï¼Œæ‰€ä»¥ç”¨æˆ·éœ€è¦åˆ›å»ºç›¸åº”ç±»å‹çš„å˜é‡å¹¶åœ¨&lt;code&gt;rows.Scan&lt;/code&gt;ä¸­ä¼ å…¥å…¶æŒ‡é’ˆï¼Œ&lt;code&gt;Scan&lt;/code&gt;å‡½æ•°ä¼šæ ¹æ®ç›®æ ‡å˜é‡çš„ç±»å‹æ‰§è¡Œç›¸åº”è½¬æ¢ã€‚ä¾‹å¦‚æŸæŸ¥è¯¢è¿”å›ä¸€ä¸ªå•åˆ—&lt;code&gt;string&lt;/code&gt;ç»“æœé›†ï¼Œç”¨æˆ·å¯ä»¥ä¼ å…¥&lt;code&gt;[]byte&lt;/code&gt;æˆ–&lt;code&gt;string&lt;/code&gt;ç±»å‹å˜é‡çš„åœ°å€ï¼ŒGoä¼šå°†åŸå§‹äºŒè¿›åˆ¶æ•°æ®æˆ–å…¶å­—ç¬¦ä¸²å½¢å¼å¡«å…¥å…¶ä¸­ã€‚ä½†å¦‚æœç”¨æˆ·çŸ¥é“è¿™ä¸€åˆ—å§‹ç»ˆå­˜å‚¨ç€æ•°å­—å­—é¢å€¼ï¼Œé‚£ä¹ˆç›¸æ¯”ä¼ å…¥&lt;code&gt;string&lt;/code&gt;åœ°å€åæ‰‹åŠ¨ä½¿ç”¨&lt;code&gt;strconv.ParseInt()&lt;/code&gt;è§£æï¼Œæ›´æ¨èçš„åšæ³•æ˜¯ç›´æ¥ä¼ å…¥ä¸€ä¸ªæ•´å‹å˜é‡çš„åœ°å€ï¼ˆå¦‚ä¸Šé¢æ‰€ç¤ºï¼‰ï¼ŒGoä¼šæ›¿ç”¨æˆ·å®Œæˆè§£æå·¥ä½œã€‚å¦‚æœè§£æå‡ºé”™ï¼Œ&lt;code&gt;Scan&lt;/code&gt;ä¼šè¿”å›ç›¸åº”çš„é”™è¯¯ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;code&gt;rows.Err()&lt;/code&gt;ç”¨äºåœ¨é€€å‡ºè¿­ä»£åæ£€æŸ¥é”™è¯¯ã€‚æ­£å¸¸æƒ…å†µä¸‹è¿­ä»£é€€å‡ºæ˜¯å› ä¸ºå†…éƒ¨äº§ç”Ÿçš„EOFé”™è¯¯ï¼Œä½¿å¾—ä¸‹ä¸€æ¬¡&lt;code&gt;rows.Next() == false&lt;/code&gt;ï¼Œä»è€Œç»ˆæ­¢å¾ªç¯ï¼›åœ¨è¿­ä»£ç»“æŸåè¦æ£€æŸ¥é”™è¯¯ï¼Œä»¥ç¡®ä¿è¿­ä»£æ˜¯å› ä¸ºæ•°æ®è¯»å–å®Œæ¯•ï¼Œè€Œéå…¶ä»–â€œçœŸæ­£â€é”™è¯¯è€Œç»“æŸçš„ã€‚éå†ç»“æœé›†çš„è¿‡ç¨‹å®é™…ä¸Šæ˜¯ç½‘ç»œIOçš„è¿‡ç¨‹ï¼Œå¯èƒ½å‡ºç°å„ç§é”™è¯¯ã€‚å¥å£®çš„ç¨‹åºåº”å½“è€ƒè™‘è¿™äº›å¯èƒ½ï¼Œè€Œä¸èƒ½æ€»æ˜¯å‡è®¾ä¸€åˆ‡æ­£å¸¸ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;code&gt;rows.Close()&lt;/code&gt;ç”¨äºå…³é—­ç»“æœé›†ã€‚ç»“æœé›†å¼•ç”¨äº†æ•°æ®åº“è¿æ¥ï¼Œå¹¶ä¼šä»ä¸­è¯»å–ç»“æœã€‚è¯»å–å®Œä¹‹åå¿…é¡»å…³é—­å®ƒæ‰èƒ½é¿å…èµ„æºæ³„éœ²ã€‚åªè¦ç»“æœé›†ä»ç„¶æ‰“å¼€ç€ï¼Œç›¸åº”çš„åº•å±‚è¿æ¥å°±å¤„äºå¿™ç¢ŒçŠ¶æ€ï¼Œä¸èƒ½è¢«å…¶ä»–æŸ¥è¯¢ä½¿ç”¨ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;å› é”™è¯¯(åŒ…æ‹¬EOF)å¯¼è‡´çš„è¿­ä»£é€€å‡ºä¼šè‡ªåŠ¨è°ƒç”¨&lt;code&gt;rows.Close()&lt;/code&gt;å…³é—­ç»“æœé›†ï¼ˆå’Œé‡Šæ”¾åº•å±‚è¿æ¥ï¼‰ã€‚ä½†å¦‚æœç¨‹åºè‡ªè¡Œæ„å¤–åœ°é€€å‡ºäº†å¾ªç¯ï¼Œä¾‹å¦‚ä¸­é€”&lt;code&gt;break &amp;amp; return&lt;/code&gt;ï¼Œç»“æœé›†å°±ä¸ä¼šè¢«å…³é—­ï¼Œäº§ç”Ÿèµ„æºæ³„éœ²ã€‚&lt;code&gt;rows.Close&lt;/code&gt;æ–¹æ³•æ˜¯å¹‚ç­‰çš„ï¼Œé‡å¤è°ƒç”¨ä¸ä¼šäº§ç”Ÿå‰¯ä½œç”¨ï¼Œå› æ­¤å»ºè®®ä½¿ç”¨ &lt;code&gt;defer rows.Close()&lt;/code&gt;æ¥å…³é—­ç»“æœé›†ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ä»¥ä¸Šå°±æ˜¯åœ¨Goä¸­ä½¿ç”¨æ•°æ®åº“çš„æ ‡å‡†æ–¹å¼ã€‚&lt;/p&gt;
&lt;h3 id=&#34;42-å•è¡ŒæŸ¥è¯¢&#34;&gt;4.2 å•è¡ŒæŸ¥è¯¢&lt;/h3&gt;
&lt;p&gt;å¦‚æœä¸€ä¸ªæŸ¥è¯¢æ¯æ¬¡æœ€å¤šè¿”å›ä¸€è¡Œï¼Œé‚£ä¹ˆå¯ä»¥ç”¨å¿«æ·çš„å•è¡ŒæŸ¥è¯¢æ¥æ›¿ä»£å†—é•¿çš„æ ‡å‡†æŸ¥è¯¢ï¼Œä¾‹å¦‚ä¸Šä¾‹å¯æ”¹å†™ä¸ºï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#204a87;font-weight:bold&#34;&gt;var&lt;/span&gt; &lt;span style=&#34;color:#000&#34;&gt;sum&lt;/span&gt; &lt;span style=&#34;color:#204a87;font-weight:bold&#34;&gt;int&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#000&#34;&gt;err&lt;/span&gt; &lt;span style=&#34;color:#ce5c00;font-weight:bold&#34;&gt;:=&lt;/span&gt; &lt;span style=&#34;color:#000&#34;&gt;db&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color:#000&#34;&gt;QueryRow&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color:#4e9a06&#34;&gt;&amp;#34;SELECT sum(n) FROM (SELECT generate_series(1,$1) as n) a;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;,&lt;/span&gt; &lt;span style=&#34;color:#0000cf;font-weight:bold&#34;&gt;10&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;).&lt;/span&gt;&lt;span style=&#34;color:#000&#34;&gt;Scan&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color:#ce5c00;font-weight:bold&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span style=&#34;color:#000&#34;&gt;sum&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#204a87;font-weight:bold&#34;&gt;if&lt;/span&gt; &lt;span style=&#34;color:#000&#34;&gt;err&lt;/span&gt; &lt;span style=&#34;color:#ce5c00;font-weight:bold&#34;&gt;!=&lt;/span&gt; &lt;span style=&#34;color:#204a87;font-weight:bold&#34;&gt;nil&lt;/span&gt; &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#000&#34;&gt;fmt&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color:#000&#34;&gt;Println&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color:#000&#34;&gt;err&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#000&#34;&gt;fmt&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color:#000&#34;&gt;Println&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color:#000&#34;&gt;sum&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ä¸åŒäº&lt;code&gt;Query&lt;/code&gt;ï¼Œå¦‚æœæŸ¥è¯¢å‘ç”Ÿé”™è¯¯ï¼Œé”™è¯¯ä¼šå»¶è¿Ÿåˆ°è°ƒç”¨&lt;code&gt;Scan()&lt;/code&gt;æ—¶ç»Ÿä¸€è¿”å›ï¼Œå‡å°‘äº†ä¸€æ¬¡é”™è¯¯å¤„ç†åˆ¤æ–­ã€‚åŒæ—¶&lt;code&gt;QueryRow&lt;/code&gt;ä¹Ÿé¿å…äº†æ‰‹åŠ¨æ“ä½œç»“æœé›†çš„éº»çƒ¦ã€‚&lt;/p&gt;
&lt;p&gt;éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå¯¹äºå•è¡ŒæŸ¥è¯¢ï¼ŒGoå°†æ²¡æœ‰ç»“æœçš„æƒ…å†µè§†ä¸ºé”™è¯¯ã€‚&lt;code&gt;sql&lt;/code&gt;åŒ…ä¸­å®šä¹‰äº†ä¸€ä¸ªç‰¹æ®Šçš„é”™è¯¯å¸¸é‡&lt;code&gt;ErrNoRows&lt;/code&gt;ï¼Œå½“ç»“æœä¸ºç©ºæ—¶ï¼Œ&lt;code&gt;QueryRow().Scan()&lt;/code&gt;ä¼šè¿”å›å®ƒã€‚&lt;/p&gt;
&lt;h3 id=&#34;43-ä¿®æ”¹æ•°æ®&#34;&gt;4.3 ä¿®æ”¹æ•°æ®&lt;/h3&gt;
&lt;p&gt;ä»€ä¹ˆæ—¶å€™ç”¨&lt;code&gt;Exec&lt;/code&gt;ï¼Œä»€ä¹ˆæ—¶å€™ç”¨&lt;code&gt;Query&lt;/code&gt;ï¼Œè¿™æ˜¯ä¸€ä¸ªé—®é¢˜ã€‚é€šå¸¸&lt;code&gt;DDL&lt;/code&gt;å’Œå¢åˆ æ”¹ä½¿ç”¨&lt;code&gt;Exec&lt;/code&gt;ï¼Œè¿”å›ç»“æœé›†çš„æŸ¥è¯¢ä½¿ç”¨&lt;code&gt;Query&lt;/code&gt;ã€‚ä½†è¿™ä¸æ˜¯ç»å¯¹çš„ï¼Œè¿™å®Œå…¨å–å†³äºç”¨æˆ·æ˜¯å¦å¸Œæœ›æƒ³è¦è·å–è¿”å›ç»“æœã€‚ä¾‹å¦‚åœ¨PostgreSQLä¸­ï¼š&lt;code&gt;INSERT ... RETURNING *;&lt;/code&gt;è™½ç„¶æ˜¯ä¸€æ¡æ’å…¥è¯­å¥ï¼Œä½†å®ƒä¹Ÿæœ‰è¿”å›ç»“æœé›†ï¼Œæ•…åº”å½“ä½¿ç”¨&lt;code&gt;Query&lt;/code&gt;è€Œä¸æ˜¯&lt;code&gt;Exec&lt;/code&gt;ã€‚&lt;/p&gt;
&lt;p&gt;&lt;code&gt;Query&lt;/code&gt;å’Œ&lt;code&gt;Exec&lt;/code&gt;è¿”å›çš„ç»“æœä¸åŒï¼Œä¸¤è€…çš„ç­¾ååˆ†åˆ«æ˜¯ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#204a87;font-weight:bold&#34;&gt;func&lt;/span&gt; &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color:#000&#34;&gt;s&lt;/span&gt; &lt;span style=&#34;color:#ce5c00;font-weight:bold&#34;&gt;*&lt;/span&gt;&lt;span style=&#34;color:#000&#34;&gt;Stmt&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;)&lt;/span&gt; &lt;span style=&#34;color:#000&#34;&gt;Query&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color:#000&#34;&gt;args&lt;/span&gt; &lt;span style=&#34;color:#ce5c00;font-weight:bold&#34;&gt;...&lt;/span&gt;&lt;span style=&#34;color:#204a87;font-weight:bold&#34;&gt;interface&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;{})&lt;/span&gt; &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color:#ce5c00;font-weight:bold&#34;&gt;*&lt;/span&gt;&lt;span style=&#34;color:#000&#34;&gt;Rows&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;,&lt;/span&gt; &lt;span style=&#34;color:#204a87;font-weight:bold&#34;&gt;error&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#204a87;font-weight:bold&#34;&gt;func&lt;/span&gt; &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color:#000&#34;&gt;s&lt;/span&gt; &lt;span style=&#34;color:#ce5c00;font-weight:bold&#34;&gt;*&lt;/span&gt;&lt;span style=&#34;color:#000&#34;&gt;Stmt&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;)&lt;/span&gt; &lt;span style=&#34;color:#000&#34;&gt;Exec&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color:#000&#34;&gt;args&lt;/span&gt; &lt;span style=&#34;color:#ce5c00;font-weight:bold&#34;&gt;...&lt;/span&gt;&lt;span style=&#34;color:#204a87;font-weight:bold&#34;&gt;interface&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;{})&lt;/span&gt; &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color:#000&#34;&gt;Result&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;,&lt;/span&gt; &lt;span style=&#34;color:#204a87;font-weight:bold&#34;&gt;error&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;)&lt;/span&gt; 
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;code&gt;Exec&lt;/code&gt;ä¸éœ€è¦è¿”å›æ•°æ®é›†ï¼Œè¿”å›çš„ç»“æœæ˜¯&lt;code&gt;Result&lt;/code&gt;ï¼Œ&lt;code&gt;Result&lt;/code&gt;æ¥å£å…è®¸è·å–æ‰§è¡Œç»“æœçš„å…ƒæ•°æ®&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#204a87;font-weight:bold&#34;&gt;type&lt;/span&gt; &lt;span style=&#34;color:#000&#34;&gt;Result&lt;/span&gt; &lt;span style=&#34;color:#204a87;font-weight:bold&#34;&gt;interface&lt;/span&gt; &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#8f5902;font-style:italic&#34;&gt;// ç”¨äºè¿”å›è‡ªå¢IDï¼Œå¹¶ä¸æ˜¯æ‰€æœ‰çš„å…³ç³»å‹æ•°æ®åº“éƒ½æœ‰è¿™ä¸ªåŠŸèƒ½ã€‚
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#8f5902;font-style:italic&#34;&gt;&lt;/span&gt;	&lt;span style=&#34;color:#000&#34;&gt;LastInsertId&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;()&lt;/span&gt; &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color:#204a87;font-weight:bold&#34;&gt;int64&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;,&lt;/span&gt; &lt;span style=&#34;color:#204a87;font-weight:bold&#34;&gt;error&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#8f5902;font-style:italic&#34;&gt;// è¿”å›å—å½±å“çš„è¡Œæ•°ã€‚
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#8f5902;font-style:italic&#34;&gt;&lt;/span&gt;	&lt;span style=&#34;color:#000&#34;&gt;RowsAffected&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;()&lt;/span&gt; &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color:#204a87;font-weight:bold&#34;&gt;int64&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;,&lt;/span&gt; &lt;span style=&#34;color:#204a87;font-weight:bold&#34;&gt;error&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;code&gt;Exec&lt;/code&gt;çš„ç”¨æ³•å¦‚ä¸‹æ‰€ç¤ºï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#000&#34;&gt;db&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color:#000&#34;&gt;Exec&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color:#4e9a06&#34;&gt;`CREATE TABLE test_users(id INTEGER PRIMARY KEY ,name TEXT);`&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#000&#34;&gt;db&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color:#000&#34;&gt;Exec&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color:#4e9a06&#34;&gt;`TRUNCATE test_users;`&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#000&#34;&gt;stmt&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;,&lt;/span&gt; &lt;span style=&#34;color:#000&#34;&gt;err&lt;/span&gt; &lt;span style=&#34;color:#ce5c00;font-weight:bold&#34;&gt;:=&lt;/span&gt; &lt;span style=&#34;color:#000&#34;&gt;db&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color:#000&#34;&gt;Prepare&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color:#4e9a06&#34;&gt;`INSERT INTO test_users(id,name) VALUES ($1,$2) RETURNING id`&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#204a87;font-weight:bold&#34;&gt;if&lt;/span&gt; &lt;span style=&#34;color:#000&#34;&gt;err&lt;/span&gt; &lt;span style=&#34;color:#ce5c00;font-weight:bold&#34;&gt;!=&lt;/span&gt; &lt;span style=&#34;color:#204a87;font-weight:bold&#34;&gt;nil&lt;/span&gt; &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#000&#34;&gt;fmt&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color:#000&#34;&gt;Println&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color:#000&#34;&gt;err&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color:#000&#34;&gt;Error&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;())&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#000&#34;&gt;res&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;,&lt;/span&gt; &lt;span style=&#34;color:#000&#34;&gt;err&lt;/span&gt; &lt;span style=&#34;color:#ce5c00;font-weight:bold&#34;&gt;:=&lt;/span&gt; &lt;span style=&#34;color:#000&#34;&gt;stmt&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color:#000&#34;&gt;Exec&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color:#0000cf;font-weight:bold&#34;&gt;1&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;,&lt;/span&gt; &lt;span style=&#34;color:#4e9a06&#34;&gt;&amp;#34;Alice&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#204a87;font-weight:bold&#34;&gt;if&lt;/span&gt; &lt;span style=&#34;color:#000&#34;&gt;err&lt;/span&gt; &lt;span style=&#34;color:#ce5c00;font-weight:bold&#34;&gt;!=&lt;/span&gt; &lt;span style=&#34;color:#204a87;font-weight:bold&#34;&gt;nil&lt;/span&gt; &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#000&#34;&gt;fmt&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color:#000&#34;&gt;Println&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color:#000&#34;&gt;err&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;}&lt;/span&gt; &lt;span style=&#34;color:#204a87;font-weight:bold&#34;&gt;else&lt;/span&gt; &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#000&#34;&gt;fmt&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color:#000&#34;&gt;Println&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color:#000&#34;&gt;res&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color:#000&#34;&gt;RowsAffected&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;())&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#000&#34;&gt;fmt&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color:#000&#34;&gt;Println&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color:#000&#34;&gt;res&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color:#000&#34;&gt;LastInsertId&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;())&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ç›¸æ¯”ä¹‹ä¸‹&lt;code&gt;Query&lt;/code&gt;åˆ™ä¼šè¿”å›ç»“æœé›†å¯¹è±¡&lt;code&gt;*Rows&lt;/code&gt;ï¼Œä½¿ç”¨æ–¹å¼è§ä¸ŠèŠ‚ã€‚å…¶ç‰¹ä¾‹&lt;code&gt;QueryRow&lt;/code&gt;ä½¿ç”¨æ–¹å¼å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#000&#34;&gt;db&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color:#000&#34;&gt;Exec&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color:#4e9a06&#34;&gt;`CREATE TABLE test_users(id INTEGER PRIMARY KEY ,name TEXT);`&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#000&#34;&gt;db&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color:#000&#34;&gt;Exec&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color:#4e9a06&#34;&gt;`TRUNCATE test_users;`&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#000&#34;&gt;stmt&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;,&lt;/span&gt; &lt;span style=&#34;color:#000&#34;&gt;err&lt;/span&gt; &lt;span style=&#34;color:#ce5c00;font-weight:bold&#34;&gt;:=&lt;/span&gt; &lt;span style=&#34;color:#000&#34;&gt;db&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color:#000&#34;&gt;Prepare&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color:#4e9a06&#34;&gt;`INSERT INTO test_users(id,name) VALUES ($1,$2) RETURNING id`&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#204a87;font-weight:bold&#34;&gt;if&lt;/span&gt; &lt;span style=&#34;color:#000&#34;&gt;err&lt;/span&gt; &lt;span style=&#34;color:#ce5c00;font-weight:bold&#34;&gt;!=&lt;/span&gt; &lt;span style=&#34;color:#204a87;font-weight:bold&#34;&gt;nil&lt;/span&gt; &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#000&#34;&gt;fmt&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color:#000&#34;&gt;Println&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color:#000&#34;&gt;err&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color:#000&#34;&gt;Error&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;())&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#204a87;font-weight:bold&#34;&gt;var&lt;/span&gt; &lt;span style=&#34;color:#000&#34;&gt;returnID&lt;/span&gt; &lt;span style=&#34;color:#204a87;font-weight:bold&#34;&gt;int&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#000&#34;&gt;err&lt;/span&gt; &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#000&#34;&gt;stmt&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color:#000&#34;&gt;QueryRow&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color:#0000cf;font-weight:bold&#34;&gt;4&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;,&lt;/span&gt; &lt;span style=&#34;color:#4e9a06&#34;&gt;&amp;#34;Alice&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;).&lt;/span&gt;&lt;span style=&#34;color:#000&#34;&gt;Scan&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color:#ce5c00;font-weight:bold&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span style=&#34;color:#000&#34;&gt;returnID&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#204a87;font-weight:bold&#34;&gt;if&lt;/span&gt; &lt;span style=&#34;color:#000&#34;&gt;err&lt;/span&gt; &lt;span style=&#34;color:#ce5c00;font-weight:bold&#34;&gt;!=&lt;/span&gt; &lt;span style=&#34;color:#204a87;font-weight:bold&#34;&gt;nil&lt;/span&gt; &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#000&#34;&gt;fmt&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color:#000&#34;&gt;Println&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color:#000&#34;&gt;err&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;}&lt;/span&gt; &lt;span style=&#34;color:#204a87;font-weight:bold&#34;&gt;else&lt;/span&gt; &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#000&#34;&gt;fmt&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color:#000&#34;&gt;Println&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color:#000&#34;&gt;returnID&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;åŒæ ·çš„è¯­å¥ä½¿ç”¨&lt;code&gt;Exec&lt;/code&gt;å’Œ&lt;code&gt;Query&lt;/code&gt;æ‰§è¡Œæœ‰å·¨å¤§çš„å·®åˆ«ã€‚å¦‚ä¸Šæ–‡æ‰€è¿°ï¼Œ&lt;code&gt;Query&lt;/code&gt;ä¼šè¿”å›ç»“æœé›†&lt;code&gt;Rows&lt;/code&gt;ï¼Œè€Œå­˜åœ¨æœªè¯»å–æ•°æ®çš„&lt;code&gt;Rows&lt;/code&gt;å…¶å®ä¼šå ç”¨åº•å±‚è¿æ¥ç›´åˆ°&lt;code&gt;rows.Close()&lt;/code&gt;ä¸ºæ­¢ã€‚å› æ­¤ï¼Œä½¿ç”¨&lt;code&gt;Query&lt;/code&gt;ä½†ä¸è¯»å–è¿”å›ç»“æœï¼Œä¼šå¯¼è‡´åº•å±‚è¿æ¥æ°¸è¿œæ— æ³•é‡Šæ”¾ã€‚&lt;code&gt;database/sql&lt;/code&gt;æœŸæœ›ç”¨æˆ·èƒ½å¤Ÿç”¨å®Œå°±æŠŠè¿æ¥è¿˜å›æ¥ï¼Œæ‰€ä»¥è¿™æ ·çš„ç”¨æ³•å¾ˆå¿«å°±ä¼šå¯¼è‡´èµ„æºè€—å°½ï¼ˆè¿æ¥è¿‡å¤šï¼‰ã€‚æ‰€ä»¥ï¼Œåº”è¯¥ç”¨&lt;code&gt;Exec&lt;/code&gt;çš„è¯­å¥ç»ä¸å¯ç”¨&lt;code&gt;Query&lt;/code&gt;æ¥æ‰§è¡Œã€‚&lt;/p&gt;
&lt;h3 id=&#34;44-å‡†å¤‡æŸ¥è¯¢&#34;&gt;4.4 å‡†å¤‡æŸ¥è¯¢&lt;/h3&gt;
&lt;p&gt;åœ¨ä¸Šä¸€èŠ‚çš„ä¸¤ä¸ªä¾‹å­ä¸­ï¼Œæ²¡æœ‰ç›´æ¥ä½¿ç”¨æ•°æ®åº“çš„&lt;code&gt;Query&lt;/code&gt;å’Œ&lt;code&gt;Exec&lt;/code&gt;æ–¹æ³•ï¼Œè€Œæ˜¯é¦–å…ˆæ‰§è¡Œäº†&lt;code&gt;db.Prepare&lt;/code&gt;è·å–å‡†å¤‡å¥½çš„è¯­å¥(prepared statement)ã€‚å‡†å¤‡å¥½çš„è¯­å¥&lt;code&gt;Stmt&lt;/code&gt;å’Œ&lt;code&gt;sql.DB&lt;/code&gt;ä¸€æ ·ï¼Œéƒ½å¯ä»¥æ‰§è¡Œ&lt;code&gt;Query&lt;/code&gt;ã€&lt;code&gt;Exec&lt;/code&gt;ç­‰æ–¹æ³•ã€‚&lt;/p&gt;
&lt;h4 id=&#34;441-å‡†å¤‡è¯­å¥çš„ä¼˜åŠ¿&#34;&gt;4.4.1 å‡†å¤‡è¯­å¥çš„ä¼˜åŠ¿&lt;/h4&gt;
&lt;p&gt;åœ¨æŸ¥è¯¢å‰è¿›è¡Œå‡†å¤‡æ˜¯Goè¯­è¨€ä¸­çš„æƒ¯ç”¨æ³•ï¼Œå¤šæ¬¡ä½¿ç”¨çš„æŸ¥è¯¢è¯­å¥åº”å½“è¿›è¡Œå‡†å¤‡ï¼ˆ&lt;code&gt;Prepare&lt;/code&gt;ï¼‰ã€‚å‡†å¤‡æŸ¥è¯¢çš„ç»“æœæ˜¯ä¸€ä¸ªå‡†å¤‡å¥½çš„è¯­å¥ï¼ˆprepared statementï¼‰ï¼Œè¯­å¥ä¸­å¯ä»¥åŒ…å«æ‰§è¡Œæ—¶æ‰€éœ€å‚æ•°çš„å ä½ç¬¦ï¼ˆå³ç»‘å®šå€¼ï¼‰ã€‚å‡†å¤‡æŸ¥è¯¢æ¯”æ‹¼å­—ç¬¦ä¸²çš„æ–¹å¼å¥½å¾ˆå¤šï¼Œå®ƒå¯ä»¥è½¬ä¹‰å‚æ•°ï¼Œé¿å…SQLæ³¨å…¥ã€‚åŒæ—¶ï¼Œå‡†å¤‡æŸ¥è¯¢å¯¹äºä¸€äº›æ•°æ®åº“ä¹Ÿçœå»äº†è§£æå’Œç”Ÿæˆæ‰§è¡Œè®¡åˆ’çš„å¼€é”€ï¼Œæœ‰åˆ©äºæ€§èƒ½ã€‚&lt;/p&gt;
&lt;h4 id=&#34;442-å ä½ç¬¦&#34;&gt;4.4.2 å ä½ç¬¦&lt;/h4&gt;
&lt;p&gt;PostgreSQLä½¿ç”¨&lt;code&gt;$N&lt;/code&gt;ä½œä¸ºå ä½ç¬¦ï¼Œ&lt;code&gt;N&lt;/code&gt;æ˜¯ä¸€ä¸ªä»1å¼€å§‹é€’å¢çš„æ•´æ•°ï¼Œä»£è¡¨å‚æ•°çš„ä½ç½®ï¼Œæ–¹ä¾¿å‚æ•°çš„é‡å¤ä½¿ç”¨ã€‚MySQLä½¿ç”¨&lt;code&gt;?&lt;/code&gt;ä½œä¸ºå ä½ç¬¦ï¼ŒSQLiteä¸¤ç§å ä½ç¬¦éƒ½å¯ä»¥ï¼Œè€ŒOracleåˆ™ä½¿ç”¨&lt;code&gt;:param1&lt;/code&gt;çš„å½¢å¼ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;MySQL               PostgreSQL            Oracle
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;=====               ==========            ======
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;WHERE col = ?       WHERE col = $1        WHERE col = :col
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;VALUES(?, ?, ?)     VALUES($1, $2, $3)    VALUES(:val1, :val2, :val3)
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ä»¥&lt;code&gt;PostgreSQL&lt;/code&gt;ä¸ºä¾‹ï¼Œåœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼š&lt;code&gt;&amp;quot;SELECT generate_series(1,$1)&amp;quot;&lt;/code&gt; å°±ç”¨åˆ°äº†&lt;code&gt;$N&lt;/code&gt;çš„å ä½ç¬¦å½¢å¼ï¼Œå¹¶åœ¨åé¢æä¾›äº†ä¸å ä½ç¬¦æ•°ç›®åŒ¹é…çš„å‚æ•°ä¸ªæ•°ã€‚&lt;/p&gt;
&lt;h4 id=&#34;443-åº•å±‚å†…å¹•&#34;&gt;4.4.3 åº•å±‚å†…å¹•&lt;/h4&gt;
&lt;p&gt;å‡†å¤‡è¯­å¥æœ‰ç€å„ç§ä¼˜ç‚¹ï¼šå®‰å…¨ï¼Œé«˜æ•ˆï¼Œæ–¹ä¾¿ã€‚ä½†Goä¸­å®ç°å®ƒçš„æ–¹å¼å¯èƒ½å’Œç”¨æˆ·æ‰€è®¾æƒ³çš„æœ‰è½»å¾®ä¸åŒï¼Œå°¤å…¶æ˜¯å…³äºå’Œ&lt;code&gt;database/sql&lt;/code&gt;å†…éƒ¨å…¶ä»–å¯¹è±¡äº¤äº’çš„éƒ¨åˆ†ã€‚&lt;/p&gt;
&lt;p&gt;åœ¨æ•°æ®åº“å±‚é¢ï¼Œå‡†å¤‡è¯­å¥&lt;code&gt;Stmt&lt;/code&gt;æ˜¯ä¸å•ä¸ªæ•°æ®åº“è¿æ¥ç»‘å®šçš„ã€‚é€šå¸¸çš„æµç¨‹æ˜¯ï¼šå®¢æˆ·ç«¯å‘æœåŠ¡å™¨å‘é€å¸¦æœ‰å ä½ç¬¦çš„æŸ¥è¯¢è¯­å¥ç”¨äºå‡†å¤‡ï¼ŒæœåŠ¡å™¨è¿”å›ä¸€ä¸ªè¯­å¥IDï¼Œå®¢æˆ·ç«¯åœ¨å®é™…æ‰§è¡Œæ—¶ï¼Œåªéœ€è¦ä¼ è¾“è¯­å¥IDå’Œç›¸åº”çš„å‚æ•°å³å¯ã€‚å› æ­¤å‡†å¤‡è¯­å¥æ— æ³•åœ¨è¿æ¥ä¹‹é—´å…±äº«ï¼Œå½“ä½¿ç”¨æ–°çš„æ•°æ®åº“è¿æ¥æ—¶ï¼Œå¿…é¡»é‡æ–°å‡†å¤‡ã€‚&lt;/p&gt;
&lt;p&gt;&lt;code&gt;database/sql&lt;/code&gt;å¹¶æ²¡æœ‰ç›´æ¥æš´éœ²å‡ºæ•°æ®åº“è¿æ¥ã€‚ç”¨æˆ·æ˜¯åœ¨&lt;code&gt;DB&lt;/code&gt;æˆ–&lt;code&gt;Tx&lt;/code&gt;ä¸Šæ‰§è¡Œ&lt;code&gt;Prepare&lt;/code&gt;ï¼Œè€Œä¸æ˜¯&lt;code&gt;Conn&lt;/code&gt;ã€‚å› æ­¤&lt;code&gt;database/sql&lt;/code&gt;æä¾›äº†ä¸€äº›ä¾¿åˆ©å¤„ç†ï¼Œä¾‹å¦‚è‡ªåŠ¨é‡è¯•ã€‚è¿™äº›æœºåˆ¶éšè—åœ¨Driverä¸­å®ç°ï¼Œè€Œä¸ä¼šæš´éœ²åœ¨ç”¨æˆ·ä»£ç ä¸­ã€‚å…¶å·¥ä½œåŸç†æ˜¯ï¼šå½“ç”¨æˆ·å‡†å¤‡ä¸€æ¡è¯­å¥æ—¶ï¼Œå®ƒåœ¨è¿æ¥æ± ä¸­çš„ä¸€ä¸ªè¿æ¥ä¸Šè¿›è¡Œå‡†å¤‡ã€‚&lt;code&gt;Stmt&lt;/code&gt;å¯¹è±¡ä¼šå¼•ç”¨å®ƒå®é™…ä½¿ç”¨çš„è¿æ¥ã€‚å½“æ‰§è¡Œ&lt;code&gt;Stmt&lt;/code&gt;æ—¶ï¼Œå®ƒä¼šå°è¯•ä¼šç”¨å¼•ç”¨çš„è¿æ¥ã€‚å¦‚æœé‚£ä¸ªè¿æ¥å¿™ç¢Œæˆ–å·²ç»è¢«å…³é—­ï¼Œå®ƒä¼šè·å–ä¸€ä¸ªæ–°çš„è¿æ¥ï¼Œå¹¶åœ¨è¿æ¥ä¸Šé‡æ–°å‡†å¤‡ï¼Œç„¶åå†æ‰§è¡Œã€‚&lt;/p&gt;
&lt;p&gt;å› ä¸ºå½“åŸæœ‰è¿æ¥å¿™æ—¶ï¼Œ&lt;code&gt;Stmt&lt;/code&gt;ä¼šåœ¨å…¶ä»–è¿æ¥ä¸Šé‡æ–°å‡†å¤‡ã€‚å› æ­¤å½“é«˜å¹¶å‘åœ°è®¿é—®æ•°æ®åº“æ—¶ï¼Œå¤§é‡çš„è¿æ¥å¤„äºå¿™ç¢ŒçŠ¶æ€ï¼Œè¿™ä¼šå¯¼è‡´&lt;code&gt;Stmt&lt;/code&gt;ä¸æ–­è·å–æ–°çš„è¿æ¥å¹¶æ‰§è¡Œå‡†å¤‡ï¼Œæœ€ç»ˆå¯¼è‡´èµ„æºæ³„éœ²ï¼Œç”šè‡³è¶…å‡ºæœåŠ¡ç«¯å…è®¸çš„è¯­å¥æ•°ç›®ä¸Šé™ã€‚æ‰€ä»¥é€šå¸¸åº”å°½é‡é‡‡ç”¨æ‰‡å…¥çš„æ–¹å¼å‡å°æ•°æ®åº“è®¿é—®å¹¶å‘æ•°ã€‚&lt;/p&gt;
&lt;h4 id=&#34;444-æŸ¥è¯¢çš„å¾®å¦™ä¹‹å¤„&#34;&gt;4.4.4 æŸ¥è¯¢çš„å¾®å¦™ä¹‹å¤„&lt;/h4&gt;
&lt;p&gt;æ•°æ®åº“è¿æ¥å…¶å®æ˜¯å®ç°äº†&lt;code&gt;Begin,Close,Prepare&lt;/code&gt;æ–¹æ³•çš„æ¥å£ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#204a87;font-weight:bold&#34;&gt;type&lt;/span&gt; &lt;span style=&#34;color:#000&#34;&gt;Conn&lt;/span&gt; &lt;span style=&#34;color:#204a87;font-weight:bold&#34;&gt;interface&lt;/span&gt; &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#000&#34;&gt;Prepare&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color:#000&#34;&gt;query&lt;/span&gt; &lt;span style=&#34;color:#204a87;font-weight:bold&#34;&gt;string&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;)&lt;/span&gt; &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color:#000&#34;&gt;Stmt&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;,&lt;/span&gt; &lt;span style=&#34;color:#204a87;font-weight:bold&#34;&gt;error&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#000&#34;&gt;Close&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;()&lt;/span&gt; &lt;span style=&#34;color:#204a87;font-weight:bold&#34;&gt;error&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#000&#34;&gt;Begin&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;()&lt;/span&gt; &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color:#000&#34;&gt;Tx&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;,&lt;/span&gt; &lt;span style=&#34;color:#204a87;font-weight:bold&#34;&gt;error&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æ‰€ä»¥è¿æ¥æ¥å£ä¸Šå®é™…å¹¶æ²¡æœ‰&lt;code&gt;Exec&lt;/code&gt;ï¼Œ&lt;code&gt;Query&lt;/code&gt;æ–¹æ³•ï¼Œè¿™äº›æ–¹æ³•å…¶å®å®šä¹‰åœ¨&lt;code&gt;Prepare&lt;/code&gt;è¿”å›çš„&lt;code&gt;Stmt&lt;/code&gt;ä¸Šã€‚å¯¹äºGoè€Œè¨€ï¼Œè¿™æ„å‘³ç€&lt;code&gt;db.Query()&lt;/code&gt;å®é™…ä¸Šæ‰§è¡Œäº†ä¸‰ä¸ªæ“ä½œï¼šé¦–å…ˆå¯¹æŸ¥è¯¢è¯­å¥åšäº†å‡†å¤‡ï¼Œç„¶åæ‰§è¡ŒæŸ¥è¯¢è¯­å¥ï¼Œæœ€åå…³é—­å‡†å¤‡å¥½çš„è¯­å¥ã€‚è¿™å¯¹æ•°æ®åº“è€Œè¨€ï¼Œå…¶å®æ˜¯3ä¸ªæ¥å›ã€‚è®¾è®¡ç²—ç³™çš„ç¨‹åºä¸ç®€é™‹å®ç°é©±åŠ¨å¯èƒ½ä¼šè®©åº”ç”¨ä¸æ•°æ®åº“äº¤äº’çš„æ¬¡æ•°å¢è‡³3å€ã€‚å¥½åœ¨ç»å¤§å¤šæ•°æ•°æ®åº“é©±åŠ¨å¯¹äºè¿™ç§æƒ…å†µæœ‰ä¼˜åŒ–ï¼Œå¦‚æœé©±åŠ¨å®ç°&lt;code&gt;sql.Queryer&lt;/code&gt;æ¥å£ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#204a87;font-weight:bold&#34;&gt;type&lt;/span&gt; &lt;span style=&#34;color:#000&#34;&gt;Queryer&lt;/span&gt; &lt;span style=&#34;color:#204a87;font-weight:bold&#34;&gt;interface&lt;/span&gt; &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#000&#34;&gt;Query&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color:#000&#34;&gt;query&lt;/span&gt; &lt;span style=&#34;color:#204a87;font-weight:bold&#34;&gt;string&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;,&lt;/span&gt; &lt;span style=&#34;color:#000&#34;&gt;args&lt;/span&gt; &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;[]&lt;/span&gt;&lt;span style=&#34;color:#000&#34;&gt;Value&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;)&lt;/span&gt; &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color:#000&#34;&gt;Rows&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;,&lt;/span&gt; &lt;span style=&#34;color:#204a87;font-weight:bold&#34;&gt;error&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;é‚£ä¹ˆ&lt;code&gt;database/sql&lt;/code&gt;å°±ä¸ä¼šå†è¿›è¡Œ&lt;code&gt;Prepare-Execute-Close&lt;/code&gt;çš„æŸ¥è¯¢æ¨¡å¼ï¼Œè€Œæ˜¯ç›´æ¥ä½¿ç”¨é©±åŠ¨å®ç°çš„&lt;code&gt;Query&lt;/code&gt;æ–¹æ³•å‘æ•°æ®åº“å‘é€æŸ¥è¯¢ã€‚å¯¹äºæŸ¥è¯¢éƒ½æ˜¯å³æ‹¼å³ç”¨ï¼Œä¹Ÿä¸æ‹…å¿ƒå®‰å…¨é—®é¢˜çš„æƒ…å†µä¸‹ï¼Œç›´æ¥&lt;code&gt;Query&lt;/code&gt;å¯ä»¥æœ‰æ•ˆå‡å°‘æ€§èƒ½å¼€é”€ã€‚&lt;/p&gt;
&lt;h2 id=&#34;5-ä½¿ç”¨äº‹åŠ¡&#34;&gt;5. ä½¿ç”¨äº‹åŠ¡&lt;/h2&gt;
&lt;p&gt;äº‹ç‰©æ˜¯å…³ç³»å‹æ•°æ®åº“çš„æ ¸å¿ƒç‰¹æ€§ã€‚Goä¸­äº‹åŠ¡ï¼ˆTxï¼‰æ˜¯ä¸€ä¸ªæŒæœ‰æ•°æ®åº“è¿æ¥çš„å¯¹è±¡ï¼Œå®ƒå…è®¸ç”¨æˆ·åœ¨&lt;strong&gt;åŒä¸€ä¸ªè¿æ¥&lt;/strong&gt;ä¸Šæ‰§è¡Œä¸Šé¢æåˆ°çš„å„ç±»æ“ä½œã€‚&lt;/p&gt;
&lt;h3 id=&#34;51-äº‹åŠ¡åŸºæœ¬æ“ä½œ&#34;&gt;5.1 äº‹åŠ¡åŸºæœ¬æ“ä½œ&lt;/h3&gt;
&lt;p&gt;é€šè¿‡&lt;code&gt;db.Begin()&lt;/code&gt;æ¥å¼€å¯ä¸€ä¸ªäº‹åŠ¡ï¼Œ&lt;code&gt;Begin&lt;/code&gt;æ–¹æ³•ä¼šè¿”å›ä¸€ä¸ªäº‹åŠ¡å¯¹è±¡&lt;code&gt;Tx&lt;/code&gt;ã€‚åœ¨ç»“æœå˜é‡&lt;code&gt;Tx&lt;/code&gt;ä¸Šè°ƒç”¨&lt;code&gt;Commit()&lt;/code&gt;æˆ–è€…&lt;code&gt;Rollback()&lt;/code&gt;æ–¹æ³•ä¼šæäº¤æˆ–å›æ»šå˜æ›´ï¼Œå¹¶å…³é—­äº‹åŠ¡ã€‚åœ¨åº•å±‚ï¼Œ&lt;code&gt;Tx&lt;/code&gt;ä¼šä»è¿æ¥æ± ä¸­è·å¾—ä¸€ä¸ªè¿æ¥å¹¶åœ¨äº‹åŠ¡è¿‡ç¨‹ä¸­ä¿æŒå¯¹å®ƒçš„ç‹¬å ã€‚äº‹åŠ¡å¯¹è±¡&lt;code&gt;Tx&lt;/code&gt;ä¸Šçš„æ–¹æ³•ä¸æ•°æ®åº“å¯¹è±¡&lt;code&gt;sql.DB&lt;/code&gt;çš„æ–¹æ³•ä¸€ä¸€å¯¹åº”ï¼Œä¾‹å¦‚&lt;code&gt;Query,Exec&lt;/code&gt;ç­‰ã€‚äº‹åŠ¡å¯¹è±¡ä¹Ÿå¯ä»¥å‡†å¤‡(prepare)æŸ¥è¯¢ï¼Œç”±äº‹åŠ¡åˆ›å»ºçš„å‡†å¤‡è¯­å¥ä¼šæ˜¾å¼ç»‘å®šåˆ°åˆ›å»ºå®ƒçš„äº‹åŠ¡ã€‚&lt;/p&gt;
&lt;h3 id=&#34;52-äº‹åŠ¡æ³¨æ„äº‹é¡¹&#34;&gt;5.2 äº‹åŠ¡æ³¨æ„äº‹é¡¹&lt;/h3&gt;
&lt;p&gt;ä½¿ç”¨äº‹åŠ¡å¯¹è±¡æ—¶ï¼Œä¸åº”å†æ‰§è¡Œäº‹åŠ¡ç›¸å…³çš„SQLè¯­å¥ï¼Œä¾‹å¦‚&lt;code&gt;BEGIN,COMMIT&lt;/code&gt;ç­‰ã€‚è¿™å¯èƒ½äº§ç”Ÿä¸€äº›å‰¯ä½œç”¨ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;Tx&lt;/code&gt;å¯¹è±¡ä¸€ç›´ä¿æŒæ‰“å¼€çŠ¶æ€ï¼Œä»è€Œå ç”¨äº†è¿æ¥ã€‚&lt;/li&gt;
&lt;li&gt;æ•°æ®åº“çŠ¶æ€ä¸å†ä¸Goä¸­ç›¸å…³å˜é‡çš„çŠ¶æ€ä¿æŒåŒæ­¥ã€‚&lt;/li&gt;
&lt;li&gt;äº‹åŠ¡æå‰ç»ˆæ­¢ä¼šå¯¼è‡´ä¸€äº›æœ¬åº”å±äºäº‹åŠ¡å†…çš„æŸ¥è¯¢è¯­å¥ä¸å†å±äºäº‹åŠ¡çš„ä¸€éƒ¨åˆ†ï¼Œè¿™äº›è¢«æ’é™¤çš„è¯­å¥æœ‰å¯èƒ½ä¼šç”±åˆ«çš„æ•°æ®åº“è¿æ¥è€ŒéåŸæœ‰çš„äº‹åŠ¡ä¸“å±è¿æ¥æ‰§è¡Œã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;å½“å¤„äºäº‹åŠ¡å†…éƒ¨æ—¶ï¼Œåº”å½“ä½¿ç”¨&lt;code&gt;Tx&lt;/code&gt;å¯¹è±¡çš„æ–¹æ³•è€Œé&lt;code&gt;DB&lt;/code&gt;çš„æ–¹æ³•ï¼Œ&lt;code&gt;DB&lt;/code&gt;å¯¹è±¡å¹¶ä¸æ˜¯äº‹åŠ¡çš„ä¸€éƒ¨åˆ†ï¼Œç›´æ¥è°ƒç”¨æ•°æ®åº“å¯¹è±¡çš„æ–¹æ³•æ—¶ï¼Œæ‰€æ‰§è¡Œçš„æŸ¥è¯¢å¹¶ä¸å±äºäº‹åŠ¡çš„ä¸€éƒ¨åˆ†ï¼Œæœ‰å¯èƒ½ç”±å…¶ä»–è¿æ¥æ‰§è¡Œã€‚&lt;/p&gt;
&lt;h3 id=&#34;53-txçš„å…¶ä»–åº”ç”¨åœºæ™¯&#34;&gt;5.3 Txçš„å…¶ä»–åº”ç”¨åœºæ™¯&lt;/h3&gt;
&lt;p&gt;å¦‚æœéœ€è¦ä¿®æ”¹è¿æ¥çš„çŠ¶æ€ï¼Œä¹Ÿéœ€è¦ç”¨åˆ°&lt;code&gt;Tx&lt;/code&gt;å¯¹è±¡ï¼Œå³ä½¿ç”¨æˆ·å¹¶ä¸éœ€è¦äº‹åŠ¡ã€‚ä¾‹å¦‚ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;åˆ›å»ºä»…è¿æ¥å¯è§çš„ä¸´æ—¶è¡¨&lt;/li&gt;
&lt;li&gt;è®¾ç½®å˜é‡ï¼Œä¾‹å¦‚&lt;code&gt;SET @var := somevalue&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;ä¿®æ”¹è¿æ¥é€‰é¡¹ï¼Œä¾‹å¦‚å­—ç¬¦é›†ï¼Œè¶…æ—¶è®¾ç½®ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;åœ¨&lt;code&gt;Tx&lt;/code&gt;ä¸Šæ‰§è¡Œçš„æ–¹æ³•éƒ½ä¿è¯åŒä¸€ä¸ªåº•å±‚è¿æ¥æ‰§è¡Œï¼Œè¿™ä½¿å¾—å¯¹è¿æ¥çŠ¶æ€çš„ä¿®æ”¹å¯¹åç»­æ“ä½œèµ·æ•ˆã€‚è¿™æ˜¯Goä¸­å®ç°è¿™ç§åŠŸèƒ½çš„æ ‡å‡†æ–¹å¼ã€‚&lt;/p&gt;
&lt;h3 id=&#34;54-åœ¨äº‹åŠ¡ä¸­å‡†å¤‡è¯­å¥&#34;&gt;5.4 åœ¨äº‹åŠ¡ä¸­å‡†å¤‡è¯­å¥&lt;/h3&gt;
&lt;p&gt;è°ƒç”¨&lt;code&gt;Tx.Prepare&lt;/code&gt;ä¼šåˆ›å»ºä¸€ä¸ªä¸äº‹åŠ¡ç»‘å®šçš„å‡†å¤‡è¯­å¥ã€‚åœ¨äº‹åŠ¡ä¸­ä½¿ç”¨å‡†å¤‡è¯­å¥ï¼Œæœ‰ä¸€ä¸ªç‰¹æ®Šé—®é¢˜éœ€è¦å…³æ³¨ï¼šä¸€å®šè¦åœ¨äº‹åŠ¡ç»“æŸå‰å…³é—­å‡†å¤‡è¯­å¥ã€‚&lt;/p&gt;
&lt;p&gt;åœ¨äº‹åŠ¡ä¸­ä½¿ç”¨&lt;code&gt;defer stmt.Close()&lt;/code&gt;æ˜¯ç›¸å½“å±é™©çš„ã€‚å› ä¸ºå½“äº‹åŠ¡ç»“æŸåï¼Œå®ƒä¼šé‡Šæ”¾è‡ªå·±æŒæœ‰çš„æ•°æ®åº“è¿æ¥ï¼Œä½†äº‹åŠ¡åˆ›å»ºçš„æœªå…³é—­&lt;code&gt;Stmt&lt;/code&gt;ä»ç„¶ä¿ç•™ç€å¯¹äº‹åŠ¡è¿æ¥çš„å¼•ç”¨ã€‚åœ¨äº‹åŠ¡ç»“æŸåæ‰§è¡Œ&lt;code&gt;stmt.Close()&lt;/code&gt;ï¼Œå¦‚æœåŸæ¥é‡Šæ”¾çš„è¿æ¥å·²ç»è¢«å…¶ä»–æŸ¥è¯¢è·å–å¹¶ä½¿ç”¨ï¼Œå°±ä¼šäº§ç”Ÿç«äº‰ï¼Œææœ‰å¯èƒ½ç ´åè¿æ¥çš„çŠ¶æ€ã€‚&lt;/p&gt;
&lt;h2 id=&#34;6-å¤„ç†ç©ºå€¼&#34;&gt;6. å¤„ç†ç©ºå€¼&lt;/h2&gt;
&lt;p&gt;å¯ç©ºåˆ—ï¼ˆNullable Columnï¼‰éå¸¸çš„æ¼äººï¼Œå®¹æ˜“å¯¼è‡´ä»£ç å˜å¾—ä¸‘é™‹ã€‚å¦‚æœå¯ä»¥ï¼Œåœ¨è®¾è®¡æ—¶å°±åº”å½“å°½é‡é¿å…ã€‚å› ä¸ºï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;Goè¯­è¨€çš„æ¯ä¸€ä¸ªå˜é‡éƒ½æœ‰ç€é»˜è®¤é›¶å€¼ï¼Œå½“æ•°æ®çš„é›¶å€¼æ²¡æœ‰æ„ä¹‰æ—¶ï¼Œå¯ä»¥ç”¨é›¶å€¼æ¥è¡¨ç¤ºç©ºå€¼ã€‚ä½†å¾ˆå¤šæƒ…å†µä¸‹ï¼Œæ•°æ®çš„é›¶å€¼å’Œç©ºå€¼å®é™…ä¸Šæœ‰ç€ä¸åŒçš„è¯­ä¹‰ã€‚å•ç‹¬çš„åŸå­ç±»å‹æ— æ³•è¡¨ç¤ºè¿™ç§æƒ…å†µã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;æ ‡å‡†åº“åªæä¾›äº†æœ‰é™çš„å››ç§&lt;code&gt;Nullable type&lt;/code&gt;ï¼šï¼š&lt;code&gt;NullInt64, NullFloat64, NullString, NullBool&lt;/code&gt;ã€‚å¹¶æ²¡æœ‰è¯¸å¦‚&lt;code&gt;NullUint64&lt;/code&gt;ï¼Œ&lt;code&gt;NullYourFavoriteType&lt;/code&gt;ï¼Œç”¨æˆ·éœ€è¦è‡ªå·±å®ç°ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;ç©ºå€¼æœ‰å¾ˆå¤šéº»çƒ¦çš„åœ°æ–¹ã€‚ä¾‹å¦‚ç”¨æˆ·è®¤ä¸ºæŸä¸€åˆ—ä¸ä¼šå‡ºç°ç©ºå€¼è€Œé‡‡ç”¨åŸºæœ¬ç±»å‹æ¥æ”¶æ—¶å´é‡åˆ°äº†ç©ºå€¼ï¼Œç¨‹åºå°±ä¼šå´©æºƒã€‚è¿™ç§é”™è¯¯éå¸¸ç¨€å°‘ï¼Œéš¾ä»¥æ•æ‰ã€ä¾¦æµ‹ã€å¤„ç†ï¼Œç”šè‡³æ„è¯†åˆ°ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;61-ä½¿ç”¨é¢å¤–çš„æ ‡è®°å­—æ®µ&#34;&gt;6.1 ä½¿ç”¨é¢å¤–çš„æ ‡è®°å­—æ®µ&lt;/h3&gt;
&lt;p&gt;&lt;code&gt;database\sql&lt;/code&gt;æä¾›äº†å››ç§åŸºæœ¬å¯ç©ºæ•°æ®ç±»å‹ï¼šä½¿ç”¨åŸºæœ¬ç±»å‹å’Œä¸€ä¸ªå¸ƒå°”æ ‡è®°çš„å¤åˆç»“æ„ä½“è¡¨ç¤ºå¯ç©ºå€¼ã€‚ä¾‹å¦‚ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#204a87;font-weight:bold&#34;&gt;type&lt;/span&gt; &lt;span style=&#34;color:#000&#34;&gt;NullInt64&lt;/span&gt; &lt;span style=&#34;color:#204a87;font-weight:bold&#34;&gt;struct&lt;/span&gt; &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#000&#34;&gt;Int64&lt;/span&gt; &lt;span style=&#34;color:#204a87;font-weight:bold&#34;&gt;int64&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#000&#34;&gt;Valid&lt;/span&gt; &lt;span style=&#34;color:#204a87;font-weight:bold&#34;&gt;bool&lt;/span&gt; &lt;span style=&#34;color:#8f5902;font-style:italic&#34;&gt;// Valid is true if Int64 is not NULL
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#8f5902;font-style:italic&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å¯ç©ºç±»å‹çš„ä½¿ç”¨æ–¹æ³•ä¸åŸºæœ¬ç±»å‹ä¸€è‡´ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#204a87;font-weight:bold&#34;&gt;for&lt;/span&gt; &lt;span style=&#34;color:#000&#34;&gt;rows&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color:#000&#34;&gt;Next&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;()&lt;/span&gt; &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#204a87;font-weight:bold&#34;&gt;var&lt;/span&gt; &lt;span style=&#34;color:#000&#34;&gt;s&lt;/span&gt; &lt;span style=&#34;color:#000&#34;&gt;sql&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color:#000&#34;&gt;NullString&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#000&#34;&gt;err&lt;/span&gt; &lt;span style=&#34;color:#ce5c00;font-weight:bold&#34;&gt;:=&lt;/span&gt; &lt;span style=&#34;color:#000&#34;&gt;rows&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color:#000&#34;&gt;Scan&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color:#ce5c00;font-weight:bold&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span style=&#34;color:#000&#34;&gt;s&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#8f5902;font-style:italic&#34;&gt;// check err
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#8f5902;font-style:italic&#34;&gt;&lt;/span&gt;	&lt;span style=&#34;color:#204a87;font-weight:bold&#34;&gt;if&lt;/span&gt; &lt;span style=&#34;color:#000&#34;&gt;s&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color:#000&#34;&gt;Valid&lt;/span&gt; &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	   &lt;span style=&#34;color:#8f5902;font-style:italic&#34;&gt;// use s.String
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#8f5902;font-style:italic&#34;&gt;&lt;/span&gt;	&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;}&lt;/span&gt; &lt;span style=&#34;color:#204a87;font-weight:bold&#34;&gt;else&lt;/span&gt; &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	   &lt;span style=&#34;color:#8f5902;font-style:italic&#34;&gt;// handle NULL case
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#8f5902;font-style:italic&#34;&gt;&lt;/span&gt;	&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h4 id=&#34;62-ä½¿ç”¨æŒ‡é’ˆ&#34;&gt;6.2 ä½¿ç”¨æŒ‡é’ˆ&lt;/h4&gt;
&lt;p&gt;åœ¨Javaä¸­é€šè¿‡è£…ç®±ï¼ˆboxingï¼‰å¤„ç†å¯ç©ºç±»å‹ï¼Œå³æŠŠåŸºæœ¬ç±»å‹åŒ…è£…æˆä¸€ä¸ªç±»ï¼Œå¹¶é€šè¿‡æŒ‡é’ˆå¼•ç”¨ã€‚äºæ˜¯ï¼Œç©ºå€¼è¯­ä¹‰å¯ä»¥é€šè¿‡æŒ‡é’ˆä¸ºç©ºæ¥è¡¨ç¤ºã€‚Goå½“ç„¶ä¹Ÿå¯ä»¥é‡‡ç”¨è¿™ç§åŠæ³•ï¼Œä¸è¿‡æ ‡å‡†åº“ä¸­å¹¶æ²¡æœ‰æä¾›è¿™ç§å®ç°æ–¹å¼ã€‚&lt;code&gt;pgx&lt;/code&gt;æä¾›äº†è¿™ç§å½¢å¼çš„å¯ç©ºç±»å‹æ”¯æŒã€‚&lt;/p&gt;
&lt;h4 id=&#34;63-ä½¿ç”¨é›¶å€¼è¡¨ç¤ºç©ºå€¼&#34;&gt;6.3 ä½¿ç”¨é›¶å€¼è¡¨ç¤ºç©ºå€¼&lt;/h4&gt;
&lt;p&gt;å¦‚æœæ•°æ®æœ¬èº«ä»è¯­ä¹‰ä¸Šå°±ä¸ä¼šå‡ºç°é›¶å€¼ï¼Œæˆ–è€…æ ¹æœ¬ä¸åŒºåˆ†é›¶å€¼å’Œç©ºå€¼ï¼Œé‚£ä¹ˆæœ€ç®€ä¾¿çš„æ–¹æ³•å°±æ˜¯ä½¿ç”¨é›¶å€¼æ¥è¡¨ç¤ºç©ºå€¼ã€‚é©±åŠ¨&lt;code&gt;go-pg&lt;/code&gt;æä¾›äº†è¿™ç§å½¢å¼çš„æ”¯æŒã€‚&lt;/p&gt;
&lt;h4 id=&#34;64-è‡ªå®šä¹‰å¤„ç†é€»è¾‘&#34;&gt;6.4 è‡ªå®šä¹‰å¤„ç†é€»è¾‘&lt;/h4&gt;
&lt;p&gt;ä»»ä½•å®ç°äº†&lt;code&gt;Scanner&lt;/code&gt;æ¥å£çš„ç±»å‹ï¼Œéƒ½å¯ä»¥ä½œä¸º&lt;code&gt;Scan&lt;/code&gt;ä¼ å…¥çš„åœ°å€å‚æ•°ç±»å‹ã€‚è¿™å°±å…è®¸ç”¨æˆ·è‡ªå·±å®šåˆ¶å¤æ‚çš„è§£æé€»è¾‘ï¼Œå®ç°æ›´ä¸°å¯Œçš„ç±»å‹æ”¯æŒã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#204a87;font-weight:bold&#34;&gt;type&lt;/span&gt; &lt;span style=&#34;color:#000&#34;&gt;Scanner&lt;/span&gt; &lt;span style=&#34;color:#204a87;font-weight:bold&#34;&gt;interface&lt;/span&gt; &lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  		&lt;span style=&#34;color:#8f5902;font-style:italic&#34;&gt;// Scan ä»æ•°æ®åº“é©±åŠ¨ä¸­æ‰«æå‡ºä¸€ä¸ªå€¼ï¼Œå½“ä¸èƒ½æ— æŸåœ°è½¬æ¢æ—¶ï¼Œåº”å½“è¿”å›é”™è¯¯
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#8f5902;font-style:italic&#34;&gt;&lt;/span&gt;  		&lt;span style=&#34;color:#8f5902;font-style:italic&#34;&gt;// srcå¯èƒ½æ˜¯int64, float64, bool, []byte, string, time.Timeï¼Œä¹Ÿå¯èƒ½æ˜¯nilï¼Œè¡¨ç¤ºç©ºå€¼ã€‚
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#8f5902;font-style:italic&#34;&gt;&lt;/span&gt;        &lt;span style=&#34;color:#000&#34;&gt;Scan&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color:#000&#34;&gt;src&lt;/span&gt; &lt;span style=&#34;color:#204a87;font-weight:bold&#34;&gt;interface&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;{})&lt;/span&gt; &lt;span style=&#34;color:#204a87;font-weight:bold&#34;&gt;error&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h4 id=&#34;65-åœ¨æ•°æ®åº“å±‚é¢è§£å†³&#34;&gt;6.5 åœ¨æ•°æ®åº“å±‚é¢è§£å†³&lt;/h4&gt;
&lt;p&gt;é€šè¿‡å¯¹åˆ—æ·»åŠ &lt;code&gt;NOT NULL&lt;/code&gt;çº¦æŸï¼Œå¯ä»¥ç¡®ä¿ä»»ä½•ç»“æœéƒ½ä¸ä¼šä¸ºç©ºã€‚æˆ–è€…ï¼Œé€šè¿‡åœ¨&lt;code&gt;SQL&lt;/code&gt;ä¸­ä½¿ç”¨&lt;code&gt;COALESCE&lt;/code&gt;æ¥ä¸ºNULLè®¾å®šé»˜è®¤å€¼ã€‚&lt;/p&gt;
&lt;h2 id=&#34;7-å¤„ç†åŠ¨æ€åˆ—&#34;&gt;7. å¤„ç†åŠ¨æ€åˆ—&lt;/h2&gt;
&lt;p&gt;&lt;code&gt;Scan()&lt;/code&gt;å‡½æ•°è¦æ±‚ä¼ é€’ç»™å®ƒçš„ç›®æ ‡å˜é‡çš„æ•°ç›®ï¼Œä¸ç»“æœé›†ä¸­çš„åˆ—æ•°æ­£å¥½åŒ¹é…ï¼Œå¦åˆ™å°±ä¼šå‡ºé”™ã€‚&lt;/p&gt;
&lt;p&gt;ä½†æ€»æœ‰ä¸€äº›æƒ…å†µï¼Œç”¨æˆ·äº‹å…ˆå¹¶ä¸çŸ¥é“è¿”å›çš„ç»“æœåˆ°åº•æœ‰å¤šå°‘åˆ—ï¼Œä¾‹å¦‚è°ƒç”¨ä¸€ä¸ªè¿”å›è¡¨çš„å­˜å‚¨è¿‡ç¨‹æ—¶ã€‚&lt;/p&gt;
&lt;p&gt;åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œä½¿ç”¨&lt;code&gt;rows.Columns()&lt;/code&gt;æ¥è·å–åˆ—ååˆ—è¡¨ã€‚åœ¨ä¸çŸ¥é“åˆ—ç±»å‹æƒ…å†µä¸‹ï¼Œåº”å½“ä½¿ç”¨&lt;code&gt;sql.RawBytes&lt;/code&gt;ä½œä¸ºæ¥å—å˜é‡çš„ç±»å‹ã€‚è·å–ç»“æœåè‡ªè¡Œè§£æã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;cols, err := rows.Columns()
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;if err != nil {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	// handle this....
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;// ç›®æ ‡åˆ—æ˜¯ä¸€ä¸ªåŠ¨æ€ç”Ÿæˆçš„æ•°ç»„
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;dest := []interface{}{
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	new(string),
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	new(uint32),
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	new(sql.RawBytes),
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;// å°†æ•°ç»„ä½œä¸ºå¯å˜å‚æ•°ä¼ å…¥Scanä¸­ã€‚
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;err = rows.Scan(dest...)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;// ...
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id=&#34;8-è¿æ¥æ± &#34;&gt;8. è¿æ¥æ± &lt;/h2&gt;
&lt;p&gt;&lt;code&gt;database/sql&lt;/code&gt;åŒ…é‡Œå®ç°äº†ä¸€ä¸ªé€šç”¨çš„è¿æ¥æ± ï¼Œå®ƒåªæä¾›äº†éå¸¸ç®€å•çš„æ¥å£ï¼Œé™¤äº†é™åˆ¶è¿æ¥æ•°ã€è®¾ç½®ç”Ÿå‘½å‘¨æœŸåŸºæœ¬æ²¡æœ‰ä»€ä¹ˆå®šåˆ¶é€‰é¡¹ã€‚ä½†äº†è§£å®ƒçš„ä¸€äº›ç‰¹æ€§ä¹Ÿæ˜¯å¾ˆæœ‰å¸®åŠ©çš„ã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;è¿æ¥æ± æ„å‘³ç€ï¼šåŒä¸€ä¸ªæ•°æ®åº“ä¸Šçš„è¿ç»­ä¸¤æ¡æŸ¥è¯¢å¯èƒ½ä¼šæ‰“å¼€ä¸¤ä¸ªè¿æ¥ï¼Œåœ¨å„è‡ªçš„è¿æ¥ä¸Šæ‰§è¡Œã€‚è¿™å¯èƒ½å¯¼è‡´ä¸€äº›è®©äººå›°æƒ‘çš„é”™è¯¯ï¼Œä¾‹å¦‚ç¨‹åºå‘˜å¸Œæœ›é”è¡¨æ’å…¥æ—¶è¿ç»­æ‰§è¡Œäº†ä¸¤æ¡å‘½ä»¤ï¼š&lt;code&gt;LOCK TABLE&lt;/code&gt;å’Œ&lt;code&gt;INSERT&lt;/code&gt;ï¼Œç»“æœå´ä¼šé˜»å¡ã€‚å› ä¸ºæ‰§è¡Œæ’å…¥æ—¶ï¼Œè¿æ¥æ± åˆ›å»ºäº†ä¸€ä¸ªæ–°çš„è¿æ¥ï¼Œè€Œè¿™æ¡è¿æ¥å¹¶æ²¡æœ‰æŒæœ‰è¡¨é”ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;åœ¨éœ€è¦æ—¶ï¼Œè€Œä¸”è¿æ¥æ± ä¸­æ²¡æœ‰å¯ç”¨çš„è¿æ¥æ—¶ï¼Œè¿æ¥æ‰è¢«åˆ›å»ºã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;é»˜è®¤æƒ…å†µä¸‹è¿æ¥æ•°é‡æ²¡æœ‰é™åˆ¶ï¼Œæƒ³åˆ›å»ºå¤šå°‘å°±æœ‰å¤šå°‘ã€‚ä½†æœåŠ¡å™¨å…è®¸çš„è¿æ¥æ•°å¾€å¾€æ˜¯æœ‰é™çš„ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;ç”¨&lt;code&gt;db.SetMaxIdleConns(N)&lt;/code&gt;æ¥é™åˆ¶è¿æ¥æ± ä¸­ç©ºé—²è¿æ¥çš„æ•°é‡ï¼Œä½†æ˜¯è¿™å¹¶ä¸ä¼šé™åˆ¶è¿æ¥æ± çš„å¤§å°ã€‚è¿æ¥å›æ”¶(recycle)çš„å¾ˆå¿«ï¼Œé€šè¿‡è®¾ç½®ä¸€ä¸ªè¾ƒå¤§çš„Nï¼Œå¯ä»¥åœ¨è¿æ¥æ± ä¸­ä¿ç•™ä¸€äº›ç©ºé—²è¿æ¥ï¼Œä¾›å¿«é€Ÿå¤ç”¨(reuse)ã€‚ä½†ä¿æŒè¿æ¥ç©ºé—²æ—¶é—´è¿‡ä¹…å¯èƒ½ä¼šå¼•å‘å…¶ä»–é—®é¢˜ï¼Œæ¯”å¦‚è¶…æ—¶ã€‚è®¾ç½®&lt;code&gt;N=0&lt;/code&gt;åˆ™å¯ä»¥é¿å…è¿æ¥ç©ºé—²å¤ªä¹…ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;ç”¨&lt;code&gt;db.SetMaxOpenConns(N)&lt;/code&gt;æ¥é™åˆ¶è¿æ¥æ± ä¸­&lt;strong&gt;æ‰“å¼€&lt;/strong&gt;çš„è¿æ¥æ•°é‡ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;ç”¨&lt;code&gt;db.SetConnMaxLifetime(d time.Duration)&lt;/code&gt;æ¥é™åˆ¶è¿æ¥çš„ç”Ÿå‘½å‘¨æœŸã€‚è¿æ¥è¶…æ—¶åï¼Œä¼šåœ¨éœ€è¦æ—¶æƒ°æ€§å›æ”¶å¤ç”¨ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;9-å¾®å¦™è¡Œä¸º&#34;&gt;9. å¾®å¦™è¡Œä¸º&lt;/h2&gt;
&lt;p&gt;&lt;code&gt;database/sql&lt;/code&gt;å¹¶ä¸å¤æ‚ï¼Œä½†æŸäº›æƒ…å†µä¸‹å®ƒçš„å¾®å¦™è¡¨ç°ä»ç„¶ä¼šå‡ºäººæ„æ–™ã€‚&lt;/p&gt;
&lt;h3 id=&#34;91-èµ„æºè€—å°½&#34;&gt;9.1 èµ„æºè€—å°½&lt;/h3&gt;
&lt;p&gt;ä¸è°¨æ…åœ°ä½¿ç”¨&lt;code&gt;database/sql&lt;/code&gt;ä¼šç»™è‡ªå·±æŒ–è®¸å¤šå‘ï¼Œæœ€å¸¸è§çš„é—®é¢˜å°±æ˜¯èµ„æºæ¯ç«­ï¼ˆresource exhaustionï¼‰ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;æ‰“å¼€å’Œå…³é—­æ•°æ®åº“ï¼ˆ&lt;code&gt;sql.DB&lt;/code&gt;ï¼‰å¯èƒ½ä¼šå¯¼è‡´èµ„æºæ¯ç«­ï¼›&lt;/li&gt;
&lt;li&gt;ç»“æœé›†æ²¡æœ‰è¯»å–å®Œæ¯•ï¼Œæˆ–è€…è°ƒç”¨&lt;code&gt;rows.Close()&lt;/code&gt;å¤±è´¥ï¼Œç»“æœé›†ä¼šä¸€ç›´å ç”¨æ± é‡Œçš„è¿æ¥ï¼›&lt;/li&gt;
&lt;li&gt;ä½¿ç”¨&lt;code&gt;Query()&lt;/code&gt;æ‰§è¡Œä¸€äº›ä¸è¿”å›ç»“æœé›†çš„è¯­å¥ï¼Œè¿”å›çš„æœªè¯»å–ç»“æœé›†ä¼šä¸€ç›´å ç”¨æ± é‡Œçš„è¿æ¥ï¼›&lt;/li&gt;
&lt;li&gt;ä¸äº†è§£å‡†å¤‡è¯­å¥ï¼ˆPrepared Statementï¼‰çš„å·¥ä½œåŸç†ä¼šäº§ç”Ÿè®¸å¤šé¢å¤–çš„æ•°æ®åº“è®¿é—®ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;92-uint64&#34;&gt;9.2 Uint64&lt;/h3&gt;
&lt;p&gt;Goåº•å±‚ä½¿ç”¨&lt;code&gt;int64&lt;/code&gt;æ¥è¡¨ç¤ºæ•´å‹ï¼Œä½¿ç”¨&lt;code&gt;uint64&lt;/code&gt;æ—¶åº”å½“æå…¶å°å¿ƒã€‚ä½¿ç”¨è¶…å‡º&lt;code&gt;int64&lt;/code&gt;è¡¨ç¤ºèŒƒå›´çš„æ•´æ•°ä½œä¸ºå‚æ•°ï¼Œä¼šäº§ç”Ÿä¸€ä¸ªæº¢å‡ºé”™è¯¯ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#8f5902;font-style:italic&#34;&gt;// Error: constant 18446744073709551615 overflows int
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#8f5902;font-style:italic&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#000&#34;&gt;_&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;,&lt;/span&gt; &lt;span style=&#34;color:#000&#34;&gt;err&lt;/span&gt; &lt;span style=&#34;color:#ce5c00;font-weight:bold&#34;&gt;:=&lt;/span&gt; &lt;span style=&#34;color:#000&#34;&gt;db&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color:#000&#34;&gt;Exec&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color:#4e9a06&#34;&gt;&amp;#34;INSERT INTO users(id) VALUES&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;,&lt;/span&gt; &lt;span style=&#34;color:#000&#34;&gt;math&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color:#000&#34;&gt;MaxUint64&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;)&lt;/span&gt; 
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;è¿™ç§ç±»å‹çš„é”™è¯¯éå¸¸ä¸å®¹æ˜“å‘ç°ï¼Œå®ƒå¯èƒ½ä¸€å¼€å§‹è¡¨ç°çš„å¾ˆæ­£å¸¸ï¼Œä½†æ˜¯æº¢å‡ºä¹‹åé—®é¢˜å°±æ¥äº†ã€‚&lt;/p&gt;
&lt;h3 id=&#34;93-ä¸åˆé¢„æœŸçš„è¿æ¥çŠ¶æ€&#34;&gt;9.3 ä¸åˆé¢„æœŸçš„è¿æ¥çŠ¶æ€&lt;/h3&gt;
&lt;p&gt;è¿æ¥çš„çŠ¶æ€ï¼Œä¾‹å¦‚æ˜¯å¦å¤„äºäº‹åŠ¡ä¸­ï¼Œæ‰€è¿æ¥çš„æ•°æ®åº“ï¼Œè®¾ç½®çš„å˜é‡ç­‰ï¼Œåº”è¯¥é€šè¿‡Goçš„ç›¸å…³ç±»å‹æ¥å¤„ç†ï¼Œè€Œä¸æ˜¯é€šè¿‡SQLè¯­å¥ã€‚ç”¨æˆ·ä¸åº”å½“å¯¹è‡ªå·±çš„æŸ¥è¯¢åœ¨å“ªæ¡è¿æ¥ä¸Šæ‰§è¡Œä½œä»»ä½•å‡è®¾ï¼Œå¦‚æœéœ€è¦åœ¨åŒä¸€æ¡è¿æ¥ä¸Šæ‰§è¡Œï¼Œéœ€è¦ä½¿ç”¨&lt;code&gt;Tx&lt;/code&gt;ã€‚&lt;/p&gt;
&lt;p&gt;ä¸¾ä¸ªä¾‹å­ï¼Œé€šè¿‡&lt;code&gt;USE DATABASE&lt;/code&gt;æ”¹å˜è¿æ¥çš„æ•°æ®åº“å¯¹äºä¸å°‘äººæ˜¯ä¹ ä»¥ä¸ºå¸¸çš„æ“ä½œï¼Œæ‰§è¡Œè¿™æ¡è¯­å¥ï¼Œåªå½±å“å½“å‰è¿æ¥çš„çŠ¶æ€ï¼Œå…¶ä»–è¿æ¥ä»ç„¶è®¿é—®çš„æ˜¯åŸæ¥çš„æ•°æ®åº“ã€‚å¦‚æœæ²¡æœ‰ä½¿ç”¨äº‹åŠ¡&lt;code&gt;Tx&lt;/code&gt;ï¼Œåç»­çš„æŸ¥è¯¢å¹¶ä¸èƒ½ä¿è¯ä»ç„¶ç”±å½“å‰çš„è¿æ¥æ‰§è¡Œï¼Œæ‰€ä»¥è¿™äº›æŸ¥è¯¢å¾ˆå¯èƒ½å¹¶ä¸åƒç”¨æˆ·é¢„æœŸçš„é‚£æ ·å·¥ä½œã€‚&lt;/p&gt;
&lt;p&gt;æ›´ç³Ÿç³•çš„æ˜¯ï¼Œå¦‚æœç”¨æˆ·æ”¹å˜äº†è¿æ¥çš„çŠ¶æ€ï¼Œç”¨å®Œä¹‹åå®ƒæˆä¸ºç©ºè¿æ¥åˆå›åˆ°äº†è¿æ¥æ± ï¼Œè¿™ä¼šæ±¡æŸ“å…¶ä»–ä»£ç çš„çŠ¶æ€ã€‚å°¤å…¶æ˜¯ç›´æ¥åœ¨SQLä¸­æ‰§è¡Œè¯¸å¦‚&lt;code&gt;BEGIN&lt;/code&gt;æˆ–&lt;code&gt;COMMIT&lt;/code&gt;è¿™æ ·çš„è¯­å¥ã€‚&lt;/p&gt;
&lt;h3 id=&#34;94-é©±åŠ¨çš„ç‰¹æ®Šè¯­æ³•&#34;&gt;9.4 é©±åŠ¨çš„ç‰¹æ®Šè¯­æ³•&lt;/h3&gt;
&lt;p&gt;å°½ç®¡&lt;code&gt;database/sql&lt;/code&gt;æ˜¯ä¸€ä¸ªé€šç”¨çš„æŠ½è±¡ï¼Œä½†ä¸åŒçš„æ•°æ®åº“ï¼Œä¸åŒçš„é©±åŠ¨ä»ç„¶ä¼šæœ‰ä¸åŒçš„è¯­æ³•å’Œè¡Œä¸ºã€‚å‚æ•°å ä½ç¬¦å°±æ˜¯ä¸€ä¸ªä¾‹å­ã€‚&lt;/p&gt;
&lt;h3 id=&#34;95-æ‰¹é‡æ“ä½œ&#34;&gt;9.5 æ‰¹é‡æ“ä½œ&lt;/h3&gt;
&lt;p&gt;å‡ºä¹æ„æ–™çš„æ˜¯ï¼Œæ ‡å‡†åº“æ²¡æœ‰æä¾›å¯¹æ‰¹é‡æ“ä½œçš„æ”¯æŒã€‚å³&lt;code&gt;INSERT INTO xxx VALUES (1),(2),...;&lt;/code&gt;è¿™ç§ä¸€æ¡è¯­å¥æ’å…¥å¤šæ¡æ•°æ®çš„å½¢å¼ã€‚ç›®å‰å®ç°è¿™ä¸ªåŠŸèƒ½è¿˜éœ€è¦è‡ªå·±æ‰‹åŠ¨æ‹¼SQLã€‚&lt;/p&gt;
&lt;h3 id=&#34;96-æ‰§è¡Œå¤šæ¡è¯­å¥&#34;&gt;9.6 æ‰§è¡Œå¤šæ¡è¯­å¥&lt;/h3&gt;
&lt;p&gt;&lt;code&gt;database/sql&lt;/code&gt;å¹¶æ²¡æœ‰å¯¹åœ¨ä¸€æ¬¡æŸ¥è¯¢ä¸­æ‰§è¡Œå¤šæ¡SQLè¯­å¥çš„æ˜¾å¼æ”¯æŒï¼Œå…·ä½“çš„è¡Œä¸ºä»¥é©±åŠ¨çš„å®ç°ä¸ºå‡†ã€‚æ‰€ä»¥å¯¹äº&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#000&#34;&gt;_&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;,&lt;/span&gt; &lt;span style=&#34;color:#000&#34;&gt;err&lt;/span&gt; &lt;span style=&#34;color:#ce5c00;font-weight:bold&#34;&gt;:=&lt;/span&gt; &lt;span style=&#34;color:#000&#34;&gt;db&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color:#000&#34;&gt;Exec&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color:#4e9a06&#34;&gt;&amp;#34;DELETE FROM tbl1; DELETE FROM tbl2&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;)&lt;/span&gt; &lt;span style=&#34;color:#8f5902;font-style:italic&#34;&gt;// Error/unpredictable result
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;è¿™æ ·çš„æŸ¥è¯¢ï¼Œæ€æ ·æ‰§è¡Œå®Œå…¨ç”±é©±åŠ¨è¯´äº†ç®—ï¼Œç”¨æˆ·å¹¶æ— æ³•ç¡®å®šé©±åŠ¨åˆ°åº•æ‰§è¡Œäº†ä»€ä¹ˆï¼Œåˆè¿”å›äº†ä»€ä¹ˆã€‚&lt;/p&gt;
&lt;h3 id=&#34;97-äº‹åŠ¡ä¸­çš„å¤šæ¡è¯­å¥&#34;&gt;9.7 äº‹åŠ¡ä¸­çš„å¤šæ¡è¯­å¥&lt;/h3&gt;
&lt;p&gt;å› ä¸ºäº‹åŠ¡ä¿è¯åœ¨å®ƒä¸Šé¢æ‰§è¡Œçš„æŸ¥è¯¢éƒ½ç”±åŒä¸€ä¸ªè¿æ¥æ¥æ‰§è¡Œï¼Œå› æ­¤äº‹åŠ¡ä¸­çš„è¯­å¥å¿…éœ€æŒ‰é¡ºåºä¸€æ¡ä¸€æ¡æ‰§è¡Œã€‚å¯¹äºè¿”å›ç»“æœé›†çš„æŸ¥è¯¢ï¼Œç»“æœé›†å¿…é¡»&lt;code&gt;Close()&lt;/code&gt;ä¹‹åæ‰èƒ½è¿›è¡Œä¸‹ä¸€æ¬¡æŸ¥è¯¢ã€‚ç”¨æˆ·å¦‚æœå°è¯•åœ¨å‰ä¸€æ¡è¯­å¥çš„ç»“æœè¿˜æ²¡è¯»å®Œå‰å°±æ‰§è¡Œæ–°çš„æŸ¥è¯¢ï¼Œè¿æ¥å°±ä¼šå¤±å»åŒæ­¥ã€‚è¿™æ„å‘³ç€äº‹åŠ¡ä¸­è¿”å›ç»“æœé›†çš„è¯­å¥éƒ½ä¼šå ç”¨ä¸€æ¬¡å•ç‹¬çš„ç½‘ç»œå¾€è¿”ã€‚&lt;/p&gt;
&lt;h2 id=&#34;10-å…¶ä»–&#34;&gt;10. å…¶ä»–&lt;/h2&gt;
&lt;p&gt;æœ¬æ–‡ä¸»ä½“åŸºäº[[Go database/sql tutorial]]([Go database/sql tutorial])ï¼Œç”±æˆ‘ç¿»è¯‘å¹¶è¿›è¡Œä¸€äº›å¢åˆ æ”¹ï¼Œä¿®æ­£è¿‡æ—¶é”™è¯¯çš„å†…å®¹ã€‚è½¬è½½ä¿ç•™å‡ºå¤„ã€‚&lt;/p&gt;

      </description>
    </item>
    
  </channel>
</rss>
