<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
    <title>Pigsty – AWS</title>
    <link>/zh/tags/aws/</link>
    <description>Recent content in AWS on Pigsty</description>
    <generator>Hugo -- gohugo.io</generator>
    <language>zh</language>
    <lastBuildDate>Wed, 22 May 2024 00:00:00 +0000</lastBuildDate>
    
	  <atom:link href="/zh/tags/aws/index.xml" rel="self" type="application/rss+xml" />
    
    
      
        
      
    
    
    <item>
      <title>Blog: Ahrefs不上云，省下四亿美元</title>
      <link>/zh/blog/cloud/ahrefs-saving/</link>
      <pubDate>Wed, 22 May 2024 00:00:00 +0000</pubDate>
      
      <guid>/zh/blog/cloud/ahrefs-saving/</guid>
      <description>
        
        
        
        <![CDATA[<img src="/zh/blog/cloud/ahrefs-saving/featured_hu00302667d3701b11bccc08ee71ddf5da_303152_640x0_resize_q75_h2_catmullrom_2.webp" width="640" height="366"/>]]>
        
        &lt;blockquote&gt;
&lt;p&gt;原文：&lt;a href=&#34;https://tech.ahrefs.com/how-ahrefs-saved-us-400m-in-3-years-by-not-going-to-the-cloud-8939dd930af8&#34;&gt;How Ahrefs Saved US$400M in 3 Years by NOT Going to the Cloud&lt;/a&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;最近云计算在 IT 基础设施领域非常流行，上云成为一种趋势。基础设施即服务云（IaaS）确实有很多优点：灵活、部署敏捷、伸缩简便、在全球多地区都能即时上线，等等等等。&lt;/p&gt;
&lt;p&gt;云服务提供商已经成为专业的 IT 服务外包供应商，提供便捷且易用的服务 —— 通过出色的营销、会议、认证和精心挑选的使用案例，他们很容易让人以为，云计算是现代企业 IT 的唯一合理选择。&lt;/p&gt;
&lt;p&gt;但是，这些外包云计算服务的成本，有时高到离谱，高到我们担心如果基础设施 100% 依赖云计算，我们的业务是否还能存在。这促使我们基于事实，进行实际的比较。以下是比较结果：&lt;/p&gt;
&lt;hr&gt;
&lt;h2 id=&#34;ahrefs-自有硬件概览&#34;&gt;Ahrefs 自有硬件概览&lt;/h2&gt;
&lt;p&gt;Ahrefs 在新加坡租用了一个托管数据中心 —— 高度同质化的标准基础设施。我们核算了这个数据中心的所有成本，并分摊到每台服务器上，然后与 Amazon Web Services (AWS) 云中进行类似的规格进行了成本对比（因为 AWS 是 IaaS 领导者，所以我们将其用作对比的标杆）&lt;/p&gt;
&lt;figure class=&#34;card rounded p-2 td-post-card mb-4 mt-4&#34; style=&#34;max-width: 276px&#34;&gt;
&lt;img class=&#34;card-img-top&#34; src=&#34;/zh/blog/cloud/ahrefs-saving/server1_hu0fc518b27bb3d90eb3dc4138277e8696_1073778_800x400_fit_q75_h2_catmullrom_2.webp&#34; width=&#34;266&#34; height=&#34;400&#34;&gt;
&lt;figcaption class=&#34;card-body px-0 pt-2 pb-0&#34;&gt;
&lt;p class=&#34;card-text&#34;&gt;
&lt;p&gt;Ahrefs 服务器&lt;/p&gt;
&lt;/p&gt;
&lt;/figcaption&gt;
&lt;/figure&gt;
&lt;p&gt;我们的硬件相对较新。托管合同始于 2020 年中 —— 即 COVID-19 疫情高峰期。所有设备也都是从那时候起新买的。我们在该数据中心的服务器配置基本都是一致的，唯一的区别是 CPU 有两种代际，但核数相同。我们每台服务器都有很高的核数，2TB 内存和两个 100G 网口，硬盘的话，平均每台服务器有16块 15TB 的硬盘。&lt;/p&gt;
&lt;p&gt;为了计算每月成本，我们把所有硬件按五年摊销归零核算，超过五年后继续用算白赚。因此这些设备的 &lt;strong&gt;启动成本&lt;/strong&gt;，会摊销到 60 个月中进行核算。&lt;/p&gt;
&lt;p&gt;所有的 &lt;strong&gt;持续性成本&lt;/strong&gt;，例如租金和电费，均以 2022 年 10 月的价格计算。尽管通货膨胀也会有影响，但这里把通胀算上就太复杂了，所以我们先忽略通胀因素。&lt;/p&gt;
&lt;p&gt;我们的托管费用由两部分组成：&lt;strong&gt;租金&lt;/strong&gt;，以及 &lt;strong&gt;实际消耗的电费&lt;/strong&gt;。自 2022 年初以来，电价大幅上涨。我们计算的时候使用的是最新的高电价，而不是整个租赁周期的的平均电价，这样计算上会让 AWS 占些便宜。&lt;/p&gt;
&lt;p&gt;此外，我们还要支付 IP 网络传输费用，和数据中心与我们驻地之间的暗光纤费用（暗光纤：已经铺设但是没有投入使用的光缆）。&lt;/p&gt;
&lt;p&gt;下表显示了我们每台服务器的月度支出。服务器硬件占整体月度支出的 2/3，而数据中心租金和电费 (DC)、互联网服务提供商 (ISP) 的 IP 传输费用、暗光纤 (DF) 和内部网络硬件 (Network HW) 构成了剩余的三分之一。&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;自建成本项&lt;/th&gt;
&lt;th&gt;每月成本（美元）&lt;/th&gt;
&lt;th&gt;每月成本（人民币）&lt;/th&gt;
&lt;th&gt;百分比&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;服务器&lt;/td&gt;
&lt;td&gt;$ 1,025&lt;/td&gt;
&lt;td&gt;¥ 7,380&lt;/td&gt;
&lt;td&gt;66%&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;数据中心、ISP、DF、网络硬件&lt;/td&gt;
&lt;td&gt;$ 524&lt;/td&gt;
&lt;td&gt;¥ 3,772.8&lt;/td&gt;
&lt;td&gt;34%&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;自建总成本&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;&lt;strong&gt;$ 1,550&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;&lt;strong&gt;¥ 11,160&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;100%&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;blockquote&gt;
&lt;p&gt;我们的自有本地硬件成本结构&lt;/p&gt;
&lt;/blockquote&gt;
&lt;hr&gt;
&lt;h2 id=&#34;aws-成本结构&#34;&gt;AWS 成本结构&lt;/h2&gt;
&lt;p&gt;由于我们托管的数据中心位于新加坡，所以我们使用 AWS 亚太地区（新加坡）区域的价格进行对比。&lt;/p&gt;
&lt;p&gt;AWS 的成本结构与托管中心不同。不幸的是，AWS 没有提供与我们服务器核数相匹配的 EC2 服务器实例。因此，我们找到了CPU &amp;amp; 内存正好是一半的相应 AWS 实例，然后将一台 Ahrefs 服务器的成本，与两台这种 EC2 实例的成本进行对比。&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;译注：EC2 定价正比与核数与内存配比，这样成本对比没有问题&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;此外我们考虑了长期折扣，因此我们使用 EC2 实例的最低价格 —— 三年预留，与五年摊销的本地自建服务器进行对比。&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;译注：AWS EC2 三年 Reserved All Upfront 即提供最好的折扣&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;除了 EC2 实例外，我们还添加了弹性块存储 (EBS) ，它并不是直接附加存储的精准替代品 —— 因为我们在服务器中使用的是大容量且快速的 NVMe 盘。为了简化计算，我们选择了更便宜的 gp3 EBS（尽管这种盘速度比我们的慢很多）。其成本由两部分组成：存储大小和 IOPS 费用。&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;译注：EBS &lt;code&gt;gp3&lt;/code&gt; 延迟在 ms 量级，&lt;code&gt;io2&lt;/code&gt; 在百微秒量级，本地盘在 55/9µs 量级&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;We keep two copies of a data chunk on our servers. But we only order usable space in EBS that takes care of the replication for us. So we should consider the price of the &lt;em&gt;gp3&lt;/em&gt; storage size equal to the size of our drives divided by 2: (1&lt;em&gt;1TB + 16&lt;/em&gt;15TB)/2 ≈ 120TB per server.&lt;/p&gt;
&lt;p&gt;因为我们自己用磁盘的时候会复制一份，但是买 EBS 的时候只买实际存储空间，EBS 替你处理数据复制。
所以在成本对比时，我们购买的 &lt;code&gt;gp3&lt;/code&gt; 存储大小是本地磁盘的一半：(1TB + 15TB 16块) / 2 ≈ 每台服务器 120TB。&lt;/p&gt;
&lt;p&gt;我们还没有把 IOPS 的成本算进来，也忽略了 EBS gp3 的各种限制；例如，gp3 云盘的最大吞吐量/实例为 &lt;strong&gt;10GB/s&lt;/strong&gt;。而单个 PCIe Gen 4 NVMe 驱动器的性能为 &lt;strong&gt;6-7GB/s&lt;/strong&gt;，而我们有 16 个并行工作的磁盘，总吞吐要大的多。因此，这完全不是一个维度上的公平比较。这种比较方法显著低估了 AWS 上的存储成本，并进一步让 AWS 在比较中占尽便宜。&lt;/p&gt;
&lt;p&gt;关于网络流量费用，AWS 与托管机房不同，AWS 不是按照带宽来计费的，而是按每GB下行流量来收费。因此，我们大致估算了每台服务器的平均下行流量，然后使用 AWS 网络计费方法进行估算。&lt;/p&gt;
&lt;p&gt;将所有三项成本组合起来，我们得到了 AWS 上的的成本分布，如下表所示&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;AWS 成本项&lt;/th&gt;
&lt;th&gt;每月成本（美元）&lt;/th&gt;
&lt;th&gt;每月成本（人民币）&lt;/th&gt;
&lt;th&gt;百分比&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;EBS 成本&lt;/td&gt;
&lt;td&gt;$ 11,486&lt;/td&gt;
&lt;td&gt;¥ 82,699.2&lt;/td&gt;
&lt;td&gt;65%&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;EC2 成本&lt;/td&gt;
&lt;td&gt;$ 5,607&lt;/td&gt;
&lt;td&gt;¥ 40,370.4&lt;/td&gt;
&lt;td&gt;32%&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;数据传输&lt;/td&gt;
&lt;td&gt;$ 464&lt;/td&gt;
&lt;td&gt;¥ 3,340.8&lt;/td&gt;
&lt;td&gt;3%&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;AWS 总成本&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;&lt;strong&gt;$ 17,557&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;&lt;strong&gt;¥ 126,410.4&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;100%&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;blockquote&gt;
&lt;p&gt;AWS成本结构&lt;/p&gt;
&lt;/blockquote&gt;
&lt;hr&gt;
&lt;h2 id=&#34;自建与aws对比&#34;&gt;自建与AWS对比&lt;/h2&gt;
&lt;p&gt;综合以上两个表格不难看出，AWS 上的支出比想象中要高得多。&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;自建成本项&lt;/th&gt;
&lt;th&gt;月成本 $&lt;/th&gt;
&lt;th&gt;占比&lt;/th&gt;
&lt;th&gt;&lt;/th&gt;
&lt;th&gt;AWS 成本项目&lt;/th&gt;
&lt;th&gt;月消 $&lt;/th&gt;
&lt;th&gt;占比&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;服务器&lt;/td&gt;
&lt;td&gt;1,025&lt;/td&gt;
&lt;td&gt;66%&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;EBS 成本&lt;/td&gt;
&lt;td&gt;11,486&lt;/td&gt;
&lt;td&gt;65%&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;DC、ISP、DF、网络硬件&lt;/td&gt;
&lt;td&gt;524&lt;/td&gt;
&lt;td&gt;34%&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;EC2 成本&lt;/td&gt;
&lt;td&gt;5,607&lt;/td&gt;
&lt;td&gt;32%&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;数据传输&lt;/td&gt;
&lt;td&gt;464&lt;/td&gt;
&lt;td&gt;3%&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;本地总成本&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;&lt;strong&gt;1,550&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;100%&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;AWS 总成本&lt;/td&gt;
&lt;td&gt;17,557&lt;/td&gt;
&lt;td&gt;100%&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;blockquote&gt;
&lt;p&gt;我们的自建成本与 AWS EC2 月消费对比：一台 AWS 服务器成本粗略等于 11.3 台 Ahrefs 自建服务器&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;在 AWS 上一台具有相似可用 SSD 空间的替代 EC2 实例的成本，大致相当于托管数据中心中 &lt;strong&gt;11.3&lt;/strong&gt; 台服务器的成本。相应来说，如果上了云，我们这 20 台服务器的机架就只能剩下大约 2 台服务器了！&lt;/p&gt;
&lt;figure class=&#34;card rounded p-2 td-post-card mb-4 mt-4&#34; style=&#34;max-width: 276px&#34;&gt;
&lt;img class=&#34;card-img-top&#34; src=&#34;/zh/blog/cloud/ahrefs-saving/server2_hu47ced090e95deffa932625253b67d13c_612938_800x400_fit_q75_h2_catmullrom_2.webp&#34; width=&#34;266&#34; height=&#34;400&#34;&gt;
&lt;figcaption class=&#34;card-body px-0 pt-2 pb-0&#34;&gt;
&lt;p class=&#34;card-text&#34;&gt;
&lt;p&gt;20 台 Ahrefs 服务器的成本与 2 台 AWS 服务器相当&lt;/p&gt;
&lt;/p&gt;
&lt;/figcaption&gt;
&lt;/figure&gt;
&lt;p&gt;那么用我们在自建数据中心里实际使用了两年半的这 850 台服务器来计算，算出总成本数字后，不难看到极其惊人的差异！&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;自建本地服务器&lt;/th&gt;
&lt;th&gt;每月成本 $&lt;/th&gt;
&lt;th&gt;&lt;/th&gt;
&lt;th&gt;AWS EC2 实例&lt;/th&gt;
&lt;th&gt;每月成本 $&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;850台服务器每月成本&lt;/td&gt;
&lt;td&gt;1,317,301&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;850台服务器每月成本&lt;/td&gt;
&lt;td&gt;14,923,154&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;30个月总成本&lt;/td&gt;
&lt;td&gt;39,519,025&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;30个月总成本&lt;/td&gt;
&lt;td&gt;447,694,623&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;AWS成本 - 自建成本&lt;/td&gt;
&lt;td&gt;&lt;strong&gt;$ 408,175,598&lt;/strong&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;blockquote&gt;
&lt;p&gt;850 台服务器用30个月的成本：AWS vs 自建&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;假设我们在实际的 2.5 年数据中心使用期间运行 850 台服务器。计算后可以看到显著的差异。&lt;/p&gt;
&lt;p&gt;如果我们选择在 2020 年使用新加坡区域的 AWS，而不是自建，那我们需要向 AWS 支付 &lt;strong&gt;超过 4 亿美元&lt;/strong&gt; 这样一笔天文数字 ，才能让自己的基础设施跑起来！&lt;/p&gt;
&lt;p&gt;有人可能会想，“或许 Ahrefs 能付得起？”&lt;/p&gt;
&lt;p&gt;确实，Ahrefs 是一家盈利且自给自足可持续的公司，所以让我们来看一下它的营收，并算一算。尽管我们是一家私有公司，不必公布我们的财务数据。但在《海峡时报》关于 &lt;a href=&#34;https://www.straitstimes.com/fastest-growing-companies-2022&#34;&gt;2022&lt;/a&gt; 年和 &lt;a href=&#34;https://www.straitstimes.com/fastest-growing-companies-2023&#34;&gt;2023&lt;/a&gt; 年新加坡增长最快的公司的文章中可以找到一些 Ahrefs 的收入信息。这些文章提供了 Ahrefs 在 2020 年和 2021 年的收入数据。&lt;/p&gt;
&lt;p&gt;我们还可以线性外推出 2022 年的收入。这是一个粗略估计，但足以让我们得出一些结论了。&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;年份&lt;/th&gt;
&lt;th&gt;类型&lt;/th&gt;
&lt;th&gt;收入, 新币&lt;/th&gt;
&lt;th&gt;SGD/USD&lt;/th&gt;
&lt;th&gt;收入, 美元&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;2020&lt;/td&gt;
&lt;td&gt;实际&lt;/td&gt;
&lt;td&gt;SGD 86,741,880&lt;/td&gt;
&lt;td&gt;0.7253&lt;/td&gt;
&lt;td&gt;USD 62,913,886&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;2021&lt;/td&gt;
&lt;td&gt;实际&lt;/td&gt;
&lt;td&gt;SGD 115,335,291&lt;/td&gt;
&lt;td&gt;0.7442&lt;/td&gt;
&lt;td&gt;USD 85,832,524&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;2022&lt;/td&gt;
&lt;td&gt;外推&lt;/td&gt;
&lt;td&gt;???&lt;/td&gt;
&lt;td&gt;0.7265&lt;/td&gt;
&lt;td&gt;USD 108,751,162&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;总计&lt;/td&gt;
&lt;td&gt;USD 257,497,571&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;blockquote&gt;
&lt;p&gt;Ahrefs 2020 - 2022 营收估计&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;从上表可以看出，Ahrefs 在过去三年的&lt;strong&gt;总收入&lt;/strong&gt;约为 2.57 亿美元。但我们也计算出，如果将&lt;strong&gt;这样一个&lt;/strong&gt;自建数据中心替换为 AWS，成本约为 4.48 亿美元。因此，公司收入甚至无法覆盖这 2.5 年的 AWS 使用成本。&lt;/p&gt;
&lt;p&gt;这是一个令人震惊的结果！&lt;/p&gt;
&lt;p&gt;但是我们的利润会去哪儿呢？&lt;/p&gt;
&lt;p&gt;正如波音公司 Dr. LJ Hart-Smith 在这份 &lt;a href=&#34;https://www.documentcloud.org/documents/69746-hart-smith-on-outsourcing.html&#34;&gt;已有 20 年历史的报告&lt;/a&gt;中所述：“如果原厂或总包商无法通过将工作外包来获利，那么谁会受益呢？当然是分包商。”&lt;/p&gt;
&lt;p&gt;需要记住的是，我们已经在计算时让 AWS 占尽便宜了 —— 自建数据中心算电费时使用高于平均水平的电价，算EBS 云盘存储价格时只算了空间部分没算 IOPS，并无视了 EBS 其实非常拉垮的慢。而且，这个数据中心并不是我们唯一的成本中心。我们在其他数据中心、服务器、服务、人员、办公室、营销活动上也有支出。&lt;/p&gt;
&lt;p&gt;因此，如果我们主要的基础设施放在云上，Ahrefs 几乎无法生存。&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;其他考虑因素&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;这篇文章没有考虑其他使比较更加复杂的方面。这些方面包括人员技能、财务控制、现金流、根据负载类型进行的容量规划等。&lt;/p&gt;
&lt;hr&gt;
&lt;h2 id=&#34;结论&#34;&gt;结论&lt;/h2&gt;
&lt;p&gt;Ahrefs 省下了约 4 亿美元，因为在过去的两年半中，基础设施没有 100% 上云。这个数字还在增加，因为目前我们又在一个新地方，用新硬件搞了另一个大型托管数据中心。&lt;/p&gt;
&lt;p&gt;Ahrefs 利用 AWS 的优势，在世界各地托管我们的前端，但 Ahrefs 基础设施的绝大部分，隐藏在托管数据中心的自有硬件上。如果我们的产品完全依赖 AWS，Ahrefs 将无法盈利，甚至无法存在。&lt;/p&gt;
&lt;p&gt;如果我们采用只用云的方式，我们的基础设施成本将高出 10 倍以上。但正因为我们没有这样做，我们可以将节省下来的资金，用于实际的产品改进和开发。而且也带来了更快、更好的结果 —— 因为（考虑到云上的限制），我们的服务器比云计算能提供的速度更快。我们的报表也生成得更快且更全面，因为每份报告所需的时间更短。&lt;/p&gt;
&lt;p&gt;基于此，我建议那些对可持续增长感兴趣的 CFO、CEO 和企业主们，仔细考虑并定期重新评估云计算的优势与实际成本。虽然云计算是早期创业公司的自然选择，或者说 100% 吧。但随着公司及其基础设施的增长，完全依赖云计算可能会使公司陷入困境。&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;而这里就出现了两难：&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;一旦上了云，想要离开是很复杂的&lt;/strong&gt;。云计算很方便，但会带来供应商锁定。而且，仅仅是出于更高的成本而放弃云计算基础设施，可能并不是工程团队想要的。他们可能会正确地认为 —— 云计算比传统的砖瓦数据中心和物理服务器环境更容易、更灵活。&lt;/p&gt;
&lt;p&gt;对于更成熟阶段的公司，&lt;a href=&#34;https://world.hey.com/dhh/we-stand-to-save-7m-over-five-years-from-our-cloud-exit-53996caa&#34;&gt;下云迁移到自有基础设施是困难的&lt;/a&gt;。在迁移过程中保持公司生存也是一个挑战。但这种痛苦的转变可能是拯救公司的关键，因为它可以避免将收入越来越多的一部分不断支付给云厂商。&lt;/p&gt;
&lt;p&gt;大公司，尤其是 FAANG 多年来吸走了大量人才。他们一直在招聘工程师来运营他们庞大的数据中心和基础设施，给小公司留下的机会很少。但最近几个月大科技公司的大规模裁员，带来了重新评估云计算的机会 —— 确实可以考虑一下招聘数据中心领域资深专业人士，并从云上搬迁下来。&lt;/p&gt;
&lt;p&gt;如果你要创办一家新公司，考虑一下这种方案：买个机架和服务器，把它们放在你家的地下室。也许这样能从第一天起就提高你们公司的可持续性。&lt;/p&gt;
&lt;hr&gt;
&lt;h2 id=&#34;下云老冯评论&#34;&gt;下云老冯评论&lt;/h2&gt;
&lt;p&gt;很高兴又看到一个难以忍受天价云租金的大客户站出来，发起对云厂商的控诉。 Ahrefs 的经验与我们一致 —— 云上服务器的综合持有成本在是本地自建的 10 倍左右 —— 即使考虑了最好的 Saving Plan 与深度折扣。37 Signal 的 DHH 则提供了&lt;a href=&#34;/zh/blog/cloud/odyssey&#34;&gt;&lt;strong&gt;另一个更有代表性的下云案例&lt;/strong&gt;&lt;/a&gt;。&lt;/p&gt;
&lt;p&gt;同时在 Ahrefs 成本核算中我们不难看出成本的结构化差异 —— 自建的存储成本是服务器成本的一半，而云上的存储成本却是服务器成本的一倍 —— 我有一篇文章专门聊过这个问题 —— &lt;a href=&#34;/zh/blog/cloud/ebs&#34;&gt;&lt;strong&gt;云盘是不是杀猪盘&lt;/strong&gt;&lt;/a&gt;？&lt;/p&gt;
&lt;p&gt;在几个关键例子上，云的成本都极其高昂 —— 无论是&lt;a href=&#34;/zh/blog/cloud/rds&#34;&gt;&lt;strong&gt;大型物理机数据库&lt;/strong&gt;&lt;/a&gt;、&lt;a href=&#34;/zh/blog/cloud/ebs&#34;&gt;&lt;strong&gt;大型 NVMe 存储&lt;/strong&gt;&lt;/a&gt;，或者只是&lt;a href=&#34;/zh/blog/cloud/ecs&#34;&gt;&lt;strong&gt;最新最快的算力&lt;/strong&gt;&lt;/a&gt;。在这些用例上，云上的客户不得不忍受高昂到荒诞的定价带来的羞辱 —— 租生产队的驴所花的钱是如此高昂，以至于几个月甚至几周的租金就能与直接购买它的价格持平。在这种情况下，你应该直接直接把这头驴买下来，而不是给赛博领主交租！&lt;/p&gt;

      </description>
    </item>
    
    <item>
      <title>Blog: 云上黑暗森林：打爆云账单，只需要S3桶名</title>
      <link>/zh/blog/cloud/s3-scam/</link>
      <pubDate>Tue, 30 Apr 2024 00:00:00 +0000</pubDate>
      
      <guid>/zh/blog/cloud/s3-scam/</guid>
      <description>
        
        
        
        <![CDATA[<img src="/zh/blog/cloud/s3-scam/featured_hu436558a25437dcda71194f4874eb71f8_399896_640x0_resize_q75_h2_catmullrom_2.webp" width="640" height="366"/>]]>
        
        &lt;p&gt;公有云上的黑暗森林法则出现了：&lt;strong&gt;只要你的 S3 对象存储桶名暴露，任何人都有能力刷爆你的云账单。&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;/zh/blog/cloud/s3-scam/featured.webp&#34;&gt;&lt;/p&gt;
&lt;hr&gt;
&lt;p&gt;试想一下，你在自己喜欢的区域创建了一个空的、&lt;strong&gt;私有的&lt;/strong&gt; AWS S3 存储桶。第二天早上，你的 AWS 账单会是什么样子？&lt;/p&gt;
&lt;p&gt;几周前，我开始为客户开发一个文档索引系统的概念验证原型 (PoC)。我在 &lt;code&gt;eu-west-1&lt;/code&gt; 区域创建了一个 S3 存储桶，并上传了一些测试文件。两天后我去查阅 AWS 账单页面，主要是为了确认我的操作是否在免费额度内。结果显然事与愿违 —— 账单超过了 &lt;strong&gt;1300美元&lt;/strong&gt;，账单面板显示，执行了将近 &lt;strong&gt;1亿次&lt;/strong&gt; S3 PUT 请求，仅仅发生在一天之内！&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;/zh/blog/cloud/s3-scam/bill.jpg&#34;&gt;&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;我的 S3 账单，按每天/每个区域计费&lt;/p&gt;
&lt;/blockquote&gt;
&lt;hr&gt;
&lt;h2 id=&#34;这些请求从哪儿来&#34;&gt;这些请求从哪儿来？&lt;/h2&gt;
&lt;p&gt;默认情况下，AWS 并不会记录对你的 S3 存储桶的请求操作。但你可以通过 &lt;a href=&#34;https://docs.aws.amazon.com/AmazonS3/latest/userguide/cloudtrail-logging.html&#34;&gt;&lt;strong&gt;AWS CloudTrail&lt;/strong&gt;&lt;/a&gt; 或 &lt;a href=&#34;https://docs.aws.amazon.com/AmazonS3/latest/userguide/ServerLogs.html&#34;&gt;&lt;strong&gt;S3 服务器访问日志&lt;/strong&gt;&lt;/a&gt; 启用此类日志记录。开启 CloudTrail 日志后，我立刻发现了成千上万的来自不同账户的写请求。&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;为何会有第三方账户对我的 S3 存储桶发起未授权请求？&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;这是针对我的账户的类 DDoS 攻击吗？还是针对 AWS 的？事实证明，&lt;strong&gt;一个流行的开源工具的默认配置，会将备份存储至 S3 中。这个工具的默认存储桶名称竟然和我使用的完全一致&lt;/strong&gt;。这就意味着，每一个部署该工具且未更改默认设置的实例，都试图将其备份数据存储到我的 S3 存储桶中！&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;备注：遗憾的是，我不能透露这个工具的名称，因为这可能会使相关公司面临风险（详情将在后文解释）。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;所以，大量未经授权的第三方用户，试图在我的私有 S3 存储桶中存储数据。但为何我要为此买单？&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;对未授权的请求，S3也会向你收费！&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;在我与 AWS 支持的沟通中，这一点得到了证实，他们的回复是：&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;是的，S3 也会对未授权请求（4xx）收费，这是符合预期的。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;因此，如果我现在打开终端输入：&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;aws s3 cp ./file.txt s3://your-bucket-name/random_key
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;我会收到 &lt;strong&gt;&lt;code&gt;AccessDenied&lt;/code&gt;&lt;/strong&gt; 错误，&lt;strong&gt;但你要为这个请求买单&lt;/strong&gt;。&lt;/p&gt;
&lt;p&gt;还有一个问题困扰着我：为什么我的账单中有一半以上的费用来自 &lt;strong&gt;us-east-1&lt;/strong&gt; 区域？我在那里根本没有存储桶！原来，未指定区域的 S3 请求默认发送至 &lt;strong&gt;us-east-1&lt;/strong&gt;，然后根据具体情况进行重定向。而你还需要支付重定向请求的费用。&lt;/p&gt;
&lt;h3 id=&#34;安全层面的问题&#34;&gt;安全层面的问题&lt;/h3&gt;
&lt;p&gt;现在我明白了，为什么我的 S3 存储桶会收到数以百万计的请求，以及为什么我最终面临一笔巨额的 S3 账单。当时，我还想到了一个点子。如果所有这些配置错误的系统，都试图将数据备份到我的 S3 存储桶，如果我将其设置为 “&lt;strong&gt;公共写入&lt;/strong&gt;” 会怎样？我将存储桶公开不到 30 秒，就在这短短时间内收集了超过 10GB 的数据。当然，我不能透露这些数据的主人是谁。但这种看似无害的配置失误，竟可能导致严重的数据泄漏，令人震惊！&lt;/p&gt;
&lt;hr&gt;
&lt;h2 id=&#34;我从中学到了什么&#34;&gt;我从中学到了什么？&lt;/h2&gt;
&lt;p&gt;&lt;strong&gt;第一课：任何知道你S3存储桶名的人，都可以随意打爆你的AWS账单&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;除了删除存储桶，你几乎无法防止这种情况发生。当直接通过 S3 API 访问时，你无法使用 CloudFront 或 WAF 来保护你的存储桶。标准的 S3 PUT 请求费用仅为每一千请求 0.005 美元，但一台机器每秒就可以轻松发起数千次请求。&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;第二课：为你的存储桶名称添加随机后缀可以提高安全性。&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;这种做法可以降低因配置错误或有意攻击而受到的威胁。至少应避免使用简短和常见的名称作为 S3 存储桶的名称。&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;第三课：执行大量 S3 请求时，确保明确指定 AWS 区域。&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;这样你可以避免因 API 重定向而产生额外的费用。&lt;/p&gt;
&lt;hr&gt;
&lt;h2 id=&#34;尾声&#34;&gt;尾声&lt;/h2&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;我向这个脆弱开源工具的维护者报告了我的发现。他们迅速修正了默认配置，不过已部署的实例无法修复了。&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;我还向 AWS 安全团队报告了此事。我希望他们可能会限制这个不幸的 S3 存储桶名称，但他们不愿意处理第三方产品的配置不当问题。&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;我向在我的存储桶中发现数据的两家公司报告了此问题。他们没有回复我的邮件，可能将其视为垃圾邮件。&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;AWS 最终同意取消了我的 S3 账单，但强调了这是一个例外情况。&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;感谢你花时间阅读我的文章。希望它能帮你避免意外的 AWS 费用！&lt;/p&gt;
&lt;hr&gt;
&lt;h2 id=&#34;下云老冯评论&#34;&gt;下云老冯评论&lt;/h2&gt;
&lt;p&gt;公有云上的黑暗森林法则出现了：&lt;strong&gt;只要你的 S3 对象存储桶名暴露，任何人都有能力刷爆你的 AWS 账单&lt;/strong&gt;。只需要知道你的存储桶名称，别人不需要知道你的 ID，也不需要通过认证，直接强行 PUT / GET 你的桶，不管成败，都会被收取费用。&lt;/p&gt;
&lt;p&gt;这引入了一种类似于 DDoS 的新攻击类型 —— DoCC （Denial of Cost Control），刷爆账单攻击。&lt;/p&gt;
&lt;p&gt;在一些群里，AWS 的售后，与工程师给出了他们的解释 —— “AWS设计收费策略有一个原则：就是如果AWS产生了成本（用户本身有一定原因），就一定要向用户收费”，AWS 销售给出的解释则是这个客户不会使用 AWS ，应该参加 AWS SA 考试培训后再上岗。&lt;/p&gt;
&lt;p&gt;但从常理来看，这完全不合理 —— 由别人发起的，连 Auth 都没有通过的请求，为什么要向用户收费？而用户除了选择不用这一个选项之外，似乎压根没有办法防止这种情况发生 —— 这是一个设计上的漏洞，也是一个安全上的漏洞。&lt;/p&gt;
&lt;p&gt;但是在 AWS 看来，该特性被视为 Feature，而不是安全漏洞或者 Bug，可以用来咔咔爆用户的金币。同样的设计逻辑贯穿在 AWS 的产品设计逻辑中，例如，Route53 查询没有解析的域名也会收费，所以知道域名是 AWS 解析的话，也可以进行 DDoS。&lt;/p&gt;
&lt;hr&gt;
&lt;p&gt;我并不确定本土云厂商是否使用了同样的处理逻辑。但他们基本都是直接或间接借鉴 AWS 的。所以有比较大的概率，也会是一样的情况。&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;/zh/blog/cloud/s3-scam/ddos.jpg&#34;&gt;&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;作为信安专业出身，我很清楚业界的一些玩法，比如打DDoS 卖高防 —— 来自某群友的截图&lt;/p&gt;
&lt;/blockquote&gt;
&lt;hr&gt;
&lt;p&gt;在 《&lt;a href=&#34;https://mp.weixin.qq.com/s?__biz=MzU5ODAyNTM5Ng==&amp;mid=2247487400&amp;idx=1&amp;sn=cf5b94165d2791030e0e874dca8383c7&amp;scene=21#wechat_redirect&#34;&gt;&lt;strong&gt;Cloudflare圆桌访谈&lt;/strong&gt;&lt;/a&gt;》中，我也提到过安全问题，比如监守自盗刷流量的问题。&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;最后我想说一下安全，我认为安全才是 Cloudflare 核心价值主张。为什么这么说，还是举一个例子。有一个独立站长朋友用了某个头部本土云 CDN ，最近两年有莫名其妙的超多流量。一个月海外几个T流量，一个IP 过来吃个10G 流量然后消失掉。后来换了个地方提供服务，这些奇怪的流量就没了。运行成本变为本来的 1/10，这就有点让人细思恐极 —— &lt;strong&gt;是不是这些云厂商坚守自盗，在盗刷流量？或者是是云厂商本身（或其附属）组织在有意攻击，从而推广他们的高防 IP 服务？&lt;/strong&gt; 这种例子其实我是有所耳闻的。&lt;/p&gt;
&lt;p&gt;因此，在使用本土云 CDN 的时候，很多用户会有一些天然的顾虑与不信任。但 Cloudflare 就解决了这个问题 —— 第一，流量不要钱，按请求量计费，所以刷流量没意义；第二，它替你抗 DDoS，即使是 Free Plan 也有这个服务，CF不能砸自己的招牌 —— 这解决了一个用户痛点，就是把账单刷爆的问题 —— 我确实有见过这样的案例，公有云账号里有几万块钱，一下子给盗刷干净了。用 Cloudflare 就彻底没有这个问题，我可以确保账单有高度的确定性 —— 如果不是确定为零的话。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;Well，总的来说，账单被刷爆，也算一种公有云上独有的安全风险了 —— 希望云用户保持谨慎小心，一点小失误，也许就会在账单上立即产生难以挽回的损失。&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;/zh/blog/cloud/s3-scam/aws-joke.jpg&#34;&gt;&lt;/p&gt;

      </description>
    </item>
    
    <item>
      <title>Blog: 扒皮云对象存储：从降本到杀猪</title>
      <link>/zh/blog/cloud/s3/</link>
      <pubDate>Tue, 26 Dec 2023 00:00:00 +0000</pubDate>
      
      <guid>/zh/blog/cloud/s3/</guid>
      <description>
        
        
        
        <![CDATA[<img src="/zh/blog/cloud/s3/featured_hu672d98350274fb6e142b5287d665ab3d_210168_640x0_resize_q75_h2_catmullrom_2.webp" width="640" height="640"/>]]>
        
        &lt;p&gt;对象存储是云计算的定义性服务，曾被视为云上降本的典范。不幸的是随着硬件的发展，资源云（Cloudflare R2）与开源平替（MinIO）的出现，曾经“物美价廉”的对象存储服务失去了性价比，和EBS一样成为了杀猪盘。我们在《云计算泥石流》系列中已经深入剖析过云上 EC2 算力，EBS 磁盘，RDS 数据库的成本构成，今天我们就来审视一下云服务之锚 —— 对象存储。&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;https://mp.weixin.qq.com/s/HathxpQ_KUuqxyrtyCDzWw&#34;&gt;&lt;img src=&#34;/zh/blog/cloud/s3/featured.webp&#34;&gt;&lt;/a&gt;&lt;/p&gt;
&lt;hr&gt;
&lt;h2 id=&#34;从降本到杀猪&#34;&gt;从降本到杀猪&lt;/h2&gt;
&lt;p&gt;&lt;strong&gt;对像存储&lt;/strong&gt;，又称简单存储服务（Simple Storage Service，缩写为 &lt;strong&gt;S3&lt;/strong&gt;，以下用S3代指）， 曾经是云上“物美价廉”的拳头产品。&lt;/p&gt;
&lt;p&gt;在十几年前，硬件的价格高昂；能够用一堆几百GB的机械硬盘，三副本搭建可靠的存储服务，并设计实现一套优雅的 HTTP API，还是一件颇有门槛的事情；因此相对于那些“企业级IT”存储方案，物美价廉的 S3 显得很有吸引力。&lt;/p&gt;
&lt;p&gt;但是计算机硬件这个领域非常特殊 —— 有着一个价格每两年减半的摩尔定律。在 AWS S3 的历史上的确有过几次降价，下面的表格里整理了几次主要降价后的 S3 标准档存储单价，也整理了对应年份企业级 HDD/SSD 的参考单位价格。&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th style=&#34;text-align:center&#34;&gt;Date&lt;/th&gt;
&lt;th style=&#34;text-align:center&#34;&gt;$/GB·月&lt;/th&gt;
&lt;th style=&#34;text-align:center&#34;&gt;¥/TB·5年&lt;/th&gt;
&lt;th style=&#34;text-align:center&#34;&gt;HDD ¥/TB&lt;/th&gt;
&lt;th style=&#34;text-align:center&#34;&gt;SSD ¥/TB&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:center&#34;&gt;&lt;a href=&#34;https://aws.amazon.com/cn/blogs/aws/amazon_s3/&#34;&gt;2006&lt;/a&gt;.03&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;0.150&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;63000&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;2800&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:center&#34;&gt;&lt;a href=&#34;http://aws.typepad.com/aws/2010/11/what-can-i-say-another-amazon-s3-price-reduction.html&#34;&gt;2010&lt;/a&gt;.11&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;0.140&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;58800&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;1680&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:center&#34;&gt;&lt;a href=&#34;http://aws.typepad.com/aws/2012/11/amazon-s3-price-reduction-december-1-2012.html&#34;&gt;2012&lt;/a&gt;.12&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;0.095&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;39900&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;420&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;15400&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:center&#34;&gt;&lt;a href=&#34;http://aws.typepad.com/aws/2014/03/aws-price-reduction-42-ec2-s3-rds-elasticache-and-elastic-mapreduce.html&#34;&gt;2014&lt;/a&gt;.04&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;0.030&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;12600&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;371&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;9051&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:center&#34;&gt;&lt;a href=&#34;https://aws.amazon.com/ru/blogs/aws/aws-storage-update-s3-glacier-price-reductions/&#34;&gt;2016&lt;/a&gt;.12&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;0.023&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;9660&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;245&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;3766&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:center&#34;&gt;&lt;a href=&#34;https://aws.amazon.com/cn/s3/pricing&#34;&gt;2023&lt;/a&gt;.12&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;0.023&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;9660&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;105&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;280&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:center&#34;&gt;&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:center&#34;&gt;&lt;strong&gt;其他参考价&lt;/strong&gt;&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;&lt;strong&gt;高性能存储&lt;/strong&gt;&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;&lt;strong&gt;顶配底折价&lt;/strong&gt;&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;&lt;strong&gt;与采购NVMe SSD&lt;/strong&gt;&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;&lt;strong&gt;价格参考&lt;/strong&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:center&#34;&gt;S3 Express&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;0.160&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;67200&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;DHH 12T&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;1400&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:center&#34;&gt;EBS io2&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;0.125 + IOPS&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;114000&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;Shannon 3.2T&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;900&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;不难看出，S3 标准档的单价从 2006 年的 &lt;strong&gt;0.15 $/GB·月&lt;/strong&gt; 到 2023 年的 &lt;strong&gt;0.023 $/GB·月&lt;/strong&gt; ，降到原来的 &lt;strong&gt;15%&lt;/strong&gt;，便宜了 &lt;strong&gt;6&lt;/strong&gt; 倍，听上去不错；然而当你考虑到 S3 底层 HDD 的价格从降到原来的 &lt;strong&gt;3.7%&lt;/strong&gt; ，便宜了整整 &lt;strong&gt;26&lt;/strong&gt; 倍时，就能发现这里面的猫腻了。&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;S3 的资源溢价倍数从 2006 年的 7 倍增长到了当下的 30 倍！&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;在2023年当下，当我们重新进行成本核算时，不难看出 S3 / EBS 这类存储服务的性价比早已今非昔比 —— 云上的算力 EC2 相比自建服务器有着 5 ～ 10 倍的溢价，而云上的块存储 EBS 相对本地SSD有着几十倍到一两百倍的溢价。云上的 S3 相对普通HDD也有着三十倍左右的资源溢价。而作为云服务之锚的 S3 / EBS / EC2 价格，又会传导到几乎所有的云服务上去 —— 这让云服务的性价比彻底丧失吸引力。&lt;/p&gt;
&lt;p&gt;这里的核心问题是：&lt;strong&gt;硬件资源的价格随着摩尔定律以指数规律下降，但节省的成本并没有穿透云厂商这个中间层，传导到终端用户的服务价格上&lt;/strong&gt;。 &lt;strong&gt;逆水行舟，不进则退，降价速度跟不上摩尔定律就是其实就是变相涨价&lt;/strong&gt;。以S3为例，在过去十几年里，云厂商S3虽然名义上降价6倍，但硬件资源却便宜了 26 倍，所以这个价格又该怎么说呢？&lt;/p&gt;
&lt;hr&gt;
&lt;h2 id=&#34;成本性能吞吐&#34;&gt;成本、性能、吞吐&lt;/h2&gt;
&lt;p&gt;尽管云服务有着高昂的溢价，但如果它是不可替代的&lt;strong&gt;最优选&lt;/strong&gt;，那么即使溢价高性价比低，也不影响价格钝感的高价值头部客户使用。然而不仅仅是成本，存储硬件的性能也遵循摩尔定律，随着时间累积，自建S3的性能也开始出现显著优势。&lt;/p&gt;
&lt;p&gt;S3 的性能主要体现在&lt;strong&gt;吞吐&lt;/strong&gt;量上，AWS S3 的 100 Gb/s 网络提供了高达 12.5 GB/s 的访问带宽，这一点确实值得称道。这样的吞吐量放在十年前毫无疑问是让人震撼的，然而在今天，一块两万块不到的企业级 12 TB NVMe SSD ，单卡就可以达到 14 GB/s 的读写带宽，100Gb的交换机和网卡也已经非常普及，想做到这一点并不复杂。&lt;/p&gt;
&lt;p&gt;在另一个关键性能指标“延迟”上，S3也被本地磁盘吊打。S3 标准档的&lt;a href=&#34;https://docs.aws.amazon.com/AmazonS3/latest/userguide/optimizing-performance.html&#34;&gt;首字节延迟相当拉垮&lt;/a&gt;，根据文档说明在  &lt;strong&gt;100～200ms&lt;/strong&gt; 百毫秒的范围。当然 AWS 也刚刚在 2023 Re:Invent 上新发布了 “高性能S3” —— &lt;strong&gt;S3 Express One Zone&lt;/strong&gt; ，能够达到单毫秒级的延迟，弥补了这个短板。但是和 4K随机读/写延迟 &lt;strong&gt;55µs/9µs&lt;/strong&gt; 十微秒量级的NVMe 还是相距甚远。&lt;/p&gt;
&lt;p&gt;S3 Express 的毫秒级延迟听上去很不错，但是当我们将其与 NVMe SSD + MinIO 自建对比时，这种“毫秒级”性能就只能自惭形秽了 —— 当代的 NVMe SSD 的4K随机读/写延迟已经达到了 55µs/9µs ，套上一层薄薄的MinIO转发，首字节输出延迟要比 S3 Express 好至少一个数量级。如果用标准档 S3 对比，性能的差距会进一步拉大到三个数量级。&lt;/p&gt;
&lt;p&gt;性能的差距仅仅是一方面，更重要的是成本。标准档的 S3 价格自 2016 年至今都没变过，一直是 0.023 $/GB月，每TB·月的人民币价格是 &lt;strong&gt;161&lt;/strong&gt; 元。高级货色 S3 Express One Zone 的价格比标准档高了一个数量级，达到每月·GB &lt;strong&gt;$0.16&lt;/strong&gt;，每TB·月的人民币价格为 &lt;strong&gt;1120&lt;/strong&gt; 元。作为参考，我们可以引用《&lt;a href=&#34;https://mp.weixin.qq.com/s/1OSRcBfd58s0tgZTUZHB9g&#34;&gt;重新拿回计算机硬件的红利&lt;/a&gt;》和 《&lt;a href=&#34;https://mp.weixin.qq.com/s/UxjiUBTpb1pRUfGtR9V3ag&#34;&gt;云盘是不是杀猪盘&lt;/a&gt;》中的数据进行对比：&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;&lt;strong&gt;因素&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;本地&lt;/strong&gt; &lt;strong&gt;PCI-E NVME SSD&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;Aliyun ESSD PL3&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;AWS io2 Block Express&lt;/strong&gt;&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;成本&lt;/td&gt;
&lt;td&gt;&lt;strong&gt;14.5 ¥/TB·月&lt;/strong&gt; ( 5年均摊 / 3.2T MLC ) 5 年质保，¥3000 零售&lt;/td&gt;
&lt;td&gt;&lt;strong&gt;3200¥/TB·月&lt;/strong&gt; （原价 6400¥，包月4000¥） 3年预付整体打5折才有此价格&lt;/td&gt;
&lt;td&gt;&lt;strong&gt;1900 ¥/TB·月&lt;/strong&gt; 使用最大规格 65536GB 256K IOPS 最优惠状态&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;容量&lt;/td&gt;
&lt;td&gt;32TB&lt;/td&gt;
&lt;td&gt;32 TB&lt;/td&gt;
&lt;td&gt;64 TB&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;IOPS&lt;/td&gt;
&lt;td&gt;4K随机读：600K ~ 1.1M 4K随机写 200K ~ 350K&lt;/td&gt;
&lt;td&gt;4K随机读：最大 1M&lt;/td&gt;
&lt;td&gt;16K随机IOPS： 256K&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;延迟&lt;/td&gt;
&lt;td&gt;4K随机读：75µs 4K随机写：15µs&lt;/td&gt;
&lt;td&gt;4K 随机读： 200µs&lt;/td&gt;
&lt;td&gt;随机IO：500µs 上下文推断为16K&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;可靠&lt;/td&gt;
&lt;td&gt;UBER &amp;lt; 1e-18，折合18个9 MTBF: 200万小时 5DWPD，持续三年&lt;/td&gt;
&lt;td&gt;数据可靠性 9个9 &lt;a href=&#34;https://help.aliyun.com/document_detail/476273.html&#34;&gt;存储与数据可靠性&lt;/a&gt;&lt;/td&gt;
&lt;td&gt;&lt;strong&gt;持久性&lt;/strong&gt;：99.999%，5个9 （0.001% 年故障率） &lt;a href=&#34;https://aws.amazon.com/cn/blogs/storage/achieve-higher-database-performance-using-amazon-ebs-io2-block-express-volumes/&#34;&gt;io2 说明&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;SLA&lt;/td&gt;
&lt;td&gt;5年质保 出问题直接换新&lt;/td&gt;
&lt;td&gt;&lt;a href=&#34;https://terms.aliyun.com/legal-agreement/terms/suit_bu1_ali_cloud/suit_bu1_ali_cloud201910310944_35008.html?spm=a2c4g.11186623.0.0.270e6e37n8Exh5&#34;&gt;Aliyun RDS SLA&lt;/a&gt; 可用性 99.99%: 月费 15% 99%: 月费 30% 95%: 月费 100%&lt;/td&gt;
&lt;td&gt;&lt;a href=&#34;https://d1.awsstatic.com/legal/amazonrdsservice/Amazon-RDS-Service-Level-Agreement-Chinese.pdf&#34;&gt;Amazon RDS SLA&lt;/a&gt; 可用性 99.95%: 月费 15% 99%: 月费 25% 95%: 月费 100%&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;这里本地 NVMe SSD 使用的例子是 Shannon DirectIO G5i 3.2TB MLC颗粒企业级SSD，是我们自己大规模使用的SSD卡。全新拆机零售件价 ¥2788 （闲鱼都有！），按5年60个月折算的每TB·月的人民币价格为 14.5 元。咱们退一步将按浪潮列表价 ¥4388 核算，TB·月价也就是 22.8。如果这个例子还不够，我们可以参考《&lt;a href=&#34;https://mp.weixin.qq.com/s/CicctyvV1xk5B-AsKfzPjw&#34;&gt;是时候放弃云计算吗&lt;/a&gt;》里面 DHH 下云采购的 12 TB Gen4 NVMe 企业级 SSD，2390$ 一块，TB·月价也正好是 &lt;strong&gt;23&lt;/strong&gt; 块钱。&lt;/p&gt;
&lt;p&gt;那么问题就来了，性能好几个数量级的 NVMe SSD，为什么单价比 S3 标准档还要便宜一个数量级（161 vs 23），比 S3 Express 便宜了两个数量级（1120 vs 23 x3 ）？如果我用这样的硬件（就算上三副本） + 开源软件自建一个对象存储服务，是不是可以实现三个数量级的性价比提升？（这还没提 SSD 在可靠性相对于 HDD 的优势）&lt;/p&gt;
&lt;p&gt;特别值得一提的，上面对比的还单纯是存储空间的费用，流入流出对象存储的流量费通常也是一笔非常可观的支出，有的档位收费靠的不是存储费用，而是取回流量费。还有 SSD 相对 HDD 可靠性的问题，云上数据自主可控的问题，这里就不再深入展开了。&lt;/p&gt;
&lt;p&gt;当然云厂商也会辩解——说我们这个 S3 啊，可不是纯粹的存储硬件资源，而是一个开箱即用的&lt;strong&gt;服务&lt;/strong&gt;。里面还包含了软件的知识产权，人力的维护成本；而自建故障率高，自建更危险，自建运维人力开销大等等等等，可惜，这套说辞放在 2006 年或者 2013 年还可以说得通，放在今天就显得有些滑稽了。&lt;/p&gt;
&lt;hr&gt;
&lt;h2 id=&#34;开源自建对象存储&#34;&gt;开源自建对象存储&lt;/h2&gt;
&lt;p&gt;在十几年前，绝大多数用户都缺乏IT自建能力，S3也没有足够成熟的开源替代品。用户可以容忍接受这样的高科技溢价。然而当各家云厂商、IDC都开始提供对象存储，甚至都出现了开源免费的对象存储方案（MinIO）后，卖方市场变成了买方市场，价值定价逻辑转变为成本定价逻辑后，不降反涨的资源溢价自然就会面临用户的拷问 —— 它到底给我带来了什么额外价值，以至于要收这种巨额费用。&lt;/p&gt;
&lt;p&gt;云的倡导者声称，上云相比自建更便宜，更简单，更快捷。对于个人站长，中小互联网企业这些云适用光谱内的用户来说，这么说肯定是没问题的。如果你的数据规模只有几十个GB，或者有一些中小规模的出海业务和CDN需求，我并不会推荐你凑热闹自建什么对象存储，你应该出门左转去 Cloudflare 用 R2 —— 这也许就是最优解。&lt;/p&gt;
&lt;p&gt;然而对于真正贡献营收大头的高价值中大规模客户来说，这些价值主张就不一定成立了。如果你主要是在本地存储使用 TB/PB 规模的数据，那么确实应当认真考虑一下自建对象存储服务的成本与收益 —— 现在用开源软件自建已经非常简单、稳定与成熟了。存储服务的可靠性主要取决于磁盘冗余：除了零星的硬盘故障 （HDD AFR 1%，SSD 2～3‰）需要你（请代维服务商）换上备件，并不会有多少额外的负担。&lt;/p&gt;
&lt;p&gt;如果说混合了EBS/S3能力的开源 Ceph 还能算有不少运维复杂度，功能也没有完全拉齐；那么完全兼容 S3 的对象存储服务开源替代 &lt;strong&gt;MinIO&lt;/strong&gt; 可以说是开箱即用了 —— 一个没有额外依赖的纯二进制，不需要几个配置参数就可以快速拉起，把服务器上的磁盘阵列转变为一个标准的本地 S3 兼容服务，甚至还集成了了 AWS 的 AK/SK/IAM 兼容实现！&lt;/p&gt;
&lt;p&gt;从运维管理的角度看，Redis 的运维复杂度比 &lt;a href=&#34;http://mp.weixin.qq.com/s?__biz=MzU5ODAyNTM5Ng==&amp;mid=2247485685&amp;idx=1&amp;sn=688f6d6d0f4128d7f77d710f04ff9024&amp;chksm=fe4b3d2ec93cb438665b7e0d554511674091b2e486a70b8a3eb7e2c7a53681fb9834a08cb3c3&amp;scene=21#wechat_redirect&#34;&gt;&lt;strong&gt;PostgreSQL&lt;/strong&gt;&lt;/a&gt; 低一个数量级，而 MinIO 的运维复杂度又比 &lt;a href=&#34;http://mp.weixin.qq.com/s?__biz=MzU5ODAyNTM5Ng==&amp;mid=2247484821&amp;idx=1&amp;sn=56e34b33f37b2555336591ad532ac7e7&amp;chksm=fe4b304ec93cb9589c2bca821e5aaa1034c7dd5b9c580dec4b09ebe3b1ed20bb48df9dfd29ce&amp;scene=21#wechat_redirect&#34;&gt;&lt;strong&gt;Redis&lt;/strong&gt;&lt;/a&gt; 还要再低一个数量级。它简单到这样一种程度：我一个人可以花个一周不到时间把 MinIO 的部署/监控作为添头放到我们开源的 &lt;a href=&#34;http://mp.weixin.qq.com/s?__biz=MzU5ODAyNTM5Ng==&amp;mid=2247485518&amp;idx=1&amp;sn=3d5f3c753facc829b2300a15df50d237&amp;chksm=fe4b3d95c93cb4833b8e80433cff46a893f939154be60a2a24ee96598f96b32271301abfda1f&amp;scene=21#wechat_redirect&#34;&gt;&lt;strong&gt;PostgreSQL RDS&lt;/strong&gt;&lt;/a&gt; 方案里来，用作可选的中央备份存储仓库。&lt;/p&gt;
&lt;p&gt;我在探探时，有几个 MinIO 集群就是这么搭建维护的：放了 &lt;strong&gt;25PB&lt;/strong&gt; 数据，可能是国内先前最大规模的 MinIO 部署。用了多少人来维护呢？抽调了一个运维工程师 1/10 不到的工作时间来兼职罢了，而自建整体综合成本在云列表价 0.5 折浮动。实践出真知，如果有人骗你说对象存储自建很难很贵，你确实可以自己动手试试 —— 要不了几个钟头，这些销售 FUD 话术就会不攻自破。&lt;/p&gt;
&lt;p&gt;对于对像存储服务来说，云的三点核心价值主张：“&lt;strong&gt;更便宜，更简单，更快捷&lt;/strong&gt;” ，&lt;strong&gt;更简单&lt;/strong&gt;这条说不上，&lt;strong&gt;更便宜&lt;/strong&gt;走向了反面，恐怕只剩下最后一点&lt;strong&gt;更快捷&lt;/strong&gt;了 —— 在这一点上确实没有谁能比过云，你确实可以在云上用1分钟不到在全世界所有区域申请PB级的存储服务，Which is Amazing！只不过你也要为这个鸡肋特权付出几十倍的高昂溢价。&lt;/p&gt;
&lt;p&gt;因此对于对像存储服务来说，云的三点核心价值主张：“更便宜，更简单，更快捷” 中，更简单这条说不上，更便宜走向了反面，恐怕只剩下最后一点快捷了 —— 在这一点上确实没有谁能比过云，你确实可以在云上用1分钟不到在全世界所有区域申请PB级的存储服务，Which is Amazing！只不过你也要为这个特权掏十几倍到几十倍的高昂溢价就是了。而对于有一定规模的企业而言，比起翻几番的运营成本来说，等个两周或者多掏点一次性资本投入根本不算个事。&lt;/p&gt;
&lt;hr&gt;
&lt;h2 id=&#34;小结&#34;&gt;小结&lt;/h2&gt;
&lt;p&gt;记得在 2019年4月1日，国内增值税正式从 16% 下调到 13% ，苹果官网随即全面降价，单品最高降价幅度达8% —— iPhone的几个典型产品都降了500元，把税点返还给了用户。但也有许多厂商选择装聋作哑维持原价，自己吃下这个福利 —— 白花花的银子怎么能随便散给别人呢？&lt;/p&gt;
&lt;p&gt;类似的事情就发生在云计算领域 —— &lt;strong&gt;硬件成本的指数下降，并没有在云厂商的服务价格上充分反映出来，而这一点，让公有云逐渐从普惠基础设施变成了垄断集中杀猪盘&lt;/strong&gt;。&lt;/p&gt;
&lt;p&gt;然而事情正在起变化，硬件重新变得有趣起来，而云厂商没有办法把这部分红利永远掩藏遮盖下去 —— &lt;strong&gt;聪明的人开始计算数字，勇敢的人已经采取行动&lt;/strong&gt; 。像马斯克和 &lt;a href=&#34;/zh/blog/cloud/odyssey&#34;&gt;&lt;strong&gt;DHH&lt;/strong&gt;&lt;/a&gt; 。越来越多的人会同样意识到这一点，追随先驱者做出明智的选择，拿回属于自己的硬件红利。&lt;/p&gt;
&lt;h3 id=&#34;references&#34;&gt;References&lt;/h3&gt;
&lt;p&gt;&lt;code&gt;[1]&lt;/code&gt; 2006: &lt;em&gt;&lt;a href=&#34;https://aws.amazon.com/cn/blogs/aws/amazon_s3/&#34;&gt;https://aws.amazon.com/cn/blogs/aws/amazon_s3/&lt;/a&gt;&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;&lt;code&gt;[2]&lt;/code&gt; 2010: &lt;em&gt;&lt;a href=&#34;http://aws.typepad.com/aws/2010/11/what-can-i-say-another-amazon-s3-price-reduction.html&#34;&gt;http://aws.typepad.com/aws/2010/11/what-can-i-say-another-amazon-s3-price-reduction.html&lt;/a&gt;&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;&lt;code&gt;[3]&lt;/code&gt; 2012: &lt;em&gt;&lt;a href=&#34;http://aws.typepad.com/aws/2012/11/amazon-s3-price-reduction-december-1-2012.html&#34;&gt;http://aws.typepad.com/aws/2012/11/amazon-s3-price-reduction-december-1-2012.html&lt;/a&gt;&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;&lt;code&gt;[4]&lt;/code&gt; 2014: &lt;em&gt;&lt;a href=&#34;http://aws.typepad.com/aws/2014/03/aws-price-reduction-42-ec2-s3-rds-elasticache-and-elastic-mapreduce.html&#34;&gt;http://aws.typepad.com/aws/2014/03/aws-price-reduction-42-ec2-s3-rds-elasticache-and-elastic-mapreduce.html&lt;/a&gt;&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;&lt;code&gt;[5]&lt;/code&gt; 2016: &lt;em&gt;&lt;a href=&#34;https://aws.amazon.com/ru/blogs/aws/aws-storage-update-s3-glacier-price-reductions/&#34;&gt;https://aws.amazon.com/ru/blogs/aws/aws-storage-update-s3-glacier-price-reductions/&lt;/a&gt;&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;&lt;code&gt;[6]&lt;/code&gt; 2023: &lt;em&gt;&lt;a href=&#34;https://aws.amazon.com/cn/s3/pricing&#34;&gt;https://aws.amazon.com/cn/s3/pricing&lt;/a&gt;&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;&lt;code&gt;[7]&lt;/code&gt; 首字节延迟相当拉垮: &lt;em&gt;&lt;a href=&#34;https://docs.aws.amazon.com/AmazonS3/latest/userguide/optimizing-performance.html&#34;&gt;https://docs.aws.amazon.com/AmazonS3/latest/userguide/optimizing-performance.html&lt;/a&gt;&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;&lt;code&gt;[8]&lt;/code&gt; 存储与数据可靠性: &lt;em&gt;&lt;a href=&#34;https://help.aliyun.com/document_detail/476273.html&#34;&gt;https://help.aliyun.com/document_detail/476273.html&lt;/a&gt;&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;&lt;code&gt;[9]&lt;/code&gt; io2 说明: &lt;em&gt;&lt;a href=&#34;https://aws.amazon.com/cn/blogs/storage/achieve-higher-database-performance-using-amazon-ebs-io2-block-express-volumes/&#34;&gt;https://aws.amazon.com/cn/blogs/storage/achieve-higher-database-performance-using-amazon-ebs-io2-block-express-volumes/&lt;/a&gt;&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;&lt;code&gt;[10]&lt;/code&gt; Aliyun RDS SLA: &lt;em&gt;&lt;a href=&#34;https://terms.aliyun.com/legal-agreement/terms/suit_bu1_ali_cloud/suit_bu1_ali_cloud201910310944_35008.html?spm=a2c4g.11186623.0.0.270e6e37n8Exh5&#34;&gt;https://terms.aliyun.com/legal-agreement/terms/suit_bu1_ali_cloud/suit_bu1_ali_cloud201910310944_35008.html?spm=a2c4g.11186623.0.0.270e6e37n8Exh5&lt;/a&gt;&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;&lt;code&gt;[11]&lt;/code&gt; Amazon RDS SLA: &lt;em&gt;&lt;a href=&#34;https://d1.awsstatic.com/legal/amazonrdsservice/Amazon-RDS-Service-Level-Agreement-Chinese.pdf&#34;&gt;https://d1.awsstatic.com/legal/amazonrdsservice/Amazon-RDS-Service-Level-Agreement-Chinese.pdf&lt;/a&gt;&lt;/em&gt;&lt;/p&gt;

      </description>
    </item>
    
    <item>
      <title>Blog: 云数据库是不是智商税</title>
      <link>/zh/blog/cloud/rds/</link>
      <pubDate>Mon, 30 Jan 2023 00:00:00 +0000</pubDate>
      
      <guid>/zh/blog/cloud/rds/</guid>
      <description>
        
        
        
        <![CDATA[<img src="/zh/blog/cloud/rds/featured_hu02aa61ae1d9de35cbe238d2676170cb9_178789_640x0_resize_q75_catmullrom.jpg" width="640" height="640"/>]]>
        
        &lt;p&gt;寒冬来袭，大厂纷纷开始裁员，进入降本增效模式，作为公有云杀猪刀一哥的云数据库，故事还能再讲下去吗？&lt;/p&gt;
&lt;p&gt;近日，Basecamp &amp;amp; HEY 联合创始人 DHH 的一篇文章【1,2】引起热议，主要内容可以概括为一句话：&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;“我们每年在云数据库（RDS/ES）上花50万美元，你知道50万美元可以买多少牛逼的服务器吗？&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;我们要下云，拜拜了您呐！“&lt;/strong&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;&lt;strong&gt;所以，50 万美元可以买多少牛逼的服务器 ？&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;https://mp.weixin.qq.com/s/YKqH324Qtg0mj6WfSMb66w&#34;&gt;&lt;img src=&#34;/zh/blog/cloud/rds/featured.png&#34;&gt;&lt;/a&gt;&lt;/p&gt;
&lt;hr&gt;
&lt;h2 id=&#34;荒谬定价&#34;&gt;荒谬定价&lt;/h2&gt;
&lt;blockquote&gt;
&lt;p&gt;磨刀霍霍向猪羊&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;&lt;strong&gt;我们可以换一种问法，服务器和RDS都卖多少钱？&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;以我们自己数据库大量使用的物理机型为例：Dell R730， 64核384GB内存，加装一块 3.2 TB MLC的NVME SSD。像这样的一台服务器部署标准的生产级 PostgreSQL，单机可以承载十几万的TPS，只读点查询可以干到四五十万。要多钱呢？算上电费网费IDC托管代维费用，按照5年报废均摊，整个生命周期成本七万五千上下，合每年一万五。当然，如果要在生产中使用，高可用是必须的，所以通常一组数据库集群需要两到三台物理机，也就是每年3万到4.5万。&lt;/p&gt;
&lt;p&gt;这里没有算入DBA费用：两三个人管几万核真没多少。&lt;/p&gt;
&lt;p&gt;如果您直接购买这样规格的云数据库，则费用几何呢？让我们看看国内阿里云的收费【3】。因为基础版（乞丐版）实在是没法生产实用（请参考：《&lt;a href=&#34;http://mp.weixin.qq.com/s?__biz=MzU5ODAyNTM5Ng==&amp;mid=2247485093&amp;idx=1&amp;sn=5815f71f1d832101d35a75f5aa4acd3c&amp;chksm=fe4b337ec93cba68fbf30eb0ed50d052c6e8972d42cf506051b5016668f4555edaa0756688dc&amp;scene=21#wechat_redirect&#34;&gt;云数据库：删库到跑路&lt;/a&gt;》），我们选用高可用版，通常底下是两到三个实例。包年包月，引擎 PostgreSQL 15 on x86，华东1默认可用区，独享的64核256GB实例：pg.x4m.8xlarge.2c，并加装一块3.2TB的ESSD PL3云盘。每年的费用在25万（3年）到75万（按需）不等，其中存储费用约占1/3。&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;/zh/blog/cloud/rds/rds-1.png&#34;&gt;&lt;/p&gt;
&lt;p&gt;让我们再来看看公有云一哥AWS【4】【5】。AWS上与此最接近的是 db.m5.16xlarge ，也是64核256GB多可用区部署，同理，我们加装一块最大8万IOPS，3.2TB的 io1 SSD磁盘，查询AWS全球与国区的报价，总体在每年160 ～ 217万元不等，存储费用约占一半，整体成本如下表所示：&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;付费模式&lt;/th&gt;
&lt;th&gt;价格&lt;/th&gt;
&lt;th&gt;折合每年（万¥）&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;IDC自建（单物理机）&lt;/td&gt;
&lt;td&gt;¥7.5w / 5年&lt;/td&gt;
&lt;td&gt;1.5&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;IDC自建（2～3台组HA）&lt;/td&gt;
&lt;td&gt;¥15w / 5年&lt;/td&gt;
&lt;td&gt;3.0 ~ 4.5&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;阿里云 RDS 按需&lt;/td&gt;
&lt;td&gt;¥87.36/时&lt;/td&gt;
&lt;td&gt;76.5&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;阿里云 RDS 月付（基准）&lt;/td&gt;
&lt;td&gt;¥4.2w / 月&lt;/td&gt;
&lt;td&gt;50&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;阿里云 RDS 年付（85折）&lt;/td&gt;
&lt;td&gt;¥425095 / 年&lt;/td&gt;
&lt;td&gt;42.5&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;阿里云 RDS 3年付（5折）&lt;/td&gt;
&lt;td&gt;¥750168 / 3年&lt;/td&gt;
&lt;td&gt;25&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;AWS 按需&lt;/td&gt;
&lt;td&gt;$25,817 / 月&lt;/td&gt;
&lt;td&gt;217&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;AWS 1年不预付&lt;/td&gt;
&lt;td&gt;$22,827 / 月&lt;/td&gt;
&lt;td&gt;191.7&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;AWS 3年全预付&lt;/td&gt;
&lt;td&gt;12w$ + 17.5k$/月&lt;/td&gt;
&lt;td&gt;175&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;AWS 中国/宁夏按需&lt;/td&gt;
&lt;td&gt;¥197,489 / 月&lt;/td&gt;
&lt;td&gt;237&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;AWS 中国/宁夏1年不预付&lt;/td&gt;
&lt;td&gt;¥143,176 / 月&lt;/td&gt;
&lt;td&gt;171&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;AWS 中国/宁夏3年全预付&lt;/td&gt;
&lt;td&gt;¥647k + 116k/月&lt;/td&gt;
&lt;td&gt;160.6&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;我们可以对比一下自建与云数据库的成本差异：&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;方式&lt;/th&gt;
&lt;th&gt;折合每年（万元）&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;IDC托管服务器 64C / 384G / 3.2TB NVME SSD 660K IOPS (2～3台)&lt;/td&gt;
&lt;td&gt;3.0 ~ 4.5&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;阿里云 RDS PG 高可用版 pg.x4m.8xlarge.2c, 64C / 256GB / 3.2TB ESSD PL3&lt;/td&gt;
&lt;td&gt;25 ～ 50&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;AWS RDS PG 高可用版 db.m5.16xlarge, 64C / 256GB / 3.2TB io1 x 80k IOPS&lt;/td&gt;
&lt;td&gt;160 ～ 217&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;所以问题来了，&lt;strong&gt;如果你用云数据库1年的钱，就够你买几台甚至十几台性能更好的服务器，那么使用云数据库的意义到底在哪里&lt;/strong&gt;？当然，公有云的大客户通常可以有商务折扣，但再怎么打折，数量级上的差距也是没法弥补的吧？&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;用云数据库到底是不是在交智商税？&lt;/strong&gt;&lt;/p&gt;
&lt;hr&gt;
&lt;h2 id=&#34;适用场景&#34;&gt;适用场景&lt;/h2&gt;
&lt;blockquote&gt;
&lt;p&gt;没有银弹&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;&lt;strong&gt;数据库是数据密集型应用的核心&lt;/strong&gt;，应用跟着数据库走，所以数据库选型需要非常审慎。而评价一款数据库需要从许多维度出发：可靠性，安全性，简单性，可伸缩性，可扩展性，可观测性，可维护性，成本性价比，等等等等。甲方真正在意的是这些属性，而不是虚头巴脑的技术炒作：存算分离，Serverless，HTAP，云原生，超融合……，这些必须翻译成工程的语言：&lt;strong&gt;牺牲了什么换来了什么&lt;/strong&gt;，才有实际意义。&lt;/p&gt;
&lt;p&gt;公有云的鼓吹者很喜欢往给它脸上贴金：节约成本，灵活弹性，安全可靠，是企业数字化转型的万灵药，是汽车对马车的革命，又好又快还便宜，诸如此类，可惜没几条是实事求是的。绕开这些虚头巴脑的东西，云数据库相比专业的数据库服务真正有优势的属性只有一条：&lt;strong&gt;弹性&lt;/strong&gt;。具体来说是两点：&lt;strong&gt;启用成本低，可伸缩性强&lt;/strong&gt;。&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;启动成本低&lt;/strong&gt;，意味着用户不需要进行机房建设，人员招聘培训，服务器采购就可以开始用；&lt;strong&gt;可伸缩性强&lt;/strong&gt;，指的是各种配置升降配，扩缩容比较容易；因此公有云真正适用的场景核心就是这两种：&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;起步阶段，流量极小的简单应用&lt;/strong&gt;&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;毫无规律可循，大起大落的负载&lt;/strong&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;前者主要包括简单网站，个人博客，小程序小工具，演示/PoC，Demo，后者主要包括低频的的数据分析/模型训练，突发的秒杀抢票，明星并发出轨等特殊场景。&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;公有云的商业模型就是租赁&lt;/strong&gt;：租服务器，租带宽，租存储，租专家。它和租房，租车，租充电宝没有本质区别。当然，租服务器和运维外包实在是不怎么中听，所以有了云这个名字，听起来更有赛博地主的感觉。而租赁这种模式的特点，就是弹性。&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;租赁模型有租赁的好处&lt;/strong&gt;，出门在外，共享充电宝可以解决临时应急性的小规模充电需求。但对于大量日常从家到单位两点一线的人来说，每天用共享充电宝给手机电脑充电，毫无疑问是非常荒谬的，何况共享充电宝租一个小时4块钱，租几个小时的钱，就够你把它直接买下来了。租车可以很好的满足临时的、突发的、一次性用车需求：外地出差旅游，临时拉一批货。但如果你的出行需求是频繁的，本地性，那么购置一辆自动驾驶的车也许是最省事省钱的选择。&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;问题的关键还是在于租售比&lt;/strong&gt;，房子的租售比几十年，汽车的租售几年，而公有云服务器的租售比通常只有几个月。如果你的业务能够稳定活几个月以上，为什么要租，而不是直接买呢？&lt;/p&gt;
&lt;p&gt;所以，云厂商赚的钱，要么来自VC砸钱求爆发增长的科技创企，要么来自灰色寻租空间比云溢价还高的特殊单位，要么是人傻钱多的狗大户，要么是零零散散的站长/学生/VPN个人用户。聪明的高净值企业客户，谁会放着便宜舒适的大House不住，跑去挤着租住方舱医院人才公寓呢？&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;如果您的业务符合公有云的适用光谱，那是最好不过；但为了不需要的灵活性与弹性支付几倍乃至十几倍溢价，那是纯交智商税&lt;/strong&gt;**。**&lt;/p&gt;
&lt;hr&gt;
&lt;h2 id=&#34;成本刺客&#34;&gt;成本刺客&lt;/h2&gt;
&lt;blockquote&gt;
&lt;p&gt;任何信息不对称都可以构成盈利空间，但你无法永远欺骗所有人。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;公有云的弹性就是针对其商业模式设计的：&lt;strong&gt;启动成本极低，维持成本极高&lt;/strong&gt;。低启动成本吸引用户上云，而且良好的弹性可以随时适配业务增长，可是业务稳定后形成供应商锁定，尾大不掉，极高的维持成本就会让用户痛不欲生了。这种模式有一个俗称 —— &lt;strong&gt;杀猪盘&lt;/strong&gt;。&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;/zh/blog/cloud/rds/rds-2.gif&#34;&gt;&lt;/p&gt;
&lt;p&gt;在我职业生涯的第一站中，就有这样一次杀猪经历让我记忆犹新。作为前几个被逼上A云的内部BU，A云直接出工程师加入手把手提供上云服务。用ODPS全家桶换掉了自建的大数据/数据库全家桶。应该说，服务确实不错，只不过，每年的存储计算开销从千万出头飙升到接近一亿，利润几乎都转移到A云了，堪称终极成本刺客。&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;/zh/blog/cloud/rds/rds-3.jpeg&#34;&gt;&lt;/p&gt;
&lt;p&gt;后来在下一站，情况则完全不同。我们管理着两万五千核规模，450W QPS的 PostgreSQL 与 Redis 数据库集群。像这种规格的数据库，如果按AWS RCU/WCU 计费，每年几个亿就出去了；即使全买长期包年包月再加个大商务折扣，至少五六千万是肯定是少不了的。而我们总共两三个DBA，几百台服务器，人力+资产均摊每年统共不到一千万。&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;/zh/blog/cloud/rds/rds-31.png&#34;&gt;&lt;/p&gt;
&lt;p&gt;这里我们可以用一种简单的方式来核算单位成本：一核算力（含mem/disk）使用一个月的综合成本，简称&lt;strong&gt;核·月&lt;/strong&gt;。我们核算过自建各机型的成本，以及云厂商给出的报价，大致结果如下：&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th style=&#34;text-align:center&#34;&gt;硬件算力&lt;/th&gt;
&lt;th style=&#34;text-align:center&#34;&gt;单价&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:center&#34;&gt;IDC自建机房（独占物理机 A1: 64C384G）&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;19&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:center&#34;&gt;IDC自建机房（独占物理机 B1: 40C64G）&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;26&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:center&#34;&gt;IDC自建机房（独占物理机 C2: 8C16G）&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;38&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:center&#34;&gt;IDC自建机房（容器，超卖200%）&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;17&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:center&#34;&gt;IDC自建机房（容器，超卖500%）&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;7&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:center&#34;&gt;UCloud 弹性虚拟机（8C16G，有超卖）&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;25&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:center&#34;&gt;阿里云 弹性服务器 2x内存（独占无超卖）&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;107&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:center&#34;&gt;阿里云 弹性服务器 4x内存（独占无超卖）&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;138&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:center&#34;&gt;阿里云 弹性服务器 8x内存（独占无超卖）&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;180&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:center&#34;&gt;AWS C5D.METAL 96C 200G (按月无预付)&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;100&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:center&#34;&gt;AWS C5D.METAL 96C 200G(预付3年)&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;80&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:center&#34;&gt;&lt;strong&gt;数据库&lt;/strong&gt;&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:center&#34;&gt;AWS RDS PostgreSQL db.T2 (4x)&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;440&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:center&#34;&gt;AWS RDS PostgreSQL db.M5 (4x)&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;611&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:center&#34;&gt;AWS RDS PostgreSQL db.R6G (8x)&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;786&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:center&#34;&gt;AWS RDS PostgreSQL db.M5 24xlarge&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;1328&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:center&#34;&gt;阿里云 RDS PG 2x内存（独占）&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;260&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:center&#34;&gt;阿里云 RDS PG 4x内存（独占）&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;320&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:center&#34;&gt;阿里云 RDS PG 8x内存（独占）&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;410&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:center&#34;&gt;ORACLE数据库授权&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;10000&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;所以这里问题就来了，单价二十块的服务器硬件，为什么可以卖出上百块，而且装上云数据库软件还可以再翻几番？&lt;strong&gt;运维是金子做的，还是服务器是金子做的？&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;常用的回应话术是：&lt;em&gt;&lt;strong&gt;数据库是基础软件里的皇冠明珠，凝聚着无数无形知识产权BlahBlah&lt;/strong&gt;&lt;/em&gt;。因此软件的价格远超硬件非常合理。如果是 Oracle 这样的顶尖商业数据库，或者索尼任天堂的主机游戏，这么说也过得去。&lt;/p&gt;
&lt;p&gt;但公有云上的云数据库（RDS for PostgreSQL/MySQL/&amp;hellip;.），本质上是开源数据库内核换皮魔改封装，加上自己管控软件和共享DBA人头服务。那这种溢价率就非常荒谬了：数据库内核是免费的呀，&lt;strong&gt;你家管控软件是金子做的，还是DBA是金子做的？&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;/zh/blog/cloud/rds/gold-rds.gif&#34;&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;公有云的秘密就在这里：&lt;strong&gt;&lt;strong&gt;用廉价的存算资源获客，用云数据库杀猪&lt;/strong&gt;&lt;/strong&gt;。&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;尽管国内公有云 IaaS （存储、计算、网络）的收入占营收接近一半，但毛利率只有 15% ～ 20%，而公有云 PaaS 的营收虽然不如 IaaS，但 PaaS 的毛利率可以达到 50%，完爆卖资源吃饭的 IaaS 。&lt;strong&gt;而 PaaS 中最具代表性的，就是云数据库&lt;/strong&gt;。&lt;/p&gt;
&lt;p&gt;正常来说，如果不是把公有云单纯当作一个 IDC 2.0 或者 CDN供应商来用，最费钱的服务就是数据库。公有云上的存储、计算、网络资源贵吗？严格来说不算特别离谱。IDC托管物理机代维的核月成本大约为二三十块，而公有云上一核 CPU 算力用一个月的价格，大概在七八十块到一两百块，考虑到各种折扣与活动，以及弹性溢价，勉强处在可以接受的合理范围。&lt;/p&gt;
&lt;p&gt;但云数据库就非常离谱了，同样是一核算力用一个月，云数据库价格比起对应规格的硬件可以翻几倍乃至十几倍。便宜一些阿里云，核月单价两百到四百，贵一些的 AWS，核月单价可以七八百甚至上千。&lt;/p&gt;
&lt;p&gt;如果说您只有一两核的 RDS ，那也别折腾了，交点税就交点吧。但如果您的业务上了量还不赶紧从云上下来，那可真的是在交智商税了。&lt;/p&gt;
&lt;hr&gt;
&lt;h2 id=&#34;足够好吗&#34;&gt;足够好吗？&lt;/h2&gt;
&lt;blockquote&gt;
&lt;p&gt;不要误会，云数据库只是及格品大锅饭。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;关于云数据库/云服务器的成本，如果您能跟销售聊到这儿，话术就该变成：&lt;em&gt;&lt;strong&gt;虽然我们贵，但是我们好呀！&lt;/strong&gt;&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;但是，云数据库真的好吗？&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;应该说，对于玩具应用，小微网站，个人托管，以及土法野路子自建数据库来，毫无技术认知的甲方来说，RDS也许足够好了。但在高净值客户与数据库专家看来，RDS不过是及格线上的大锅饭产品罢了。&lt;/p&gt;
&lt;p&gt;说到底，公有云源于大厂内部的运维能力外溢，大厂人自己厂里技术啥样门儿清，大可不必有啥莫名的崇拜。（Google也许算个例外）。&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;/zh/blog/cloud/rds/rds-4.png&#34;&gt;&lt;/p&gt;
&lt;p&gt;以 &lt;strong&gt;性能&lt;/strong&gt; 为例，性能的核心指标是 &lt;strong&gt;延迟 / 响应时间&lt;/strong&gt;，特别是长尾延迟，会直接影响用户体验：没有人愿意等着划一下屏幕转几秒圈圈。而在这一点上，&lt;strong&gt;磁盘&lt;/strong&gt;起到决定性作用。&lt;/p&gt;
&lt;p&gt;我们生产环境数据库中使用的是本地 NVME SSD，典型4K写延迟为15µs，读延迟94µs。因而，PostgreSQL简单查询的响应时间通常为 100 ~ 300µs，应用侧的查询响应时间通常为 200 ~ 600µs；对于简单查询，我们的 SLO 是命中1ms内，未命中10ms内，超过10ms算慢查询，要打回去优化。&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;/zh/blog/cloud/rds/rds-41.png&#34;&gt;&lt;/p&gt;
&lt;p&gt;而 AWS 提供的EBS服务用fio实测性能极其拉垮【6】，默认的gp3读写延迟为 40ms，io1 读写延迟为10ms，整整差了近三个数量级，而且IOPS最大也只有八万。RDS使用的存储就是EBS，如果连一次磁盘访问都需要10ms，那这就根本没法整了。io2 倒是使用了自建同款 NVMe SSD，然而远程块存储相比本地磁盘延迟直接翻倍。&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;/zh/blog/cloud/rds/rds-5.png&#34;&gt;&lt;/p&gt;
&lt;p&gt;确实，有时候云厂商会提供性能足够好的本地的NVME SSD，但都会非常鸡贼的设定各种限制条件，来避免用户来使用EC2来自建数据库。AWS的限制方式是只有NVME SSD Ephemeral Storage，这种盘一旦遇上EC2重启就自动抹干净了，根本没法用。阿里云的限制方式是给你卖天价，相比直接采购硬件，&lt;strong&gt;阿里云的 ESSD PL3 则高达 200 倍&lt;/strong&gt;。以 3.2TB 规格的企业级 PCI-E SSD 卡为参照基准，AWS 上售租比为 1个月，阿里云上为 9 天，租用此时长即可买下整块磁盘。若在阿里云以采购三年最大优惠五折计算，租用三年的时间可购买 123 块同款硬盘近 400TB 永久所有权。&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;再以&lt;/strong&gt; &lt;strong&gt;可观测性&lt;/strong&gt; &lt;strong&gt;为例，没有一家RDS的监控能称得上是“好”&lt;/strong&gt;。就以监控指标数量来说吧，虽然说知道服务死了还是活着只需要几个指标，但如果想进行故障根因分析，需要越多越好的监控指标来构建良好的Context。而大多数RDS都只是做了一些基本的监控指标，和简陋到可怜的监控面板。以阿里云RDS PG为例【7】，所谓的“增强监控”，里面只有这么点可怜的指标 ， AWS里和PG数据库相关的指标也差不多不到100个，而我们自己的监控系统里主机指标有800多类，PGSQL数据库指标610类，REDIS指标257类，整个大约三千类指标，在数量上完爆这些RDS。&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;/zh/blog/cloud/rds/rds-6.png&#34;&gt;&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;/img/pigsty/dashboard.jpg&#34;&gt;&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;公开 &lt;a href=&#34;https://demo.pigsty.cc&#34;&gt;Demo&lt;/a&gt;：https://demo.pigsty.cc&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;至于&lt;strong&gt;可靠性&lt;/strong&gt;，以前我对RDS的可靠性还抱有基本的信任，直到一个月前A云香港机房那场丑闻。租的机房，服务器喷水消防，OSS故障，大量RDS不可用也切不了；然后A云自己整个Region的管控服务竟然因为一个单AZ的故障自己挂点了，&lt;strong&gt;连自己的管控API都做不到异地容灾，那做云数据库异地容灾岂不是天大的笑话&lt;/strong&gt;。&lt;/p&gt;
&lt;p&gt;当然，并不是说自建就不会出现这些问题，只是稍微靠谱点的IDC托管都不至于犯这么离谱的错误。安全性也不用多说，最近闹的出过的几次大笑话，比如著名的SHGA；一堆样例代码里硬编码AK/SK，云RDS更安全吗？别搞笑啦，经典架构起码还有VPN堡垒机扛着一层，而公网上暴露端口弱密码裸奔的数据库简直不要太多，攻击面肯定是更大了无疑。&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;云数据库另一个广为人所诟病的是其可扩展性&lt;/strong&gt;。RDS是不给用户 dbsu 权限的，这也意味着用户是不能在数据库中安装扩展插件，而 PostgreSQL 的插件恰恰就是其醍醐味，没有扩展的PostgreSQL就像可乐不加冰，酸奶不加糖一样。更严重的问题是&lt;strong&gt;在一些故障出现时，用户甚至都丧失了自我救助的能力&lt;/strong&gt;，参见《&lt;a href=&#34;http://mp.weixin.qq.com/s?__biz=MzU5ODAyNTM5Ng==&amp;mid=2247485093&amp;idx=1&amp;sn=5815f71f1d832101d35a75f5aa4acd3c&amp;chksm=fe4b337ec93cba68fbf30eb0ed50d052c6e8972d42cf506051b5016668f4555edaa0756688dc&amp;scene=21#wechat_redirect&#34;&gt;云数据库：从删库到跑路&lt;/a&gt;》中的真实案例：WAL归档与PITR这么基础性的功能，在RDS中竟然是一个付费的升级功能。至于可维护性，有些人说云数据库可以点点鼠标就创建销毁多方便呀，说这话的人肯定没经历过重启每个数据库都要收手机短信验证码的山炮场景。&lt;strong&gt;有 Database as Code 式的管理工具，真正的工程师绝对不会用这种“ClickOps”&lt;/strong&gt;。&lt;/p&gt;
&lt;p&gt;不过任何事物存在都有其道理，云数据库也不是一无是处，在&lt;strong&gt;可伸缩性&lt;/strong&gt;上，云数据库确实卷出了新高度，比如各种 Serverless 的花活，但这也是给云厂商自己省钱超卖用的，对用户来说确实没有太大意义。&lt;/p&gt;
&lt;hr&gt;
&lt;h2 id=&#34;淘汰dba&#34;&gt;淘汰DBA？&lt;/h2&gt;
&lt;blockquote&gt;
&lt;p&gt;被云厂商垄断，想招都找不到，还淘汰？&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;&lt;strong&gt;云数据库的另一种鼓吹思路是，用了RDS，你就不用DBA啦！&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;例如这篇知名点炮文《&lt;a href=&#34;https://mp.weixin.qq.com/s/DtRFnh8LgtfesCNMNl3eNw&#34;&gt;你怎么还在招聘DBA&lt;/a&gt;》【8】里说：我们有数据库自治服务！RDS和DAS能帮你解决这些数据库相关的问题，DBA都要下岗了，哈哈哈哈。我相信任何认真看过这些所谓“自治服务”，“AI4DB”官方文档【9】【10】的人都不会相信这种鬼话：&lt;strong&gt;连一个足够好用的监控系统都算不上的小模块，能让数据库自治起来，这不是在说梦话？&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;DBA，Database Administrator，数据库管理员，以前也叫做数据库协调员、数据库程序员。DBA是一个横跨于研发团队与运维团队的广博角色，涉及DA、SA、Dev、Ops、以及SRE的多种职责，负责各种与数据与数据库有关的问题：设置管理策略与运维标准，规划软硬件架构，协调管理数据库，验证表模式设计，优化SQL查询，分析执行计划，乃至于处理紧急故障以及抢救数据。&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;DBA的第一点价值在于安全兜底&lt;/strong&gt;：&lt;strong&gt;他是企业核心数据资产的守护者，也是可以轻易对企业造成致命伤害的人&lt;/strong&gt;。在蚂蚁金服有个段子，能搞死支付宝的，除了监管就是DBA了。高管们通常也很难意识到 DBA 对于公司的重要性，直到出了数据库事故，一堆CXO紧张地站在DBA背后观看救火修复过程时…。比起避免一场数据库故障所造成的损失，例如：全美停航，Youtube宕机，工厂停产一天，雇佣DBA的成本显得微不足道。&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;DBA的第二点价值在于模型设计与优化&lt;/strong&gt;。许多公司并不在乎他们的查询是纯狗屎，他们只是觉得“硬件很便宜”，砸钱买硬件就好了。然而问题在于，一个调整不当的查询/SQL或设计不当的数据模型与表结构，可以对性能产生几个数量级的影响。总会在某一个规模，堆硬件的成本相比雇佣一个靠谱DBA的成本高得令人望而却步。实话说，&lt;strong&gt;我认为大多数公司在IT软硬件开销中花费最大的是：开发人员没有正确使用数据库&lt;/strong&gt;。&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;DBA的基本功是管理DB，但灵魂在于A&lt;/strong&gt;：Administration ，如何管住研发人员创造的熵，需要的可不仅仅是技术。“自治数据库”也许可以帮助你分析负载创建索引，但没有任何可能帮你理解业务需求，去Push业务去优化表结构，而这一点在未来的二三十年里，都看不到任何被云替代的可能。&lt;/p&gt;
&lt;p&gt;无论是公有云厂商，还是以Kubernetes为代表的云原生/私有云，或者是类似 Pigsty 【11】这样的本地开源RDS替代，&lt;strong&gt;其核心价值都在于****尽可能多地使用软件，而不是人来应对系统复杂度&lt;/strong&gt;。那么，&lt;strong&gt;云软件会革了运维与DBA的命吗&lt;/strong&gt;？&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;云并不是什么都不用管的运维外包魔法&lt;/strong&gt;。根据复杂度守恒定律，无论是系统管理员还是数据库管理员，管理员这个岗位消失的唯一方式是，它们被重命名为“DevOps Engineer”或SRE。&lt;strong&gt;好的云软件可以帮你屏蔽运维杂活，解决70%的日常高频问题，然而总是会有那么一些复杂问题只有人才能处理&lt;/strong&gt;。你可能需要更少的人手来打理这些云软件，但总归还是需要人来管理【12】。毕竟，&lt;strong&gt;你也需要懂行的人来协调处理，才不至于被云厂商嘎嘎割韭菜当傻逼。&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;在大型组织中，一个好的DBA是至关重要的&lt;/strong&gt;。然而优秀的DBA相当稀有，供不应求，以至于这个角色在大多数组织中只能外包：包给专业的数据库服务公司，包给云数据库RDS服务团队。找不到DBA供应的组织只能将这个职责 &lt;strong&gt;内包&lt;/strong&gt; 给自己的研发/运维人员，直到公司的规模足够大，或者吃到足够的苦头之后，一些Dev/Ops才会培养出相应的能力来。&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;DBA不会被淘汰，只会被集中到云厂商中垄断提供服务。&lt;/strong&gt;&lt;/p&gt;
&lt;hr&gt;
&lt;h2 id=&#34;垄断阴影&#34;&gt;垄断阴影&lt;/h2&gt;
&lt;blockquote&gt;
&lt;p&gt;在2020年，计算自由的敌人是云计算软件。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;&lt;strong&gt;比起“淘汰DBA”，云的出现蕴含着更大的威胁&lt;/strong&gt;。我们需要担心的是这样一幅图景：公有云（或果子云）坐大，控制硬件与运营商上下游，垄断计算，存储，网络，顶尖专家资源，形成事实标准。假如所有顶级DBA都被挖到云厂商去集中提供共享专家服务，普通的企业组织就彻底失去了用好数据库的能力，最终只能选择被公有云收税杀猪。最终，所有IT资源集中于云厂商，只要控制住这几个关键少数，就可以控制整个互联网。这毫无疑问与互联网诞生的初衷相悖。&lt;/p&gt;
&lt;p&gt;引用 DDIA 作者 Martin Kelppmann 的一段话【13】来说：&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;strong&gt;在2020年，计算自由的敌人是云计算软件&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;—— 即主要在供应商的服务器上运行的软件，而你的所有数据也存储在这些服务器上。这些“云软件”也许有一个客户端组件（手机App，网页App，跑在你浏览器中的JavaScript），但它们只能与供应商的服务端共同工作。而云软件存在很多问题：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;如果提供云软件的公司倒闭，或决定停产，软件就没法工作了，而你用这些软件创造的文档与数据就被锁死了。对于初创公司编写的软件来说，这是一个很常见的问题：这些公司可能会被大公司收购，而大公司没有兴趣继续维护这些初创公司的产品。&lt;/li&gt;
&lt;li&gt;谷歌和其他云服务可能在没有任何警告和追索手段的情况下，突然暂停你的账户。例如，您可能在完全无辜的情况下，被自动化系统判定为违反服务条款：其他人可能入侵了你的账户，并在你不知情的情况下使用它来发送恶意软件或钓鱼邮件，触发违背服务条款。因而，你可能会突然发现自己用Google Docs或其它App创建的文档全部都被永久锁死，无法访问了。&lt;/li&gt;
&lt;li&gt;而那些运行在你自己的电脑上的软件，即使软件供应商破产了，它也可以继续运行，直到永远。（如果软件不再与你的操作系统兼容，你也可以在虚拟机和模拟器中运行它，当然前提是它不需要联络服务器来检查许可证）。例如，互联网档案馆有一个超过10万个历史软件的软件集锦，你可以在浏览器中的模拟器里运行！相比之下，如果云软件被关闭，你没有办法保存它，因为你从来就没有服务端软件的副本，无论是源代码还是编译后的形式。&lt;/li&gt;
&lt;li&gt;20世纪90年代，无法定制或扩展你所使用的软件的问题，在云软件中进一步加剧。对于在你自己的电脑上运行的闭源软件，至少有人可以对它的数据文件格式进行逆向工程，这样你还可以把它加载到其他的替代软件里（例如OOXML之前的微软Office文件格式，或者规范发布前的Photoshop文件）。有了云软件，甚至连这个都做不到了，因为数据只存储在云端，而不是你自己电脑上的文件。&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;如果所有的软件都是免费和开源的，这些问题就都解决了&lt;/strong&gt;。然而，开源实际上并不是解决云软件问题的必要条件；即使是闭源软件也可以避免上述问题，只要它运行在你自己的电脑上，而不是供应商的云服务器上。请注意，互联网档案馆能够在没有源代码的情况下维持历史软件的正常运行：如果只是出于存档的目的，在模拟器中运行编译后的机器代码就够了。也许拥有源码会让事情更容易一些，但这并不是关键，&lt;strong&gt;最重要的事情，还是要有一份软件的副本&lt;/strong&gt;。&lt;/p&gt;
&lt;p&gt;我和我的合作者们以前曾主张过&lt;strong&gt;本地优先软件&lt;/strong&gt;的概念，这是对云软件的这些问题的一种回应。本地优先的软件在你自己的电脑上运行，将其数据存储在你的本地硬盘上，同时也保留了云计算软件的便利性，比如，实时协作，和在你所有的设备上同步数据。开源的本地优先的软件当然非常好，但这并不是必须的，本地优先软件90%的优点同样适用于闭源的软件。云软件，而不是闭源软件，才是对软件自由的真正威胁，原因在于：&lt;strong&gt;云厂商能够突然心血来潮随心所欲地锁定你的所有数据，其危害要比无法查看和修改你的软件源码的危害大得多&lt;/strong&gt;。因此，普及本地优先的软件显得更为重要和紧迫。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;有力就会有反作用力，与云软件相对应的本地优先软件开始如雨后春笋一般出现。例如，以Kubernetes为代表的 Cloud Native 运动就是一例。“Cloud Native”，云厂商将 Native 解释 “原生”：“原生诞生在公有云环境里的软件”；而其真正的含义应为 “本地”，即与 Cloud 相对应的 “Local” —— 本地云 / 私有云 / 专有云 / 原生云，叫什么不重要，重要的是它运行在用户想运行的任何地方（包括云服务器），而不是仅仅是公有云所独有！&lt;/p&gt;
&lt;p&gt;以 K8S为代表的开源项目，将原本公有云才有的资源调度/智能运维能力普及到所有企业中，让企业在本地也可以运行起‘云’一样的能力。对于无状态的应用来说，它已经是一个足够好的 “云操作系统” 内核。Ceph/Minio也提供了 S3 对象存储的开源替代，只有一个问题仍然没有答案，有状态的，生产级的数据库服务如何管理与部署？&lt;/p&gt;
&lt;p&gt;时代在呼唤 RDS 的开源替代物。&lt;/p&gt;
&lt;hr&gt;
&lt;h2 id=&#34;解决方案&#34;&gt;解决方案&lt;/h2&gt;
&lt;blockquote&gt;
&lt;p&gt;Pigsty —— 开源免费，开箱即用，更好的 RDS PG 替代&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;我希望，未来的世界人人都有自由使用优秀服务的事实权利，而不是只能被圈养在几个公有云厂商提供的猪圈（Pigsty）里吃粑粑。这就是我要做 Pigsty 的原因 —— &lt;strong&gt;一个更好的，开源免费的 PostgreSQL RDS替代&lt;/strong&gt;。让用户能够在任何地方（包括云服务器）上，一键拉起有比云RDS更好的数据库服务。&lt;/p&gt;
&lt;p&gt;Pigsty 是是对 PostgreSQL 的彻底补完，&lt;strong&gt;更是对云数据库的辛辣嘲讽&lt;/strong&gt;。它本意是“猪圈”，但更是 Postgres In Great STYle 的缩写，即“&lt;strong&gt;全盛状态下的 PostgreSQL&lt;/strong&gt;”。它是一个完全基于开源软件的，可以运行在任何地方的，浓缩了 PostgreSQL 使用管理最佳实践的 Me-Better  RDS 开源替代。用真实世界的大规模，高标准 PostgreSQL 集群打磨而来的解决方案，它是为了满足探探自己管理数据库的需求而生，在八个维度上进行了许多有价值的工作：&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;/zh/blog/cloud/rds/rds-7.png&#34;&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;可观测性（Observability）是天；天行健君子以自强不息&lt;/strong&gt;；Pigsty使用现代可观测性技术栈为 PostgreSQL 打造了一款无与伦比的监控系统，从全局大盘概览到单个表/索引/函数等对象的秒极历史详情指标一览无遗，让用户对系统能够做到洞若观火，进而掌控一切。此外，Pigsty的监控系统还可以独立使用，监控第三方数据库实例。&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;可控制性（Controllability）是地；地势坤君子以厚德载物&lt;/strong&gt;；Pigsty提供Database as Code的能力：使用表现力丰富的声明式接口描述数据库集群的状态，并使用幂等的剧本进行部署与调整。让用户拥有精细定制的能力的同时又无需操心实现细节，解放心智负担，让数据库操作与管理的门槛从专家级降低到新手级。&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;可伸缩性（Scalability）是水；水洊至习坎君子以常德行&lt;/strong&gt;；Pigsty提供预制通用调参模板（OLTP / OLAP / CRIT / TINY），自动优化系统参数，并可通过级联复制无限扩展只读能力，也使用Pgbouncer连接池优化海量并发连接；Pigsty确保 PostgreSQL 的性能可以在现代硬件条件下充分发挥：单机可达数万并发连接/百万级单点查询QPS/十万级单条写入TPS。&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;可维护性（Maintainability）是火；明两作离大人以继明照于四方&lt;/strong&gt;；Pigsty 允许在线摘除添加实例以扩缩容，Switchover/滚动升级进行升降配，提供基于逻辑复制的不停机迁移方案，将维护窗口压缩至亚秒级，让系统整体的可演化性，可用性，可维护性提高到一个新的水准。&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;安全性（Security）是雷；洊雷震君子以恐惧修省&lt;/strong&gt;；Pigsty提供了一套遵循最小权限原则的访问控制模型，并带有各种安全特性开关：流复制同步提交防丢失，数据目录校验和防腐败，网络流量SSL加密防监听，远程备份AES-256防泄漏。只要物理硬件与密码安全，用户无需担心数据库的安全性。&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;简单性（Simplicity）是风；随风巽君子以申命行事&lt;/strong&gt;；使用Pigsty的难度不会超过任何云数据库，它旨在以最小的复杂度成本交付完整的RDS功能，模块化设计允许用户自行组合选用所需的功能。Pigsty提供基于Vagrant的本地开发测试沙箱，与Terraform的云端IaC一键部署模板，让您在任意新EL节点上一键完成离线安装，完整复刻环境。&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;可靠性（Reliability）是山；兼山艮君子以思不出其位&lt;/strong&gt;；Pigsty提供了故障自愈的高可用架构应对硬件问题，也提供开箱即用的PITR时间点恢复为人为删库与软件缺陷兜底，并通过长时间、大规模的生产环境运行与高可用演练验证其可靠性。&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;可扩展性（Extensibility）是泽：丽泽兑君子以朋友讲习&lt;/strong&gt;；Pigsty深度整合PostgreSQL生态核心扩展PostGIS、TimescaleDB、Citus 、PGVector、以及大量扩展插件；Pigsty提供模块化设计的Prometheus/Grafana可观测性技术栈，以及MINIO，ETCD，Redis、Greenplum 等组件的监控与高可用部署与PostgreSQL 组合使用；&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;/zh/blog/cloud/rds/rds-8.png&#34;&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;更重要的是，Pigsty是完全开源免费的自由软件&lt;/strong&gt;，采用 AGPL v3.0 协议。我们用爱发电，而您可以用几十块核·月的纯硬件成本，跑起运行功能完备甚至更好的RDS服务。无论你是初心者还是资深DBA，无论你管理着上万核的大集群还是1核2G的小水管，无论你已经用了RDS还是在本地搭建过数据库，只要你是 PostgreSQL 用户，Pigsty都会对您有所帮助，完全免费。&lt;strong&gt;您可以专注于业务中最有趣或最有价值的部分，将杂活丢给软件来解决&lt;/strong&gt;。&lt;/p&gt;
&lt;p&gt;尽管Pigsty 本身旨在用数据库自动驾驶软件替代人肉数据库运维，但正如上所述，再好的软件也没法解决 100% 的问题。总会有一些的冷门低频疑难杂症需要专家介入处理。我们提供免费的社区答疑，如果您觉得安装使用维护有困难，需要下云迁移或者疑难杂症兜底，我们也提供顶尖的数据库专家咨询服务，性价比相对公有云数据库的&lt;a href=&#34;/zh/blog/cloud/sla/&#34;&gt;工单/SLA&lt;/a&gt;极有竞争力。Pigsty帮助用户用好 PostgreSQL，而我们帮助用户用好 Pigsty。&lt;/p&gt;
&lt;p&gt;Pigsty简单易用，人力成本与复杂度RDS持平，但资源成本差异确是天翻地覆。且不说自建机房的20块和几百块的云数据库怎么比，考虑到 RDS 对比同规格 EC2 都有几倍的溢价，您完全可以折中：使用云服务器部署 Pigsty RDS，既保留了云的弹性，又可以原地省掉五六成开销。如果是IDC自建或者代维，成本砍掉90%都不一定打得住。&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;/zh/blog/cloud/rds/rds-9.png&#34;&gt;&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;RDS成本与规模成本曲线&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;Pigsty 允许您践行最终极的 FinOps 理念 —— 用几乎接近于纯资源的价格，在任何地方（ECS，资源云，机房服务器甚至本地笔记本虚拟机）运行生产级的 PostgreSQL RDS 数据库服务。&lt;strong&gt;让云数据库的能力成本，从正比于资源的边际成本，变为约等于0的固定学习成本&lt;/strong&gt;。&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;如果您可以用几分之一的成本来使用更好的 RDS 服务，那么再用云数据库就真的是纯纯的智商税了。&lt;/strong&gt;&lt;/p&gt;
&lt;hr&gt;
&lt;h2 id=&#34;reference&#34;&gt;Reference&lt;/h2&gt;
&lt;p&gt;【1】&lt;a href=&#34;https://world.hey.com/dhh/why-we-re-leaving-the-cloud-654b47e0&#34;&gt;为什么我们要离开云&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;【2】&lt;a href=&#34;https://www.infoq.cn/article/qoq3v6jfenwwzmpg4fre&#34;&gt;上云“被坑”十年终放弃，寒冬里第一轮“下云潮”要来了？&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;【3】&lt;a href=&#34;https://rdsbuy.console.aliyun.com/create/rds/PostgreSQL&#34;&gt;阿里云RDS for PostgreSQL定价&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;【4】&lt;a href=&#34;https://calculator.aws/#/addService/RDSPostgreSQL&#34;&gt;AWS Pricing Calculator&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;【5】 &lt;a href=&#34;https://calculator.amazonaws.cn/#/?trk=pricing-ban&#34;&gt;AWS Pricing Calculator&lt;/a&gt; （中国宁夏）&lt;/p&gt;
&lt;p&gt;【6】&lt;a href=&#34;https://github.com/Vonng/pgtpc/blob/master/fio/aws-ebs-bench.md&#34;&gt;FIO 测试 AWS EBS性能&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;【7】&lt;a href=&#34;https://help.aliyun.com/document_detail/299200.html&#34;&gt;阿里云RDS PG 增强监控&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;【8】&lt;a href=&#34;https://mp.weixin.qq.com/s/DtRFnh8LgtfesCNMNl3eNw&#34;&gt;你为什么还在招DBA&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;【9】&lt;a href=&#34;https://help.aliyun.com/document_detail/159166.html&#34;&gt;阿里云RDS PG 数据库自治服务&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;【10】&lt;a href=&#34;https://docs.opengauss.org/zh/docs/3.0.0/docs/Developerguide/AI4DB-%E6%95%B0%E6%8D%AE%E5%BA%93%E8%87%AA%E6%B2%BB%E8%BF%90%E7%BB%B4.html&#34;&gt;OpenGauss AI for DB&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;【11】&lt;a href=&#34;https://pigsty.cc/&#34;&gt;Me-Better RDS PostgreSQL 替代 Pigsty&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;【12】&lt;a href=&#34;https://mp.weixin.qq.com/s/9lceZdyUZU9AzsqlAcpjTA&#34;&gt;Pigsty v2 正式发布：更好的RDS PG开源替代&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;【13】&lt;a href=&#34;https://mp.weixin.qq.com/s/DJsDRO18saZaxe3oyzzYrA&#34;&gt;是时候和GPL说再见了&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;【14】&lt;a href=&#34;https://mp.weixin.qq.com/s/c8bpK4o3H7-EyRqVdNDndQ&#34;&gt;云数据库是不是智商税？&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;【15】&lt;a href=&#34;https://mp.weixin.qq.com/s/rtx4UWkuvrKf7gtd6pFr-A&#34;&gt;大厂裁员轰轰烈烈，哪个技术岗位可以独善其身？&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;【16】&lt;a href=&#34;https://mp.weixin.qq.com/s/UZVoQxFYbG7WlJ1JC-gclQ&#34;&gt;蹭个热度&amp;ndash;要不要DBA和云数据库&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;【17】&lt;a href=&#34;https://mp.weixin.qq.com/s/LFnWliDxPQnVePkDWsIVag&#34;&gt;你怎么不招DBA&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;【18】&lt;a href=&#34;https://mp.weixin.qq.com/s/Py3o31w3db5E9FsviAZeCA&#34;&gt;DBA还是一份好工作吗？&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;【19】&lt;a href=&#34;https://mp.weixin.qq.com/s/AGEW1iHQkQy4NQyYC2GonQ&#34;&gt;云RDS：从删库到跑路&lt;/a&gt;&lt;/p&gt;

      </description>
    </item>
    
  </channel>
</rss>
