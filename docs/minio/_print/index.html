<!doctype html>
<html itemscope itemtype="http://schema.org/WebPage" lang="en" class="no-js">
  <head>
    <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link rel="canonical" type="text/html" href="/docs/minio/">
<link rel="alternate" type="application/rss&#43;xml" href="/docs/minio/index.xml">
<meta name="robots" content="noindex, nofollow">


<link rel="shortcut icon" href="/favicons/favicon.ico" >
<link rel="apple-touch-icon" href="/favicons/apple-touch-icon-180x180.png" sizes="180x180">
<link rel="icon" type="image/png" href="/favicons/favicon-16x16.png" sizes="16x16">
<link rel="icon" type="image/png" href="/favicons/favicon-32x32.png" sizes="32x32">
<link rel="icon" type="image/png" href="/favicons/android-36x36.png" sizes="36x36">
<link rel="icon" type="image/png" href="/favicons/android-48x48.png" sizes="48x48">
<link rel="icon" type="image/png" href="/favicons/android-72x72.png" sizes="72x72">
<link rel="icon" type="image/png" href="/favicons/android-96x96.png" sizes="96x96">
<link rel="icon" type="image/png" href="/favicons/android-144x144.png" sizes="144x144">
<link rel="icon" type="image/png" href="/favicons/android-192x192.png" sizes="192x192">

<title>Module: MINIO | Pigsty</title>
<meta name="description" content="Pigsty has built-in MinIO support. MinIO is an S3 OSS alternative which is used as an optional PostgreSQL backup repo">
<meta property="og:title" content="Module: MINIO" />
<meta property="og:description" content="Pigsty has built-in MinIO support. MinIO is an S3 OSS alternative which is used as an optional PostgreSQL backup repo" />
<meta property="og:type" content="website" />
<meta property="og:url" content="/docs/minio/" />

<meta itemprop="name" content="Module: MINIO">
<meta itemprop="description" content="Pigsty has built-in MinIO support. MinIO is an S3 OSS alternative which is used as an optional PostgreSQL backup repo"><meta name="twitter:card" content="summary"/><meta name="twitter:title" content="Module: MINIO"/>
<meta name="twitter:description" content="Pigsty has built-in MinIO support. MinIO is an S3 OSS alternative which is used as an optional PostgreSQL backup repo"/>




<link rel="preload" href="/scss/main.min.194607c777ee31a481a26dfc3d1c65134dfc8eb296a0aae9d353b3bd5be6a683.css" as="style">
<link href="/scss/main.min.194607c777ee31a481a26dfc3d1c65134dfc8eb296a0aae9d353b3bd5be6a683.css" rel="stylesheet" integrity="">

<script
  src="/js/jquery-3.6.3.min.js"
  integrity="sha512-STof4xm1wgkfm7heWqFJVn58Hm3EtS31XFaagaa8VMReCXAkQnJZ+jEy8PCC/iT18dFy95WcExNHFTqLyp72eQ=="
  crossorigin="anonymous"></script>
<script defer
  src="/js/lunr.min.js"
  integrity="sha384-203J0SNzyqHby3iU6hzvzltrWi/M41wOP5Gu+BiJMz5nwKykbkUx8Kp7iti0Lpli"
  crossorigin="anonymous"></script>
<script async src="https://www.googletagmanager.com/gtag/js?id=G-LG1V9WTKGE"></script>
<script>
var doNotTrack = false;
if (!doNotTrack) {
	window.dataLayer = window.dataLayer || [];
	function gtag(){dataLayer.push(arguments);}
	gtag('js', new Date());
	gtag('config', 'G-LG1V9WTKGE');
}
</script>
  </head>
  <body class="td-section">
    <header>
      <nav class="td-navbar navbar-dark js-navbar-scroll">
<div class="container-fluid flex-column flex-md-row">
  <a class="navbar-brand" href="/"><span class="navbar-brand__logo navbar-logo"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xl="http://www.w3.org/1999/xlink" xmlns:dc="http://purl.org/dc/elements/1.1/" viewBox="0 0 24 24" width="24" height="24"><defs/><g id="32" fill="none" stroke-dasharray="none" fill-opacity="1" stroke-opacity="1" stroke="none"><title>32</title><g id="32_图层_2"><title>图层 2</title><g id="Group_17"><g id="Graphic_16"/><g id="Graphic_15"><path d="M7.666187 11.971335l2.165064-3.75H14.16138l2.165065 3.75-2.165065 3.75H9.831251z" fill="#bbb" fill-opacity=".9526367"/><path d="M7.666187 11.971335l2.165064-3.75H14.16138l2.165065 3.75-2.165065 3.75H9.831251z" stroke="#fff" stroke-linecap="round" stroke-linejoin="round" stroke-width=".6730434"/></g><g id="Graphic_14"><path d="M7.666187 19.474806l2.165064-3.75H14.16138l2.165065 3.75-2.165065 3.75H9.831251z" fill="#de372c" fill-opacity=".8545852"/><path d="M7.666187 19.474806l2.165064-3.75H14.16138l2.165065 3.75-2.165065 3.75H9.831251z" stroke="#fff" stroke-linecap="round" stroke-linejoin="round" stroke-width=".6730434"/></g><g id="Graphic_13"><path d="M14.161476 15.751202l2.165064-3.75h4.33013l2.165064 3.75-2.165064 3.75H16.32654z" fill="#424242" fill-opacity=".9016462"/><path d="M14.161476 15.751202l2.165064-3.75h4.33013l2.165064 3.75-2.165064 3.75H16.32654z" stroke="#fff" stroke-linecap="round" stroke-linejoin="round" stroke-width=".6730434"/></g><g id="Graphic_12"><path d="M14.161476 8.226008 16.32654 4.4760076h4.33013L22.821734 8.226008l-2.165064 3.75H16.32654z" fill="#ffa269" fill-opacity=".8975772"/><path d="M14.161476 8.226008 16.32654 4.4760076h4.33013L22.821734 8.226008l-2.165064 3.75H16.32654z" stroke="#fff" stroke-linecap="round" stroke-linejoin="round" stroke-width=".6730434"/></g><g id="Graphic_11"><path d="M7.666187 4.5 9.831251.75H14.16138L16.326445 4.5 14.16138 8.25H9.831251z" fill="#419edb" fill-opacity=".8979957"/><path d="M7.666187 4.5 9.831251.75H14.16138L16.326445 4.5 14.16138 8.25H9.831251z" stroke="#fff" stroke-linecap="round" stroke-linejoin="round" stroke-width=".6730434"/></g><g id="Graphic_10"><path d="M1.1491742 8.226008 3.3142388 4.4760076H7.644368L9.809432 8.226008l-2.165064 3.75H3.3142388z" fill="#2f6793" fill-opacity=".9002511"/><path d="M1.1491742 8.226008 3.3142388 4.4760076H7.644368L9.809432 8.226008l-2.165064 3.75H3.3142388z" stroke="#fff" stroke-linecap="round" stroke-linejoin="round" stroke-width=".6730434"/></g><g id="Graphic_9"><path d="M1.182071 15.741036l2.1650645-3.75h4.330129l2.1650645 3.75-2.1650645 3.75H3.3471355z" fill="#53ac79" fill-opacity=".9"/><path d="M1.182071 15.741036l2.1650645-3.75h4.330129l2.1650645 3.75-2.1650645 3.75H3.3471355z" stroke="#fff" stroke-linecap="round" stroke-linejoin="round" stroke-width=".6730434"/></g></g></g></g></svg></span><span class="navbar-brand__name">Pigsty</span></a>
  <div class="td-navbar-nav-scroll ms-md-auto" id="main_navbar">
    <ul class="navbar-nav">
      <li class="nav-item">
        <a class="nav-link active" href="/docs/"><i class='fa-solid fa-book'></i><span>Docs</span></a>
      </li>
      <li class="nav-item">
        <a class="nav-link" href="/blog/"><i class="fas fa-blog"></i><span>Blog</span></a>
      </li>
      <li class="nav-item">
        <a class="nav-link" href="https://github.com/Vonng/pigsty/" target="_blank" rel="noopener"><i class='fab fa-github'></i><span>GitHub</span></a>
      </li>
      <li class="nav-item dropdown d-none d-lg-block">
        <div class="dropdown">
  <a class="nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
      <i class="fa-solid fa-language"></i>English</a>
  <ul class="dropdown-menu">
    <li><a class="dropdown-item" href="/zh/docs/minio/">中文</a></li>
    </ul>
</div>
</li>
      </ul>
  </div>
  <div class="d-none d-lg-block">
    <div class="td-search td-search--offline">
  <div class="td-search__icon"></div>
  <input
    type="search"
    class="td-search__input form-control"
    placeholder="Search this site…"
    aria-label="Search this site…"
    autocomplete="off"
    
    data-offline-search-index-json-src="/offline-search-index.3dfcc24888a9d723be176d4ac329adc8.json"
    data-offline-search-base-href="/"
    data-offline-search-max-results="10"
  >
</div>
  </div>
</div>
</nav>
    </header>
    <div class="container-fluid td-outer">
      <div class="td-main">
        <div class="row flex-xl-nowrap">
          <main class="col-12 col-md-9 col-xl-8 ps-md-5" role="main">
            




<div class="td-content">
<div class="pageinfo pageinfo-primary d-print-none">
<p>
This is the multi-page printable view of this section.
<a href="#" onclick="print();return false;">Click here to print</a>.
</p><p>
<a href="/docs/minio/">Return to the regular view of this page</a>.
</p>
</div>



<h1 class="title">Module: MINIO</h1>
<div class="lead">Pigsty has built-in MinIO support. MinIO is an S3 OSS alternative which is used as an optional PostgreSQL backup repo</div>




    <ul>
    
  
  
  
  

  
    
    
	
<li>1: <a href="#pg-45b8da1dfca6b0e91aef873f7b72b337">Usage</a></li>


    
  
    
    
	
<li>2: <a href="#pg-08605fa7a960e0149e3c22312586b71e">Configuration</a></li>


    
  
    
    
	
<li>3: <a href="#pg-280b7e56b08e272d7b26411d506d6c5d">Parameters</a></li>


    
  
    
    
	
<li>4: <a href="#pg-ccc1805ae841df3ebaeb7bb6b8008203">Playbook</a></li>


    
  
    
    
	
<li>5: <a href="#pg-172708bf70f3c5729ee49aac66787c09">Administration</a></li>


    
  
    
    
	
<li>6: <a href="#pg-81383092950ff4115e1c3850be65d36f">Monitoring</a></li>


    
  
    
    
	
<li>7: <a href="#pg-61857417600e2adc512dcba599edd776">Metrics</a></li>


    
  
    
    
	
<li>8: <a href="#pg-571982477397f0d78a3a5034a4ef3e1d">FAQ</a></li>


    
  

    </ul>


<div class="content">
      <blockquote>
<p><a href="https://min.io/docs/minio/linux/reference/minio-mc/mc-mb.html">Min.IO</a>: S3-Compatible Open-Source Multi-Cloud Object Storage</p>
</blockquote>
<p>MinIO is an S3-compatible object storage server. It&rsquo;s designed to be scalable, secure, and easy to use.
It has native multi-node multi-driver HA support and can store documents, pictures, videos, and backups.</p>
<p>Pigsty uses MinIO as an optional PostgreSQL backup storage repo, in addition to the default local posix FS repo.
If the MinIO repo is used, the <code>MINIO</code> module should be installed before any <a href="/docs/pgsql/"><code>PGSQL</code></a> modules.
MinIO requires a trusted CA to work, so you have to install it in addition to <a href="/docs/node/"><code>NODE</code></a> module.</p>

</div>
</div>


  
  
  
  

  
  

  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-45b8da1dfca6b0e91aef873f7b72b337">1 - Usage</h1>
    <div class="lead">Get started with MinIO and MCli, how to access the MinIO service?</div>
	<p>After MinIO cluster is <a href="/docs/minio/config/">configured</a> and deployed with the <a href="/docs/minio/playbook/">playbook</a>,
you can start using and accessing the MinIO cluster by following the instructions here.</p>
<hr>
<h2 id="deploy-cluster">Deploy Cluster</h2>
<p>It is straightforward to deploy a single-node MinIO instance with Pigsty.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">minio</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span>{<span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">hosts</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span>{<span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">10.10.10.10</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span>{<span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">minio_seq: 1 } }, vars</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span>{<span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">minio_cluster</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">minio } }</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span></code></pre></div><p>Define it in the <a href="/docs/setup/config/#inventory">config inventory</a>, then run the playbook:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>./minio.yml -l minio
</span></span></code></pre></div><p>The <a href="/docs/setup/playbook/#installyml"><code>install.yml</code></a> playbook will automatically create the MinIO cluster defined in the inventory,
so you don&rsquo;t need to run the <code>minio.yml</code> playbook manually, if you choose the default one-pass installation.</p>
<p>If you plan to deploy a production-grade large-scale multi-node MinIO cluster,
we <strong>strongly</strong> recommend you to read the Pigsty MinIO <a href="/docs/minio/config/">configuration document</a>
and the MinIO <a href="https://min.io/docs/minio/linux/operations/concepts.html">document</a> before proceeding.</p>
<hr>
<h2 id="access-cluster">Access Cluster</h2>
<p>You have to access MinIO via HTTPS, so make sure the default minio service domain (<code>sss.pigsty</code>) point to the right place:</p>
<ol>
<li>You can add static resolution records in <a href="/docs/reference/param/#node_etc_hosts"><code>node_etc_hosts</code></a> or manually modify the <code>/etc/hosts</code> file</li>
<li>You can add a record on the internal DNS server if you are using an DNS service</li>
<li>You can add a record in <a href="/docs/reference/param/#dns_records"><code>dns_records</code></a> if you are using the DNSMASQ on infra nodes</li>
</ol>
<p>It is recommended to use the first method: static DNS resolution records to avoid MinIO&rsquo;s additional dependency on DNS in production environments.</p>
<p>You have to point the MinIO service domain to the IP address and service port of the MinIO server node, or the IP address and service port of the load balancer.
Pigsty will use the default domain name <code>sss.pigsty</code> and default port <code>9000</code>.</p>
<p>For example, if you are using haproxy to expose MinIO service <a href="/docs/minio/config/#expose-service">like this</a>, the port may be <code>9002</code>.</p>
<hr>
<h2 id="adding-alias">Adding Alias</h2>
<p>To access the MinIO server cluster using the <code>mcli</code> client, you need to configure the server alias first:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>mcli <span style="color:#204a87">alias</span> ls  <span style="color:#8f5902;font-style:italic"># list minio alias (the default is sss)</span>
</span></span><span style="display:flex;"><span>mcli <span style="color:#204a87">alias</span> <span style="color:#204a87">set</span> sss https://sss.pigsty:9000 minioadmin minioadmin              <span style="color:#8f5902;font-style:italic"># root user</span>
</span></span><span style="display:flex;"><span>mcli <span style="color:#204a87">alias</span> <span style="color:#204a87">set</span> sss https://sss.pigsty:9002 minioadmin minioadmin              <span style="color:#8f5902;font-style:italic"># root user, on load balancer port 9002</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>mcli <span style="color:#204a87">alias</span> <span style="color:#204a87">set</span> pgbackrest https://sss.pigsty:9000 pgbackrest S3User.Backup    <span style="color:#8f5902;font-style:italic"># use another user</span>
</span></span></code></pre></div><p>There&rsquo;s a pre-configured MinIO alias named <code>sss</code> on the admin user of the admin node, you can use it directly.</p>
<p>For the full functionality of the MinIO client tool <code>mcli</code>, please refer to the documentation: <a href="https://min.io/docs/minio/linux/reference/minio-mc.html">MinIO Client</a>.</p>
<hr>
<h2 id="manage-user">Manage User</h2>
<p>You can manage biz users in MinIO using <code>mcli</code>, for example, you can create the two default biz users using the command line:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>mcli admin user list sss     <span style="color:#8f5902;font-style:italic"># list all users </span>
</span></span><span style="display:flex;"><span><span style="color:#204a87">set</span> +o <span style="color:#204a87">history</span>               <span style="color:#8f5902;font-style:italic"># hide shell history</span>
</span></span><span style="display:flex;"><span>mcli admin user add sss dba S3User.DBA
</span></span><span style="display:flex;"><span>mcli admin user add sss pgbackrest S3User.Backup
</span></span><span style="display:flex;"><span><span style="color:#204a87">set</span> -o <span style="color:#204a87">history</span> 
</span></span></code></pre></div><hr>
<h2 id="manage-bucket">Manage Bucket</h2>
<p>You can manage bucket with mcli:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>mcli ls sss/                         <span style="color:#8f5902;font-style:italic"># list all bucket on &#39;sss&#39;</span>
</span></span><span style="display:flex;"><span>mcli mb --ignore-existing sss/hello  <span style="color:#8f5902;font-style:italic"># create a bucket named &#39;hello&#39;</span>
</span></span><span style="display:flex;"><span>mcli rb --force sss/hello            <span style="color:#8f5902;font-style:italic"># delete the &#39;hello&#39; bucket</span>
</span></span></code></pre></div><hr>
<h2 id="mange-object">Mange Object</h2>
<p>You can perform object CRUD with cli, for example:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>mcli cp /www/pigsty/* sss/infra/     <span style="color:#8f5902;font-style:italic"># upload local repo content to infra bucket </span>
</span></span><span style="display:flex;"><span>mcli cp sss/infra/plugins.tgz /tmp/  <span style="color:#8f5902;font-style:italic"># download file to local from minio</span>
</span></span><span style="display:flex;"><span>mcli ls sss/infra                    <span style="color:#8f5902;font-style:italic"># list all files in the infra bucket</span>
</span></span><span style="display:flex;"><span>mcli rm sss/infra/plugins.tgz        <span style="color:#8f5902;font-style:italic"># delete file in infra bucket  </span>
</span></span><span style="display:flex;"><span>mcli cat sss/infra/repo_complete     <span style="color:#8f5902;font-style:italic"># output the content of </span>
</span></span></code></pre></div><p>Check the <a href="https://min.io/docs/minio/linux/administration/object-management.html">Tutorial: Object Management</a> for detail</p>
<hr>
<h2 id="use-rclone">Use rclone</h2>
<p>Pigsty repo has <a href="https://rclone.org/">rclone</a> available, a convenient cloud object storage client that you can use to access MinIO services.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>yum install rclone<span style="color:#000;font-weight:bold">;</span> <span style="color:#8f5902;font-style:italic"># el compatible</span>
</span></span><span style="display:flex;"><span>dnf install rclone<span style="color:#000;font-weight:bold">;</span> <span style="color:#8f5902;font-style:italic"># debian/ubuntu</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>mkdir -p ~/.config/rclone/<span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>tee ~/.config/rclone/rclone.conf &gt; /dev/null <span style="color:#4e9a06">&lt;&lt;EOF
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">[sss]
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">type = s3
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">access_key_id = minioadmin
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">secret_access_key = minioadmin
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">endpoint = sss.pigsty:9000
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">EOF</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>rclone ls sss:/
</span></span></code></pre></div><hr>
<h2 id="backup-repo">Backup Repo</h2>
<p>The MinIO is used as a backup repository for pgBackRest by default in Pigsty.
When you modify the <a href="/docs/reference/param/#pgbackrest_method"><code>pgbackrest_method</code></a> to <code>minio</code>, the PGSQL module will automatically switch the backup repository to MinIO.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">pgbackrest_method: local          # pgbackrest repo method</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">local,minio,[user-defined...]</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:bold">pgbackrest_repo:                  # pgbackrest repo</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">https://pgbackrest.org/configuration.html#section-repository</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">local</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">                          </span><span style="color:#8f5902;font-style:italic"># default pgbackrest repo with local posix fs</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">path</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">/pg/backup             </span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#8f5902;font-style:italic"># local backup directory, `/pg/backup` by default</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">retention_full_type</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">count   </span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#8f5902;font-style:italic"># retention full backups by count</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">retention_full</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#0000cf;font-weight:bold">2</span><span style="color:#f8f8f8;text-decoration:underline">             </span><span style="color:#8f5902;font-style:italic"># keep 2, at most 3 full backup when using local fs repo</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">minio</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">                          </span><span style="color:#8f5902;font-style:italic"># optional minio repo for pgbackrest</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">type</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">s3                     </span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#8f5902;font-style:italic"># minio is s3-compatible, so s3 is used</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">s3_endpoint</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">sss.pigsty      </span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#8f5902;font-style:italic"># minio endpoint domain name, `sss.pigsty` by default</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">s3_region</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">us-east-1         </span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#8f5902;font-style:italic"># minio region, us-east-1 by default, useless for minio</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">s3_bucket</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">pgsql             </span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#8f5902;font-style:italic"># minio bucket name, `pgsql` by default</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">s3_key</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">pgbackrest           </span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#8f5902;font-style:italic"># minio user access key for pgbackrest</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">s3_key_secret</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">S3User.Backup </span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#8f5902;font-style:italic"># minio user secret key for pgbackrest</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">s3_uri_style</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">path           </span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#8f5902;font-style:italic"># use path style uri for minio rather than host style</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">path</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">/pgbackrest            </span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#8f5902;font-style:italic"># minio backup path, default is `/pgbackrest`</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">storage_port</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#0000cf;font-weight:bold">9000</span><span style="color:#f8f8f8;text-decoration:underline">            </span><span style="color:#8f5902;font-style:italic"># minio port, 9000 by default</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">storage_ca_file</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">/pg/cert/ca.crt </span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#8f5902;font-style:italic"># minio ca file path, `/pg/cert/ca.crt` by default</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">bundle</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">y</span><span style="color:#f8f8f8;text-decoration:underline">                     </span><span style="color:#8f5902;font-style:italic"># bundle small files into a single file</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">cipher_type</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">aes-256-cbc     </span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#8f5902;font-style:italic"># enable AES encryption for remote backup repo</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">cipher_pass</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">pgBackRest      </span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#8f5902;font-style:italic"># AES encryption password, default is &#39;pgBackRest&#39;</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">retention_full_type</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">time    </span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#8f5902;font-style:italic"># retention full backup by time on minio repo</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">retention_full</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#0000cf;font-weight:bold">14</span><span style="color:#f8f8f8;text-decoration:underline">            </span><span style="color:#8f5902;font-style:italic"># keep full backup for last 14 days</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span></code></pre></div><p>Beware that if you are using MinIO through load balancer, you should use the corresponding domain name and port number here.</p>
<br>
<hr>
<br>

</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-08605fa7a960e0149e3c22312586b71e">2 - Configuration</h1>
    <div class="lead">Configure MinIO clusters according to your needs, and access service through LB &amp; Proxy</div>
	<hr>
<h2 id="configuration">Configuration</h2>
<p>You have to define a MinIO cluster in the <a href="/docs/setup/config/#inventory">config inventory</a> before deploying it.</p>
<p>There are 3 major deployment modes for MinIO clusters:</p>
<ul>
<li><a href="/docs/minio/config/#single-node-single-drive">SNSD: Single-Node Single-Drive</a>: you can use any dir as driver in this mode, convenient for dev/test/demo.</li>
<li><a href="/docs/minio/config/#single-node-multi-drive">SNMD: Single-Node Multi-Drive</a>: a compromise mode, use multiple disks (&gt;=2) on a single server, only when resources are extremely limited.</li>
<li><a href="/docs/minio/config/#multi-node-single-drive">MNMD: Multi-Node Multi-Drive</a>: standard production deployment, best reliability, but requires multiple servers and real drivers.</li>
</ul>
<p>We recommend using SNSD and MNMD for development and production deployment, respectively, and SNMD only when resources are extremely limited (only one server).</p>
<p>Besides, you can use <a href="/docs/minio/config/#multi-pool-deployment">multi-pool deployment</a> to scale an existing MinIO cluster, or directly deploy <a href="/docs/minio/config/#multiple-clusters">multiple clusters</a>.</p>
<p>When using a multi-node MinIO cluster, you can access the service from any node, so the best practice is to use a load balancer and HA <a href="/docs/minio/config/#access-service">access</a>.</p>
<hr>
<h2 id="core-param">Core Param</h2>
<p>There&rsquo;s one and only one core param for MinIO deployment, which is <code>MINIO_VOLUMES</code>, which specify the nodes, drivers, pools of a minio cluster</p>
<p>Pigsty will auto-generate <code>MINIO_VOLUMES</code> according to the config inventory for you, but you can always override it directly.
If not explicitly specified, Pigsty will generate it according to the following rules:</p>
<ul>
<li>SNSD: <code>MINIO_VOLUMES</code> is point to any dir on local node, from <a href="/docs/minio/param/#minio_data"><code>minio_data</code></a></li>
<li>SNMD: <code>MINIO_VOLUMES</code> is point to a series of real driver on local node, from <a href="/docs/minio/param/#minio_data"><code>minio_data</code></a></li>
<li>MNMD: <code>MINIO_VOLUMES</code> is point to multiple node &amp; multiple drivers, according to <a href="/docs/minio/param/#minio_data"><code>minio_data</code></a> and <a href="/docs/minio/param/#minio_node"><code>minio_node</code></a>
<ul>
<li>Use <a href="/zh/docs/minio/param#minio_data"><code>minio_data</code></a> to specify drivers on each node, such as <code>/data{1...4}</code></li>
<li>Use <a href="/zh/docs/minio/param#minio_node"><code>minio_node</code></a> to specify node name pattern, such as <code>${minio_cluster}-${minio_seq}.pigsty</code></li>
</ul>
</li>
<li>Multi-Pool: <code>MINIO_VOLUMES</code> need to be explicitly specified</li>
</ul>
<hr>
<h2 id="single-node-single-drive">Single-Node Single-Drive</h2>
<p>Tutorial: <a href="https://min.io/docs/minio/linux/operations/install-deploy-manage/deploy-minio-single-node-single-drive.html">deploy-minio-single-node-single-drive</a></p>
<p>To define a singleton MinIO instance, it&rsquo;s straightforward:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># 1 Node 1 Driver (DEFAULT)</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:bold">minio</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span>{<span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">hosts</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span>{<span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">10.10.10.10</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span>{<span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">minio_seq: 1 } }, vars</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span>{<span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">minio_cluster</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">minio } }</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span></code></pre></div><p>The only required params are <a href="/docs/reference/param/#minio_seq"><code>minio_seq</code></a> and <a href="/docs/reference/param/#minio_cluster"><code>minio_cluster</code></a>, which generate a unique identity for each MinIO instance.</p>
<p>Single-Node Single-Driver mode is for dev purposes, so you can use a common dir as the data dir.
The default data dir for SNSD minio is specified by <a href="/docs/minio/param/#minio_data"><code>minio_data</code></a>, which is <code>/data/minio</code> by default.
Beware that in multi-driver or multi-node mode, MinIO will refuse to start if using a common dir as the data dir rather than a mount point.</p>
<p>We strongly recommend using a static domain name record to access MinIO. For example, the default <code>sss.pigsty</code> if <a href="/docs/minio/param/#minio_domain"><code>minio_domain</code></a> can be added to all nodes through:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">node_etc_hosts</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000;font-weight:bold">[</span><span style="color:#4e9a06">&#34;10.10.10.10 sss.pigsty&#34;</span><span style="color:#000;font-weight:bold">]</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#8f5902;font-style:italic"># domain name to access minio from all nodes (required)</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span></code></pre></div><hr>
<h2 id="single-node-multi-drive">Single-Node Multi-Drive</h2>
<p>Reference: <a href="https://min.io/docs/minio/linux/operations/install-deploy-manage/deploy-minio-single-node-multi-drive.html">deploy-minio-single-node-multi-drive</a></p>
<p>To use multiple disks on a single node, you have to specify the <a href="/docs/reference/param/#minio_data"><code>minio_data</code></a> in the format of <code>{{ prefix }}{x...y}</code>,
which defines a series of disk mount points.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">minio</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">hosts</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span>{<span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">10.10.10.10</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span>{<span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">minio_seq</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#0000cf;font-weight:bold">1</span><span style="color:#f8f8f8;text-decoration:underline"> </span>}<span style="color:#f8f8f8;text-decoration:underline"> </span>}<span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">vars</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">minio_cluster</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">minio        </span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#8f5902;font-style:italic"># minio cluster name, minio by default</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">minio_data</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#39;/data{1...4}&#39;</span><span style="color:#f8f8f8;text-decoration:underline">   </span><span style="color:#8f5902;font-style:italic"># minio data dir(s), use {x...y} to specify multi drivers</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span></code></pre></div>

<div class="alert alert-secondary" role="alert">
<h4 class="alert-heading">Use real drivers and mountpoint</h4>

    Beware that in multi-driver or multi-node mode, MinIO will refuse to start if using a common dir as the data dir rather than a mount point.

</div>

<p>This example defines a single-node MinIO cluster with 4 drivers: <code>/data1</code>, <code>/data2</code>, <code>/data3</code>, <code>/data4</code>. You have to mount them properly before launching MinIO:</p>
<p>The vagrant MinIO <a href="https://github.com/Vonng/pigsty/blob/main/vagrant/spec/minio.rb">sandbox</a> has pre-defined 4-node MinIO cluster with 4 drivers.
You have to properly mount them before starting MinIO (be sure to format disks with <code>xfs</code>):</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>mkfs.xfs /dev/vdb<span style="color:#000;font-weight:bold">;</span> mkdir /data1<span style="color:#000;font-weight:bold">;</span> mount -t xfs /dev/sdb /data1<span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>mkfs.xfs /dev/vdc<span style="color:#000;font-weight:bold">;</span> mkdir /data2<span style="color:#000;font-weight:bold">;</span> mount -t xfs /dev/sdb /data2<span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>mkfs.xfs /dev/vdd<span style="color:#000;font-weight:bold">;</span> mkdir /data3<span style="color:#000;font-weight:bold">;</span> mount -t xfs /dev/sdb /data3<span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>mkfs.xfs /dev/vde<span style="color:#000;font-weight:bold">;</span> mkdir /data4<span style="color:#000;font-weight:bold">;</span> mount -t xfs /dev/sdb /data4<span style="color:#000;font-weight:bold">;</span>
</span></span></code></pre></div><p>Disk management is beyond this topic, just make sure your <code>/etc/fstab</code> is properly configured to auto-mount disks after reboot.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>/dev/vdb /data1 xfs defaults,noatime,nodiratime <span style="color:#0000cf;font-weight:bold">0</span> <span style="color:#0000cf;font-weight:bold">0</span>
</span></span><span style="display:flex;"><span>/dev/vdc /data2 xfs defaults,noatime,nodiratime <span style="color:#0000cf;font-weight:bold">0</span> <span style="color:#0000cf;font-weight:bold">0</span>
</span></span><span style="display:flex;"><span>/dev/vdd /data3 xfs defaults,noatime,nodiratime <span style="color:#0000cf;font-weight:bold">0</span> <span style="color:#0000cf;font-weight:bold">0</span>
</span></span><span style="display:flex;"><span>/dev/vde /data4 xfs defaults,noatime,nodiratime <span style="color:#0000cf;font-weight:bold">0</span> <span style="color:#0000cf;font-weight:bold">0</span>
</span></span></code></pre></div><p>SNMD mode can utilize multiple disks on a single server to provide higher performance and capacity, and tolerate partial disk failures.</p>
<p>But it can do nothing with node failure, and you can&rsquo;t add new nodes at runtime, so we don&rsquo;t recommend using SNMD mode in production unless you have a special reason.</p>
<hr>
<h2 id="multi-node-multi-drive">Multi-Node Multi-Drive</h2>
<p>Reference: <a href="https://min.io/docs/minio/linux/operations/install-deploy-manage/deploy-minio-multi-node-multi-drive.html">deploy-minio-multi-node-multi-drive</a></p>
<p>The extra <a href="/docs/reference/param/#minio_node"><code>minio_node</code></a> param will be used for a multi-node deployment in addition to the  <a href="/zh/docs/minio/param#minio_dataduojiduo"><code>minio_data</code></a></p>
<p>For example, this configuration defines a 4-node MinIO cluster with 4 drivers per node:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">minio</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">hosts</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">10.10.10.10</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span>{<span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">minio_seq: 1 }  # nodename</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">minio-1.pigsty</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">10.10.10.11</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span>{<span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">minio_seq: 2 }  # nodename</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">minio-2.pigsty</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">10.10.10.12</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span>{<span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">minio_seq: 3 }  # nodename</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">minio-3.pigsty</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">10.10.10.13</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span>{<span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">minio_seq: 4 }  # nodename</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">minio-4.pigsty</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">vars</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">minio_cluster</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">minio</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">minio_data</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#39;/data{1...4}&#39;</span><span style="color:#f8f8f8;text-decoration:underline">                         </span><span style="color:#8f5902;font-style:italic"># 4-disk per node</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">minio_node</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#39;${minio_cluster}-${minio_seq}.pigsty&#39;</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#8f5902;font-style:italic"># minio name pattern</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span></code></pre></div><p>The <a href="/zh/docs/minio/param#minio_node"><code>minio_node</code></a> param specifies the MinIO node name pattern, which is <code>${minio_cluster}-${minio_seq}.pigsty</code> by default.
The server name is very important for MinIO to identify and access other nodes in the cluster.
It will be populated with <code>minio_cluster</code> and <code>minio_seq</code>, and write to <code>/etc/hosts</code> of all minio cluster members.</p>
<p>In this case, the <code>MINIO_VOLUMES</code> will be set to <code>https://minio-{1...4}.pigsty/data{1...4}</code> to identify the 16 disks on 4 nodes.</p>
<hr>
<h2 id="multi-pool">Multi-Pool</h2>
<p>MinIO&rsquo;s architecture allows for <a href="/docs/minio/admin/#expand-cluster">cluster expansion</a> by adding new storage pools.
In Pigsty, you can achieve this by explicitly specifying the <a href="/docs/minio/param/#minio_volumes"><code>minio_volumes</code></a> param to specify nodes/disks for each pool.</p>
<p>For example, suppose you have already created a MinIO cluster as defined in the <a href="/docs/minio/config/#multi-node-multi-drive">Multi-Node Multi-Disk</a> example,
and now you want to add a new storage pool consisting of four nodes.</p>
<p>You can specify <a href="/zh/docs/minio/param#minio_volumes"><code>minio_volumes</code></a> here to allocate nodes for each pool to scale out the cluster.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">minio</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">hosts</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">10.10.10.10</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span>{<span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">minio_seq</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#0000cf;font-weight:bold">1</span><span style="color:#f8f8f8;text-decoration:underline"> </span>}<span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">10.10.10.11</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span>{<span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">minio_seq</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#0000cf;font-weight:bold">2</span><span style="color:#f8f8f8;text-decoration:underline"> </span>}<span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">10.10.10.12</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span>{<span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">minio_seq</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#0000cf;font-weight:bold">3</span><span style="color:#f8f8f8;text-decoration:underline"> </span>}<span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">10.10.10.13</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span>{<span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">minio_seq</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#0000cf;font-weight:bold">4</span><span style="color:#f8f8f8;text-decoration:underline"> </span>}<span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">10.10.10.14</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span>{<span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">minio_seq</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#0000cf;font-weight:bold">5</span><span style="color:#f8f8f8;text-decoration:underline"> </span>}<span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">10.10.10.15</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span>{<span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">minio_seq</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#0000cf;font-weight:bold">6</span><span style="color:#f8f8f8;text-decoration:underline"> </span>}<span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">10.10.10.16</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span>{<span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">minio_seq</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#0000cf;font-weight:bold">7</span><span style="color:#f8f8f8;text-decoration:underline"> </span>}<span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">10.10.10.17</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span>{<span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">minio_seq</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#0000cf;font-weight:bold">8</span><span style="color:#f8f8f8;text-decoration:underline"> </span>}<span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">vars</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">minio_cluster</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">minio</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">minio_data</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;/data{1...4}&#34;</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">minio_node</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#39;${minio_cluster}-${minio_seq}.pigsty&#39;</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#8f5902;font-style:italic"># minio 节点名称规则</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">minio_volumes</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#39;https://minio-{1...4}.pigsty:9000/data{1...4} https://minio-{5...8}.pigsty:9000/data{1...4}&#39;</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span></code></pre></div><p>Here, the two space-separated parameters represent two storage pools, each with four nodes and four disks per node.</p>
<p>For more information on storage pools, please refer to <a href="/docs/minio/admin/">Management Plan: MinIO Cluster Expansion</a>.</p>
<hr>
<h2 id="multiple-clusters">Multiple Clusters</h2>
<p>You can deploy new MinIO nodes as a completely new MinIO cluster by defining a new group with a different cluster name.</p>
<p>The following configuration declares two independent MinIO clusters:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">minio1</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">hosts</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">10.10.10.10</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span>{<span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">minio_seq</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#0000cf;font-weight:bold">1</span><span style="color:#f8f8f8;text-decoration:underline"> </span>}<span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">10.10.10.11</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span>{<span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">minio_seq</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#0000cf;font-weight:bold">2</span><span style="color:#f8f8f8;text-decoration:underline"> </span>}<span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">10.10.10.12</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span>{<span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">minio_seq</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#0000cf;font-weight:bold">3</span><span style="color:#f8f8f8;text-decoration:underline"> </span>}<span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">10.10.10.13</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span>{<span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">minio_seq</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#0000cf;font-weight:bold">4</span><span style="color:#f8f8f8;text-decoration:underline"> </span>}<span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">vars</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">minio_cluster</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">minio2</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">minio_data</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;/data{1...4}&#34;</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:bold">minio2</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">hosts</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">    
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">10.10.10.14</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span>{<span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">minio_seq</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#0000cf;font-weight:bold">5</span><span style="color:#f8f8f8;text-decoration:underline"> </span>}<span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">10.10.10.15</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span>{<span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">minio_seq</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#0000cf;font-weight:bold">6</span><span style="color:#f8f8f8;text-decoration:underline"> </span>}<span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">10.10.10.16</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span>{<span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">minio_seq</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#0000cf;font-weight:bold">7</span><span style="color:#f8f8f8;text-decoration:underline"> </span>}<span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">10.10.10.17</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span>{<span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">minio_seq</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#0000cf;font-weight:bold">8</span><span style="color:#f8f8f8;text-decoration:underline"> </span>}<span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">vars</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">minio_cluster</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">minio2</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">minio_data</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;/data{1...4}&#34;</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">minio_alias</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">sss2</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">minio_domain</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">sss2.pigsty</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">minio_endpoint</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">sss2.pigsty:9000</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span></code></pre></div><p>Please note that by default, Pigsty allows only one MinIO cluster per deployment.
If you need to deploy multiple MinIO clusters, some parameters with default values need to be explicitly set and cannot be omitted to avoid naming conflicts, as shown above.</p>
<hr>
<h2 id="expose-service">Expose Service</h2>
<p>MinIO will serve on port <code>9000</code> by default. If a multi-node MinIO cluster is deployed, you can access its service via any node.
It would be better to expose MinIO service via a load balancer, such as the default <a href="/docs/reference/param/#haproxy"><code>haproxy</code></a> on <a href="/docs/node/"><code>NODE</code></a>, or use the L2 <a href="/docs/reference/param/#node_vip">vip</a>.</p>
<p>To expose MinIO service with haproxy, you have to define an extra service with <a href="/docs/reference/param/#haproxy_services"><code>haproxy_services</code></a>:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">minio</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">hosts</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">10.10.10.10</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span>{<span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">minio_seq: 1 , nodename</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">minio-1 }</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">10.10.10.11</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span>{<span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">minio_seq: 2 , nodename</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">minio-2 }</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">10.10.10.12</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span>{<span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">minio_seq: 3 , nodename</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">minio-3 }</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">vars</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">minio_cluster</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">minio</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">node_cluster</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">minio</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">minio_data</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#39;/data{1...2}&#39;</span><span style="color:#f8f8f8;text-decoration:underline">         </span><span style="color:#8f5902;font-style:italic"># use two disk per node</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">minio_node</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#39;${minio_cluster}-${minio_seq}.pigsty&#39;</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#8f5902;font-style:italic"># minio node name pattern</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">haproxy_services</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">                  </span><span style="color:#8f5902;font-style:italic"># EXPOSING MINIO SERVICE WITH HAPROXY</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span>- <span style="color:#204a87;font-weight:bold">name</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">minio                   </span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#8f5902;font-style:italic"># [REQUIRED] service name, unique</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">        </span><span style="color:#204a87;font-weight:bold">port</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#0000cf;font-weight:bold">9002</span><span style="color:#f8f8f8;text-decoration:underline">                     </span><span style="color:#8f5902;font-style:italic"># [REQUIRED] service port, unique</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">        </span><span style="color:#204a87;font-weight:bold">options</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">                       </span><span style="color:#8f5902;font-style:italic"># [OPTIONAL] minio health check</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">          </span>- <span style="color:#000">option httpchk</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">          </span>- <span style="color:#000">option http-keep-alive</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">          </span>- <span style="color:#000">http-check send meth OPTIONS uri /minio/health/live</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">          </span>- <span style="color:#000">http-check expect status 200</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">        </span><span style="color:#204a87;font-weight:bold">servers</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">          </span>- {<span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">name: minio-1 ,ip: 10.10.10.10 ,port: 9000 ,options</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#39;check-ssl ca-file /etc/pki/ca.crt check port 9000&#39;</span><span style="color:#f8f8f8;text-decoration:underline"> </span>}<span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">          </span>- {<span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">name: minio-2 ,ip: 10.10.10.11 ,port: 9000 ,options</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#39;check-ssl ca-file /etc/pki/ca.crt check port 9000&#39;</span><span style="color:#f8f8f8;text-decoration:underline"> </span>}<span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">          </span>- {<span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">name: minio-3 ,ip: 10.10.10.12 ,port: 9000 ,options</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#39;check-ssl ca-file /etc/pki/ca.crt check port 9000&#39;</span><span style="color:#f8f8f8;text-decoration:underline"> </span>}<span style="color:#f8f8f8;text-decoration:underline">
</span></span></span></code></pre></div><p>MinIO uses port <code>9000</code> by default. A multi-node MinIO cluster can be accessed by connecting to <strong>any one of its nodes</strong>.</p>
<p>Service access falls under the scope of the <a href="/docs/node/">NODE</a> module, and we&rsquo;ll provide only a basic introduction here.</p>
<p>High-availability access to a multi-node MinIO cluster can be achieved using an L2 VIP or HAProxy.
For example, you can use Keepalived to bind an L2 <a href="/docs/reference/param/#node_vip">VIP</a> to the MinIO cluster,
or use the <a href="/docs/reference/param/#haproxy"><code>haproxy</code></a> component provided by the <a href="/docs/node/"><code>NODE</code></a> module to expose MinIO services through a load balancer.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># minio cluster with 4 nodes and 4 drivers per node</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:bold">minio</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">hosts</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">10.10.10.10</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span>{<span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">minio_seq: 1 , nodename</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">minio-1 }</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">10.10.10.11</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span>{<span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">minio_seq: 2 , nodename</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">minio-2 }</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">10.10.10.12</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span>{<span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">minio_seq: 3 , nodename</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">minio-3 }</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">10.10.10.13</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span>{<span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">minio_seq: 4 , nodename</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">minio-4 }</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">vars</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">minio_cluster</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">minio</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">minio_data</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#39;/data{1...4}&#39;</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">minio_buckets</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000;font-weight:bold">[</span><span style="color:#f8f8f8;text-decoration:underline"> </span>{<span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">name</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">pgsql }, { name: infra }, { name: redis } ]</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">minio_users</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span>- {<span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">access_key: dba , secret_key: S3User.DBA, policy</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">consoleAdmin }</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span>- {<span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">access_key: pgbackrest , secret_key: S3User.SomeNewPassWord , policy</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">readwrite }</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#8f5902;font-style:italic"># bind a node l2 vip (10.10.10.9) to minio cluster (optional)</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">node_cluster</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">minio</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">vip_enabled</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">true</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">vip_vrid</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#0000cf;font-weight:bold">128</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">vip_address</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#0000cf;font-weight:bold">10.10.10.9</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">vip_interface</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">eth1</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#8f5902;font-style:italic"># expose minio service with haproxy on all nodes</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">haproxy_services</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span>- <span style="color:#204a87;font-weight:bold">name</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">minio                   </span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#8f5902;font-style:italic"># [REQUIRED] service name, unique</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">        </span><span style="color:#204a87;font-weight:bold">port</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#0000cf;font-weight:bold">9002</span><span style="color:#f8f8f8;text-decoration:underline">                     </span><span style="color:#8f5902;font-style:italic"># [REQUIRED] service port, unique</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">        </span><span style="color:#204a87;font-weight:bold">balance</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">leastconn            </span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#8f5902;font-style:italic"># [OPTIONAL] load balancer algorithm</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">        </span><span style="color:#204a87;font-weight:bold">options</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">                       </span><span style="color:#8f5902;font-style:italic"># [OPTIONAL] minio health check</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">          </span>- <span style="color:#000">option httpchk</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">          </span>- <span style="color:#000">option http-keep-alive</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">          </span>- <span style="color:#000">http-check send meth OPTIONS uri /minio/health/live</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">          </span>- <span style="color:#000">http-check expect status 200</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">        </span><span style="color:#204a87;font-weight:bold">servers</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">          </span>- {<span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">name: minio-1 ,ip: 10.10.10.10 ,port: 9000 ,options</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#39;check-ssl ca-file /etc/pki/ca.crt check port 9000&#39;</span><span style="color:#f8f8f8;text-decoration:underline"> </span>}<span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">          </span>- {<span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">name: minio-2 ,ip: 10.10.10.11 ,port: 9000 ,options</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#39;check-ssl ca-file /etc/pki/ca.crt check port 9000&#39;</span><span style="color:#f8f8f8;text-decoration:underline"> </span>}<span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">          </span>- {<span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">name: minio-3 ,ip: 10.10.10.12 ,port: 9000 ,options</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#39;check-ssl ca-file /etc/pki/ca.crt check port 9000&#39;</span><span style="color:#f8f8f8;text-decoration:underline"> </span>}<span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">          </span>- {<span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">name: minio-4 ,ip: 10.10.10.13 ,port: 9000 ,options</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#39;check-ssl ca-file /etc/pki/ca.crt check port 9000&#39;</span><span style="color:#f8f8f8;text-decoration:underline"> </span>}<span style="color:#f8f8f8;text-decoration:underline">
</span></span></span></code></pre></div><p>In the configuration above, HAProxy is enabled on all nodes of the MinIO cluster, exposing MinIO services on port <code>9002</code>, and a Layer 2 VIP is bound to the cluster.
When in use, users should point the <code>sss.pigsty</code> domain name to the VIP address <code>10.10.10.9</code> and access MinIO services using port <code>9002</code>.
This ensures high availability, as the VIP will automatically switch to another node if any node fails.</p>
<p>In this scenario, you may also need to globally modify the destination of domain name resolution and adjust the <a href="/docs/minio/param/#minio_endpoint"><code>minio_endpoint</code></a> parameter to change the endpoint address corresponding to the MinIO alias on the management node:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">minio_endpoint</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">https://sss.pigsty:9002  </span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#8f5902;font-style:italic"># Override the default https://sss.pigsty:9000</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:bold">node_etc_hosts</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000;font-weight:bold">[</span><span style="color:#4e9a06">&#34;10.10.10.9 sss.pigsty&#34;</span><span style="color:#000;font-weight:bold">]</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#8f5902;font-style:italic"># Other nodes will use the sss.pigsty domain</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span></code></pre></div><hr>
<h2 id="dedicate-proxies">Dedicate Proxies</h2>
<p>Pigsty allow using dedicate load balancer cluster instead of the node cluster itself to run VIP &amp; HAProxy.</p>
<p>For example, the <a href="/docs/conf/prod/"><code>prod</code></a> template uses this way.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">proxy</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">hosts</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">10.10.10.18 </span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span>{<span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">nodename: proxy1 ,node_cluster: proxy ,vip_interface: eth1 ,vip_role</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">master }</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">10.10.10.19 </span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span>{<span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">nodename: proxy2 ,node_cluster: proxy ,vip_interface: eth1 ,vip_role</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">backup }</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">vars</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">vip_enabled</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">true</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">vip_address</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#0000cf;font-weight:bold">10.10.10.20</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">vip_vrid</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#0000cf;font-weight:bold">20</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">haproxy_services:      # expose minio service </span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">sss.pigsty:9000</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span>- <span style="color:#204a87;font-weight:bold">name</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">minio       </span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#8f5902;font-style:italic"># [REQUIRED] service name, unique</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">        </span><span style="color:#204a87;font-weight:bold">port</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#0000cf;font-weight:bold">9000</span><span style="color:#f8f8f8;text-decoration:underline">         </span><span style="color:#8f5902;font-style:italic"># [REQUIRED] service port, unique</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">        </span><span style="color:#204a87;font-weight:bold">balance</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">leastconn</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#8f5902;font-style:italic"># Use leastconn algorithm and minio health check</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">        </span><span style="color:#204a87;font-weight:bold">options</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000;font-weight:bold">[</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;option httpchk&#34;</span><span style="color:#000;font-weight:bold">,</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;option http-keep-alive&#34;</span><span style="color:#000;font-weight:bold">,</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;http-check send meth OPTIONS uri /minio/health/live&#34;</span><span style="color:#000;font-weight:bold">,</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;http-check expect status 200&#34;</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000;font-weight:bold">]</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">        </span><span style="color:#204a87;font-weight:bold">servers</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">           </span><span style="color:#8f5902;font-style:italic"># reload service with ./node.yml -t haproxy_config,haproxy_reload</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">          </span>- {<span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">name: minio-1 ,ip: 10.10.10.21 ,port: 9000 ,options</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#39;check-ssl ca-file /etc/pki/ca.crt check port 9000&#39;</span><span style="color:#f8f8f8;text-decoration:underline"> </span>}<span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">          </span>- {<span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">name: minio-2 ,ip: 10.10.10.22 ,port: 9000 ,options</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#39;check-ssl ca-file /etc/pki/ca.crt check port 9000&#39;</span><span style="color:#f8f8f8;text-decoration:underline"> </span>}<span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">          </span>- {<span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">name: minio-3 ,ip: 10.10.10.23 ,port: 9000 ,options</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#39;check-ssl ca-file /etc/pki/ca.crt check port 9000&#39;</span><span style="color:#f8f8f8;text-decoration:underline"> </span>}<span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">          </span>- {<span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">name: minio-4 ,ip: 10.10.10.24 ,port: 9000 ,options</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#39;check-ssl ca-file /etc/pki/ca.crt check port 9000&#39;</span><span style="color:#f8f8f8;text-decoration:underline"> </span>}<span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">          </span>- {<span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">name: minio-5 ,ip: 10.10.10.25 ,port: 9000 ,options</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#39;check-ssl ca-file /etc/pki/ca.crt check port 9000&#39;</span><span style="color:#f8f8f8;text-decoration:underline"> </span>}<span style="color:#f8f8f8;text-decoration:underline">
</span></span></span></code></pre></div><p>In this case, you need to manually configure the DNS resolution to point <code>sss.pigsty</code> to the VIP address of dedicate proxies cluster</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">minio_endpoint: https://sss.pigsty:9002    # overwrite the defaults</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">https://sss.pigsty:9000</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:bold">node_etc_hosts</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000;font-weight:bold">[</span><span style="color:#4e9a06">&#34;10.10.10.20 sss.pigsty&#34;</span><span style="color:#000;font-weight:bold">]</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#8f5902;font-style:italic"># domain name to access minio from all nodes (required)</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span></code></pre></div><hr>
<h2 id="access-service">Access Service</h2>
<p>To use the <a href="/docs/minio/config/#expose-service">exposed service</a>, you have to update/append the MinIO credential in the <a href="/docs/reference/param/#pgbackrest_repo"><code>pgbackrest_repo</code></a> section:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># This is the newly added HA MinIO Repo definition, USE THIS INSTEAD!</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:bold">minio_ha</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">type</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">s3</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">s3_endpoint: minio-1.pigsty   # s3_endpoint could be any load balancer</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#0000cf;font-weight:bold">10.10.10.1</span>{<span style="color:#0000cf;font-weight:bold">0</span><span style="color:#000;font-weight:bold">,</span><span style="color:#0000cf;font-weight:bold">1</span><span style="color:#000;font-weight:bold">,</span><span style="color:#0000cf;font-weight:bold">2</span>}<span style="color:#000;font-weight:bold">,</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">or domain names point to any of the 3 nodes</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">s3_region: us-east-1          # you could use external domain name</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">sss.pigsty , which resolve to any members  (`minio_domain`)</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">s3_bucket: pgsql              # instance &amp; nodename can be used </span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">minio-1.pigsty minio-1.pigsty minio-1.pigsty minio-1 minio-2 minio-3</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">s3_key</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">pgbackrest           </span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#8f5902;font-style:italic"># Better using a new password for MinIO pgbackrest user</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">s3_key_secret</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">S3User.SomeNewPassWord</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">s3_uri_style</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">path</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">path</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">/pgbackrest</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">storage_port</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#0000cf;font-weight:bold">9002</span><span style="color:#f8f8f8;text-decoration:underline">            </span><span style="color:#8f5902;font-style:italic"># Use the load balancer port 9002 instead of default 9000 (direct access)</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">storage_ca_file</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">/etc/pki/ca.crt</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">bundle</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">y</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">cipher_type</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">aes-256-cbc     </span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#8f5902;font-style:italic"># Better using a new cipher password for your production environment</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">cipher_pass</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">pgBackRest.With.Some.Extra.PassWord.And.Salt.${pg_cluster}</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">retention_full_type</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">time</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">retention_full</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#0000cf;font-weight:bold">14</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span></code></pre></div><hr>
<h2 id="expose-console">Expose Console</h2>
<p>MinIO has a built-in console that can be accessed via HTTPS @ <a href="/docs/minio/param/#minio_admin_port"><code>minio_admin_port</code></a>.
If you want to expose the MinIO console to the outside world, you can add MinIO to <a href="/docs/reference/param/#infra_portal"><code>infra_portal</code></a>.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># ./infra.yml -t nginx</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:bold">infra_portal</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">home         </span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span>{<span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">domain</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">h.pigsty }</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">grafana      </span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span>{<span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">domain: g.pigsty ,endpoint</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;${admin_ip}:3000&#34;</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">, websocket</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">true</span><span style="color:#f8f8f8;text-decoration:underline"> </span>}<span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">prometheus   </span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span>{<span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">domain: p.pigsty ,endpoint</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;${admin_ip}:9090&#34;</span><span style="color:#f8f8f8;text-decoration:underline"> </span>}<span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">alertmanager </span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span>{<span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">domain: a.pigsty ,endpoint</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;${admin_ip}:9093&#34;</span><span style="color:#f8f8f8;text-decoration:underline"> </span>}<span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">blackbox     </span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span>{<span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">endpoint</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;${admin_ip}:9115&#34;</span><span style="color:#f8f8f8;text-decoration:underline"> </span>}<span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">loki         </span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span>{<span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">endpoint</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;${admin_ip}:3100&#34;</span><span style="color:#f8f8f8;text-decoration:underline"> </span>}<span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#8f5902;font-style:italic"># MinIO console require HTTPS / Websocket to work</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">minio        </span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span>{<span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">domain: m.pigsty     ,endpoint</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;10.10.10.10:9001&#34;</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">,scheme: https ,websocket</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">true</span><span style="color:#f8f8f8;text-decoration:underline"> </span>}<span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">minio10      </span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span>{<span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">domain: m10.pigsty   ,endpoint</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;10.10.10.10:9001&#34;</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">,scheme: https ,websocket</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">true</span><span style="color:#f8f8f8;text-decoration:underline"> </span>}<span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">minio11      </span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span>{<span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">domain: m11.pigsty   ,endpoint</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;10.10.10.11:9001&#34;</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">,scheme: https ,websocket</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">true</span><span style="color:#f8f8f8;text-decoration:underline"> </span>}<span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">minio12      </span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span>{<span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">domain: m12.pigsty   ,endpoint</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;10.10.10.12:9001&#34;</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">,scheme: https ,websocket</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">true</span><span style="color:#f8f8f8;text-decoration:underline"> </span>}<span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">minio13      </span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span>{<span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">domain: m13.pigsty   ,endpoint</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;10.10.10.13:9001&#34;</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">,scheme: https ,websocket</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">true</span><span style="color:#f8f8f8;text-decoration:underline"> </span>}<span style="color:#f8f8f8;text-decoration:underline">
</span></span></span></code></pre></div><p>Beware that MinIO console should be accessed via HTTPS, please <strong>DO NOT</strong> expose MinIO console without encryption in production.</p>
<p>Which means you usually need to add <code>m.pigsty</code> resolution to your DNS server, or <code>/etc/hosts</code> on your local host, to access the MinIO console.</p>
<p>Meanwhile, if you are using Pigsty&rsquo;s self-signed CA rather than a regular public CA,
you usually need to manually trust the CA or certificate to skip the &ldquo;insecure&rdquo; warning in the browser.</p>
<br>
<hr>
<br>

</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-280b7e56b08e272d7b26411d506d6c5d">3 - Parameters</h1>
    <div class="lead">MinIO has 15 parameters to customize the cluster as needed.</div>
	<p>MinIO is a S3 compatible object storage service.
Which is used as an optional central backup storage repo for PostgreSQL.</p>
<p>You may also use it for other purposes, such as storing large files, documents, pictures &amp; videos.</p>
<hr>
<h2 id="parameters">Parameters</h2>
<p>There are <strong>15</strong> related parameters in MinIO module:</p>
<table>
<thead>
<tr>
<th style="text-align:right">Parameter</th>
<th style="text-align:center">Type</th>
<th style="text-align:center">Level</th>
<th>Comment</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right"><a href="/docs/minio/param/#minio_seq"><code>minio_seq</code></a></td>
<td style="text-align:center">int</td>
<td style="text-align:center">I</td>
<td>minio instance identifier, REQUIRED</td>
</tr>
<tr>
<td style="text-align:right"><a href="/docs/minio/param/#minio_cluster"><code>minio_cluster</code></a></td>
<td style="text-align:center">string</td>
<td style="text-align:center">C</td>
<td>minio cluster name, minio by default</td>
</tr>
<tr>
<td style="text-align:right"><a href="/docs/minio/param/#minio_clean"><code>minio_clean</code></a></td>
<td style="text-align:center">bool</td>
<td style="text-align:center">G/C/A</td>
<td>cleanup minio during init?, false by default</td>
</tr>
<tr>
<td style="text-align:right"><a href="/docs/minio/param/#minio_user"><code>minio_user</code></a></td>
<td style="text-align:center">username</td>
<td style="text-align:center">C</td>
<td>minio os user, <code>minio</code> by default</td>
</tr>
<tr>
<td style="text-align:right"><a href="/docs/minio/param/#minio_node"><code>minio_node</code></a></td>
<td style="text-align:center">string</td>
<td style="text-align:center">C</td>
<td>minio node name pattern</td>
</tr>
<tr>
<td style="text-align:right"><a href="/docs/minio/param/#minio_data"><code>minio_data</code></a></td>
<td style="text-align:center">path</td>
<td style="text-align:center">C</td>
<td>minio data dir(s), use {x&hellip;y} to specify multi drivers</td>
</tr>
<tr>
<td style="text-align:right"><a href="/docs/minio/param/#minio_volumes"><code>minio_volumes</code></a></td>
<td style="text-align:center">string</td>
<td style="text-align:center">C</td>
<td>minio core parameter, specify nodes and disks, auto-gen by default</td>
</tr>
<tr>
<td style="text-align:right"><a href="/docs/minio/param/#minio_domain"><code>minio_domain</code></a></td>
<td style="text-align:center">string</td>
<td style="text-align:center">G</td>
<td>minio external domain name, <code>sss.pigsty</code> by default</td>
</tr>
<tr>
<td style="text-align:right"><a href="/docs/minio/param/#minio_port"><code>minio_port</code></a></td>
<td style="text-align:center">port</td>
<td style="text-align:center">C</td>
<td>minio service port, 9000 by default</td>
</tr>
<tr>
<td style="text-align:right"><a href="/docs/minio/param/#minio_admin_port"><code>minio_admin_port</code></a></td>
<td style="text-align:center">port</td>
<td style="text-align:center">C</td>
<td>minio console port, 9001 by default</td>
</tr>
<tr>
<td style="text-align:right"><a href="/docs/minio/param/#minio_access_key"><code>minio_access_key</code></a></td>
<td style="text-align:center">username</td>
<td style="text-align:center">C</td>
<td>root access key, <code>minioadmin</code> by default</td>
</tr>
<tr>
<td style="text-align:right"><a href="/docs/minio/param/#minio_secret_key"><code>minio_secret_key</code></a></td>
<td style="text-align:center">password</td>
<td style="text-align:center">C</td>
<td>root secret key, <code>minioadmin</code> by default</td>
</tr>
<tr>
<td style="text-align:right"><a href="/docs/minio/param/#minio_extra_vars"><code>minio_extra_vars</code></a></td>
<td style="text-align:center">string</td>
<td style="text-align:center">C</td>
<td>extra environment variables for minio server</td>
</tr>
<tr>
<td style="text-align:right"><a href="/docs/minio/param/#minio_alias"><code>minio_alias</code></a></td>
<td style="text-align:center">string</td>
<td style="text-align:center">G</td>
<td>alias name for local minio deployment</td>
</tr>
<tr>
<td style="text-align:right"><a href="/docs/minio/param/#minio_endpoint"><code>minio_endpoint</code></a></td>
<td style="text-align:center">string</td>
<td style="text-align:center">C</td>
<td>corresponding host:port for above minio alias</td>
</tr>
<tr>
<td style="text-align:right"><a href="/docs/minio/param/#minio_buckets"><code>minio_buckets</code></a></td>
<td style="text-align:center">bucket[]</td>
<td style="text-align:center">C</td>
<td>list of minio bucket to be created</td>
</tr>
<tr>
<td style="text-align:right"><a href="/docs/minio/param/#minio_users"><code>minio_users</code></a></td>
<td style="text-align:center">user[]</td>
<td style="text-align:center">C</td>
<td>list of minio user to be created</td>
</tr>
</tbody>
</table>
<p>The <a href="/docs/minio/param/#minio_volumes"><code>minio_volumes</code></a> and <a href="minio_volumes"><code>minio_endpoint</code></a> are auto-generated parameters, but you can explicitly override these two parameters.</p>
<hr>
<h2 id="defaults">Defaults</h2>
<p>The default parameters of MinIO is defined in <a href="https://github.com/Vonng/pigsty/blob/main/roles/minio/defaults/main.yml"><code>roles/minio/defaults/main.yml</code></a></p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic">#-----------------------------------------------------------------</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#8f5902;font-style:italic"># MINIO</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#8f5902;font-style:italic">#-----------------------------------------------------------------</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#8f5902;font-style:italic">#minio_seq: 1                     # minio instance identifier, REQUIRED</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:bold">minio_cluster</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">minio             </span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#8f5902;font-style:italic"># minio cluster identifier, REQUIRED</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:bold">minio_clean</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">false</span><span style="color:#f8f8f8;text-decoration:underline">                </span><span style="color:#8f5902;font-style:italic"># cleanup minio during init?, false by default</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:bold">minio_user</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">minio                </span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#8f5902;font-style:italic"># minio os user, `minio` by default</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:bold">minio_node</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#39;${minio_cluster}-${minio_seq}.pigsty&#39;</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#8f5902;font-style:italic"># minio node name pattern</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:bold">minio_data</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#39;/data/minio&#39;</span><span style="color:#f8f8f8;text-decoration:underline">         </span><span style="color:#8f5902;font-style:italic"># minio data dir(s), use {x...y} to specify multi drivers</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#8f5902;font-style:italic">#minio_volumes:                   # minio data volumes, override defaults if specified</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:bold">minio_domain</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">sss.pigsty         </span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#8f5902;font-style:italic"># minio external domain name, `sss.pigsty` by default</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:bold">minio_port</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#0000cf;font-weight:bold">9000</span><span style="color:#f8f8f8;text-decoration:underline">                  </span><span style="color:#8f5902;font-style:italic"># minio service port, 9000 by default</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:bold">minio_admin_port</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#0000cf;font-weight:bold">9001</span><span style="color:#f8f8f8;text-decoration:underline">            </span><span style="color:#8f5902;font-style:italic"># minio console port, 9001 by default</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:bold">minio_access_key</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">minioadmin     </span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#8f5902;font-style:italic"># root access key, `minioadmin` by default</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:bold">minio_secret_key</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">minioadmin     </span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#8f5902;font-style:italic"># root secret key, `minioadmin` by default</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:bold">minio_extra_vars</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#39;&#39;</span><span style="color:#f8f8f8;text-decoration:underline">              </span><span style="color:#8f5902;font-style:italic"># extra environment variables</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:bold">minio_alias</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">sss                 </span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#8f5902;font-style:italic"># alias name for local minio deployment</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#8f5902;font-style:italic">#minio_endpoint: https://sss.pigsty:9000 # if not specified, overwritten by defaults</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:bold">minio_buckets</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000;font-weight:bold">[</span><span style="color:#f8f8f8;text-decoration:underline"> </span>{<span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">name</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">pgsql }, { name: infra },  { name: redis } ]</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:bold">minio_users</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span>- {<span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">access_key: dba , secret_key: S3User.DBA, policy</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">consoleAdmin }</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span>- {<span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">access_key: pgbackrest , secret_key: S3User.Backup, policy</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">readwrite }</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span></code></pre></div><hr>
<h2 id="minio_seq"><code>minio_seq</code></h2>
<p>name: <code>minio_seq</code>, type: <code>int</code>, level: <code>I</code></p>
<p>minio instance identifier, REQUIRED identity parameters. no default value, you have to assign it manually</p>
<hr>
<h2 id="minio_cluster"><code>minio_cluster</code></h2>
<p>name: <code>minio_cluster</code>, type: <code>string</code>, level: <code>C</code></p>
<p>minio cluster name, <code>minio</code> by default. This is useful when deploying multiple MinIO clusters</p>
<hr>
<h2 id="minio_clean"><code>minio_clean</code></h2>
<p>name: <code>minio_clean</code>, type: <code>bool</code>, level: <code>G/C/A</code></p>
<p>cleanup minio during init?, <code>false</code> by default</p>
<hr>
<h2 id="minio_user"><code>minio_user</code></h2>
<p>name: <code>minio_user</code>, type: <code>username</code>, level: <code>C</code></p>
<p>minio os user name, <code>minio</code> by default</p>
<hr>
<h2 id="minio_node"><code>minio_node</code></h2>
<p>name: <code>minio_node</code>, type: <code>string</code>, level: <code>C</code></p>
<p>minio node name pattern, this is used for <a href="/docs/minio/#multi-node-multi-drive">multi-node</a> deployment</p>
<p>default values: <code>${minio_cluster}-${minio_seq}.pigsty</code></p>
<hr>
<h2 id="minio_data"><code>minio_data</code></h2>
<p>name: <code>minio_data</code>, type: <code>path</code>, level: <code>C</code></p>
<p>minio data dir(s)</p>
<p>default values: <code>/data/minio</code>, which is a common dir for <a href="/docs/minio/#single-node-single-drive">single-node</a> deployment.</p>
<p>For a <a href="/docs/minio/#single-node-multi-drive">multi-drive</a> deployment, you can use <code>{x...y}</code> notion to specify multi drivers.</p>
<hr>
<h2 id="minio_volumes"><code>minio_volumes</code></h2>
<p>name: <code>minio_volumes</code>, type: <code>string</code>, level: <code>C</code></p>
<p>The only core parameter of MinIO, if not specified, it will be auto-generated by the following rule:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">minio_volumes</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;{% if minio_cluster_size|int &gt; 1 %}https://{{ minio_node|replace(&#39;${minio_cluster}&#39;, minio_cluster)|replace(&#39;${minio_seq}&#39;,minio_seq_range) }}:{{ minio_port|default(9000) }}{% endif %}{{ minio_data }}&#34;</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span></code></pre></div><ul>
<li>In case of <a href="/docs/minio/config/">SNSD</a> or <a href="/docs/minio/config/">SNMD</a> deployment, <code>minio_volumes</code> directly uses the value of <a href="/docs/minio/param/#minio_data"><code>minio_data</code></a></li>
<li>In case of <a href="/docs/minio/config/">MNMD</a> deployment, <code>minio_volumes</code> uses the values of <code>minio_node</code>, <code>minio_port</code>, <code>minio_data</code> to generate this param:</li>
<li>In case of multiple storage pool, you have to override <code>minio_volumes</code> to specify multiple node pools explicitly.</li>
</ul>
<p>It user&rsquo;s responsibility to make sure the parameters used in <code>minio_volumes</code> are consistent with <code>minio_node</code>, <code>minio_port</code>, <code>minio_data</code>.</p>
<hr>
<h2 id="minio_domain"><code>minio_domain</code></h2>
<p>name: <code>minio_domain</code>, type: <code>string</code>, level: <code>G</code></p>
<p>minio service domain name, <code>sss.pigsty</code> by default.</p>
<p>The client can access minio S3 service via this domain name. This name will be registered to local DNSMASQ and included in SSL certs.</p>
<hr>
<h2 id="minio_port"><code>minio_port</code></h2>
<p>name: <code>minio_port</code>, type: <code>port</code>, level: <code>C</code></p>
<p>minio service port, <code>9000</code> by default</p>
<hr>
<h2 id="minio_admin_port"><code>minio_admin_port</code></h2>
<p>name: <code>minio_admin_port</code>, type: <code>port</code>, level: <code>C</code></p>
<p>minio console port, <code>9001</code> by default</p>
<hr>
<h2 id="minio_access_key"><code>minio_access_key</code></h2>
<p>name: <code>minio_access_key</code>, type: <code>username</code>, level: <code>C</code></p>
<p>root access key, <code>minioadmin</code> by default</p>
<hr>
<h2 id="minio_secret_key"><code>minio_secret_key</code></h2>
<p>name: <code>minio_secret_key</code>, type: <code>password</code>, level: <code>C</code></p>
<p>root secret key, <code>minioadmin</code> by default</p>
<p>default values: <code>minioadmin</code></p>
<blockquote>
<p><strong>PLEASE CHANGE THIS IN YOUR DEPLOYMENT</strong></p>
</blockquote>
<hr>
<h2 id="minio_extra_vars"><code>minio_extra_vars</code></h2>
<p>name: <code>minio_extra_vars</code>, type: <code>string</code>, level: <code>C</code></p>
<p>extra environment variables for minio server. Check <a href="https://min.io/docs/minio/linux/reference/minio-server/minio-server.html">Minio Server</a> for the complete list.</p>
<p>default value is empty string, you can use multiline string to passing multiple environment variables.</p>
<hr>
<h2 id="minio_alias"><code>minio_alias</code></h2>
<p>name: <code>minio_alias</code>, type: <code>string</code>, level: <code>G</code></p>
<p>MinIO alias name for the local MinIO cluster</p>
<p>default values: <code>sss</code>, which will be written to infra nodes&rsquo; / admin users&rsquo; client alias profile.</p>
<hr>
<h2 id="minio_endpoint"><code>minio_endpoint</code></h2>
<p>name: <code>minio_endpoint</code>, type: <code>string</code>, level: <code>C</code></p>
<p>The corresponding host:port for the above MinIO alias. This parameter is not defined by default.</p>
<p>If not defined, it will be overwritten by the following default value:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>mcli <span style="color:#204a87">alias</span> <span style="color:#204a87">set</span> <span style="color:#ce5c00;font-weight:bold">{{</span> minio_alias <span style="color:#ce5c00;font-weight:bold">}}</span> <span style="color:#ce5c00;font-weight:bold">{</span>% <span style="color:#204a87;font-weight:bold">if</span> minio_endpoint is defined and minio_endpoint !<span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#4e9a06">&#39;&#39;</span> %<span style="color:#ce5c00;font-weight:bold">}{{</span> minio_endpoint <span style="color:#ce5c00;font-weight:bold">}}{</span>% <span style="color:#204a87;font-weight:bold">else</span> %<span style="color:#ce5c00;font-weight:bold">}</span>https://<span style="color:#ce5c00;font-weight:bold">{{</span> minio_domain <span style="color:#ce5c00;font-weight:bold">}}</span>:<span style="color:#ce5c00;font-weight:bold">{{</span> minio_port <span style="color:#ce5c00;font-weight:bold">}}{</span>% endif %<span style="color:#ce5c00;font-weight:bold">}</span> <span style="color:#ce5c00;font-weight:bold">{{</span> minio_access_key <span style="color:#ce5c00;font-weight:bold">}}</span> <span style="color:#ce5c00;font-weight:bold">{{</span> minio_secret_key <span style="color:#ce5c00;font-weight:bold">}}</span>
</span></span></code></pre></div><p>This alias &amp; endpoint will be added to the admin user on the admin node.</p>
<hr>
<h2 id="minio_buckets"><code>minio_buckets</code></h2>
<p>name: <code>minio_buckets</code>, type: <code>bucket[]</code>, level: <code>C</code></p>
<p>list of minio bucket to be created by default:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">minio_buckets</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000;font-weight:bold">[</span><span style="color:#f8f8f8;text-decoration:underline"> </span>{<span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">name</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">pgsql }, { name: infra },  { name: redis } ]</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span></code></pre></div><p>Three default buckets are created for module <a href="/docs/pgsql/"><code>PGSQL</code></a>, <a href="/docs/infra/"><code>INFRA</code></a>, and <a href="/docs/redis/"><code>REDIS</code></a></p>
<hr>
<h2 id="minio_users"><code>minio_users</code></h2>
<p>name: <code>minio_users</code>, type: <code>user[]</code>, level: <code>C</code></p>
<p>list of minio user to be created, default value:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">minio_users</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span>- {<span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">access_key: dba , secret_key: S3User.DBA, policy</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">consoleAdmin }</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span>- {<span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">access_key: pgbackrest , secret_key: S3User.Backup, policy</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">readwrite }</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span></code></pre></div><p>Two default users are created for PostgreSQL DBA and pgBackREST.</p>


<div class="alert alert-danger" role="alert">
<h4 class="alert-heading">It's dangerous to use default passwords!</h4>

    

</div>

<br>
<hr>
<br>

</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-ccc1805ae841df3ebaeb7bb6b8008203">4 - Playbook</h1>
    <div class="lead">How to manage MinIO cluster with ansible playbooks</div>
	<p>You have to <a href="/docs/minio/config/">configure</a> minio cluster in the <a href="/docs/setup/config/#inventory">config inventory</a> before running the playbook.</p>
<hr>
<h2 id="playbook">Playbook</h2>
<p>There&rsquo;s a built-in playbook: <a href="/docs/minio/playbook/#minioyml"><code>minio.yml</code></a> for installing the MinIO cluster.</p>
<h3 id="minioyml"><code>minio.yml</code></h3>
<p><a href="https://github.com/Vonng/pigsty/blob/main/minio.yml"><code>minio.yml</code></a></p>
<ul>
<li><code>minio-id</code>        : generate minio identity</li>
<li><code>minio_install</code>   : install minio/mcli
<ul>
<li><code>minio_os_user</code>   : create os user minio</li>
<li><code>minio_pkg</code>       : install minio/mcli package</li>
<li><code>minio_clean</code>     : remove minio data (not default)</li>
<li><code>minio_dir</code>       : create minio directories</li>
</ul>
</li>
<li><code>minio_config</code>    : generate minio config
<ul>
<li><code>minio_conf</code>    : minio main config</li>
<li><code>minio_cert</code>    : minio ssl cert</li>
<li><code>minio_dns</code>     : write minio dns records</li>
</ul>
</li>
<li><code>minio_launch</code>    : launch minio service</li>
<li><code>minio_register</code>  : register minio to prometheus</li>
<li><code>minio_provision</code> : create minio aliases/buckets/users
<ul>
<li><code>minio_alias</code>   : create minio client alias</li>
<li><code>minio_bucket</code>  : create minio buckets</li>
<li><code>minio_user</code>    : create minio biz users</li>
</ul>
</li>
</ul>
<p>Trusted ca file: <code>/etc/pki/ca.crt</code> should exist on all nodes already. which is generated in <code>role: ca</code> and loaded &amp; trusted by default in <code>role: node</code>.</p>
<p>You should install <a href="/docs/minio/"><code>MINIO</code></a> module on Pigsty-managed nodes (i.e., Install <a href="/docs/node/"><code>NODE</code></a> first)</p>
<p><a href="https://asciinema.org/a/566415"><img alt="asciicast" src="https://asciinema.org/a/566415.svg"></a></p>
<hr>
<h2 id="commands">Commands</h2>
<p>MINIO Playbook cheatsheet and common commands</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>./minio.yml -l &lt;cls&gt;                      <span style="color:#8f5902;font-style:italic"># init MINIO module on group &lt;cls&gt;</span>
</span></span><span style="display:flex;"><span>./minio.yml -l minio -e <span style="color:#000">minio_clean</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#204a87">true</span>  <span style="color:#8f5902;font-style:italic"># init MINIO, and remove existing MinIO &amp; Data (DANGEROUS!)</span>
</span></span><span style="display:flex;"><span>./minio.yml -l minio -e <span style="color:#000">minio_clean</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#204a87">true</span> -t minio_clean <span style="color:#8f5902;font-style:italic"># Remove existing MinIO &amp; Data (DANGEROUS!)</span>
</span></span><span style="display:flex;"><span>./minio.yml -l minio -t minio_instal      <span style="color:#8f5902;font-style:italic"># install MinIO, setup dirs, without configure &amp; launch</span>
</span></span><span style="display:flex;"><span>./minio.yml -l minio -t minio_config      <span style="color:#8f5902;font-style:italic"># generate MinIO config &amp; certs</span>
</span></span><span style="display:flex;"><span>./minio.yml -l minio -t minio_launch      <span style="color:#8f5902;font-style:italic"># restart MinIO cluster</span>
</span></span></code></pre></div><hr>
<h2 id="safeguard">Safeguard</h2>
<p>Minio has a safeguard to prevent accidental deletion. Control by the following parameter:</p>
<ul>
<li><a href="/zh/docs/minio/param#minio_clean"><code>minio_clean</code></a>, <code>false</code> by default, which means Pigsty will not remove existing MinIO data by default</li>
</ul>
<p>If you wish to remove existing minio data during init, please set this parameter to <code>true</code> in the config file, or override it with command-line parameter <code>-e minio_clean=true</code>.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>./minio.yml -l &lt;cls&gt; -e <span style="color:#000">minio_clean</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#204a87">true</span>
</span></span></code></pre></div><p>If you just want to clean existing MinIO data without installing a new instance, simply execute the <code>minio_clean</code> subtask:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>./minio.yml -l &lt;cls&gt; -e <span style="color:#000">minio_clean</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#204a87">true</span> -t minio_clean
</span></span></code></pre></div><hr>
<h2 id="demo">Demo</h2>
<p><a href="https://asciinema.org/a/566415"><img alt="asciicast" src="https://asciinema.org/a/566415.svg"></a></p>
<br>
<hr>
<br>

</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-172708bf70f3c5729ee49aac66787c09">5 - Administration</h1>
    <div class="lead">Admin SOP, create &amp; remove MinIO clusters and members</div>
	<p>Here are some administration SOP for MinIO:</p>
<ul>
<li><a href="/docs/minio/admin/#create-cluster">Create Cluster</a></li>
<li><a href="/docs/minio/admin/#remove-cluster">Remove Cluster</a></li>
<li><a href="/docs/minio/admin/#expand-cluster">Expand Cluster</a></li>
<li><a href="/docs/minio/admin/#shrink-cluster">Shrink Cluster</a></li>
<li><a href="/docs/minio/admin/#upgrade-cluster">Upgrade Cluster</a></li>
<li><a href="/docs/minio/admin/#node-failure-recovery">Node Failure Recovery</a></li>
<li><a href="/docs/minio/admin/#disk-failure-recovery">Disk failure Recovery</a></li>
</ul>
<p>Check <a href="/docs/minio/faq/">ETCD: FAQ</a> for more questions.</p>
<hr>
<h2 id="create-cluster">Create Cluster</h2>
<p>To create a MinIO cluster, define the <code>minio</code> cluster in <a href="/docs/setup/config/#inventory">inventory</a> first:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">minio</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span>{<span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">hosts</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span>{<span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">10.10.10.10</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span>{<span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">minio_seq: 1 } }, vars</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span>{<span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">minio_cluster</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">minio } }</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span></code></pre></div><p>The <a href="/docs/minio/param/#minio_cluster"><code>minio_cluster</code></a> param mark this cluster as a MinIO cluster, and the <code>minio_seq</code> is the sequence number of the MinIO node, which is used to generate MinIO node name like <code>minio-1</code>, <code>minio-2</code>, etc.</p>
<p>This snippet defines a single-node MinIO cluster, using the following command to create the MinIO cluster:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>./minio.yml -l minio  <span style="color:#8f5902;font-style:italic"># init MinIO module on the minio group </span>
</span></span></code></pre></div><hr>
<h2 id="remove-cluster">Remove Cluster</h2>
<p>To destroy an existing MinIO cluster, use the <code>minio_clean</code> subtask of  <a href="/docs/minio/playbook/#minioyml"><code>minio.yml</code></a>, DO THINK before you type.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>./minio.yml -l minio -t minio_clean -e <span style="color:#000">minio_clean</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#204a87">true</span>   <span style="color:#8f5902;font-style:italic"># Stop MinIO and Remove Data Dir </span>
</span></span></code></pre></div><p>If you wish to remove prometheus monitor target too:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>ansible infra -b -a <span style="color:#4e9a06">&#39;rm -rf /etc/prometheus/targets/minio/minio-1.yml&#39;</span>  <span style="color:#8f5902;font-style:italic"># delete the minio monitoring target </span>
</span></span></code></pre></div><hr>
<h2 id="expand-cluster">Expand Cluster</h2>
<ul>
<li><a href="https://min.io/docs/minio/linux/operations/install-deploy-manage/expand-minio-deployment.html">Tutorial: Expand MinIO Deployment</a></li>
</ul>
<p>You can not scale MinIO at node/disk level, but you can scale at storage pool (multiple nodes) level.</p>
<p>Assume you have a 4-node MinIO cluster and want to double the capacity by adding another four-node storage pool.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">minio</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">hosts</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">10.10.10.10</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span>{<span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">minio_seq: 1 , nodename</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">minio-1 }</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">10.10.10.11</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span>{<span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">minio_seq: 2 , nodename</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">minio-2 }</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">10.10.10.12</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span>{<span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">minio_seq: 3 , nodename</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">minio-3 }</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">10.10.10.13</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span>{<span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">minio_seq: 4 , nodename</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">minio-4 }</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">vars</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">minio_cluster</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">minio</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">minio_data</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#39;/data{1...4}&#39;</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">minio_buckets</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000;font-weight:bold">[</span><span style="color:#f8f8f8;text-decoration:underline"> </span>{<span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">name</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">pgsql }, { name: infra }, { name: redis } ]</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">minio_users</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span>- {<span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">access_key: dba , secret_key: S3User.DBA, policy</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">consoleAdmin }</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span>- {<span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">access_key: pgbackrest , secret_key: S3User.SomeNewPassWord , policy</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">readwrite }</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#8f5902;font-style:italic"># bind a node l2 vip (10.10.10.9) to minio cluster (optional)</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">node_cluster</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">minio</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">vip_enabled</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">true</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">vip_vrid</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#0000cf;font-weight:bold">128</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">vip_address</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#0000cf;font-weight:bold">10.10.10.9</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">vip_interface</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">eth1</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#8f5902;font-style:italic"># expose minio service with haproxy on all nodes</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">haproxy_services</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span>- <span style="color:#204a87;font-weight:bold">name</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">minio                   </span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#8f5902;font-style:italic"># [REQUIRED] service name, unique</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">        </span><span style="color:#204a87;font-weight:bold">port</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#0000cf;font-weight:bold">9002</span><span style="color:#f8f8f8;text-decoration:underline">                     </span><span style="color:#8f5902;font-style:italic"># [REQUIRED] service port, unique</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">        </span><span style="color:#204a87;font-weight:bold">balance</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">leastconn            </span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#8f5902;font-style:italic"># [OPTIONAL] load balancer algorithm</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">        </span><span style="color:#204a87;font-weight:bold">options</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">                       </span><span style="color:#8f5902;font-style:italic"># [OPTIONAL] minio health check</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">          </span>- <span style="color:#000">option httpchk</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">          </span>- <span style="color:#000">option http-keep-alive</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">          </span>- <span style="color:#000">http-check send meth OPTIONS uri /minio/health/live</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">          </span>- <span style="color:#000">http-check expect status 200</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">        </span><span style="color:#204a87;font-weight:bold">servers</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">          </span>- {<span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">name: minio-1 ,ip: 10.10.10.10 ,port: 9000 ,options</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#39;check-ssl ca-file /etc/pki/ca.crt check port 9000&#39;</span><span style="color:#f8f8f8;text-decoration:underline"> </span>}<span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">          </span>- {<span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">name: minio-2 ,ip: 10.10.10.11 ,port: 9000 ,options</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#39;check-ssl ca-file /etc/pki/ca.crt check port 9000&#39;</span><span style="color:#f8f8f8;text-decoration:underline"> </span>}<span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">          </span>- {<span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">name: minio-3 ,ip: 10.10.10.12 ,port: 9000 ,options</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#39;check-ssl ca-file /etc/pki/ca.crt check port 9000&#39;</span><span style="color:#f8f8f8;text-decoration:underline"> </span>}<span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">          </span>- {<span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">name: minio-4 ,ip: 10.10.10.13 ,port: 9000 ,options</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#39;check-ssl ca-file /etc/pki/ca.crt check port 9000&#39;</span><span style="color:#f8f8f8;text-decoration:underline"> </span>}<span style="color:#f8f8f8;text-decoration:underline">
</span></span></span></code></pre></div><p>Step 1, add 4 node definition in the group, allocate sequence number 5 to 8.
The key step is to modify the <a href="/docs/minio/param/#minio_volumes"><code>minio_volumes</code></a> param, assign the new 4 nodes to a new <strong>storage pool</strong>.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">minio</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">hosts</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">10.10.10.10</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span>{<span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">minio_seq: 1 , nodename</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">minio-1 }</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">10.10.10.11</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span>{<span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">minio_seq: 2 , nodename</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">minio-2 }</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">10.10.10.12</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span>{<span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">minio_seq: 3 , nodename</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">minio-3 }</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">10.10.10.13</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span>{<span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">minio_seq: 4 , nodename</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">minio-4 }</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#8f5902;font-style:italic"># new nodes</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">10.10.10.14</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span>{<span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">minio_seq: 5 , nodename</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">minio-5 }</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">10.10.10.15</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span>{<span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">minio_seq: 6 , nodename</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">minio-6 }</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">10.10.10.16</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span>{<span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">minio_seq: 7 , nodename</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">minio-7 }</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">10.10.10.17</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span>{<span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">minio_seq: 8 , nodename</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">minio-8 }</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">vars</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">minio_cluster</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">minio</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">minio_data</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#39;/data{1...4}&#39;</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">minio_volumes</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#39;https://minio-{1...4}.pigsty:9000/data{1...4} https://minio-{5...8}.pigsty:9000/data{1...4}&#39;</span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#8f5902;font-style:italic"># 新增的集群配置</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#8f5902;font-style:italic"># misc params</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span></code></pre></div><p>Step 2, adding these nodes to Pigsty:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>./node.yml -l 10.10.10.14,10.10.10.15,10.10.10.16,10.10.10.17
</span></span></code></pre></div><p>Step 3, Provisioning MinIO on new nodes with <code>minio_install</code> subtask (user, dir, pkg, &hellip;):</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>./minio.yml -l 10.10.10.14,10.10.10.15,10.10.10.16,10.10.10.17 -t minio_install
</span></span></code></pre></div><p>Step 4: Reconfigure the entire MinIO cluster on the <strong>whole cluster</strong> with <code>minio_config</code> subtask</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>./minio.yml -l minio -t minio_config
</span></span></code></pre></div><blockquote>
<p>That is to say, the existing 4-nodes&rsquo; <code>MINIO_VOLUMES</code> configuration will be updated, too</p>
</blockquote>
<p>Step 5: Restart the entire MinIO cluster simultaneously (be careful, do not rolling restart!):</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>./minio.yml -l minio -t minio_launch -f <span style="color:#0000cf;font-weight:bold">10</span>   <span style="color:#8f5902;font-style:italic"># with 10 parallel</span>
</span></span></code></pre></div><p>Step 6: This is <strong>optional</strong>, if you are using a load balancer, make sure the load balancer configuration is updated.</p>
<p>For example, add the new four nodes to the load balancer configuration:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># expose minio service with haproxy on all nodes</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:bold">haproxy_services</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span>- <span style="color:#204a87;font-weight:bold">name</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">minio                   </span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#8f5902;font-style:italic"># [REQUIRED] service name, unique</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">port</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#0000cf;font-weight:bold">9002</span><span style="color:#f8f8f8;text-decoration:underline">                     </span><span style="color:#8f5902;font-style:italic"># [REQUIRED] service port, unique</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">balance</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">leastconn            </span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#8f5902;font-style:italic"># [OPTIONAL] load balancer algorithm</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">options</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">                       </span><span style="color:#8f5902;font-style:italic"># [OPTIONAL] minio health check</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span>- <span style="color:#000">option httpchk</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span>- <span style="color:#000">option http-keep-alive</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span>- <span style="color:#000">http-check send meth OPTIONS uri /minio/health/live</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span>- <span style="color:#000">http-check expect status 200</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">servers</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span>- {<span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">name: minio-1 ,ip: 10.10.10.10 ,port: 9000 ,options</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#39;check-ssl ca-file /etc/pki/ca.crt check port 9000&#39;</span><span style="color:#f8f8f8;text-decoration:underline"> </span>}<span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span>- {<span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">name: minio-2 ,ip: 10.10.10.11 ,port: 9000 ,options</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#39;check-ssl ca-file /etc/pki/ca.crt check port 9000&#39;</span><span style="color:#f8f8f8;text-decoration:underline"> </span>}<span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span>- {<span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">name: minio-3 ,ip: 10.10.10.12 ,port: 9000 ,options</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#39;check-ssl ca-file /etc/pki/ca.crt check port 9000&#39;</span><span style="color:#f8f8f8;text-decoration:underline"> </span>}<span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span>- {<span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">name: minio-4 ,ip: 10.10.10.13 ,port: 9000 ,options</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#39;check-ssl ca-file /etc/pki/ca.crt check port 9000&#39;</span><span style="color:#f8f8f8;text-decoration:underline"> </span>}<span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span>- {<span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">name: minio-5 ,ip: 10.10.10.14 ,port: 9000 ,options</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#39;check-ssl ca-file /etc/pki/ca.crt check port 9000&#39;</span><span style="color:#f8f8f8;text-decoration:underline"> </span>}<span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span>- {<span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">name: minio-6 ,ip: 10.10.10.15 ,port: 9000 ,options</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#39;check-ssl ca-file /etc/pki/ca.crt check port 9000&#39;</span><span style="color:#f8f8f8;text-decoration:underline"> </span>}<span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span>- {<span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">name: minio-7 ,ip: 10.10.10.16 ,port: 9000 ,options</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#39;check-ssl ca-file /etc/pki/ca.crt check port 9000&#39;</span><span style="color:#f8f8f8;text-decoration:underline"> </span>}<span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span>- {<span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">name: minio-8 ,ip: 10.10.10.17 ,port: 9000 ,options</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#39;check-ssl ca-file /etc/pki/ca.crt check port 9000&#39;</span><span style="color:#f8f8f8;text-decoration:underline"> </span>}<span style="color:#f8f8f8;text-decoration:underline">
</span></span></span></code></pre></div><p>Then Tun the <code>haproxy</code> subtask of the <code>node.yml</code> playbook to update the load balancer configuration:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>./node.yml -l minio -t haproxy_config,haproxy_reload   <span style="color:#8f5902;font-style:italic"># re-configure and reload haproxy service definition</span>
</span></span></code></pre></div><p>If node L2 VIP is also used to ensure reliable load balancer access, you also need to add new nodes (if any) to the existing NODE VIP group:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>./node.yml -l minio -t node_vip  <span style="color:#8f5902;font-style:italic"># reload node l2 vip configuration</span>
</span></span></code></pre></div><hr>
<h2 id="shrink-cluster">Shrink Cluster</h2>
<p>MinIO cannot scale down at the node/disk level, but you can retire at the storage pool (multiple nodes) level ——
Add a new storage pool, drain the old storage pool, migrate to the new storage pool, and then retire the old storage pool.</p>
<ul>
<li><a href="https://min.io/docs/minio/linux/operations/install-deploy-manage/decommission-server-pool.html">Tutorial: Decommission Server Pool</a></li>
</ul>
<hr>
<h2 id="upgrade-cluster">Upgrade Cluster</h2>
<ul>
<li><a href="https://min.io/docs/minio/linux/operations/install-deploy-manage/upgrade-minio-deployment.html">Tutorial: Upgrade MinIO Deployment</a></li>
</ul>
<p>First, download the new version of the MinIO software package to the local software repository of the INFRA node:</p>
<ul>
<li><a href="https://github.com/minio/minio">minio</a>:
<ul>
<li>amd64: <a href="https://dl.min.io/server/minio/release/linux-amd64/">https://dl.min.io/server/minio/release/linux-amd64/</a></li>
<li>arm64: <a href="https://dl.min.io/server/minio/release/linux-arm64/">https://dl.min.io/server/minio/release/linux-arm64/</a></li>
</ul>
</li>
<li><a href="https://github.com/minio/mc">mcli</a>:
<ul>
<li>amd64: <a href="https://dl.min.io/client/mc/release/linux-amd64/">https://dl.min.io/client/mc/release/linux-amd64/</a></li>
<li>arm64: <a href="https://dl.min.io/client/mc/release/linux-arm64/">https://dl.min.io/client/mc/release/linux-arm64/</a></li>
</ul>
</li>
</ul>
<p>and then rebuild the software repo with:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>./infra.yml -t repo_create
</span></span></code></pre></div><p>You can upgrade all MinIO software packages with Ansible <code>package</code> module:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>ansible minio -m package -b -a <span style="color:#4e9a06">&#39;name=minio state=latest&#39;</span>  <span style="color:#8f5902;font-style:italic"># upgrade MinIO server</span>
</span></span><span style="display:flex;"><span>ansible minio -m package -b -a <span style="color:#4e9a06">&#39;name=mcli state=latest&#39;</span>   <span style="color:#8f5902;font-style:italic"># upgrade mcli client</span>
</span></span></code></pre></div><p>Finlly, notify the MinIO cluster to restart with the <code>mc</code> command line tool:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>mc admin service restart sss
</span></span></code></pre></div><hr>
<h2 id="node-failure-recovery">Node Failure Recovery</h2>
<ul>
<li><a href="https://min.io/docs/minio/linux/operations/data-recovery/recover-after-node-failure.html#minio-restore-hardware-failure-node">Tutorial: Restore Hardware Failure Node</a></li>
</ul>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># 1. remove failure node</span>
</span></span><span style="display:flex;"><span>bin/node-rm &lt;your_old_node_ip&gt;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># 2. replace failure node with the same name (modify the inventory in case of IP change)</span>
</span></span><span style="display:flex;"><span>bin/node-add &lt;your_new_node_ip&gt;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># 3. provisioning MinIO on new node</span>
</span></span><span style="display:flex;"><span>./minio.yml -l &lt;your_new_node_ip&gt;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># 4. instruct MinIO to perform heal action</span>
</span></span><span style="display:flex;"><span>mc admin heal
</span></span></code></pre></div><hr>
<h2 id="disk-failure-recovery">Disk Failure Recovery</h2>
<ul>
<li><a href="https://min.io/docs/minio/linux/operations/data-recovery/recover-after-drive-failure.html#minio-restore-hardware-failure-drive">Tutorial: Restore Hardware Failure Disk</a></li>
</ul>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># 1. umount failure disk</span>
</span></span><span style="display:flex;"><span>umount /dev/&lt;your_disk_device&gt;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># 2. replace with new driver, format with xfs</span>
</span></span><span style="display:flex;"><span>mkfs.xfs /dev/sdb -L DRIVE1
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># 3. don&#39;t forget to setup fstab for auto-mount</span>
</span></span><span style="display:flex;"><span>vi /etc/fstab
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># LABEL=DRIVE1     /mnt/drive1    xfs     defaults,noatime  0       2</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># 4. remount the new disk</span>
</span></span><span style="display:flex;"><span>mount -a
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># 5. instruct MinIO to perform heal action</span>
</span></span><span style="display:flex;"><span>mc admin heal
</span></span></code></pre></div>
</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-81383092950ff4115e1c3850be65d36f">6 - Monitoring</h1>
    <div class="lead">MinIO monitoring metrics, dashboards, and alerting rules</div>
	<hr>
<h2 id="dashboard">Dashboard</h2>
<p>There is one dashboard for <a href="/docs/minio/"><code>MINIO</code></a> module.</p>
<p><a href="https://demo.pigsty.cc/d/minio-overview">MinIO Overview</a>: Overview of one single MinIO cluster</p>
<p><a href="https://demo.pigsty.cc/d/minio-overview"><img alt="minio-overview.jpg" src="/img/dashboard/minio-overview.jpg"></a></p>
<hr>
<h2 id="alert-rules">Alert Rules</h2>
<p>There are 3 predefined alert rules for MinIO,
defined in <a href="https://github.com/Vonng/pigsty/blob/main/files/prometheus/rules/minio.yml"><code>files/prometheus/rules/minio.yml</code></a></p>
<ul>
<li><code>MinioServerDown</code></li>
<li><code>MinioNodeOffline</code></li>
<li><code>MinioDiskOffline</code></li>
</ul>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic">#==============================================================#</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#8f5902;font-style:italic">#                         Aliveness                            #</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#8f5902;font-style:italic">#==============================================================#</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#8f5902;font-style:italic"># MinIO server instance down</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span>- <span style="color:#204a87;font-weight:bold">alert</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">MinioServerDown</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">expr</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">minio_up &lt; 1</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">for</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">1m</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">labels</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span>{<span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">level: 0, severity: CRIT, category</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">minio }</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">annotations</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">summary</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;CRIT MinioServerDown {{ $labels.ins }}@{{ $labels.instance }}&#34;</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">description</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000;font-weight:bold">|</span><span style="color:#8f5902;font-style:italic">
</span></span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic">      minio_up[ins={{ $labels.ins }}, instance={{ $labels.instance }}] = {{ $value }} &lt; 1
</span></span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic">      http://g.pigsty/d/minio-overview</span><span style="color:#f8f8f8;text-decoration:underline">      
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#8f5902;font-style:italic">#==============================================================#</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#8f5902;font-style:italic">#                         Error                                #</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#8f5902;font-style:italic">#==============================================================#</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#8f5902;font-style:italic"># MinIO node offline triggers a p1 alert</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span>- <span style="color:#204a87;font-weight:bold">alert</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">MinioNodeOffline</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">expr</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">avg_over_time(minio_cluster_nodes_offline_total{job=&#34;minio&#34;}[5m]) &gt; 0</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">for</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">3m</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">labels</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span>{<span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">level: 1, severity: WARN, category</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">minio }</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">annotations</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">summary</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;WARN MinioNodeOffline: {{ $labels.cls }} {{ $value }}&#34;</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">description</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000;font-weight:bold">|</span><span style="color:#8f5902;font-style:italic">
</span></span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic">      minio_cluster_nodes_offline_total[cls={{ $labels.cls }}] = {{ $value }} &gt; 0
</span></span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic">      http://g.pigsty/d/minio-overview?from=now-5m&amp;to=now&amp;var-cls={{$labels.cls}}</span><span style="color:#f8f8f8;text-decoration:underline">      
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#8f5902;font-style:italic"># MinIO disk offline triggers a p1 alert</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span>- <span style="color:#204a87;font-weight:bold">alert</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">MinioDiskOffline</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">expr</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">avg_over_time(minio_cluster_disk_offline_total{job=&#34;minio&#34;}[5m]) &gt; 0</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">for</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">3m</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">labels</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span>{<span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">level: 1, severity: WARN, category</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">minio }</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">annotations</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">summary</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;WARN MinioDiskOffline: {{ $labels.cls }} {{ $value }}&#34;</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">description</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000;font-weight:bold">|</span><span style="color:#8f5902;font-style:italic">
</span></span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic">      minio_cluster_disk_offline_total[cls={{ $labels.cls }}] = {{ $value }} &gt; 0
</span></span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic">      http://g.pigsty/d/minio-overview?from=now-5m&amp;to=now&amp;var-cls={{$labels.cls}}</span><span style="color:#f8f8f8;text-decoration:underline">      
</span></span></span></code></pre></div>
</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-61857417600e2adc512dcba599edd776">7 - Metrics</h1>
    <div class="lead">Pigsty MINIO module metric list</div>
	<p><a href="/docs/minio/"><strong><code>MINIO</code></strong></a> module has 79 available metrics</p>
<table>
<thead>
<tr>
<th>Metric Name</th>
<th>Type</th>
<th>Labels</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>minio_audit_failed_messages</td>
<td>counter</td>
<td><code>ip</code>, <code>job</code>, <code>target_id</code>, <code>cls</code>, <code>instance</code>, <code>server</code>, <code>ins</code></td>
<td>Total number of messages that failed to send since start</td>
</tr>
<tr>
<td>minio_audit_target_queue_length</td>
<td>gauge</td>
<td><code>ip</code>, <code>job</code>, <code>target_id</code>, <code>cls</code>, <code>instance</code>, <code>server</code>, <code>ins</code></td>
<td>Number of unsent messages in queue for target</td>
</tr>
<tr>
<td>minio_audit_total_messages</td>
<td>counter</td>
<td><code>ip</code>, <code>job</code>, <code>target_id</code>, <code>cls</code>, <code>instance</code>, <code>server</code>, <code>ins</code></td>
<td>Total number of messages sent since start</td>
</tr>
<tr>
<td>minio_cluster_bucket_total</td>
<td>gauge</td>
<td><code>ip</code>, <code>job</code>, <code>cls</code>, <code>instance</code>, <code>server</code>, <code>ins</code></td>
<td>Total number of buckets in the cluster</td>
</tr>
<tr>
<td>minio_cluster_capacity_raw_free_bytes</td>
<td>gauge</td>
<td><code>ip</code>, <code>job</code>, <code>cls</code>, <code>instance</code>, <code>server</code>, <code>ins</code></td>
<td>Total free capacity online in the cluster</td>
</tr>
<tr>
<td>minio_cluster_capacity_raw_total_bytes</td>
<td>gauge</td>
<td><code>ip</code>, <code>job</code>, <code>cls</code>, <code>instance</code>, <code>server</code>, <code>ins</code></td>
<td>Total capacity online in the cluster</td>
</tr>
<tr>
<td>minio_cluster_capacity_usable_free_bytes</td>
<td>gauge</td>
<td><code>ip</code>, <code>job</code>, <code>cls</code>, <code>instance</code>, <code>server</code>, <code>ins</code></td>
<td>Total free usable capacity online in the cluster</td>
</tr>
<tr>
<td>minio_cluster_capacity_usable_total_bytes</td>
<td>gauge</td>
<td><code>ip</code>, <code>job</code>, <code>cls</code>, <code>instance</code>, <code>server</code>, <code>ins</code></td>
<td>Total usable capacity online in the cluster</td>
</tr>
<tr>
<td>minio_cluster_drive_offline_total</td>
<td>gauge</td>
<td><code>ip</code>, <code>job</code>, <code>cls</code>, <code>instance</code>, <code>server</code>, <code>ins</code></td>
<td>Total drives offline in this cluster</td>
</tr>
<tr>
<td>minio_cluster_drive_online_total</td>
<td>gauge</td>
<td><code>ip</code>, <code>job</code>, <code>cls</code>, <code>instance</code>, <code>server</code>, <code>ins</code></td>
<td>Total drives online in this cluster</td>
</tr>
<tr>
<td>minio_cluster_drive_total</td>
<td>gauge</td>
<td><code>ip</code>, <code>job</code>, <code>cls</code>, <code>instance</code>, <code>server</code>, <code>ins</code></td>
<td>Total drives in this cluster</td>
</tr>
<tr>
<td>minio_cluster_health_erasure_set_healing_drives</td>
<td>gauge</td>
<td><code>pool</code>, <code>ip</code>, <code>job</code>, <code>cls</code>, <code>set</code>, <code>instance</code>, <code>server</code>, <code>ins</code></td>
<td>Get the count of healing drives of this erasure set</td>
</tr>
<tr>
<td>minio_cluster_health_erasure_set_online_drives</td>
<td>gauge</td>
<td><code>pool</code>, <code>ip</code>, <code>job</code>, <code>cls</code>, <code>set</code>, <code>instance</code>, <code>server</code>, <code>ins</code></td>
<td>Get the count of the online drives in this erasure set</td>
</tr>
<tr>
<td>minio_cluster_health_erasure_set_read_quorum</td>
<td>gauge</td>
<td><code>pool</code>, <code>ip</code>, <code>job</code>, <code>cls</code>, <code>set</code>, <code>instance</code>, <code>server</code>, <code>ins</code></td>
<td>Get the read quorum for this erasure set</td>
</tr>
<tr>
<td>minio_cluster_health_erasure_set_status</td>
<td>gauge</td>
<td><code>pool</code>, <code>ip</code>, <code>job</code>, <code>cls</code>, <code>set</code>, <code>instance</code>, <code>server</code>, <code>ins</code></td>
<td>Get current health status for this erasure set</td>
</tr>
<tr>
<td>minio_cluster_health_erasure_set_write_quorum</td>
<td>gauge</td>
<td><code>pool</code>, <code>ip</code>, <code>job</code>, <code>cls</code>, <code>set</code>, <code>instance</code>, <code>server</code>, <code>ins</code></td>
<td>Get the write quorum for this erasure set</td>
</tr>
<tr>
<td>minio_cluster_health_status</td>
<td>gauge</td>
<td><code>ip</code>, <code>job</code>, <code>cls</code>, <code>instance</code>, <code>server</code>, <code>ins</code></td>
<td>Get current cluster health status</td>
</tr>
<tr>
<td>minio_cluster_nodes_offline_total</td>
<td>gauge</td>
<td><code>ip</code>, <code>job</code>, <code>cls</code>, <code>instance</code>, <code>server</code>, <code>ins</code></td>
<td>Total number of MinIO nodes offline</td>
</tr>
<tr>
<td>minio_cluster_nodes_online_total</td>
<td>gauge</td>
<td><code>ip</code>, <code>job</code>, <code>cls</code>, <code>instance</code>, <code>server</code>, <code>ins</code></td>
<td>Total number of MinIO nodes online</td>
</tr>
<tr>
<td>minio_cluster_objects_size_distribution</td>
<td>gauge</td>
<td><code>ip</code>, <code>range</code>, <code>job</code>, <code>cls</code>, <code>instance</code>, <code>server</code>, <code>ins</code></td>
<td>Distribution of object sizes across a cluster</td>
</tr>
<tr>
<td>minio_cluster_objects_version_distribution</td>
<td>gauge</td>
<td><code>ip</code>, <code>range</code>, <code>job</code>, <code>cls</code>, <code>instance</code>, <code>server</code>, <code>ins</code></td>
<td>Distribution of object versions across a cluster</td>
</tr>
<tr>
<td>minio_cluster_usage_deletemarker_total</td>
<td>gauge</td>
<td><code>ip</code>, <code>job</code>, <code>cls</code>, <code>instance</code>, <code>server</code>, <code>ins</code></td>
<td>Total number of delete markers in a cluster</td>
</tr>
<tr>
<td>minio_cluster_usage_object_total</td>
<td>gauge</td>
<td><code>ip</code>, <code>job</code>, <code>cls</code>, <code>instance</code>, <code>server</code>, <code>ins</code></td>
<td>Total number of objects in a cluster</td>
</tr>
<tr>
<td>minio_cluster_usage_total_bytes</td>
<td>gauge</td>
<td><code>ip</code>, <code>job</code>, <code>cls</code>, <code>instance</code>, <code>server</code>, <code>ins</code></td>
<td>Total cluster usage in bytes</td>
</tr>
<tr>
<td>minio_cluster_usage_version_total</td>
<td>gauge</td>
<td><code>ip</code>, <code>job</code>, <code>cls</code>, <code>instance</code>, <code>server</code>, <code>ins</code></td>
<td>Total number of versions (includes delete marker) in a cluster</td>
</tr>
<tr>
<td>minio_cluster_webhook_failed_messages</td>
<td>counter</td>
<td><code>ip</code>, <code>job</code>, <code>cls</code>, <code>instance</code>, <code>server</code>, <code>ins</code></td>
<td>Number of messages that failed to send</td>
</tr>
<tr>
<td>minio_cluster_webhook_online</td>
<td>gauge</td>
<td><code>ip</code>, <code>job</code>, <code>cls</code>, <code>instance</code>, <code>server</code>, <code>ins</code></td>
<td>Is the webhook online?</td>
</tr>
<tr>
<td>minio_cluster_webhook_queue_length</td>
<td>counter</td>
<td><code>ip</code>, <code>job</code>, <code>cls</code>, <code>instance</code>, <code>server</code>, <code>ins</code></td>
<td>Webhook queue length</td>
</tr>
<tr>
<td>minio_cluster_webhook_total_messages</td>
<td>counter</td>
<td><code>ip</code>, <code>job</code>, <code>cls</code>, <code>instance</code>, <code>server</code>, <code>ins</code></td>
<td>Total number of messages sent to this target</td>
</tr>
<tr>
<td>minio_cluster_write_quorum</td>
<td>gauge</td>
<td><code>ip</code>, <code>job</code>, <code>cls</code>, <code>instance</code>, <code>server</code>, <code>ins</code></td>
<td>Maximum write quorum across all pools and sets</td>
</tr>
<tr>
<td>minio_node_file_descriptor_limit_total</td>
<td>gauge</td>
<td><code>ip</code>, <code>job</code>, <code>cls</code>, <code>instance</code>, <code>server</code>, <code>ins</code></td>
<td>Limit on total number of open file descriptors for the MinIO Server process</td>
</tr>
<tr>
<td>minio_node_file_descriptor_open_total</td>
<td>gauge</td>
<td><code>ip</code>, <code>job</code>, <code>cls</code>, <code>instance</code>, <code>server</code>, <code>ins</code></td>
<td>Total number of open file descriptors by the MinIO Server process</td>
</tr>
<tr>
<td>minio_node_go_routine_total</td>
<td>gauge</td>
<td><code>ip</code>, <code>job</code>, <code>cls</code>, <code>instance</code>, <code>server</code>, <code>ins</code></td>
<td>Total number of go routines running</td>
</tr>
<tr>
<td>minio_node_ilm_expiry_pending_tasks</td>
<td>gauge</td>
<td><code>ip</code>, <code>job</code>, <code>cls</code>, <code>instance</code>, <code>server</code>, <code>ins</code></td>
<td>Number of pending ILM expiry tasks in the queue</td>
</tr>
<tr>
<td>minio_node_ilm_transition_active_tasks</td>
<td>gauge</td>
<td><code>ip</code>, <code>job</code>, <code>cls</code>, <code>instance</code>, <code>server</code>, <code>ins</code></td>
<td>Number of active ILM transition tasks</td>
</tr>
<tr>
<td>minio_node_ilm_transition_missed_immediate_tasks</td>
<td>gauge</td>
<td><code>ip</code>, <code>job</code>, <code>cls</code>, <code>instance</code>, <code>server</code>, <code>ins</code></td>
<td>Number of missed immediate ILM transition tasks</td>
</tr>
<tr>
<td>minio_node_ilm_transition_pending_tasks</td>
<td>gauge</td>
<td><code>ip</code>, <code>job</code>, <code>cls</code>, <code>instance</code>, <code>server</code>, <code>ins</code></td>
<td>Number of pending ILM transition tasks in the queue</td>
</tr>
<tr>
<td>minio_node_ilm_versions_scanned</td>
<td>counter</td>
<td><code>ip</code>, <code>job</code>, <code>cls</code>, <code>instance</code>, <code>server</code>, <code>ins</code></td>
<td>Total number of object versions checked for ilm actions since server start</td>
</tr>
<tr>
<td>minio_node_io_rchar_bytes</td>
<td>counter</td>
<td><code>ip</code>, <code>job</code>, <code>cls</code>, <code>instance</code>, <code>server</code>, <code>ins</code></td>
<td>Total bytes read by the process from the underlying storage system including cache, /proc/[pid]/io rchar</td>
</tr>
<tr>
<td>minio_node_io_read_bytes</td>
<td>counter</td>
<td><code>ip</code>, <code>job</code>, <code>cls</code>, <code>instance</code>, <code>server</code>, <code>ins</code></td>
<td>Total bytes read by the process from the underlying storage system, /proc/[pid]/io read_bytes</td>
</tr>
<tr>
<td>minio_node_io_wchar_bytes</td>
<td>counter</td>
<td><code>ip</code>, <code>job</code>, <code>cls</code>, <code>instance</code>, <code>server</code>, <code>ins</code></td>
<td>Total bytes written by the process to the underlying storage system including page cache, /proc/[pid]/io wchar</td>
</tr>
<tr>
<td>minio_node_io_write_bytes</td>
<td>counter</td>
<td><code>ip</code>, <code>job</code>, <code>cls</code>, <code>instance</code>, <code>server</code>, <code>ins</code></td>
<td>Total bytes written by the process to the underlying storage system, /proc/[pid]/io write_bytes</td>
</tr>
<tr>
<td>minio_node_process_cpu_total_seconds</td>
<td>counter</td>
<td><code>ip</code>, <code>job</code>, <code>cls</code>, <code>instance</code>, <code>server</code>, <code>ins</code></td>
<td>Total user and system CPU time spent in seconds</td>
</tr>
<tr>
<td>minio_node_process_resident_memory_bytes</td>
<td>gauge</td>
<td><code>ip</code>, <code>job</code>, <code>cls</code>, <code>instance</code>, <code>server</code>, <code>ins</code></td>
<td>Resident memory size in bytes</td>
</tr>
<tr>
<td>minio_node_process_starttime_seconds</td>
<td>gauge</td>
<td><code>ip</code>, <code>job</code>, <code>cls</code>, <code>instance</code>, <code>server</code>, <code>ins</code></td>
<td>Start time for MinIO process per node, time in seconds since Unix epoc</td>
</tr>
<tr>
<td>minio_node_process_uptime_seconds</td>
<td>gauge</td>
<td><code>ip</code>, <code>job</code>, <code>cls</code>, <code>instance</code>, <code>server</code>, <code>ins</code></td>
<td>Uptime for MinIO process per node in seconds</td>
</tr>
<tr>
<td>minio_node_scanner_bucket_scans_finished</td>
<td>counter</td>
<td><code>ip</code>, <code>job</code>, <code>cls</code>, <code>instance</code>, <code>server</code>, <code>ins</code></td>
<td>Total number of bucket scans finished since server start</td>
</tr>
<tr>
<td>minio_node_scanner_bucket_scans_started</td>
<td>counter</td>
<td><code>ip</code>, <code>job</code>, <code>cls</code>, <code>instance</code>, <code>server</code>, <code>ins</code></td>
<td>Total number of bucket scans started since server start</td>
</tr>
<tr>
<td>minio_node_scanner_directories_scanned</td>
<td>counter</td>
<td><code>ip</code>, <code>job</code>, <code>cls</code>, <code>instance</code>, <code>server</code>, <code>ins</code></td>
<td>Total number of directories scanned since server start</td>
</tr>
<tr>
<td>minio_node_scanner_objects_scanned</td>
<td>counter</td>
<td><code>ip</code>, <code>job</code>, <code>cls</code>, <code>instance</code>, <code>server</code>, <code>ins</code></td>
<td>Total number of unique objects scanned since server start</td>
</tr>
<tr>
<td>minio_node_scanner_versions_scanned</td>
<td>counter</td>
<td><code>ip</code>, <code>job</code>, <code>cls</code>, <code>instance</code>, <code>server</code>, <code>ins</code></td>
<td>Total number of object versions scanned since server start</td>
</tr>
<tr>
<td>minio_node_syscall_read_total</td>
<td>counter</td>
<td><code>ip</code>, <code>job</code>, <code>cls</code>, <code>instance</code>, <code>server</code>, <code>ins</code></td>
<td>Total read SysCalls to the kernel. /proc/[pid]/io syscr</td>
</tr>
<tr>
<td>minio_node_syscall_write_total</td>
<td>counter</td>
<td><code>ip</code>, <code>job</code>, <code>cls</code>, <code>instance</code>, <code>server</code>, <code>ins</code></td>
<td>Total write SysCalls to the kernel. /proc/[pid]/io syscw</td>
</tr>
<tr>
<td>minio_notify_current_send_in_progress</td>
<td>gauge</td>
<td><code>ip</code>, <code>job</code>, <code>cls</code>, <code>instance</code>, <code>server</code>, <code>ins</code></td>
<td>Number of concurrent async Send calls active to all targets (deprecated, please use &lsquo;minio_notify_target_current_send_in_progress&rsquo; instead)</td>
</tr>
<tr>
<td>minio_notify_events_errors_total</td>
<td>counter</td>
<td><code>ip</code>, <code>job</code>, <code>cls</code>, <code>instance</code>, <code>server</code>, <code>ins</code></td>
<td>Events that were failed to be sent to the targets (deprecated, please use &lsquo;minio_notify_target_failed_events&rsquo; instead)</td>
</tr>
<tr>
<td>minio_notify_events_sent_total</td>
<td>counter</td>
<td><code>ip</code>, <code>job</code>, <code>cls</code>, <code>instance</code>, <code>server</code>, <code>ins</code></td>
<td>Total number of events sent to the targets (deprecated, please use &lsquo;minio_notify_target_total_events&rsquo; instead)</td>
</tr>
<tr>
<td>minio_notify_events_skipped_total</td>
<td>counter</td>
<td><code>ip</code>, <code>job</code>, <code>cls</code>, <code>instance</code>, <code>server</code>, <code>ins</code></td>
<td>Events that were skipped to be sent to the targets due to the in-memory queue being full</td>
</tr>
<tr>
<td>minio_s3_requests_4xx_errors_total</td>
<td>counter</td>
<td><code>ip</code>, <code>job</code>, <code>cls</code>, <code>instance</code>, <code>server</code>, <code>ins</code>, <code>api</code></td>
<td>Total number of S3 requests with (4xx) errors</td>
</tr>
<tr>
<td>minio_s3_requests_errors_total</td>
<td>counter</td>
<td><code>ip</code>, <code>job</code>, <code>cls</code>, <code>instance</code>, <code>server</code>, <code>ins</code>, <code>api</code></td>
<td>Total number of S3 requests with (4xx and 5xx) errors</td>
</tr>
<tr>
<td>minio_s3_requests_incoming_total</td>
<td>gauge</td>
<td><code>ip</code>, <code>job</code>, <code>cls</code>, <code>instance</code>, <code>server</code>, <code>ins</code></td>
<td>Total number of incoming S3 requests</td>
</tr>
<tr>
<td>minio_s3_requests_inflight_total</td>
<td>gauge</td>
<td><code>ip</code>, <code>job</code>, <code>cls</code>, <code>instance</code>, <code>server</code>, <code>ins</code>, <code>api</code></td>
<td>Total number of S3 requests currently in flight</td>
</tr>
<tr>
<td>minio_s3_requests_rejected_auth_total</td>
<td>counter</td>
<td><code>ip</code>, <code>job</code>, <code>cls</code>, <code>instance</code>, <code>server</code>, <code>ins</code></td>
<td>Total number of S3 requests rejected for auth failure</td>
</tr>
<tr>
<td>minio_s3_requests_rejected_header_total</td>
<td>counter</td>
<td><code>ip</code>, <code>job</code>, <code>cls</code>, <code>instance</code>, <code>server</code>, <code>ins</code></td>
<td>Total number of S3 requests rejected for invalid header</td>
</tr>
<tr>
<td>minio_s3_requests_rejected_invalid_total</td>
<td>counter</td>
<td><code>ip</code>, <code>job</code>, <code>cls</code>, <code>instance</code>, <code>server</code>, <code>ins</code></td>
<td>Total number of invalid S3 requests</td>
</tr>
<tr>
<td>minio_s3_requests_rejected_timestamp_total</td>
<td>counter</td>
<td><code>ip</code>, <code>job</code>, <code>cls</code>, <code>instance</code>, <code>server</code>, <code>ins</code></td>
<td>Total number of S3 requests rejected for invalid timestamp</td>
</tr>
<tr>
<td>minio_s3_requests_total</td>
<td>counter</td>
<td><code>ip</code>, <code>job</code>, <code>cls</code>, <code>instance</code>, <code>server</code>, <code>ins</code>, <code>api</code></td>
<td>Total number of S3 requests</td>
</tr>
<tr>
<td>minio_s3_requests_ttfb_seconds_distribution</td>
<td>gauge</td>
<td><code>ip</code>, <code>job</code>, <code>cls</code>, <code>le</code>, <code>instance</code>, <code>server</code>, <code>ins</code>, <code>api</code></td>
<td>Distribution of time to first byte across API calls</td>
</tr>
<tr>
<td>minio_s3_requests_waiting_total</td>
<td>gauge</td>
<td><code>ip</code>, <code>job</code>, <code>cls</code>, <code>instance</code>, <code>server</code>, <code>ins</code></td>
<td>Total number of S3 requests in the waiting queue</td>
</tr>
<tr>
<td>minio_s3_traffic_received_bytes</td>
<td>counter</td>
<td><code>ip</code>, <code>job</code>, <code>cls</code>, <code>instance</code>, <code>server</code>, <code>ins</code></td>
<td>Total number of s3 bytes received</td>
</tr>
<tr>
<td>minio_s3_traffic_sent_bytes</td>
<td>counter</td>
<td><code>ip</code>, <code>job</code>, <code>cls</code>, <code>instance</code>, <code>server</code>, <code>ins</code></td>
<td>Total number of s3 bytes sent</td>
</tr>
<tr>
<td>minio_software_commit_info</td>
<td>gauge</td>
<td><code>ip</code>, <code>job</code>, <code>cls</code>, <code>instance</code>, <code>commit</code>, <code>server</code>, <code>ins</code></td>
<td>Git commit hash for the MinIO release</td>
</tr>
<tr>
<td>minio_software_version_info</td>
<td>gauge</td>
<td><code>ip</code>, <code>job</code>, <code>cls</code>, <code>instance</code>, <code>version</code>, <code>server</code>, <code>ins</code></td>
<td>MinIO Release tag for the server</td>
</tr>
<tr>
<td>minio_up</td>
<td>Unknown</td>
<td><code>ip</code>, <code>job</code>, <code>cls</code>, <code>instance</code>, <code>ins</code></td>
<td>N/A</td>
</tr>
<tr>
<td>minio_usage_last_activity_nano_seconds</td>
<td>gauge</td>
<td><code>ip</code>, <code>job</code>, <code>cls</code>, <code>instance</code>, <code>server</code>, <code>ins</code></td>
<td>Time elapsed (in nano seconds) since last scan activity.</td>
</tr>
<tr>
<td>scrape_duration_seconds</td>
<td>Unknown</td>
<td><code>ip</code>, <code>job</code>, <code>cls</code>, <code>instance</code>, <code>ins</code></td>
<td>N/A</td>
</tr>
<tr>
<td>scrape_samples_post_metric_relabeling</td>
<td>Unknown</td>
<td><code>ip</code>, <code>job</code>, <code>cls</code>, <code>instance</code>, <code>ins</code></td>
<td>N/A</td>
</tr>
<tr>
<td>scrape_samples_scraped</td>
<td>Unknown</td>
<td><code>ip</code>, <code>job</code>, <code>cls</code>, <code>instance</code>, <code>ins</code></td>
<td>N/A</td>
</tr>
<tr>
<td>scrape_series_added</td>
<td>Unknown</td>
<td><code>ip</code>, <code>job</code>, <code>cls</code>, <code>instance</code>, <code>ins</code></td>
<td>N/A</td>
</tr>
<tr>
<td>up</td>
<td>Unknown</td>
<td><code>ip</code>, <code>job</code>, <code>cls</code>, <code>instance</code>, <code>ins</code></td>
<td>N/A</td>
</tr>
</tbody>
</table>

</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-571982477397f0d78a3a5034a4ef3e1d">8 - FAQ</h1>
    <div class="lead">Pigsty MINIO module frequently asked questions</div>
	<hr>
<h2 id="fail-to-launch-multi-node--multi-driver-minio-cluster">Fail to launch multi-node / multi-driver MinIO cluster.</h2>
<p>In <a href="/docs/minio/#single-node-multi-drive">Multi-Driver</a> or <a href="/docs/minio/#multi-node-multi-drive">Multi-Node</a> mode, MinIO will refuse to start if the data dir is not a valid mount point.</p>
<p>Use mounted disks for MinIO data dir rather than some regular directory. You can use the regular directory only in the <a href="/docs/minio/#single-node-single-drive">single node, single drive</a> mode.</p>
<hr>
<h2 id="how-to-deploy-a-multi-node-multi-drive-minio-cluster">How to deploy a multi-node multi-drive MinIO cluster?</h2>
<blockquote>
<p>Check <a href="/docs/minio/#multi-node-multi-drive">Create Multi-Node Multi-Driver MinIO Cluster</a></p>
</blockquote>
<hr>
<h2 id="how-to-add-a-member-to-the-existing-minio-cluster">How to add a member to the existing MinIO cluster?</h2>
<blockquote>
<p>You&rsquo;d better plan the MinIO cluster before deployment&hellip; Since this requires a global restart</p>
</blockquote>
<p>Check this: <a href="https://min.io/docs/minio/linux/operations/install-deploy-manage/expand-minio-deployment.html">Expand MinIO Deployment</a></p>
<hr>
<h2 id="how-to-use-a-ha-minio-deployment-for-pgsql">How to use a HA MinIO deployment for PGSQL?</h2>
<blockquote>
<p>Access the HA MinIO cluster with an optional load balancer and different ports.</p>
</blockquote>
<p>Here is an example: <a href="/docs/minio/#access-service">Access MinIO Service</a></p>

</div>



    
	
  



          </main>
        </div>
      </div>
      <footer class="td-footer row d-print-none">
  <div class="container-fluid">
    <div class="row mx-md-2">
      <div class="td-footer__left col-6 col-sm-4 order-sm-1">
        <ul class="td-footer__links-list">
  
  <li class="td-footer__links-item" data-bs-toggle="tooltip" title="Mail" aria-label="Mail">
    <a target="_blank" rel="noopener" href="mailto:rh@vonng.com" aria-label="Mail">
      <i class="fa fa-envelope"></i>
    </a>
  </li>
  
  <li class="td-footer__links-item" data-bs-toggle="tooltip" title="GitHub" aria-label="GitHub">
    <a target="_blank" rel="noopener" href="https://github.com/Vonng/pigsty" aria-label="GitHub">
      <i class="fab fa-github"></i>
    </a>
  </li>
  
  <li class="td-footer__links-item" data-bs-toggle="tooltip" title="Twitter" aria-label="Twitter">
    <a target="_blank" rel="noopener" href="https://twitter.com/GobeUncleWang" aria-label="Twitter">
      <i class="fab fa-twitter"></i>
    </a>
  </li>
  
</ul>

      </div><div class="td-footer__right col-6 col-sm-4 order-sm-3">
        <ul class="td-footer__links-list">
  
  <li class="td-footer__links-item" data-bs-toggle="tooltip" title="WeChat" aria-label="WeChat">
    <a target="_blank" rel="noopener" href="/img/pigsty/pigsty-cc.jpg" aria-label="WeChat">
      <i class="fa fa-comment"></i>
    </a>
  </li>
  
  <li class="td-footer__links-item" data-bs-toggle="tooltip" title="Discord" aria-label="Discord">
    <a target="_blank" rel="noopener" href="https://discord.gg/wDzt5VyWEz" aria-label="Discord">
      <i class="fab fa-discord"></i>
    </a>
  </li>
  
  <li class="td-footer__links-item" data-bs-toggle="tooltip" title="Telegram" aria-label="Telegram">
    <a target="_blank" rel="noopener" href="https://t.me/joinchat/gV9zfZraNPM3YjFh" aria-label="Telegram">
      <i class="fab fa-telegram"></i>
    </a>
  </li>
  
</ul>

      </div><div class="td-footer__center col-12 col-sm-4 py-2 order-sm-2">
        <span class="td-footer__copyright">&copy;
    2018&ndash;2024
    <span class="td-footer__authors">Ruohang Feng</span></span><span class="td-footer__all_rights_reserved">All Rights Reserved</span></span><span class="ms-2"><a href="https://vonng.com/en/" target="_blank" rel="noopener">@Vonng</a></span>
<br><span>Pigsty® distributed under <a href="/docs/about/license" target="_blank" rel="noopener">AGPLv3</a></span>
<br><span class="ms-2"><a href="/docs/about/privacy" target="_blank" rel="noopener">Privacy Policy</a></span>
<span><a href="http://beian.miit.gov.cn/" target="_blank" rel="noopener">浙ICP备15016890号</a></span>
      </div>
    </div>
  </div>
</footer>

    </div>
    <script src="/js/main.min.248655eb216150e39da254c2f7aa5357805d0ec66bdb741b591cd35fb5f629ab.js" integrity="sha256-JIZV6yFhUOOdolTC96pTV4BdDsZr23QbWRzTX7X2Kas=" crossorigin="anonymous"></script>
<script defer src="/js/click-to-copy.min.f724d3de49218995223b7316aa2e53e2b34bf42026bf399ebb21bb02212402d1.js" integrity="sha256-9yTT3kkhiZUiO3MWqi5T4rNL9CAmvzmeuyG7AiEkAtE=" crossorigin="anonymous"></script>
<script src='/js/tabpane-persist.js'></script>

  </body>
</html>
