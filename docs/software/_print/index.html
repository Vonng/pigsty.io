<!doctype html>
<html itemscope itemtype="http://schema.org/WebPage" lang="en" class="no-js">
  <head>
    <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link rel="canonical" type="text/html" href="/docs/software/">
<link rel="alternate" type="application/rss&#43;xml" href="/docs/software/index.xml">
<meta name="robots" content="noindex, nofollow">


<link rel="shortcut icon" href="/favicons/favicon.ico" >
<link rel="apple-touch-icon" href="/favicons/apple-touch-icon-180x180.png" sizes="180x180">
<link rel="icon" type="image/png" href="/favicons/favicon-16x16.png" sizes="16x16">
<link rel="icon" type="image/png" href="/favicons/favicon-32x32.png" sizes="32x32">
<link rel="icon" type="image/png" href="/favicons/android-36x36.png" sizes="36x36">
<link rel="icon" type="image/png" href="/favicons/android-48x48.png" sizes="48x48">
<link rel="icon" type="image/png" href="/favicons/android-72x72.png" sizes="72x72">
<link rel="icon" type="image/png" href="/favicons/android-96x96.png" sizes="96x96">
<link rel="icon" type="image/png" href="/favicons/android-144x144.png" sizes="144x144">
<link rel="icon" type="image/png" href="/favicons/android-192x192.png" sizes="192x192">

<title>Software &amp; Tools | Pigsty</title>
<meta name="description" content="Software and tools that use PostgreSQL can be managed by the docker daemon">
<meta property="og:title" content="Software &amp; Tools" />
<meta property="og:description" content="Software and tools that use PostgreSQL can be managed by the docker daemon" />
<meta property="og:type" content="website" />
<meta property="og:url" content="/docs/software/" />

<meta itemprop="name" content="Software &amp; Tools">
<meta itemprop="description" content="Software and tools that use PostgreSQL can be managed by the docker daemon"><meta name="twitter:card" content="summary"/><meta name="twitter:title" content="Software &amp; Tools"/>
<meta name="twitter:description" content="Software and tools that use PostgreSQL can be managed by the docker daemon"/>




<link rel="preload" href="/scss/main.min.194607c777ee31a481a26dfc3d1c65134dfc8eb296a0aae9d353b3bd5be6a683.css" as="style">
<link href="/scss/main.min.194607c777ee31a481a26dfc3d1c65134dfc8eb296a0aae9d353b3bd5be6a683.css" rel="stylesheet" integrity="">

<script
  src="/js/jquery-3.6.3.min.js"
  integrity="sha512-STof4xm1wgkfm7heWqFJVn58Hm3EtS31XFaagaa8VMReCXAkQnJZ+jEy8PCC/iT18dFy95WcExNHFTqLyp72eQ=="
  crossorigin="anonymous"></script>
<script defer
  src="/js/lunr.min.js"
  integrity="sha384-203J0SNzyqHby3iU6hzvzltrWi/M41wOP5Gu+BiJMz5nwKykbkUx8Kp7iti0Lpli"
  crossorigin="anonymous"></script>
<script async src="https://www.googletagmanager.com/gtag/js?id=G-LG1V9WTKGE"></script>
<script>
var doNotTrack = false;
if (!doNotTrack) {
	window.dataLayer = window.dataLayer || [];
	function gtag(){dataLayer.push(arguments);}
	gtag('js', new Date());
	gtag('config', 'G-LG1V9WTKGE');
}
</script>
  </head>
  <body class="td-section">
    <header>
      <nav class="td-navbar navbar-dark js-navbar-scroll">
<div class="container-fluid flex-column flex-md-row">
  <a class="navbar-brand" href="/"><span class="navbar-brand__logo navbar-logo"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xl="http://www.w3.org/1999/xlink" xmlns:dc="http://purl.org/dc/elements/1.1/" viewBox="0 0 24 24" width="24" height="24"><defs/><g id="32" fill="none" stroke-dasharray="none" fill-opacity="1" stroke-opacity="1" stroke="none"><title>32</title><g id="32_图层_2"><title>图层 2</title><g id="Group_17"><g id="Graphic_16"/><g id="Graphic_15"><path d="M7.666187 11.971335l2.165064-3.75H14.16138l2.165065 3.75-2.165065 3.75H9.831251z" fill="#bbb" fill-opacity=".9526367"/><path d="M7.666187 11.971335l2.165064-3.75H14.16138l2.165065 3.75-2.165065 3.75H9.831251z" stroke="#fff" stroke-linecap="round" stroke-linejoin="round" stroke-width=".6730434"/></g><g id="Graphic_14"><path d="M7.666187 19.474806l2.165064-3.75H14.16138l2.165065 3.75-2.165065 3.75H9.831251z" fill="#de372c" fill-opacity=".8545852"/><path d="M7.666187 19.474806l2.165064-3.75H14.16138l2.165065 3.75-2.165065 3.75H9.831251z" stroke="#fff" stroke-linecap="round" stroke-linejoin="round" stroke-width=".6730434"/></g><g id="Graphic_13"><path d="M14.161476 15.751202l2.165064-3.75h4.33013l2.165064 3.75-2.165064 3.75H16.32654z" fill="#424242" fill-opacity=".9016462"/><path d="M14.161476 15.751202l2.165064-3.75h4.33013l2.165064 3.75-2.165064 3.75H16.32654z" stroke="#fff" stroke-linecap="round" stroke-linejoin="round" stroke-width=".6730434"/></g><g id="Graphic_12"><path d="M14.161476 8.226008 16.32654 4.4760076h4.33013L22.821734 8.226008l-2.165064 3.75H16.32654z" fill="#ffa269" fill-opacity=".8975772"/><path d="M14.161476 8.226008 16.32654 4.4760076h4.33013L22.821734 8.226008l-2.165064 3.75H16.32654z" stroke="#fff" stroke-linecap="round" stroke-linejoin="round" stroke-width=".6730434"/></g><g id="Graphic_11"><path d="M7.666187 4.5 9.831251.75H14.16138L16.326445 4.5 14.16138 8.25H9.831251z" fill="#419edb" fill-opacity=".8979957"/><path d="M7.666187 4.5 9.831251.75H14.16138L16.326445 4.5 14.16138 8.25H9.831251z" stroke="#fff" stroke-linecap="round" stroke-linejoin="round" stroke-width=".6730434"/></g><g id="Graphic_10"><path d="M1.1491742 8.226008 3.3142388 4.4760076H7.644368L9.809432 8.226008l-2.165064 3.75H3.3142388z" fill="#2f6793" fill-opacity=".9002511"/><path d="M1.1491742 8.226008 3.3142388 4.4760076H7.644368L9.809432 8.226008l-2.165064 3.75H3.3142388z" stroke="#fff" stroke-linecap="round" stroke-linejoin="round" stroke-width=".6730434"/></g><g id="Graphic_9"><path d="M1.182071 15.741036l2.1650645-3.75h4.330129l2.1650645 3.75-2.1650645 3.75H3.3471355z" fill="#53ac79" fill-opacity=".9"/><path d="M1.182071 15.741036l2.1650645-3.75h4.330129l2.1650645 3.75-2.1650645 3.75H3.3471355z" stroke="#fff" stroke-linecap="round" stroke-linejoin="round" stroke-width=".6730434"/></g></g></g></g></svg></span><span class="navbar-brand__name">Pigsty</span></a>
  <div class="td-navbar-nav-scroll ms-md-auto" id="main_navbar">
    <ul class="navbar-nav">
      <li class="nav-item">
        <a class="nav-link active" href="/docs/"><i class='fa-solid fa-book'></i><span>Docs</span></a>
      </li>
      <li class="nav-item">
        <a class="nav-link" href="/blog/"><i class="fas fa-blog"></i><span>Blog</span></a>
      </li>
      <li class="nav-item">
        <a class="nav-link" href="https://github.com/Vonng/pigsty/" target="_blank" rel="noopener"><i class='fab fa-github'></i><span>GitHub</span></a>
      </li>
      <li class="nav-item dropdown d-none d-lg-block">
        <div class="dropdown">
  <a class="nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
      <i class="fa-solid fa-language"></i>English</a>
  <ul class="dropdown-menu">
    <li><a class="dropdown-item" href="/zh/docs/software/">中文</a></li>
    </ul>
</div>
</li>
      </ul>
  </div>
  <div class="d-none d-lg-block">
    <div class="td-search td-search--offline">
  <div class="td-search__icon"></div>
  <input
    type="search"
    class="td-search__input form-control"
    placeholder="Search this site…"
    aria-label="Search this site…"
    autocomplete="off"
    
    data-offline-search-index-json-src="/offline-search-index.b40d8bc16bcda835248990ff9db38455.json"
    data-offline-search-base-href="/"
    data-offline-search-max-results="10"
  >
</div>
  </div>
</div>
</nav>
    </header>
    <div class="container-fluid td-outer">
      <div class="td-main">
        <div class="row flex-xl-nowrap">
          <main class="col-12 col-md-9 col-xl-8 ps-md-5" role="main">
            




<div class="td-content">
<div class="pageinfo pageinfo-primary d-print-none">
<p>
This is the multi-page printable view of this section.
<a href="#" onclick="print();return false;">Click here to print</a>.
</p><p>
<a href="/docs/software/">Return to the regular view of this page</a>.
</p>
</div>



<h1 class="title">Software &amp; Tools</h1>
<div class="lead">Software and tools that use PostgreSQL can be managed by the docker daemon</div>




    <ul>
    
  
  
  
  

  
    
    
	
<li>1: <a href="#pg-73d64ed6cf2902263f8969b19456a73c">Dify: AI Workflow and LLMOps</a></li>


    
  
    
    
	
<li>2: <a href="#pg-af738ab5b44c495aeb279ea812fce87d">Odoo: OSS ERP for Enterprise</a></li>


    
  
    
    
	
<li>3: <a href="#pg-ec2bdc8f3ec36d2976e9e4d360775c61">Supabase: Self-Hosting OSS Firebase</a></li>


    
  
    
    
	
<li>4: <a href="#pg-2e3fe03b4958e2681fa579e931fb2c22">Kong: the Nginx API Gateway</a></li>


    
  
    
    
	
<li>5: <a href="#pg-5d00b8779841da134b5b22fde61c99db">Jupyter: AI Notebook &amp; IDE</a></li>


    
  
    
    
	
<li>6: <a href="#pg-712570c64c1ea4a71b6a08b0dd16d98b">Gitea: Simple Self-Hosting Git Service</a></li>


    
  
    
    
	
<li>7: <a href="#pg-1a5013ccb6314c00d1dbde17782c7234">Wiki.js: OSS Wiki Software</a></li>


    
  
    
    
	
<li>8: <a href="#pg-39d65c3b01d1bc14497afab7a5e3a53b">Minio: OSS AWS S3 Alternative</a></li>


    
  
    
    
	
<li>9: <a href="#pg-28564e14d16e9a4152a3a74308aadc58">ByteBase: PG Schema Migration</a></li>


    
  
    
    
	
<li>10: <a href="#pg-df59db962ac59a6b76913d3d9c08ddd3">PGAdmin4: PG Admin GUI Tool</a></li>


    
  
    
    
	
<li>11: <a href="#pg-e0991d41daeb1162d48a97bf676e105e">PostgREST: Generate REST API from Schema</a></li>


    
  
    
    
	
<li>12: <a href="#pg-9ec15a0d01cd5abc36fd6af1f45a0595">SchemaSPY: Dump &amp; Visualize PG Schema</a></li>


    
  
    
    
	
<li>13: <a href="#pg-04017d0d30f9f51be2b31a34c8bdf117">PGWeb: Browser-based PG Client</a></li>


    
  
    
    
	
<li>14: <a href="#pg-57ab357de3ec0981b36e0aeb8ae7d50b">Discourse: OSS Forum Software</a></li>


    
  
    
    
	
<li>15: <a href="#pg-1040742b787f34bbaa39a7a8145b00c4">GitLab: OSS GitHub Alternative</a></li>


    
  

    </ul>


<div class="content">
      <p>PostgreSQL is the most popular database in the world, and countless software is built on PostgreSQL, around PostgreSQL, or serves PostgreSQL itself, such as</p>
<ul>
<li>&ldquo;<strong>Application software</strong>&rdquo; that uses PostgreSQL as the preferred database</li>
<li>&ldquo;<strong>Tooling software</strong>&rdquo; that serves PostgreSQL software development and management</li>
<li>&ldquo;<strong>Database software</strong>&rdquo; that derives, wraps, forks, modifies, or extends PostgreSQL</li>
</ul>
<p>And Pigsty just have a series of Docker Compose templates for these software, application and databases:</p>
<table>
<thead>
<tr>
<th style="text-align:center">Name</th>
<th style="text-align:center">Website</th>
<th style="text-align:center">Type</th>
<th style="text-align:center">State</th>
<th style="text-align:center">Port</th>
<th>Domain</th>
<th style="text-align:left">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center"><a href="/docs/software/supabase/"><strong>Supabase</strong></a></td>
<td style="text-align:center"><a href="https://supabase.com/">Supabase</a></td>
<td style="text-align:center">DB</td>
<td style="text-align:center"><strong>GA</strong></td>
<td style="text-align:center">8000</td>
<td>supa.pigsty</td>
<td style="text-align:left">OSS Firebase Alternative, Backend as Platform</td>
</tr>
<tr>
<td style="text-align:center">PolarDB</td>
<td style="text-align:center"><a href="https://github.com/ApsaraDB/PolarDB-for-PostgreSQL">PolarDB</a></td>
<td style="text-align:center">DB</td>
<td style="text-align:center"><strong>GA</strong></td>
<td style="text-align:center">5532</td>
<td></td>
<td style="text-align:left">OSS RAC for PostgreSQL</td>
</tr>
<tr>
<td style="text-align:center">FerretDB</td>
<td style="text-align:center"><a href="https://www.ferretdb.com/">FerretDB</a></td>
<td style="text-align:center">DB</td>
<td style="text-align:center"><strong>GA</strong></td>
<td style="text-align:center">27017</td>
<td></td>
<td style="text-align:left">OSS Mongo Alternative base on PostgreSQL</td>
</tr>
<tr>
<td style="text-align:center"><a href="/docs/software/minio/"><strong>MinIO</strong></a></td>
<td style="text-align:center"><a href="https://min.io/">MinIO</a></td>
<td style="text-align:center">DB</td>
<td style="text-align:center"><strong>GA</strong></td>
<td style="text-align:center">9000</td>
<td>sss.pigsty</td>
<td style="text-align:left">OSS AWS S3 Alternative, Simple Storage Service</td>
</tr>
<tr>
<td style="text-align:center">EdgeDB</td>
<td style="text-align:center"><a href="https://www.edgedb.com/">EdgeDB</a></td>
<td style="text-align:center">DB</td>
<td style="text-align:center"><em>TBD</em></td>
<td style="text-align:center"></td>
<td></td>
<td style="text-align:left">OSS Graph Database base on PostgreSQL</td>
</tr>
<tr>
<td style="text-align:center">NocoDB</td>
<td style="text-align:center"><a href="https://nocodb.com/">NocoDB</a></td>
<td style="text-align:center">APP</td>
<td style="text-align:center"><strong>GA</strong></td>
<td style="text-align:center">8080</td>
<td>noco.pigsty</td>
<td style="text-align:left">OSS Airtable Alternative over PostgreSQL</td>
</tr>
<tr>
<td style="text-align:center"><a href="/docs/software/odoo/"><strong>Odoo</strong></a></td>
<td style="text-align:center"><a href="https://www.odoo.com/">Odoo</a></td>
<td style="text-align:center">APP</td>
<td style="text-align:center"><strong>GA</strong></td>
<td style="text-align:center">8069</td>
<td>odoo.pigsty</td>
<td style="text-align:left">OSS ERP Software base on PostgreSQL</td>
</tr>
<tr>
<td style="text-align:center"><a href="/docs/software/dify/"><strong>Dify</strong></a></td>
<td style="text-align:center"><a href="https://dify.ai/zh">Dify</a></td>
<td style="text-align:center">APP</td>
<td style="text-align:center"><strong>GA</strong></td>
<td style="text-align:center">8001</td>
<td>dify.pigsty</td>
<td style="text-align:left">OSS AI Workflow Orachestration &amp; LLMOps Platform</td>
</tr>
<tr>
<td style="text-align:center"><a href="/docs/software/jupyter/"><strong>Jupyter</strong></a></td>
<td style="text-align:center"><a href="https://jupyter.org/">Jupyter</a></td>
<td style="text-align:center">APP</td>
<td style="text-align:center"><strong>GA</strong></td>
<td style="text-align:center"></td>
<td>lab.pigsty</td>
<td style="text-align:left">OSS AI Python Notebook &amp; Data Analysis IDE</td>
</tr>
<tr>
<td style="text-align:center"><a href="/docs/software/gitea/"><strong>Gitea</strong></a></td>
<td style="text-align:center"><a href="https://gitea.com/">Gitea</a></td>
<td style="text-align:center">APP</td>
<td style="text-align:center"><strong>GA</strong></td>
<td style="text-align:center">8889</td>
<td>git.pigsty</td>
<td style="text-align:left">OSS DevOps Git Service</td>
</tr>
<tr>
<td style="text-align:center"><a href="/docs/software/wiki/"><strong>Wiki</strong></a></td>
<td style="text-align:center"><a href="https://js.wiki/">Wiki.js</a></td>
<td style="text-align:center">APP</td>
<td style="text-align:center"><strong>GA</strong></td>
<td style="text-align:center">9002</td>
<td>wiki.pigsty</td>
<td style="text-align:left">OSS Wiki Software</td>
</tr>
<tr>
<td style="text-align:center">GitLab</td>
<td style="text-align:center"><a href="https://gitlab.com/">GitLab</a></td>
<td style="text-align:center">APP</td>
<td style="text-align:center"><em>TBD</em></td>
<td style="text-align:center"></td>
<td></td>
<td style="text-align:left">OSS GitHub Alternative, Code Management Platform</td>
</tr>
<tr>
<td style="text-align:center">Mastodon</td>
<td style="text-align:center"><a href="https://joinmastodon.org/">Mastodon</a></td>
<td style="text-align:center">APP</td>
<td style="text-align:center"><em>TBD</em></td>
<td style="text-align:center"></td>
<td></td>
<td style="text-align:left">OSS Decentralized Social Network</td>
</tr>
<tr>
<td style="text-align:center">Keycloak</td>
<td style="text-align:center"><a href="https://www.keycloak.org/">Keycloak</a></td>
<td style="text-align:center">APP</td>
<td style="text-align:center"><em>TBD</em></td>
<td style="text-align:center"></td>
<td></td>
<td style="text-align:left">OSS Identity &amp; Access Management Component</td>
</tr>
<tr>
<td style="text-align:center">Harbour</td>
<td style="text-align:center"><a href="https://goharbor.io/">Harbour</a></td>
<td style="text-align:center">APP</td>
<td style="text-align:center"><em>TBD</em></td>
<td style="text-align:center"></td>
<td></td>
<td style="text-align:left">OSS Docker/K8S Image Repository</td>
</tr>
<tr>
<td style="text-align:center">Confluence</td>
<td style="text-align:center"><a href="https://www.atlassian.com/software/confluence">Confluence</a></td>
<td style="text-align:center">APP</td>
<td style="text-align:center"><em>TBD</em></td>
<td style="text-align:center"></td>
<td></td>
<td style="text-align:left">Enterprise Knowledge Management System</td>
</tr>
<tr>
<td style="text-align:center">Jira</td>
<td style="text-align:center"><a href="https://www.atlassian.com/software/jira">Jira</a></td>
<td style="text-align:center">APP</td>
<td style="text-align:center"><em>TBD</em></td>
<td style="text-align:center"></td>
<td></td>
<td style="text-align:left">Enterprise Project Management Tools</td>
</tr>
<tr>
<td style="text-align:center">Zabbix</td>
<td style="text-align:center"><a href="https://www.zabbix.com/">Zabbix 7</a></td>
<td style="text-align:center">APP</td>
<td style="text-align:center"><em>TBD</em></td>
<td style="text-align:center"></td>
<td></td>
<td style="text-align:left">OSS Monitoring Platform for Enterprise</td>
</tr>
<tr>
<td style="text-align:center">Grafana</td>
<td style="text-align:center"><a href="https://grafana.com/">Grafana</a></td>
<td style="text-align:center">APP</td>
<td style="text-align:center"><em>TBD</em></td>
<td style="text-align:center"></td>
<td></td>
<td style="text-align:left">Dashboard, Data Visualization &amp; Monitoring Platform</td>
</tr>
<tr>
<td style="text-align:center">Metabase</td>
<td style="text-align:center"><a href="https://www.metabase.com/">Metabase</a></td>
<td style="text-align:center">APP</td>
<td style="text-align:center"><strong>GA</strong></td>
<td style="text-align:center">9004</td>
<td>mtbs.pigsty</td>
<td style="text-align:left">Fast analysis of data from multiple data sources</td>
</tr>
<tr>
<td style="text-align:center">ByteBase</td>
<td style="text-align:center"><a href="https://www.bytebase.com/">ByteBase</a></td>
<td style="text-align:center">APP</td>
<td style="text-align:center"><strong>GA</strong></td>
<td style="text-align:center">8887</td>
<td>ddl.pigsty</td>
<td style="text-align:left">Database Migration Tool for PostgreSQL</td>
</tr>
<tr>
<td style="text-align:center"><a href="/docs/software/kong/"><strong>Kong</strong></a></td>
<td style="text-align:center"><a href="https://konghq.com/">Kong</a></td>
<td style="text-align:center">TOOL</td>
<td style="text-align:center"><strong>GA</strong></td>
<td style="text-align:center">8000</td>
<td>api.pigsty</td>
<td style="text-align:left">OSS API Gateway based on Nginx/OpenResty</td>
</tr>
<tr>
<td style="text-align:center"><a href="/docs/software/postgrest/"><strong>PostgREST</strong></a></td>
<td style="text-align:center"><a href="https://postgrest.org/">PostgREST</a></td>
<td style="text-align:center">TOOL</td>
<td style="text-align:center"><strong>GA</strong></td>
<td style="text-align:center">8884</td>
<td>api.pigsty</td>
<td style="text-align:left">Generate RESTAPI from PostgreSQL Schemas</td>
</tr>
<tr>
<td style="text-align:center"><a href="/docs/software/pgadmin/"><strong>pgAdmin4</strong></a></td>
<td style="text-align:center"><a href="https://www.pgadmin.org/">pgAdmin4</a></td>
<td style="text-align:center">TOOL</td>
<td style="text-align:center"><strong>GA</strong></td>
<td style="text-align:center">8885</td>
<td>adm.pigsty</td>
<td style="text-align:left">PostgreSQL GUI Admin Tools</td>
</tr>
<tr>
<td style="text-align:center"><a href="/docs/software/pgweb/"><strong>pgWeb</strong></a></td>
<td style="text-align:center"><a href="https://github.com/sosedoff/pgweb?tab=readme-ov-file">pgWeb</a></td>
<td style="text-align:center">TOOL</td>
<td style="text-align:center"><strong>GA</strong></td>
<td style="text-align:center">8886</td>
<td>cli.pigsty</td>
<td style="text-align:left">PostgreSQL Web GUI Client</td>
</tr>
<tr>
<td style="text-align:center">SchemaSpy</td>
<td style="text-align:center"><a href="https://schemaspy.org/">SchemaSpy</a></td>
<td style="text-align:center">TOOL</td>
<td style="text-align:center"><em>TBD</em></td>
<td style="text-align:center"></td>
<td></td>
<td style="text-align:left">Dump &amp; Visualize PostgreSQL Schema</td>
</tr>
<tr>
<td style="text-align:center">pgBadger</td>
<td style="text-align:center"><a href="https://github.com/darold/pgbadger">pgBadger</a></td>
<td style="text-align:center">TOOL</td>
<td style="text-align:center"><em>TBD</em></td>
<td style="text-align:center"></td>
<td></td>
<td style="text-align:left">PostgreSQL Log Analysis</td>
</tr>
<tr>
<td style="text-align:center">pg_exporter</td>
<td style="text-align:center"><a href="https://github.com/Vonng/pg_exporter">pg_exporter</a></td>
<td style="text-align:center">TOOL</td>
<td style="text-align:center"><strong>GA</strong></td>
<td style="text-align:center">9630</td>
<td></td>
<td style="text-align:left">Expose PostgreSQL &amp; Pgbouncer Metrics for Prometheus</td>
</tr>
</tbody>
</table>


<div class="alert alert-success" role="alert">
<h4 class="alert-heading">How to prepare Docker?</h4>

    To run docker compose templates, you need to install the <a href="/docs/docker/"><strong><code>DOCKER</code></strong></a> module on the <a href="/docs/node/#common-node"><strong>node</strong></a>,
If you don&rsquo;t have the Internet access or having firewall issues, you may need to configure a DockerHub proxy, check the <a href="/docs/tasks/docker/"><strong>tutorial</strong></a>.

</div>


</div>
</div>


  
  
  
  

  
  

  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-73d64ed6cf2902263f8969b19456a73c">1 - Dify: AI Workflow and LLMOps</h1>
    <div class="lead">How to use Pigsty to build an AI Workflow LLMOps platform — Dify, and use external PostgreSQL, PGVector, Redis as storage?</div>
	<p><a href="https://dify.ai/"><strong>Dify</strong></a> &ndash; The Innovation Engine for GenAI Applications</p>
<p>Dify is an open-source LLM app development platform. Orchestrate LLM apps from agents to complex AI workflows, with an RAG engine.
Which claims to be more production-ready than LangChain.</p>
<p>Of course, a workflow orchestration software like this needs a database underneath — Dify uses <strong>PostgreSQL</strong> for metadata storage, as well as Redis for caching and a dedicated vector database.
You can pull the Docker images and play locally, but for production deployment, this setup won&rsquo;t suffice — there&rsquo;s no HA, backup, PITR, monitoring, and many other things.</p>
<p>Fortunately, Pigsty provides a battery-include production-grade highly available PostgreSQL cluster, along with the Redis and S3 (MinIO) capabilities that Dify needs, as well as Nginx to expose the Web service, making it the perfect companion for Dify.</p>
<blockquote>
<p>Off-load the stateful part to Pigsty, you only need to pull up the stateless blue circle part with a simple <code>docker compose up</code>.</p>
</blockquote>
<p>BTW, I have to criticize the design of the Dify template. Since the metadata is already stored in PostgreSQL, why not add <code>pgvector</code> to use it as a vector database? What&rsquo;s even more baffling is that <code>pgvector</code> is a separate image and container. Why not just use a PG image with <code>pgvector</code> included?</p>
<p>Dify &ldquo;supports&rdquo; a bunch of flashy vector databases, but since PostgreSQL is already chosen, using <code>pgvector</code> as the default vector database is the natural choice. Similarly, I think the Dify team should consider removing Redis. Celery task queues can use PostgreSQL as backend storage, so having multiple databases is unnecessary. Entities should not be multiplied without necessity.</p>
<p>Therefore, the Pigsty-provided <a href="https://github.com/Vonng/pigsty/tree/master/app/dify">Dify Docker Compose template</a> has made some adjustments to the official example. It removes the <code>db</code> and <code>redis</code> database images, using instances managed by Pigsty. The vector database is fixed to use <code>pgvector</code>, reusing the same PostgreSQL instance.</p>
<p>In the end, the architecture is simplified to three stateless containers: <code>dify-api</code>, <code>dify-web</code>, and <code>dify-worker</code>, which can be created and destroyed at will. There are also two optional containers, <code>ssrf_proxy</code> and <code>nginx</code>, for providing proxy and some security features.</p>
<p>There’s a bit of state management left with <a href="https://github.com/Vonng/pigsty/blob/main/app/dify/docker-compose.yml#L128">file system volumes</a>, storing things like private keys. Regular backups are sufficient.</p>
<p>Reference:</p>
<ul>
<li><a href="https://github.com/langgenius/dify/">GitHub: langgenius/Dify</a></li>
<li><a href="https://github.com/Vonng/pigsty/tree/master/app/dify">Pigsty: Dify Docker Compose Template</a></li>
</ul>
<hr>
<h2 id="pigsty-preparation">Pigsty Preparation</h2>
<p>Let&rsquo;s take the <a href="/docs/concept/arch/#singleton-meta">single-node installation</a> of Pigsty as an example. Suppose you have a machine with the IP address <code>10.10.10.10</code> and already pigsty <a href="/docs/setup/install/">installed</a>.</p>
<p>We need to define the database clusters required in the Pigsty configuration file <code>pigsty.yml</code>.</p>
<p>Here, we define a cluster named <code>pg-meta</code>, which includes a superuser named <code>dbuser_dify</code> (the implementation is a bit rough as the Migration script executes <code>CREATE EXTENSION</code> which require dbsu privilege for now),</p>
<p>And there&rsquo;s a database named <code>dify</code> with the <code>pgvector</code> extension installed, and a specific firewall rule allowing users to access the database from anywhere using a password (you can also restrict it to a more precise range, such as the Docker subnet <code>172.0.0.0/8</code>).</p>
<p>Additionally, a standard single-instance Redis cluster <code>redis-dify</code> with the password <code>redis.dify</code> is defined.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">pg-meta</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">hosts</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span>{<span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">10.10.10.10</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span>{<span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">pg_seq: 1, pg_role</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">primary } }</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">vars</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">pg_cluster</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">pg-meta</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">pg_users</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000;font-weight:bold">[</span><span style="color:#f8f8f8;text-decoration:underline"> </span>{<span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">name: dbuser_dify ,password: DBUser.Dify  ,superuser: true ,pgbouncer: true ,roles</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000;font-weight:bold">[</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">dbrole_admin ] } ]</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">pg_databases</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000;font-weight:bold">[</span><span style="color:#f8f8f8;text-decoration:underline"> </span>{<span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">name: dify, owner: dbuser_dify, extensions</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000;font-weight:bold">[</span><span style="color:#f8f8f8;text-decoration:underline"> </span>{<span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">name</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">pgvector } ] } ]</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">pg_hba_rules</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000;font-weight:bold">[</span><span style="color:#f8f8f8;text-decoration:underline"> </span>{<span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">user: dbuser_dify , db: all ,addr: world ,auth: pwd ,title</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#39;allow dify user world pwd access&#39;</span><span style="color:#f8f8f8;text-decoration:underline"> </span>}<span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000;font-weight:bold">]</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:bold">redis-dify</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">hosts</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span>{<span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">10.10.10.10</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span>{<span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">redis_node: 1 , redis_instances</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span>{<span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">6379</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span>{<span style="color:#f8f8f8;text-decoration:underline"> </span>}<span style="color:#f8f8f8;text-decoration:underline"> </span>}<span style="color:#f8f8f8;text-decoration:underline"> </span>}<span style="color:#f8f8f8;text-decoration:underline"> </span>}<span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">vars</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span>{<span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">redis_cluster: redis-dify ,redis_password: &#39;redis.dify&#39; ,redis_max_memory</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">64MB }</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span></code></pre></div><p>For demonstration purposes, we use single-instance configurations. You can refer to the Pigsty documentation to deploy <a href="/docs/concept/ha/">high availability</a> PG and Redis clusters. After defining the clusters, use the following commands to create the PG and Redis clusters:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>bin/pgsql-add  pg-meta                <span style="color:#8f5902;font-style:italic"># create the dify database cluster</span>
</span></span><span style="display:flex;"><span>bin/redis-add  redis-dify             <span style="color:#8f5902;font-style:italic"># create redis cluster</span>
</span></span></code></pre></div><p>Alternatively, you can define a new <a href="/docs/pgsql/user/">business user</a> and <a href="/docs/pgsql/db/">business database</a> on an existing PostgreSQL cluster, such as <code>pg-meta</code>, and create them with the following commands:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>bin/pgsql-user pg-meta dbuser_dify    <span style="color:#8f5902;font-style:italic"># create dify biz user</span>
</span></span><span style="display:flex;"><span>bin/pgsql-db   pg-meta dify           <span style="color:#8f5902;font-style:italic"># create dify biz database</span>
</span></span></code></pre></div><p>You should be able to access PostgreSQL and Redis with the following connection strings, adjusting the connection information as needed:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>psql postgres://dbuser_dify:DBUser.Dify@10.10.10.10:5432/dify -c <span style="color:#4e9a06">&#39;SELECT 1&#39;</span>
</span></span><span style="display:flex;"><span>redis-cli -u redis://redis.dify@10.10.10.10:6379/0 ping
</span></span></code></pre></div><p>Once you confirm these connection strings are working, you&rsquo;re all set to start deploying Dify.</p>
<p>For demonstration purposes, we&rsquo;re using direct IP connections. For a multi-node high availability PG cluster, please refer to the <a href="/docs/concept/svc/">service access</a> section.</p>
<p>The above assumes you are already a Pigsty user familiar with deploying PostgreSQL and Redis clusters. You can skip the next section and proceed to see <a href="/docs/software/dify/#dify-configuration">how to configure Dify</a>.</p>
<hr>
<h2 id="starting-from-scratch">Starting from Scratch</h2>
<p>If you&rsquo;re already familiar with setting up Pigsty, feel free to skip this section.</p>
<p><a href="/docs/setup/prepare/">Prepare</a> a fresh Linux x86_64 node that runs <a href="/docs/reference/compatibility/">compatible</a> OS, then run as a <strong>sudo-able</strong> user:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>curl -fsSL https://repo.pigsty.io/get <span style="color:#000;font-weight:bold">|</span> bash
</span></span></code></pre></div><p>It will <a href="/docs/software/dify/#download">download</a> Pigsty source to your home, then perform <a href="/docs/software/dify/#configure">configure</a> and <a href="/docs/software/dify/#install">install</a> to finish the installation.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#204a87">cd</span> ~/pigsty   <span style="color:#8f5902;font-style:italic"># get pigsty source and entering dir</span>
</span></span><span style="display:flex;"><span>./bootstrap   <span style="color:#8f5902;font-style:italic"># download bootstrap pkgs &amp; ansible [optional]</span>
</span></span><span style="display:flex;"><span>./configure   <span style="color:#8f5902;font-style:italic"># pre-check and config templating   [optional]</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># change pigsty.yml, adding those cluster definitions above into all.children </span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>./install.yml <span style="color:#8f5902;font-style:italic"># install pigsty according to pigsty.yml</span>
</span></span></code></pre></div><p>You should insert the above PostgreSQL cluster and Redis cluster definitions into the <code>pigsty.yml</code> file, then run <a href="/docs/infra/#infrayml"><code>install.yml</code></a> to complete the installation.</p>
<p><strong>Redis Deploy</strong></p>
<p>Pigsty will not deploy redis in <code>install.yml</code>, so you have to run <a href="/docs/redis/#redisyml"><code>redis.yml</code></a> playbook to install Redis explicitly:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>./redis.yml
</span></span></code></pre></div><p><strong>Docker Deploy</strong></p>
<p>Pigsty will not deploy Docker by default, so you need to install Docker with the <a href="/docs/docker/#dockeryml"><code>docker.yml</code></a> playbook.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>./docker.yml
</span></span></code></pre></div><hr>
<h2 id="dify-confiugration">Dify Confiugration</h2>
<p>You can configure dify in the <a href="https://github.com/Vonng/pigsty/blob/main/app/dify/.env"><code>.env</code></a> file:</p>
<p>All parameters are self-explanatory and filled in with default values that work directly in the <a href="/docs/setup/provision/">Pigsty sandbox env</a>.
Fill in the database connection information according to your actual conf, consistent with the PG/Redis cluster configuration above.</p>
<p>Changing the <code>SECRET_KEY</code> field is recommended. You can generate a strong key with <code>openssl rand -base64 42</code>:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># meta parameter</span>
</span></span><span style="display:flex;"><span><span style="color:#000">DIFY_PORT</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#0000cf;font-weight:bold">8001</span> <span style="color:#8f5902;font-style:italic"># expose dify nginx service with port 8001 by default</span>
</span></span><span style="display:flex;"><span><span style="color:#000">LOG_LEVEL</span><span style="color:#ce5c00;font-weight:bold">=</span>INFO <span style="color:#8f5902;font-style:italic"># The log level for the application. Supported values are `DEBUG`, `INFO`, `WARNING`, `ERROR`, `CRITICAL`</span>
</span></span><span style="display:flex;"><span><span style="color:#000">SECRET_KEY</span><span style="color:#ce5c00;font-weight:bold">=</span>sk-9f73s3ljTXVcMT3Blb3ljTqtsKiGHXVcMT3BlbkFJLK7U <span style="color:#8f5902;font-style:italic"># A secret key for signing and encryption, gen with `openssl rand -base64 42`</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># postgres credential</span>
</span></span><span style="display:flex;"><span><span style="color:#000">PG_USERNAME</span><span style="color:#ce5c00;font-weight:bold">=</span>dbuser_dify
</span></span><span style="display:flex;"><span><span style="color:#000">PG_PASSWORD</span><span style="color:#ce5c00;font-weight:bold">=</span>DBUser.Dify
</span></span><span style="display:flex;"><span><span style="color:#000">PG_HOST</span><span style="color:#ce5c00;font-weight:bold">=</span>10.10.10.10
</span></span><span style="display:flex;"><span><span style="color:#000">PG_PORT</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#0000cf;font-weight:bold">5432</span>
</span></span><span style="display:flex;"><span><span style="color:#000">PG_DATABASE</span><span style="color:#ce5c00;font-weight:bold">=</span>dify
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># redis credential</span>
</span></span><span style="display:flex;"><span><span style="color:#000">REDIS_HOST</span><span style="color:#ce5c00;font-weight:bold">=</span>10.10.10.10
</span></span><span style="display:flex;"><span><span style="color:#000">REDIS_PORT</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#0000cf;font-weight:bold">6379</span>
</span></span><span style="display:flex;"><span><span style="color:#000">REDIS_USERNAME</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#39;&#39;</span>
</span></span><span style="display:flex;"><span><span style="color:#000">REDIS_PASSWORD</span><span style="color:#ce5c00;font-weight:bold">=</span>redis.dify
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># minio/s3 [OPTIONAL] when STORAGE_TYPE=s3</span>
</span></span><span style="display:flex;"><span><span style="color:#000">STORAGE_TYPE</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#204a87">local</span>
</span></span><span style="display:flex;"><span><span style="color:#000">S3_ENDPOINT</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#39;https://sss.pigsty&#39;</span>
</span></span><span style="display:flex;"><span><span style="color:#000">S3_BUCKET_NAME</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#39;infra&#39;</span>
</span></span><span style="display:flex;"><span><span style="color:#000">S3_ACCESS_KEY</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#39;dba&#39;</span>
</span></span><span style="display:flex;"><span><span style="color:#000">S3_SECRET_KEY</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#39;S3User.DBA&#39;</span>
</span></span><span style="display:flex;"><span><span style="color:#000">S3_REGION</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#39;us-east-1&#39;</span>
</span></span></code></pre></div><p>Now we can pull up dify with docker compose:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#204a87">cd</span> pigsty/app/dify <span style="color:#ce5c00;font-weight:bold">&amp;&amp;</span> make up
</span></span></code></pre></div><hr>
<h2 id="expose-dify-service-via-nginx">Expose Dify Service via Nginx</h2>
<p>Dify expose web/api via its own nginx through port 80 by default, while pigsty uses port 80 for its own Nginx. T</p>
<p>herefore, we expose Dify via port <code>8001</code> by default, and use Pigsty&rsquo;s Nginx to forward to this port.</p>
<p>Change <code>infra_portal</code> in <code>pigsty.yml</code>, with the new <code>dify</code> line:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">infra_portal</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">                     </span><span style="color:#8f5902;font-style:italic"># domain names and upstream servers</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">home         </span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span>{<span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">domain</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">h.pigsty }</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">grafana      </span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span>{<span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">domain: g.pigsty ,endpoint</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;${admin_ip}:3000&#34;</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">, websocket</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">true</span><span style="color:#f8f8f8;text-decoration:underline"> </span>}<span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">prometheus   </span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span>{<span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">domain: p.pigsty ,endpoint</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;${admin_ip}:9090&#34;</span><span style="color:#f8f8f8;text-decoration:underline"> </span>}<span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">alertmanager </span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span>{<span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">domain: a.pigsty ,endpoint</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;${admin_ip}:9093&#34;</span><span style="color:#f8f8f8;text-decoration:underline"> </span>}<span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">blackbox     </span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span>{<span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">endpoint</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;${admin_ip}:9115&#34;</span><span style="color:#f8f8f8;text-decoration:underline"> </span>}<span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">loki         </span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span>{<span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">endpoint</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;${admin_ip}:3100&#34;</span><span style="color:#f8f8f8;text-decoration:underline"> </span>}<span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">dify         </span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span>{<span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">domain: dify.pigsty ,endpoint</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;10.10.10.10:8001&#34;</span><span style="color:#204a87;font-weight:bold">, websocket</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">true</span><span style="color:#f8f8f8;text-decoration:underline"> </span>}<span style="color:#f8f8f8;text-decoration:underline">
</span></span></span></code></pre></div><p>Then expose dify web service via Pigsty&rsquo;s Nginx server:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>./infra.yml -t nginx
</span></span></code></pre></div><p>Don&rsquo;t forget to add <code>dify.pigsty</code> to your DNS or local <code>/etc/hosts</code> / <code>C:\Windows\System32\drivers\etc\hosts</code> to access via domain name.</p>

</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-af738ab5b44c495aeb279ea812fce87d">2 - Odoo: OSS ERP for Enterprise</h1>
    <div class="lead">How to self-hosting the eopn source ERP &ndash; odoo</div>
	<p><a href="https://www.odoo.com/">Odoo</a> is an open-source enterprise resource planning (ERP) software
that provides a full suite of business applications, including CRM, sales, purchasing, inventory, production, accounting, and other management functions. Odoo is a typical web application that uses PostgreSQL as the underlying database.</p>
<blockquote>
<p>All your business on one platform, Simple, efficient, yet affordable</p>
</blockquote>
<h2 id="get-started">Get Started</h2>
<p>Check <a href=".env"><code>.env</code></a> file for configurable environment variables:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># https://hub.docker.com/_/odoo#</span>
</span></span><span style="display:flex;"><span><span style="color:#000">PG_HOST</span><span style="color:#ce5c00;font-weight:bold">=</span>10.10.10.10
</span></span><span style="display:flex;"><span><span style="color:#000">PG_PORT</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#0000cf;font-weight:bold">5432</span>
</span></span><span style="display:flex;"><span><span style="color:#000">PG_USER</span><span style="color:#ce5c00;font-weight:bold">=</span>dbuser_odoo
</span></span><span style="display:flex;"><span><span style="color:#000">PG_PASS</span><span style="color:#ce5c00;font-weight:bold">=</span>DBUser.Odoo
</span></span><span style="display:flex;"><span><span style="color:#000">ODOO_PORT</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#0000cf;font-weight:bold">8069</span>
</span></span></code></pre></div><p>Then launch odoo with:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>make up  <span style="color:#8f5902;font-style:italic"># docker compose up</span>
</span></span></code></pre></div><p>Visit <a href="http://ddl.pigsty">http://ddl.pigsty</a> or http://10.10.10.10:8887</p>
<h2 id="makefile">Makefile</h2>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>make up         <span style="color:#8f5902;font-style:italic"># pull up odoo with docker compose in minimal mode</span>
</span></span><span style="display:flex;"><span>make run        <span style="color:#8f5902;font-style:italic"># launch odoo with docker , local data dir and external PostgreSQL</span>
</span></span><span style="display:flex;"><span>make view       <span style="color:#8f5902;font-style:italic"># print odoo access point</span>
</span></span><span style="display:flex;"><span>make log        <span style="color:#8f5902;font-style:italic"># tail -f odoo logs</span>
</span></span><span style="display:flex;"><span>make info       <span style="color:#8f5902;font-style:italic"># introspect odoo with jq</span>
</span></span><span style="display:flex;"><span>make stop       <span style="color:#8f5902;font-style:italic"># stop odoo container</span>
</span></span><span style="display:flex;"><span>make clean      <span style="color:#8f5902;font-style:italic"># remove odoo container</span>
</span></span><span style="display:flex;"><span>make pull       <span style="color:#8f5902;font-style:italic"># pull latest odoo image</span>
</span></span><span style="display:flex;"><span>make rmi        <span style="color:#8f5902;font-style:italic"># remove odoo image</span>
</span></span><span style="display:flex;"><span>make save       <span style="color:#8f5902;font-style:italic"># save odoo image to /tmp/docker/odoo.tgz</span>
</span></span><span style="display:flex;"><span>make load       <span style="color:#8f5902;font-style:italic"># load odoo image from /tmp/docker/odoo.tgz</span>
</span></span></code></pre></div><h2 id="use-external-postgresql">Use External PostgreSQL</h2>
<p>You can use external PostgreSQL for Odoo. Odoo will create its own database during setup, so you don&rsquo;t need to do that</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">pg_users</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000;font-weight:bold">[</span><span style="color:#f8f8f8;text-decoration:underline"> </span>{<span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">name: dbuser_odoo ,password: DBUser.Odoo ,pgbouncer: true ,roles: [ dbrole_admin ]    ,comment</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">admin user for odoo database } ]</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:bold">pg_databases</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000;font-weight:bold">[</span><span style="color:#f8f8f8;text-decoration:underline"> </span>{<span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">name: odoo ,owner: dbuser_odoo ,revokeconn: true ,comment</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">odoo primary database } ]</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span></code></pre></div><p>And create business user &amp; database with:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>bin/pgsql-user  pg-meta  dbuser_odoo
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic">#bin/pgsql-db    pg-meta  odoo     # odoo will create the database during setup</span>
</span></span></code></pre></div><p>Check connectivity:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>psql postgres://dbuser_odoo:DBUser.Odoo@10.10.10.10:5432/odoo
</span></span></code></pre></div><hr>
<h2 id="expose-odoo-service">Expose Odoo Service</h2>
<p><a href="/docs/tasks/nginx/">Expose</a> odoo seb service via nginx portal:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">infra_portal</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">                     </span><span style="color:#8f5902;font-style:italic"># domain names and upstream servers</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">home         </span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span>{<span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">domain</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">h.pigsty }</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">grafana      </span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span>{<span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">domain: g.pigsty    ,endpoint</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;${admin_ip}:3000&#34;</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">, websocket</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">true</span><span style="color:#f8f8f8;text-decoration:underline"> </span>}<span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">prometheus   </span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span>{<span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">domain: p.pigsty    ,endpoint</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;${admin_ip}:9090&#34;</span><span style="color:#f8f8f8;text-decoration:underline"> </span>}<span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">alertmanager </span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span>{<span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">domain: a.pigsty    ,endpoint</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;${admin_ip}:9093&#34;</span><span style="color:#f8f8f8;text-decoration:underline"> </span>}<span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">blackbox     </span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span>{<span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">endpoint</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;${admin_ip}:9115&#34;</span><span style="color:#f8f8f8;text-decoration:underline"> </span>}<span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">loki         </span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span>{<span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">endpoint</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;${admin_ip}:3100&#34;</span><span style="color:#f8f8f8;text-decoration:underline"> </span>}<span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">odoo         </span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span>{<span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">domain: odoo.pigsty, endpoint</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;127.0.0.1:8069&#34;</span><span style="color:#204a87;font-weight:bold">, websocket</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">true</span><span style="color:#f8f8f8;text-decoration:underline"> </span>}<span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#8f5902;font-style:italic"># &lt;------ add this line</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>./infra.yml -t nginx   <span style="color:#8f5902;font-style:italic"># setup nginx infra portal</span>
</span></span></code></pre></div><hr>
<h2 id="odoo-addons">Odoo Addons</h2>
<p>There are lots of Odoo modules available in the community, you can install them by downloading and placing them in the <code>addons</code> folder.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">volumes</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span>- <span style="color:#000">./addons:/mnt/extra-addons</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span></code></pre></div><p>You can mount the <code>./addons</code> dir to the <code>/mnt/extra-addons</code> in the container, then download and unzip to the <code>addons</code> folder,</p>
<p>To enable addon module, first entering the <a href="https://www.odoo.com/documentation/17.0/applications/general/developer_mode.html">Developer mode</a></p>
<blockquote>
<p>Settings -&gt; Generic Settings -&gt; Developer Tools -&gt; Activate the developer Mode</p>
</blockquote>
<p>Then goes to the &gt; Apps -&gt; Update Apps List, then you can find the extra addons and install from the panel.</p>
<p>Frequently used <a href="https://apps.odoo.com/apps/modules/browse?order=Downloads">free</a> addons: <a href="https://apps.odoo.com/apps/modules/17.0/base_accounting_kit/">Accounting Kit</a></p>
<hr>
<h2 id="demo">Demo</h2>
<p>Check public demo: <a href="http://odoo.pigsty.cc">http://odoo.pigsty.cc</a>, username: <code>test@pigsty.cc</code>, password: <code>pigsty</code></p>
<p>If you want to access odoo through SSL, you have to trust <code>files/pki/ca/ca.crt</code> on your browser (or use the dirty hack <code>thisisunsafe</code> in chrome)</p>

</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-ec2bdc8f3ec36d2976e9e4d360775c61">3 - Supabase: Self-Hosting OSS Firebase</h1>
    <div class="lead">How to self-host Supabase with existing managed HA PostgreSQL cluster, and launch the stateless part with docker-compose?</div>
	<p><a href="https://supabase.com/">Supabase</a>, The open-source Firebase alternative based on PostgreSQL.</p>
<p>Pigsty allow you to self-host <strong>supabase</strong> with existing managed HA postgres cluster, and launch the stateless part of supabase with docker-compose.</p>
<blockquote>
<p>Notice: Supabase is <a href="https://supabase.com/ga">GA</a> since 2024.04.15</p>
</blockquote>
<hr>
<h2 id="quick-start">Quick Start</h2>
<p>To run supabase with existing postgres instance, prepare the <a href="/docs/software/supabase/#database">database</a> with <a href="https://github.com/Vonng/pigsty/blob/main/conf/supa.yml"><code>supa.yml</code></a></p>
<p>then launch the <a href="/docs/software/supabase/#stateless-part">stateless part</a> with the <a href="https://github.com/Vonng/pigsty/blob/main/app/supabase/docker-compose.yml"><code>docker-compose</code></a> file:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#204a87">cd</span> app/supabase<span style="color:#000;font-weight:bold">;</span> make up    <span style="color:#8f5902;font-style:italic"># https://supabase.com/docs/guides/self-hosting/docker</span>
</span></span></code></pre></div><p>Then you can access the supabase studio dashboard via <code>http://&lt;admin_ip&gt;:8000</code> by default, the default dashboard username is <code>supabase</code> and password is <code>pigsty</code>.</p>
<p>You can also configure the <code>infra_portal</code> to expose the WebUI to the public through Nginx and SSL.</p>
<hr>
<h2 id="database">Database</h2>
<p>Supabase require certain PostgreSQL extensions, schemas, and roles to work, which can be pre-configured by Pigsty: <a href="https://github.com/Vonng/pigsty/blob/main/conf/supa.yml"><code>supa.yml</code></a>.</p>
<p>The following example will configure the default <code>pg-meta</code> cluster as underlying postgres for supabase:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># supabase example cluster: pg-meta, this cluster needs to be migrated with ~/pigsty/app/supabase/migration.sql :</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:bold">pg-meta</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">hosts</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span>{<span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">10.10.10.10</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span>{<span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">pg_seq: 1, pg_role</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">primary } }</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">vars</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">pg_cluster</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">pg-meta</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">pg_version</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#0000cf;font-weight:bold">15</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">pg_users</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#8f5902;font-style:italic"># supabase roles: anon, authenticated, dashboard_user</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span>- {<span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">name: anon           ,login</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">false</span><span style="color:#f8f8f8;text-decoration:underline"> </span>}<span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span>- {<span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">name: authenticated  ,login</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">false</span><span style="color:#f8f8f8;text-decoration:underline"> </span>}<span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span>- {<span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">name: dashboard_user ,login: false ,replication: true ,createdb: true ,createrole</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">true</span><span style="color:#f8f8f8;text-decoration:underline"> </span>}<span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span>- {<span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">name: service_role   ,login: false ,bypassrls</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">true</span><span style="color:#f8f8f8;text-decoration:underline"> </span>}<span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#8f5902;font-style:italic"># supabase users: please use the same password</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span>- {<span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">name: supabase_admin             ,password: &#39;DBUser.Supa&#39; ,pgbouncer: true ,inherit: true   ,superuser: true ,replication: true ,createdb: true ,createrole: true ,bypassrls</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">true</span><span style="color:#f8f8f8;text-decoration:underline"> </span>}<span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span>- {<span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">name: authenticator              ,password: &#39;DBUser.Supa&#39; ,pgbouncer: true ,inherit: false  ,roles</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000;font-weight:bold">[</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">authenticated ,anon ,service_role ] }</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span>- {<span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">name: supabase_auth_admin        ,password: &#39;DBUser.Supa&#39; ,pgbouncer: true ,inherit: false  ,createrole</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">true</span><span style="color:#f8f8f8;text-decoration:underline"> </span>}<span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span>- {<span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">name: supabase_storage_admin     ,password: &#39;DBUser.Supa&#39; ,pgbouncer: true ,inherit: false  ,createrole: true ,roles</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000;font-weight:bold">[</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">authenticated ,anon ,service_role ] }</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span>- {<span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">name: supabase_functions_admin   ,password: &#39;DBUser.Supa&#39; ,pgbouncer: true ,inherit: false  ,createrole</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">true</span><span style="color:#f8f8f8;text-decoration:underline"> </span>}<span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span>- {<span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">name: supabase_replication_admin ,password: &#39;DBUser.Supa&#39; ,replication</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">true</span><span style="color:#f8f8f8;text-decoration:underline"> </span>}<span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span>- {<span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">name: supabase_read_only_user    ,password: &#39;DBUser.Supa&#39; ,bypassrls: true ,roles</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000;font-weight:bold">[</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">pg_read_all_data ] }</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">pg_databases</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span>- {<span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">name: meta ,baseline: cmdb.sql ,comment: pigsty meta database ,schemas</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000;font-weight:bold">[</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">pigsty ]}</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#8f5902;font-style:italic"># the pigsty cmdb, optional</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span>- <span style="color:#204a87;font-weight:bold">name</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">supa</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">        </span><span style="color:#204a87;font-weight:bold">baseline: supa.sql    # the init-scripts</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">https://github.com/supabase/postgres/tree/develop/migrations/db/init-scripts</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">        </span><span style="color:#204a87;font-weight:bold">owner</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">supabase_admin</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">        </span><span style="color:#204a87;font-weight:bold">comment</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">supabase postgres database</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">        </span><span style="color:#204a87;font-weight:bold">schemas</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000;font-weight:bold">[</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">extensions ,auth ,realtime ,storage ,graphql_public ,supabase_functions ,_analytics ,_realtime ]</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">        </span><span style="color:#204a87;font-weight:bold">extensions</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">          </span>- {<span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">name: pgcrypto  ,schema: extensions  } # 1.3   </span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">cryptographic functions</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">          </span>- {<span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">name: pg_net    ,schema: extensions  } # 0.7.1 </span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">Async HTTP</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">          </span>- {<span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">name: pgjwt     ,schema: extensions  } # 0.2.0 </span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">JSON Web Token API for Postgresql</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">          </span>- {<span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">name: uuid-ossp ,schema: extensions  } # 1.1   </span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">generate universally unique identifiers (UUIDs)</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">          </span>- {<span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">name: pgsodium        }                # 3.1.8 </span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">pgsodium is a modern cryptography library for Postgres.</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">          </span>- {<span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">name: supabase_vault  }                # 0.2.8 </span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">Supabase Vault Extension</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">          </span>- {<span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">name: pg_graphql      }                # 1.3.0 : pg_graphql</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">GraphQL support</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">pg_hba_rules</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span>- {<span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">user: all ,db: supa ,addr: intra       ,auth: pwd ,title</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#39;allow supa database access from intranet&#39;</span>}<span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span>- {<span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">user: all ,db: supa ,addr: 172.0.0.0/8 ,auth: pwd ,title</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#39;allow supa database access from docker network&#39;</span>}<span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">pg_extensions</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">                                        </span><span style="color:#8f5902;font-style:italic"># required extensions</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span>- <span style="color:#000">pg_repack_${pg_version}* wal2json_${pg_version}* pgvector_${pg_version}* pg_cron_${pg_version}* pgsodium_${pg_version}*</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span>- <span style="color:#000">vault_${pg_version}* pg_graphql_${pg_version}* pgjwt_${pg_version}* pg_net_${pg_version}* pgsql-http_${pg_version}*</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">pg_libs</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#39;pg_net, pg_stat_statements, auto_explain&#39;</span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#8f5902;font-style:italic"># add pg_net to shared_preload_libraries</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span></code></pre></div><p>Beware that <code>baseline: supa.sql</code> parameter will use the <a href="https://github.com/Vonng/pigsty/blob/main/files/supa.sql"><code>files/supa.sql</code></a> as database baseline schema, which is gathered from <a href="https://github.com/supabase/postgres/tree/develop/migrations/db/init-scripts">here</a>.
You also have to run the migration script: <a href="migration.sqlc"><code>migration.sql</code></a> after the cluster provisioning, which is gathered from <a href="https://github.com/supabase/postgres/tree/develop/migrations/db/migrations">supabase/postgres/migrations/db/migrations</a> in chronological order and slightly modified to fit Pigsty.</p>
<p>You can check the latest migration files and add them to <a href="migration.sqlc"><code>migration.sql</code></a>, the current script is synced with <a href="https://github.com/supabase/postgres/blob/develop/migrations/db/migrations/20231013070755_grant_authenticator_to_supabase_storage_admin.sql">20231013070755</a>.
You can run migration on provisioned postgres cluster <code>pg-meta</code> with simple <code>psql</code> command:</p>
<blockquote>
<p>Known issue: &ldquo;ERROR:  unrecognized configuration parameter &ldquo;pgsodium.enable_event_trigger&rdquo;: <a href="https://github.com/Vonng/pigsty/issues/350">https://github.com/Vonng/pigsty/issues/350</a> , fix with:</p>
</blockquote>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>pg edit-config pg-meta --force -p pgsodium.enable_event_trigger<span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#39;off&#39;</span> <span style="color:#8f5902;font-style:italic"># setup pgsodium event trigger</span>
</span></span><span style="display:flex;"><span>psql <span style="color:#4e9a06">${</span><span style="color:#000">PGURL</span><span style="color:#4e9a06">}</span> -c <span style="color:#4e9a06">&#39;SHOW pgsodium.enable_event_trigger;&#39;</span>                <span style="color:#8f5902;font-style:italic"># should be off or false</span>
</span></span><span style="display:flex;"><span>pg restart pg-meta                                                    <span style="color:#8f5902;font-style:italic"># restart pg-meta to enable the new configuration</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># connection string</span>
</span></span><span style="display:flex;"><span><span style="color:#000">PGURL</span><span style="color:#ce5c00;font-weight:bold">=</span>postgres://supabase_admin:DBUser.Supa@10.10.10.10:5432/supa
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># check connectivity &amp; extensions</span>
</span></span><span style="display:flex;"><span>psql <span style="color:#4e9a06">${</span><span style="color:#000">PGURL</span><span style="color:#4e9a06">}</span> -c <span style="color:#4e9a06">&#39;\dx&#39;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># perform migration</span>
</span></span><span style="display:flex;"><span>psql <span style="color:#4e9a06">${</span><span style="color:#000">PGURL</span><span style="color:#4e9a06">}</span> -v <span style="color:#000">ON_ERROR_STOP</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#0000cf;font-weight:bold">1</span> --no-psqlrc -f ~/pigsty/app/supabase/migration.sql
</span></span></code></pre></div><p>The database is now ready for supabase!</p>
<p><strong>Optional</strong>: setup <code>pg_cron</code> extension</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># install pg_cron</span>
</span></span><span style="display:flex;"><span>pg edit-config pg-meta --force -p cron.database_name<span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#39;supa&#39;</span>           <span style="color:#8f5902;font-style:italic"># setup pg_cron database_name parameter</span>
</span></span><span style="display:flex;"><span>psql <span style="color:#4e9a06">${</span><span style="color:#000">PGURL</span><span style="color:#4e9a06">}</span> -c <span style="color:#4e9a06">&#39;SHOW cron.database_name;&#39;</span>                           <span style="color:#8f5902;font-style:italic"># should be the underlying database name for supabase</span>
</span></span><span style="display:flex;"><span>psql <span style="color:#4e9a06">${</span><span style="color:#000">PGURL</span><span style="color:#4e9a06">}</span> -c <span style="color:#4e9a06">&#39;CREATE EXTENSION pg_cron;&#39;</span><span style="color:#000;font-weight:bold">;</span>                         <span style="color:#8f5902;font-style:italic"># create pg_cron extension on the database &#39;supa&#39;</span>
</span></span></code></pre></div><hr>
<h2 id="stateless-part">Stateless Part</h2>
<p>Supabase stateless part is managed by <code>docker-compose</code>, the <a href="https://github.com/Vonng/pigsty/blob/main/app/supabase/docker-compose.yml"><code>docker-compose</code></a> file we use here is a simplified version of <a href="https://github.com/supabase/supabase/blob/master/docker/docker-compose.yml">github.com/supabase/docker/docker-compose.yml</a>.</p>
<p>Everything you need to care about is in the <a href=".env"><code>.env</code></a> file, which contains important settings for supabase. It is already configured to use the <code>pg-meta</code>.<code>supa</code> database by default, You have to change that according to your actual deployment.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic">############</span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># Secrets - YOU MUST CHANGE THESE BEFORE GOING INTO PRODUCTION</span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic">############</span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># you have to change the JWT_SECRET to a random string with at least 32 characters long</span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># and issue new ANON_KEY/SERVICE_ROLE_KEY JWT with that new secret, check the tutorial:</span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># https://supabase.com/docs/guides/self-hosting/docker#securing-your-services</span>
</span></span><span style="display:flex;"><span><span style="color:#000">JWT_SECRET</span><span style="color:#ce5c00;font-weight:bold">=</span>your-super-secret-jwt-token-with-at-least-32-characters-long
</span></span><span style="display:flex;"><span><span style="color:#000">ANON_KEY</span><span style="color:#ce5c00;font-weight:bold">=</span>eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyAgCiAgICAicm9sZSI6ICJhbm9uIiwKICAgICJpc3MiOiAic3VwYWJhc2UtZGVtbyIsCiAgICAiaWF0IjogMTY0MTc2OTIwMCwKICAgICJleHAiOiAxNzk5NTM1NjAwCn0.dc_X5iR_VP_qT0zsiyj_I_OZ2T9FtRU2BBNWN8Bu4GE
</span></span><span style="display:flex;"><span><span style="color:#000">SERVICE_ROLE_KEY</span><span style="color:#ce5c00;font-weight:bold">=</span>eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyAgCiAgICAicm9sZSI6ICJzZXJ2aWNlX3JvbGUiLAogICAgImlzcyI6ICJzdXBhYmFzZS1kZW1vIiwKICAgICJpYXQiOiAxNjQxNzY5MjAwLAogICAgImV4cCI6IDE3OTk1MzU2MDAKfQ.DaYlNEoUrrEn2Ig7tqibS-PHK5vgusbcbo7X36XVt4Q
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic">############</span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># Dashboard - Credentials for the Supabase Studio WebUI</span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic">############</span>
</span></span><span style="display:flex;"><span><span style="color:#000">DASHBOARD_USERNAME</span><span style="color:#ce5c00;font-weight:bold">=</span>supabase         <span style="color:#8f5902;font-style:italic"># change to your own username</span>
</span></span><span style="display:flex;"><span><span style="color:#000">DASHBOARD_PASSWORD</span><span style="color:#ce5c00;font-weight:bold">=</span>pigsty           <span style="color:#8f5902;font-style:italic"># change to your own password</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic">############</span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># Database - You can change these to any PostgreSQL database that has logical replication enabled.</span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic">############</span>
</span></span><span style="display:flex;"><span><span style="color:#000">POSTGRES_HOST</span><span style="color:#ce5c00;font-weight:bold">=</span>10.10.10.10           <span style="color:#8f5902;font-style:italic"># change to Pigsty managed PostgreSQL cluster/instance VIP/IP/Hostname</span>
</span></span><span style="display:flex;"><span><span style="color:#000">POSTGRES_PORT</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#0000cf;font-weight:bold">5432</span>                  <span style="color:#8f5902;font-style:italic"># you can use other service port such as 5433, 5436, 6432, etc...</span>
</span></span><span style="display:flex;"><span><span style="color:#000">POSTGRES_DB</span><span style="color:#ce5c00;font-weight:bold">=</span>supa                    <span style="color:#8f5902;font-style:italic"># change to supabase database name, `supa` by default in pigsty</span>
</span></span><span style="display:flex;"><span><span style="color:#000">POSTGRES_PASSWORD</span><span style="color:#ce5c00;font-weight:bold">=</span>DBUser.Supa       <span style="color:#8f5902;font-style:italic"># supabase dbsu password (shared by multiple supabase biz users)</span>
</span></span></code></pre></div><p>Usually you&rsquo;ll have to change these parameters accordingly. Here we&rsquo;ll use fixed username, password and IP:Port database connstr for simplicity.</p>
<p>The postgres username is fixed as <code>supabase_admin</code> and the password is <code>DBUser.Supa</code>, change that according to your <a href="https://github.com/Vonng/pigsty/blob/main/conf/supa.yml#L44"><code>supa.yml</code></a>
And the supabase studio WebUI credential is managed by <code>DASHBOARD_USERNAME</code> and <code>DASHBOARD_PASSWORD</code>, which is <code>supabase</code> and <code>pigsty</code> by default.</p>
<p>The official tutorial: <a href="https://supabase.com/docs/guides/self-hosting/docker">Self-Hosting with Docker</a> just have all the details you need.</p>
<blockquote>
<h3 id="hint">Hint</h3>
<p>You can use the <a href="/docs/concept/svc/">Primary Service</a> of that cluster through DNS/VIP and other service ports, or whatever access method you like.</p>
<p>You can also configure <code>supabase.storage</code> service to use the MinIO service managed by pigsty, too</p>
</blockquote>
<p>Once configured, you can launch the stateless part with <code>docker-compose</code> or <code>make up</code> shortcut:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#204a87">cd</span> ~/pigsty/app/supabase<span style="color:#000;font-weight:bold">;</span> make up    <span style="color:#8f5902;font-style:italic">#  = docker compose up</span>
</span></span></code></pre></div><hr>
<h2 id="expose-service">Expose Service</h2>
<p>The supabase studio dashboard is exposed on port <code>8000</code> by default, you can add this service to the <code>infra_portal</code> to expose it to the public through Nginx and SSL.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">infra_portal</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">                     </span><span style="color:#8f5902;font-style:italic"># domain names and upstream servers</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#8f5902;font-style:italic"># ...</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">supa         </span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span>{<span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">domain: supa.pigsty ,endpoint</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;10.10.10.10:8000&#34;</span><span style="color:#204a87;font-weight:bold">, websocket</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">true</span><span style="color:#f8f8f8;text-decoration:underline"> </span>}<span style="color:#f8f8f8;text-decoration:underline">
</span></span></span></code></pre></div><p>To expose the service, you can run the <code>infra.yml</code> playbook with the <code>nginx</code> tag:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>./infra.yml -t nginx
</span></span></code></pre></div><p>Make suare <code>supa.pigsty</code> or your own domain is resolvable to the <code>infra_portal</code> server, and you can access the supabase studio dashboard via <code>https://supa.pigsty</code>.</p>

</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-2e3fe03b4958e2681fa579e931fb2c22">4 - Kong: the Nginx API Gateway</h1>
    <div class="lead">Learn how to deploy Kong, the API gateway, with Docker Compose and use external PostgreSQL as the backend database</div>
	<p><img src="/img/docs/app/kong.jpeg"></p>
<h2 id="tldr">TL;DR</h2>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#204a87">cd</span> app/kong <span style="color:#000;font-weight:bold">;</span> docker-compose up -d
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>make up         <span style="color:#8f5902;font-style:italic"># pull up kong with docker-compose</span>
</span></span><span style="display:flex;"><span>make ui         <span style="color:#8f5902;font-style:italic"># run swagger ui container</span>
</span></span><span style="display:flex;"><span>make log        <span style="color:#8f5902;font-style:italic"># tail -f kong logs</span>
</span></span><span style="display:flex;"><span>make info       <span style="color:#8f5902;font-style:italic"># introspect kong with jq</span>
</span></span><span style="display:flex;"><span>make stop       <span style="color:#8f5902;font-style:italic"># stop kong container</span>
</span></span><span style="display:flex;"><span>make clean      <span style="color:#8f5902;font-style:italic"># remove kong container</span>
</span></span><span style="display:flex;"><span>make rmui       <span style="color:#8f5902;font-style:italic"># remove swagger ui container</span>
</span></span><span style="display:flex;"><span>make pull       <span style="color:#8f5902;font-style:italic"># pull latest kong image</span>
</span></span><span style="display:flex;"><span>make rmi        <span style="color:#8f5902;font-style:italic"># remove kong image</span>
</span></span><span style="display:flex;"><span>make save       <span style="color:#8f5902;font-style:italic"># save kong image to /tmp/kong.tgz</span>
</span></span><span style="display:flex;"><span>make load       <span style="color:#8f5902;font-style:italic"># load kong image from /tmp</span>
</span></span></code></pre></div><h2 id="scripts">Scripts</h2>
<ul>
<li>Default Port: 8000</li>
<li>Default SSL Port: 8443</li>
<li>Default Admin Port: 8001</li>
<li>Default Postgres Database: <code>postgres://dbuser_kong:DBUser.Kong@10.10.10.10:5432/kong</code></li>
</ul>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># postgres://dbuser_kong:DBUser.Kong@10.10.10.10:5432/kong</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span>- {<span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">name: kong, owner: dbuser_kong, revokeconn: true , comment</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">kong the api gateway database }</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span>- {<span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">name: dbuser_kong, password: DBUser.Kong , pgbouncer: true , roles</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000;font-weight:bold">[</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">dbrole_admin ] }</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span></code></pre></div>
</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-5d00b8779841da134b5b22fde61c99db">5 - Jupyter: AI Notebook &amp; IDE</h1>
    <div class="lead">Run Jupyter Lab in container, and access PostgreSQL database</div>
	<p>Run jupyter notebook with docker, you have to:</p>
<ul>
<li>
<ol>
<li>change the default password in <a href=".env"><code>.env</code></a>: <code>JUPYTER_TOKEN</code></li>
</ol>
</li>
<li>
<ol start="2">
<li>create data dir with proper permission: <code>make dir</code>, owned by <code>1000:100</code></li>
</ol>
</li>
<li>
<ol start="3">
<li><code>make up</code> to pull up jupyter with docker compose</li>
</ol>
</li>
</ul>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#204a87">cd</span> ~/pigsty/app/jupyter <span style="color:#000;font-weight:bold">;</span> make dir up
</span></span></code></pre></div><p>Visit <a href="http://lab.pigsty">http://lab.pigsty</a> or http://10.10.10.10:8888, the default password is <code>pigsty</code></p>
<ul>
<li><a href="http://lab.pigsty?token=pigsty"><code>http://lab.pigsty?token=pigsty</code></a></li>
</ul>
<h2 id="prepare">Prepare</h2>
<p>Create a data directory <code>/data/jupyter</code>, with the default uid &amp; gid <code>1000:100</code>:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>make dir   <span style="color:#8f5902;font-style:italic"># mkdir -p /data/jupyter; chown -R 1000:100 /data/jupyter</span>
</span></span></code></pre></div><h2 id="connect-to-postgres">Connect to Postgres</h2>
<p>Use the jupyter terminal to install <code>psycopg2-binary</code> &amp; <code>psycopg2</code> package.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>pip install psycopg2-binary psycopg2
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># install with a mirror</span>
</span></span><span style="display:flex;"><span>pip install -i https://pypi.tuna.tsinghua.edu.cn/simple psycopg2-binary psycopg2
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>pip install --upgrade pip
</span></span><span style="display:flex;"><span>pip config <span style="color:#204a87">set</span> global.index-url https://pypi.tuna.tsinghua.edu.cn/simple
</span></span></code></pre></div><p>Or installation with <code>conda</code>:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>conda config --add channels https://mirrors.tuna.tsinghua.edu.cn/anaconda/pkgs/free/
</span></span><span style="display:flex;"><span>conda config --add channels https://mirrors.tuna.tsinghua.edu.cn/anaconda/pkgs/main/
</span></span><span style="display:flex;"><span>conda config --add channels https://mirrors.tuna.tsinghua.edu.cn/anaconda/cloud/conda-forge/
</span></span></code></pre></div><p>then use the driver in your notebook</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">import</span> <span style="color:#000">psycopg2</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#000">conn</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">psycopg2</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">connect</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#39;postgres://dbuser_dba:DBUser.DBA@10.10.10.10:5432/meta&#39;</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span><span style="color:#000">cursor</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">conn</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">cursor</span><span style="color:#000;font-weight:bold">()</span>
</span></span><span style="display:flex;"><span><span style="color:#000">cursor</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">execute</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#39;SELECT * FROM pg_stat_activity&#39;</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">for</span> <span style="color:#000">i</span> <span style="color:#204a87;font-weight:bold">in</span> <span style="color:#000">cursor</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">fetchall</span><span style="color:#000;font-weight:bold">():</span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87">print</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">i</span><span style="color:#000;font-weight:bold">)</span>
</span></span></code></pre></div><h2 id="alias">Alias</h2>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>make up         <span style="color:#8f5902;font-style:italic"># pull up jupyter with docker compose</span>
</span></span><span style="display:flex;"><span>make dir        <span style="color:#8f5902;font-style:italic"># create required /data/jupyter and set owner</span>
</span></span><span style="display:flex;"><span>make run        <span style="color:#8f5902;font-style:italic"># launch jupyter with docker</span>
</span></span><span style="display:flex;"><span>make view       <span style="color:#8f5902;font-style:italic"># print jupyter access point</span>
</span></span><span style="display:flex;"><span>make log        <span style="color:#8f5902;font-style:italic"># tail -f jupyter logs</span>
</span></span><span style="display:flex;"><span>make info       <span style="color:#8f5902;font-style:italic"># introspect jupyter with jq</span>
</span></span><span style="display:flex;"><span>make stop       <span style="color:#8f5902;font-style:italic"># stop jupyter container</span>
</span></span><span style="display:flex;"><span>make clean      <span style="color:#8f5902;font-style:italic"># remove jupyter container</span>
</span></span><span style="display:flex;"><span>make pull       <span style="color:#8f5902;font-style:italic"># pull latest jupyter image</span>
</span></span><span style="display:flex;"><span>make rmi        <span style="color:#8f5902;font-style:italic"># remove jupyter image</span>
</span></span><span style="display:flex;"><span>make save       <span style="color:#8f5902;font-style:italic"># save jupyter image to /tmp/docker/jupyter.tgz</span>
</span></span><span style="display:flex;"><span>make load       <span style="color:#8f5902;font-style:italic"># load jupyter image from /tmp/docker/jupyter.tgz</span>
</span></span></code></pre></div>
</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-712570c64c1ea4a71b6a08b0dd16d98b">6 - Gitea: Simple Self-Hosting Git Service</h1>
    <div class="lead">Launch the self-hosting Git service with Gitea and Pigsty managed PostgreSQL</div>
	<p>Public Demo: <a href="http://git.pigsty.cc">http://git.pigsty.cc</a></p>
<p><img src="/img/docs/app/gitea.jpeg"></p>
<h2 id="tldr">TL;DR</h2>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#204a87">cd</span> ~/pigsty/app/gitea<span style="color:#000;font-weight:bold">;</span> make up
</span></span></code></pre></div><p>Pigsty use <code>8889</code> port for gitea by default</p>
<p><a href="http://git.pigsty">http://git.pigsty</a> or http://10.10.10.10:8889</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>make up      <span style="color:#8f5902;font-style:italic"># pull up gitea with docker-compose in minimal mode</span>
</span></span><span style="display:flex;"><span>make run     <span style="color:#8f5902;font-style:italic"># launch gitea with docker , local data dir and external PostgreSQL</span>
</span></span><span style="display:flex;"><span>make view    <span style="color:#8f5902;font-style:italic"># print gitea access point</span>
</span></span><span style="display:flex;"><span>make log     <span style="color:#8f5902;font-style:italic"># tail -f gitea logs</span>
</span></span><span style="display:flex;"><span>make info    <span style="color:#8f5902;font-style:italic"># introspect gitea with jq</span>
</span></span><span style="display:flex;"><span>make stop    <span style="color:#8f5902;font-style:italic"># stop gitea container</span>
</span></span><span style="display:flex;"><span>make clean   <span style="color:#8f5902;font-style:italic"># remove gitea container</span>
</span></span><span style="display:flex;"><span>make pull    <span style="color:#8f5902;font-style:italic"># pull latest gitea image</span>
</span></span><span style="display:flex;"><span>make rmi     <span style="color:#8f5902;font-style:italic"># remove gitea image</span>
</span></span><span style="display:flex;"><span>make save    <span style="color:#8f5902;font-style:italic"># save gitea image to /tmp/gitea.tgz</span>
</span></span><span style="display:flex;"><span>make load    <span style="color:#8f5902;font-style:italic"># load gitea image from /tmp</span>
</span></span></code></pre></div><h2 id="postgresql-preparation">PostgreSQL Preparation</h2>
<p>Gitea use built-in SQLite as default metadata storage, you can let Gitea use external PostgreSQL by setting connection string environment variable</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># postgres://dbuser_gitea:DBUser.gitea@10.10.10.10:5432/gitea</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:bold">db</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">   </span>{<span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">name: gitea, owner: dbuser_gitea, comment</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">gitea primary database }</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:bold">user</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span>{<span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">name: dbuser_gitea , password: DBUser.gitea, roles</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000;font-weight:bold">[</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">dbrole_admin ] }</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span></code></pre></div>
</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-1a5013ccb6314c00d1dbde17782c7234">7 - Wiki.js: OSS Wiki Software</h1>
    <div class="lead">How to self-hosting your own wikipedia with Wiki.js and use Pigsty managed PostgreSQL as the backend database</div>
	<p>Public Demo: <a href="http://wiki.pigsty.cc">http://wiki.pigsty.cc</a></p>
<p><img src="/img/docs/app/wiki.jpg"></p>
<h2 id="tl-dr">TL; DR</h2>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#204a87">cd</span> app/wiki <span style="color:#000;font-weight:bold">;</span> docker-compose up -d
</span></span></code></pre></div><h2 id="postgres-preparation">Postgres Preparation</h2>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># postgres://dbuser_wiki:DBUser.Wiki@10.10.10.10:5432/wiki</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span>- {<span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">name: wiki, owner: dbuser_wiki, revokeconn: true , comment</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">wiki the api gateway database }</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span>- {<span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">name: dbuser_wiki, password: DBUser.Wiki , pgbouncer: true , roles</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000;font-weight:bold">[</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">dbrole_admin ] }</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>bin/createuser pg-meta dbuser_wiki
</span></span><span style="display:flex;"><span>bin/createdb   pg-meta wiki
</span></span></code></pre></div><h2 id="configuration">Configuration</h2>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">version</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;3&#34;</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:bold">services</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">wiki</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">container_name</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">wiki</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">image</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">requarks/wiki:2</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">environment</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">DB_TYPE</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">postgres</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">DB_HOST</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#0000cf;font-weight:bold">10.10.10.10</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">DB_PORT</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#0000cf;font-weight:bold">5432</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">DB_USER</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">dbuser_wiki</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">DB_PASS</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">DBUser.Wiki</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">DB_NAME</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">wiki</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">restart</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">unless-stopped</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">ports</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span>- <span style="color:#4e9a06">&#34;9002:3000&#34;</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span></code></pre></div><h2 id="access">Access</h2>
<ul>
<li>Default Port for wiki: 9002</li>
</ul>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># add to nginx_upstream</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span>- {<span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">name: wiki  , domain: wiki.pigsty.cc , endpoint</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;127.0.0.1:9002&#34;</span><span style="color:#f8f8f8;text-decoration:underline">   </span>}<span style="color:#f8f8f8;text-decoration:underline">
</span></span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>./infra.yml -t nginx_config
</span></span><span style="display:flex;"><span>ansible all -b -a <span style="color:#4e9a06">&#39;nginx -s reload&#39;</span>
</span></span></code></pre></div>
</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-39d65c3b01d1bc14497afab7a5e3a53b">8 - Minio: OSS AWS S3 Alternative</h1>
    <div class="lead">Launch minio with docker for testing &amp; development</div>
	<p>Public Demo: <a href="http://sss.pigsty.cc">http://sss.pigsty.cc</a></p>
<p>Credential: <code>admin</code>  / <code>pigsty.minio</code></p>
<p><img src="/img/docs/app/minio.jpeg"></p>
<h2 id="tl-dr">TL; DR</h2>
<p>Launch minio (s3) service on 9000 &amp; 9001</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#204a87">cd</span> ~/pigsty/app/minio <span style="color:#000;font-weight:bold">;</span> docker-compose up -d
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>docker run -p 9000:9000 -p 9001:9001 <span style="color:#4e9a06">\
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06"></span>  -e <span style="color:#4e9a06">&#34;MINIO_ROOT_USER=admin&#34;</span> <span style="color:#4e9a06">\
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06"></span>  -e <span style="color:#4e9a06">&#34;MINIO_ROOT_PASSWORD=pigsty.minio&#34;</span> <span style="color:#4e9a06">\
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06"></span>  minio/minio server /data --console-address <span style="color:#4e9a06">&#34;:9001&#34;</span>
</span></span></code></pre></div><p>visit http://10.10.10.10:9000 with user <code>admin</code> and password <code>pigsty.minio</code></p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>make up         <span style="color:#8f5902;font-style:italic"># pull up minio with docker-compose</span>
</span></span><span style="display:flex;"><span>make run        <span style="color:#8f5902;font-style:italic"># launch minio with docker</span>
</span></span><span style="display:flex;"><span>make view       <span style="color:#8f5902;font-style:italic"># print minio access point</span>
</span></span><span style="display:flex;"><span>make log        <span style="color:#8f5902;font-style:italic"># tail -f minio logs</span>
</span></span><span style="display:flex;"><span>make info       <span style="color:#8f5902;font-style:italic"># introspect minio with jq</span>
</span></span><span style="display:flex;"><span>make stop       <span style="color:#8f5902;font-style:italic"># stop minio container</span>
</span></span><span style="display:flex;"><span>make clean      <span style="color:#8f5902;font-style:italic"># remove minio container</span>
</span></span><span style="display:flex;"><span>make pull       <span style="color:#8f5902;font-style:italic"># pull latest minio image</span>
</span></span><span style="display:flex;"><span>make rmi        <span style="color:#8f5902;font-style:italic"># remove minio image</span>
</span></span><span style="display:flex;"><span>make save       <span style="color:#8f5902;font-style:italic"># save minio image to /tmp/minio.tgz</span>
</span></span><span style="display:flex;"><span>make load       <span style="color:#8f5902;font-style:italic"># load minio image from /tmp</span>
</span></span></code></pre></div>
</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-28564e14d16e9a4152a3a74308aadc58">9 - ByteBase: PG Schema Migration</h1>
    <div class="lead">Self-hosting bytebase with PostgreSQL managed by Pigsty</div>
	<h2 id="bytebase">ByteBase</h2>
<p><a href="https://bytebase.com/">ByteBase</a> is a database schema change management tool, which is a tool for database schema changes. The following command will start a ByteBase on the meta node <code>8887</code> port by default.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>mkdir -p /data/bytebase/data<span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>docker run --init --name bytebase --restart always --detach --publish 8887:8887 --volume /data/bytebase/data:/var/opt/bytebase <span style="color:#4e9a06">\
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06"></span>    bytebase/bytebase:1.0.4 --data /var/opt/bytebase --host http://ddl.pigsty --port <span style="color:#0000cf;font-weight:bold">8887</span>
</span></span></code></pre></div><p>Then visit http://10.10.10.10:8887/ 或 <a href="http://ddl.pigsty/">http://ddl.pigsty</a> to access bytebase console. You have to &ldquo;Create Project&rdquo;, &ldquo;Env&rdquo;, &ldquo;Instance&rdquo;, &ldquo;Database&rdquo; to perform schema migration.</p>
<p>Public Demo: <a href="http://ddl.pigsty.cc">http://ddl.pigsty.cc</a></p>
<p>Default username &amp; password: <code>admin</code> / <code>pigsty</code></p>
<p><img src="/img/docs/app/bytebase.jpeg"></p>
<hr>
<h2 id="bytebase-overview">Bytebase Overview</h2>
<p>Schema Migrator for PostgreSQL</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#204a87">cd</span> app/bytebase<span style="color:#000;font-weight:bold">;</span> make up
</span></span></code></pre></div><p>Visit <a href="http://ddl.pigsty">http://ddl.pigsty</a> or http://10.10.10.10:8887</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>make up         <span style="color:#8f5902;font-style:italic"># pull up bytebase with docker-compose in minimal mode</span>
</span></span><span style="display:flex;"><span>make run        <span style="color:#8f5902;font-style:italic"># launch bytebase with docker , local data dir and external PostgreSQL</span>
</span></span><span style="display:flex;"><span>make view       <span style="color:#8f5902;font-style:italic"># print bytebase access point</span>
</span></span><span style="display:flex;"><span>make log        <span style="color:#8f5902;font-style:italic"># tail -f bytebase logs</span>
</span></span><span style="display:flex;"><span>make info       <span style="color:#8f5902;font-style:italic"># introspect bytebase with jq</span>
</span></span><span style="display:flex;"><span>make stop       <span style="color:#8f5902;font-style:italic"># stop bytebase container</span>
</span></span><span style="display:flex;"><span>make clean      <span style="color:#8f5902;font-style:italic"># remove bytebase container</span>
</span></span><span style="display:flex;"><span>make pull       <span style="color:#8f5902;font-style:italic"># pull latest bytebase image</span>
</span></span><span style="display:flex;"><span>make rmi        <span style="color:#8f5902;font-style:italic"># remove bytebase image</span>
</span></span><span style="display:flex;"><span>make save       <span style="color:#8f5902;font-style:italic"># save bytebase image to /tmp/bytebase.tgz</span>
</span></span><span style="display:flex;"><span>make load       <span style="color:#8f5902;font-style:italic"># load bytebase image from /tmp</span>
</span></span></code></pre></div><h2 id="postgresql-preparation">PostgreSQL Preparation</h2>
<p>Bytebase use its internal PostgreSQL database by default, You can use external PostgreSQL for higher durability.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># postgres://dbuser_bytebase:DBUser.Bytebase@10.10.10.10:5432/bytebase</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:bold">db</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">   </span>{<span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">name: bytebase, owner: dbuser_bytebase, comment</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">bytebase primary database }</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:bold">user</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span>{<span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">name: dbuser_bytebase , password: DBUser.Bytebase, roles</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000;font-weight:bold">[</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">dbrole_admin ] }</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span></code></pre></div><p>if you wish to user an external PostgreSQL, drop monitor extensions and views &amp; pg_repack</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>DROP SCHEMA monitor CASCADE<span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>DROP EXTENSION pg_repack<span style="color:#000;font-weight:bold">;</span>
</span></span></code></pre></div><p>After bytebase initialized, you can create them back with <code>/pg/tmp/pg-init-template.sql</code></p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>psql bytebase &lt; /pg/tmp/pg-init-template.sql
</span></span></code></pre></div>
</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-df59db962ac59a6b76913d3d9c08ddd3">10 - PGAdmin4: PG Admin GUI Tool</h1>
    <div class="lead">Launch pgAdmin4 with docker, and load Pigsty server list into it</div>
	<p>pgAdmin4 is a useful PostgreSQL management tool. Execute the following command to launch the pgadmin service on the admin node:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#204a87">cd</span> ~/pigsty/app/pgadmin <span style="color:#000;font-weight:bold">;</span> docker-compose up -d
</span></span></code></pre></div><p>The default port for pgadmin is <code>8885</code>, and you can access it through the following address:</p>
<p><a href="http://adm.pigsty">http://adm.pigsty</a></p>
<hr>
<h2 id="demo">Demo</h2>
<p>Public Demo: <a href="http://adm.pigsty.cc">http://adm.pigsty.cc</a></p>
<p>Credentials: <code>admin@pigsty.cc</code> / <code>pigsty</code></p>
<p><img src="/img/docs/app/pgadmin.jpeg"></p>
<h2 id="tl-dr">TL; DR</h2>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#204a87">cd</span> ~/pigsty/app/pgadmin   <span style="color:#8f5902;font-style:italic"># enter docker compose dir</span>
</span></span><span style="display:flex;"><span>make up                   <span style="color:#8f5902;font-style:italic"># launch pgadmin container</span>
</span></span><span style="display:flex;"><span>make conf view            <span style="color:#8f5902;font-style:italic"># load pigsty server list</span>
</span></span></code></pre></div><p>Shortcuts:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>make up         <span style="color:#8f5902;font-style:italic"># pull up pgadmin with docker-compose</span>
</span></span><span style="display:flex;"><span>make run        <span style="color:#8f5902;font-style:italic"># launch pgadmin with docker</span>
</span></span><span style="display:flex;"><span>make view       <span style="color:#8f5902;font-style:italic"># print pgadmin access point</span>
</span></span><span style="display:flex;"><span>make log        <span style="color:#8f5902;font-style:italic"># tail -f pgadmin logs</span>
</span></span><span style="display:flex;"><span>make info       <span style="color:#8f5902;font-style:italic"># introspect pgadmin with jq</span>
</span></span><span style="display:flex;"><span>make stop       <span style="color:#8f5902;font-style:italic"># stop pgadmin container</span>
</span></span><span style="display:flex;"><span>make clean      <span style="color:#8f5902;font-style:italic"># remove pgadmin container</span>
</span></span><span style="display:flex;"><span>make conf       <span style="color:#8f5902;font-style:italic"># provision pgadmin with pigsty pg servers list </span>
</span></span><span style="display:flex;"><span>make dump       <span style="color:#8f5902;font-style:italic"># dump servers.json from pgadmin container</span>
</span></span><span style="display:flex;"><span>make pull       <span style="color:#8f5902;font-style:italic"># pull latest pgadmin image</span>
</span></span><span style="display:flex;"><span>make rmi        <span style="color:#8f5902;font-style:italic"># remove pgadmin image</span>
</span></span><span style="display:flex;"><span>make save       <span style="color:#8f5902;font-style:italic"># save pgadmin image to /tmp/pgadmin.tgz</span>
</span></span><span style="display:flex;"><span>make load       <span style="color:#8f5902;font-style:italic"># load pgadmin image from /tmp</span>
</span></span></code></pre></div>
</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-e0991d41daeb1162d48a97bf676e105e">11 - PostgREST: Generate REST API from Schema</h1>
    <div class="lead">Launch postgREST to generate REST API from PostgreSQL schema automatically</div>
	<p><a href="https://postgrest.org/en/stable/index.html">PostgREST</a> is a binary component that automatically generates a REST API
based on the PostgreSQL database schema.</p>
<p>For example, the following command will launch postgrest with docker (local port 8884, using default admin user, and
expose Pigsty CMDB schema):</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>docker run --init --name postgrest --restart always --detach --publish 8884:8081 postgrest/postgrest
</span></span></code></pre></div><p>Visit <a href="http://10.10.10.10:8884/">http://10.10.10.10:8884</a> will show all auto-generated API definitions and automatically
expose API documentation using <a href="http://home.pigsty.cc:8883">Swagger Editor</a>.</p>
<p>If you wish to perform CRUD operations and design more fine-grained permission control, please refer
to <a href="https://postgrest.org/en/stable/tutorials/tut1.html">Tutorial 1 - The Golden Key</a> to generate a signed JWT.</p>
<p><img src="/img/docs/app/postgrest.jpeg"></p>
<p>This is an example of creating pigsty cmdb API with PostgREST</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#204a87">cd</span> ~/pigsty/app/postgrest <span style="color:#000;font-weight:bold">;</span> docker-compose up -d
</span></span></code></pre></div><p>http://10.10.10.10:8884 is the default endpoint for PostgREST</p>
<p>http://10.10.10.10:8883 is the default api docs for PostgREST</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>make up         <span style="color:#8f5902;font-style:italic"># pull up postgrest with docker-compose</span>
</span></span><span style="display:flex;"><span>make run        <span style="color:#8f5902;font-style:italic"># launch postgrest with docker</span>
</span></span><span style="display:flex;"><span>make ui         <span style="color:#8f5902;font-style:italic"># run swagger ui container</span>
</span></span><span style="display:flex;"><span>make view       <span style="color:#8f5902;font-style:italic"># print postgrest access point</span>
</span></span><span style="display:flex;"><span>make log        <span style="color:#8f5902;font-style:italic"># tail -f postgrest logs</span>
</span></span><span style="display:flex;"><span>make info       <span style="color:#8f5902;font-style:italic"># introspect postgrest with jq</span>
</span></span><span style="display:flex;"><span>make stop       <span style="color:#8f5902;font-style:italic"># stop postgrest container</span>
</span></span><span style="display:flex;"><span>make clean      <span style="color:#8f5902;font-style:italic"># remove postgrest container</span>
</span></span><span style="display:flex;"><span>make rmui       <span style="color:#8f5902;font-style:italic"># remove swagger ui container</span>
</span></span><span style="display:flex;"><span>make pull       <span style="color:#8f5902;font-style:italic"># pull latest postgrest image</span>
</span></span><span style="display:flex;"><span>make rmi        <span style="color:#8f5902;font-style:italic"># remove postgrest image</span>
</span></span><span style="display:flex;"><span>make save       <span style="color:#8f5902;font-style:italic"># save postgrest image to /tmp/postgrest.tgz</span>
</span></span><span style="display:flex;"><span>make load       <span style="color:#8f5902;font-style:italic"># load postgrest image from /tmp</span>
</span></span></code></pre></div><h2 id="swagger-ui">Swagger UI</h2>
<p>Launch a swagger OpenAPI UI and visualize PostgREST API on 8883 with:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>docker run --init --name postgrest --name swagger -p 8883:8080 -e <span style="color:#000">API_URL</span><span style="color:#ce5c00;font-weight:bold">=</span>http://10.10.10.10:8884 swaggerapi/swagger-ui
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># docker run -d -e API_URL=http://10.10.10.10:8884 -p 8883:8080 swaggerapi/swagger-editor # swagger editor</span>
</span></span></code></pre></div><p>Check <a href="http://10.10.10.10:8883/">http://10.10.10.10:8883/</a></p>

</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-9ec15a0d01cd5abc36fd6af1f45a0595">12 - SchemaSPY: Dump &amp; Visualize PG Schema</h1>
    <div class="lead">Dump &amp; visualize PostgreSQL schema with SchemaSPY</div>
	<p>Use the following <code>docker</code> command to generate a database schema report, using CMDB as an example:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>docker run -v /www/schema/pg-meta/meta/pigsty:/output andrewjones/schemaspy-postgres:latest -host 10.10.10.10 -port <span style="color:#0000cf;font-weight:bold">5432</span> -u dbuser_dba -p DBUser.DBA -db meta -s pigsty
</span></span></code></pre></div><p>Then visit <a href="http://h.pigsty/schema/pg-meta/meta/pigsty">http://h.pigsty/schema/pg-meta/meta/pigsty</a> to access the schema report.</p>

</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-04017d0d30f9f51be2b31a34c8bdf117">13 - PGWeb: Browser-based PG Client</h1>
    <div class="lead">Launch pgweb to access PostgreSQL via web browser</div>
	<p>PGWEB: <a href="https://github.com/sosedoff/pgweb">https://github.com/sosedoff/pgweb</a></p>
<p>Simple web-based and cross-platform PostgreSQL database explorer.</p>
<p>Public Demo: <a href="http://cli.pigsty.cc">http://cli.pigsty.cc</a></p>
<p><img src="/img/docs/app/pgweb.jpeg"></p>
<h2 id="tl-dr">TL; DR</h2>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#204a87">cd</span> ~/pigsty/app/pgweb <span style="color:#000;font-weight:bold">;</span> make up
</span></span></code></pre></div><p>Visit <a href="http://cli.pigsty">http://cli.pigsty</a> or http://10.10.10.10:8886</p>
<p>Try connecting with example URLs:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>postgres://dbuser_meta:DBUser.Meta@10.10.10.10:5432/meta?sslmode<span style="color:#ce5c00;font-weight:bold">=</span>disable
</span></span><span style="display:flex;"><span>postgres://test:test@10.10.10.11:5432/test?sslmode<span style="color:#ce5c00;font-weight:bold">=</span>disable
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>make up         <span style="color:#8f5902;font-style:italic"># pull up pgweb with docker compose</span>
</span></span><span style="display:flex;"><span>make run        <span style="color:#8f5902;font-style:italic"># launch pgweb with docker</span>
</span></span><span style="display:flex;"><span>make view       <span style="color:#8f5902;font-style:italic"># print pgweb access point</span>
</span></span><span style="display:flex;"><span>make log        <span style="color:#8f5902;font-style:italic"># tail -f pgweb logs</span>
</span></span><span style="display:flex;"><span>make info       <span style="color:#8f5902;font-style:italic"># introspect pgweb with jq</span>
</span></span><span style="display:flex;"><span>make stop       <span style="color:#8f5902;font-style:italic"># stop pgweb container</span>
</span></span><span style="display:flex;"><span>make clean      <span style="color:#8f5902;font-style:italic"># remove pgweb container</span>
</span></span><span style="display:flex;"><span>make pull       <span style="color:#8f5902;font-style:italic"># pull latest pgweb image</span>
</span></span><span style="display:flex;"><span>make rmi        <span style="color:#8f5902;font-style:italic"># remove pgweb image</span>
</span></span><span style="display:flex;"><span>make save       <span style="color:#8f5902;font-style:italic"># save pgweb image to /tmp/docker/pgweb.tgz</span>
</span></span><span style="display:flex;"><span>make load       <span style="color:#8f5902;font-style:italic"># load pgweb image from /tmp/docker/pgweb.tgz</span>
</span></span></code></pre></div><h2 id="快捷方式">快捷方式</h2>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>make up         <span style="color:#8f5902;font-style:italic"># pull up pgweb with docker-compose</span>
</span></span><span style="display:flex;"><span>make run        <span style="color:#8f5902;font-style:italic"># launch pgweb with docker</span>
</span></span><span style="display:flex;"><span>make view       <span style="color:#8f5902;font-style:italic"># print pgweb access point</span>
</span></span><span style="display:flex;"><span>make log        <span style="color:#8f5902;font-style:italic"># tail -f pgweb logs</span>
</span></span><span style="display:flex;"><span>make info       <span style="color:#8f5902;font-style:italic"># introspect pgweb with jq</span>
</span></span><span style="display:flex;"><span>make stop       <span style="color:#8f5902;font-style:italic"># stop pgweb container</span>
</span></span><span style="display:flex;"><span>make clean      <span style="color:#8f5902;font-style:italic"># remove pgweb container</span>
</span></span><span style="display:flex;"><span>make pull       <span style="color:#8f5902;font-style:italic"># pull latest pgweb image</span>
</span></span><span style="display:flex;"><span>make rmi        <span style="color:#8f5902;font-style:italic"># remove pgweb image</span>
</span></span><span style="display:flex;"><span>make save       <span style="color:#8f5902;font-style:italic"># save pgweb image to /tmp/pgweb.tgz</span>
</span></span><span style="display:flex;"><span>make load       <span style="color:#8f5902;font-style:italic"># load pgweb image from /tmp</span>
</span></span></code></pre></div>
</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-57ab357de3ec0981b36e0aeb8ae7d50b">14 - Discourse: OSS Forum Software</h1>
    <div class="lead">How to self-hosting open source forum software &ndash; Discourse, and use external PG managed by Pigsty</div>
	<p>To setup an open-source forum Discourse, you need to adjust the default <code>app.yml</code> config, focusing on the SMTP part of the configuration.</p>
<details><summary>Discourse Config Example</summary>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">templates</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span>- <span style="color:#4e9a06">&#34;templates/web.china.template.yml&#34;</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span>- <span style="color:#4e9a06">&#34;templates/postgres.template.yml&#34;</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span>- <span style="color:#4e9a06">&#34;templates/redis.template.yml&#34;</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span>- <span style="color:#4e9a06">&#34;templates/web.template.yml&#34;</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span>- <span style="color:#4e9a06">&#34;templates/web.ratelimited.template.yml&#34;</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#8f5902;font-style:italic">## Uncomment these two lines if you wish to add Lets Encrypt (https)</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#8f5902;font-style:italic"># - &#34;templates/web.ssl.template.yml&#34;</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#8f5902;font-style:italic"># - &#34;templates/web.letsencrypt.ssl.template.yml&#34;</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:bold">expose</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span>- <span style="color:#4e9a06">&#34;80:80&#34;</span><span style="color:#f8f8f8;text-decoration:underline">   </span><span style="color:#8f5902;font-style:italic"># http</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span>- <span style="color:#4e9a06">&#34;443:443&#34;</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#8f5902;font-style:italic"># https</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:bold">params</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">db_default_text_search_config</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;pg_catalog.english&#34;</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">db_shared_buffers</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;768MB&#34;</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:bold">env</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">LC_ALL</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">en_US.UTF-8</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">LANG</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">en_US.UTF-8</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">LANGUAGE</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">en_US.UTF-8</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">EMBER_CLI_PROD_ASSETS</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#0000cf;font-weight:bold">1</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">UNICORN_WORKERS</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#0000cf;font-weight:bold">4</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">DISCOURSE_HOSTNAME</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">forum.pigsty</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">DISCOURSE_DEVELOPER_EMAILS</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#39;fengruohang@outlook.com,rh@vonng.com&#39;</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">DISCOURSE_SMTP_ENABLE_START_TLS</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">false</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">DISCOURSE_SMTP_AUTHENTICATION</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">login</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">DISCOURSE_SMTP_OPENSSL_VERIFY_MODE</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">none</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">DISCOURSE_SMTP_ADDRESS</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">smtpdm.server.address</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">DISCOURSE_SMTP_PORT</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#0000cf;font-weight:bold">80</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">DISCOURSE_SMTP_USER_NAME</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">no_reply@mail.pigsty.cc</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">DISCOURSE_SMTP_PASSWORD</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;&lt;password&gt;&#34;</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">DISCOURSE_SMTP_DOMAIN</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">mail.pigsty.cc</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:bold">volumes</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span>- <span style="color:#204a87;font-weight:bold">volume</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">host</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">/var/discourse/shared/standalone</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">guest</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">/shared</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span>- <span style="color:#204a87;font-weight:bold">volume</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">host</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">/var/discourse/shared/standalone/log/var-log</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">guest</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">/var/log</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:bold">hooks</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">after_code</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span>- <span style="color:#204a87;font-weight:bold">exec</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">        </span><span style="color:#204a87;font-weight:bold">cd</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">$home/plugins</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">        </span><span style="color:#204a87;font-weight:bold">cmd</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">          </span>- <span style="color:#000">git clone https://github.com/discourse/docker_manager.git</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:bold">run</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span>- <span style="color:#204a87;font-weight:bold">exec</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">echo &#34;Beginning of custom commands&#34;</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#8f5902;font-style:italic"># - exec: rails r &#34;SiteSetting.notification_email=&#39;no_reply@mail.pigsty.cc&#39;&#34;</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span>- <span style="color:#204a87;font-weight:bold">exec</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">echo &#34;End of custom commands&#34;</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span></code></pre></div></details>
<p>Then launch Discourse with the following command:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>./launcher rebuild app
</span></span></code></pre></div>
</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-1040742b787f34bbaa39a7a8145b00c4">15 - GitLab: OSS GitHub Alternative</h1>
    <div class="lead">How to self-hosting GitLab, and use external HA PostgreSQL cluster?</div>
	<p>Check <a href="https://docs.gitlab.com/ee/install/docker.html">Gitlab Docker Deployment</a> to finish docker deployment.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#204a87">export</span> <span style="color:#000">GITLAB_HOME</span><span style="color:#ce5c00;font-weight:bold">=</span>/data/gitlab
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>sudo docker run --detach <span style="color:#4e9a06">\
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06"></span>  --hostname gitlab.example.com <span style="color:#4e9a06">\
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06"></span>  --publish 443:443 --publish 80:80 --publish 23:22 <span style="color:#4e9a06">\
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06"></span>  --name gitlab <span style="color:#4e9a06">\
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06"></span>  --restart always <span style="color:#4e9a06">\
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06"></span>  --volume <span style="color:#000">$GITLAB_HOME</span>/config:/etc/gitlab <span style="color:#4e9a06">\
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06"></span>  --volume <span style="color:#000">$GITLAB_HOME</span>/logs:/var/log/gitlab <span style="color:#4e9a06">\
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06"></span>  --volume <span style="color:#000">$GITLAB_HOME</span>/data:/var/opt/gitlab <span style="color:#4e9a06">\
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06"></span>  --shm-size 256m <span style="color:#4e9a06">\
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06"></span>  gitlab/gitlab-ee:latest
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>sudo docker <span style="color:#204a87">exec</span> -it gitlab grep <span style="color:#4e9a06">&#39;Password:&#39;</span> /etc/gitlab/initial_root_password
</span></span></code></pre></div><p>Then change the connection string to the Pigsty managed PostgreSQL clusters.</p>

</div>



    
	
  



          </main>
        </div>
      </div>
      <footer class="td-footer row d-print-none">
  <div class="container-fluid">
    <div class="row mx-md-2">
      <div class="td-footer__left col-6 col-sm-4 order-sm-1">
        <ul class="td-footer__links-list">
  
  <li class="td-footer__links-item" data-bs-toggle="tooltip" title="Mail" aria-label="Mail">
    <a target="_blank" rel="noopener" href="mailto:rh@vonng.com" aria-label="Mail">
      <i class="fa fa-envelope"></i>
    </a>
  </li>
  
  <li class="td-footer__links-item" data-bs-toggle="tooltip" title="GitHub" aria-label="GitHub">
    <a target="_blank" rel="noopener" href="https://github.com/Vonng/pigsty" aria-label="GitHub">
      <i class="fab fa-github"></i>
    </a>
  </li>
  
  <li class="td-footer__links-item" data-bs-toggle="tooltip" title="Twitter" aria-label="Twitter">
    <a target="_blank" rel="noopener" href="https://twitter.com/GobeUncleWang" aria-label="Twitter">
      <i class="fab fa-twitter"></i>
    </a>
  </li>
  
</ul>

      </div><div class="td-footer__right col-6 col-sm-4 order-sm-3">
        <ul class="td-footer__links-list">
  
  <li class="td-footer__links-item" data-bs-toggle="tooltip" title="WeChat" aria-label="WeChat">
    <a target="_blank" rel="noopener" href="/img/pigsty/pigsty-cc.jpg" aria-label="WeChat">
      <i class="fa fa-comment"></i>
    </a>
  </li>
  
  <li class="td-footer__links-item" data-bs-toggle="tooltip" title="Discord" aria-label="Discord">
    <a target="_blank" rel="noopener" href="https://discord.gg/wDzt5VyWEz" aria-label="Discord">
      <i class="fab fa-discord"></i>
    </a>
  </li>
  
  <li class="td-footer__links-item" data-bs-toggle="tooltip" title="Telegram" aria-label="Telegram">
    <a target="_blank" rel="noopener" href="https://t.me/joinchat/gV9zfZraNPM3YjFh" aria-label="Telegram">
      <i class="fab fa-telegram"></i>
    </a>
  </li>
  
</ul>

      </div><div class="td-footer__center col-12 col-sm-4 py-2 order-sm-2">
        <span class="td-footer__copyright">&copy;
    2018&ndash;2025
    <span class="td-footer__authors">Ruohang Feng</span></span><span class="td-footer__all_rights_reserved">All Rights Reserved</span></span><span class="ms-2"><a href="https://vonng.com/en/" target="_blank" rel="noopener">@Vonng</a></span>
<br><span>Pigsty® distributed under <a href="/docs/about/license" target="_blank" rel="noopener">AGPLv3</a></span>
<br><span class="ms-2"><a href="/docs/about/privacy" target="_blank" rel="noopener">Privacy Policy</a></span>
<span><a href="http://beian.miit.gov.cn/" target="_blank" rel="noopener">浙ICP备15016890号</a></span>
      </div>
    </div>
  </div>
</footer>

    </div>
    <script src="/js/main.min.248655eb216150e39da254c2f7aa5357805d0ec66bdb741b591cd35fb5f629ab.js" integrity="sha256-JIZV6yFhUOOdolTC96pTV4BdDsZr23QbWRzTX7X2Kas=" crossorigin="anonymous"></script>
<script defer src="/js/click-to-copy.min.f724d3de49218995223b7316aa2e53e2b34bf42026bf399ebb21bb02212402d1.js" integrity="sha256-9yTT3kkhiZUiO3MWqi5T4rNL9CAmvzmeuyG7AiEkAtE=" crossorigin="anonymous"></script>
<script src='/js/tabpane-persist.js'></script>

  </body>
</html>
